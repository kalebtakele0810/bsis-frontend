Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(a){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;d>f;f++)if(b=c[f],a.call(e,b,f,c))return b;return void 0}});var app=angular.module("bsis",["ngRoute","angular-loading-bar","ui.bootstrap","ngResource","ngTable","xeditable","ui.select","ngSanitize","checklist-model","ngMessages","ui.grid","ui.grid.exporter","ui.grid.pagination","ui.grid.selection","gettext"]).config(["$routeProvider","PERMISSIONS","UI",function(a,b,c){a.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl",permission:b.AUTHENTICATED}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/forgotPassword",{templateUrl:"views/forgotPassword.html",controller:"ForgotPasswordCtrl"}).when("/passwordReset",{templateUrl:"views/passwordReset.html",controller:"PasswordResetCtrl"}).when("/logout",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",permission:b.AUTHENTICATED}).when("/donors",{redirectTo:"/findDonor",permission:b.VIEW_DONOR_INFORMATION,enabled:c.DONORS_TAB_ENABLED}).when("/findDonor",{templateUrl:"views/donors/findDonor.html",controller:"FindDonorsCtrl",permission:b.VIEW_DONOR,enabled:c.DONORS_TAB_ENABLED,reloadOnSearch:!1}).when("/addDonor",{templateUrl:"views/donors/addDonor.html",controller:"AddDonorCtrl",permission:b.ADD_DONOR,enabled:c.DONORS_TAB_ENABLED}).when("/duplicateDonors",{templateUrl:"views/donors/duplicateDonors.html",controller:"DonorsDuplicateCtrl",permission:b.VIEW_DUPLICATE_DONORS,enabled:c.DONORS_TAB_ENABLED}).when("/manageDuplicateDonors",{templateUrl:"views/donors/manageDuplicateDonors.html",controller:"ManageDonorsDuplicateCtrl",permission:b.MERGE_DONORS,enabled:c.DONORS_TAB_ENABLED}).when("/manageClinic/:id?",{templateUrl:"views/donors/manageClinic.html",controller:"ViewDonationBatchCtrl",permission:b.VIEW_DONATION_BATCH,enabled:c.DONORS_TAB_ENABLED}).when("/exportDonorList",{templateUrl:"views/donors/donorCommunications.html",controller:"DonorCommunicationsCtrl",permission:b.EXPORT_CLINIC_DATA,enabled:c.DONORS_TAB_ENABLED,reloadOnSearch:!1}).when("/viewDonor/:id?",{templateUrl:"views/donors/viewDonor.html",controller:"ViewDonorCtrl",permission:b.VIEW_DONOR,enabled:c.DONORS_TAB_ENABLED}).when("/manageDonationBatches",{templateUrl:"views/donors/manageDonationBatches.html",controller:"ManageDonationBatchesCtrl",permission:b.VIEW_DONATION_BATCH,enabled:c.DONORS_TAB_ENABLED}).when("/donorCounselling",{templateUrl:"views/donors/donorCounselling.html",controller:"DonorCounsellingCtrl",permission:b.VIEW_POST_DONATION_COUNSELLING_DONORS,reloadOnSearch:!1}).when("/donorCounselling/:donorId",{templateUrl:"views/donors/donorCounsellingDetails.html",controller:"DonorCounsellingDetailsCtrl",permission:b.VIEW_POST_DONATION_COUNSELLING}).when("/components",{redirectTo:"/addComponentBatch",permission:b.VIEW_COMPONENT_INFORMATION,enabled:c.COMPONENTS_TAB_ENABLED}).when("/addComponentBatch",{templateUrl:"views/components/addComponentBatch.html",controller:"AddComponentBatchCtrl",permission:b.ADD_COMPONENT_BATCH,enabled:c.COMPONENTS_TAB_ENABLED,reloadOnSearch:!1}).when("/viewComponentBatches",{templateUrl:"views/components/viewComponentBatches.html",controller:"ViewComponentBatchesCtrl",permission:b.VIEW_COMPONENT_BATCH,enabled:c.COMPONENTS_TAB_ENABLED,reloadOnSearch:!1}).when("/recordComponents",{templateUrl:"views/components/recordComponents.html",controller:"RecordComponentsCtrl",permission:b.ADD_COMPONENT,enabled:c.COMPONENTS_TAB_ENABLED,reloadOnSearch:!1}).when("/findComponents",{templateUrl:"views/components/findComponents.html",controller:"FindComponentsCtrl",permission:b.VIEW_COMPONENT,enabled:c.COMPONENTS_TAB_ENABLED,reloadOnSearch:!1}).when("/discardComponents",{templateUrl:"views/components/discardComponents.html",controller:"DiscardComponentsCtrl",permission:b.DISCARD_COMPONENT,enabled:c.COMPONENTS_TAB_ENABLED,reloadOnSearch:!1}).when("/findDiscards",{templateUrl:"views/components/findDiscards.html",controller:"FindDiscardsCtrl",permission:b.VIEW_DISCARDS,enabled:c.COMPONENTS_TAB_ENABLED,reloadOnSearch:!1}).when("/viewComponentBatch/:id",{templateUrl:"views/components/viewComponentBatch.html",controller:"ViewComponentBatchCtrl",permission:b.VIEW_COMPONENT_BATCH,enabled:c.COMPONENTS_TAB_ENABLED}).when("/testing",{redirectTo:"/manageTestBatches",permission:b.VIEW_TESTING_INFORMATION,enabled:c.TESTING_TAB_ENABLED}).when("/findTestSamples",{templateUrl:"views/testing/findTestSamples.html",controller:"FindTestSamplesCtrl",permission:b.VIEW_TEST_OUTCOME,enabled:c.TESTING_TAB_ENABLED}).when("/viewTestSample",{templateUrl:"views/testing/viewTestSample.html",controller:"ViewTestSampleCtrl",permission:b.VIEW_TEST_OUTCOME,enabled:c.TESTING_TAB_ENABLED,reloadOnSearch:!1}).when("/manageTestBatches",{templateUrl:"views/testing/manageTestBatches.html",controller:"ManageTestBatchesCtrl",permission:b.VIEW_TEST_BATCH,enabled:c.TESTING_TAB_ENABLED}).when("/manageTestBatch/:id?",{templateUrl:"views/testing/manageTestBatch.html",controller:"ManageTestBatchCtrl",permission:b.VIEW_TEST_BATCH,enabled:c.TESTING_TAB_ENABLED}).when("/recordTTIOutcomes/:id/:bloodTestType",{templateUrl:"views/testing/recordTTIOutcomes.html",controller:"RecordTestOutcomesCtrl",permission:b.ADD_TTI_OUTCOME,enabled:c.TESTING_TAB_ENABLED}).when("/reenterTTIOutcomes/:id/:bloodTestType",{templateUrl:"views/testing/reenterTTIOutcomes.html",controller:"ReenterTestOutcomesCtrl",permission:b.ADD_TTI_OUTCOME,enabled:c.TESTING_TAB_ENABLED}).when("/reenterABORhOutcomes/:id/:bloodTestType",{templateUrl:"views/testing/reenterABORhOutcomes.html",controller:"ReenterTestOutcomesCtrl",permission:b.ADD_BLOOD_TYPING_OUTCOME,enabled:c.TESTING_TAB_ENABLED}).when("/recordRepeatTTIOutcomes/:id/:bloodTestType",{templateUrl:"views/testing/recordRepeatTTIOutcomes.html",controller:"RecordTestOutcomesCtrl",permission:b.ADD_TTI_OUTCOME,enabled:c.TESTING_TAB_ENABLED}).when("/recordABORhOutcomes/:id/:bloodTestType",{templateUrl:"views/testing/recordABORhOutcomes.html",controller:"RecordTestOutcomesCtrl",permission:b.ADD_BLOOD_TYPING_OUTCOME,enabled:c.TESTING_TAB_ENABLED}).when("/resolveAmbiguousABORhOutcomes/:id",{templateUrl:"views/testing/resolveAmbiguousABORhOutcomes.html",controller:"ResolveAmbiguousABORhOutcomesCtrl",permission:b.ADD_BLOOD_TYPING_OUTCOME,enabled:c.TESTING_TAB_ENABLED}).when("/recordRepeatABORhOutcomes/:id/:bloodTestType",{templateUrl:"views/testing/recordRepeatABORhOutcomes.html",controller:"RecordTestOutcomesCtrl",permission:b.ADD_BLOOD_TYPING_OUTCOME,enabled:c.TESTING_TAB_ENABLED}).when("/inventory",{redirectTo:"/findInventory",permission:b.VIEW_INVENTORY_INFORMATION,enabled:c.INVENTORY_TAB_ENABLED}).when("/findInventory",{templateUrl:"views/inventory/findInventory.html",controller:"FindInventoryCtrl",permission:b.VIEW_INVENTORY_INFORMATION,enabled:c.INVENTORY_TAB_ENABLED}).when("/viewStockLevels",{templateUrl:"views/inventory/viewStockLevels.html",controller:"ViewStockLevelsCtrl",permission:b.VIEW_INVENTORY_INFORMATION,enabled:c.INVENTORY_TAB_ENABLED}).when("/manageOrders",{templateUrl:"views/inventory/manageOrders.html",controller:"ManageOrdersCtrl",permission:b.ISSUE_COMPONENT,enabled:c.INVENTORY_TAB_ENABLED}).when("/fulfilOrder/:id",{templateUrl:"views/inventory/fulfilOrder.html",controller:"FulfilOrderCtrl",permission:b.ISSUE_COMPONENT,enabled:c.INVENTORY_TAB_ENABLED}).when("/viewOrder/:id",{templateUrl:"views/inventory/viewOrder.html",controller:"ViewOrderCtrl",permission:b.VIEW_ORDER_FORM,enabled:c.INVENTORY_TAB_ENABLED}).when("/viewOrders",{templateUrl:"views/inventory/viewOrders.html",controller:"ViewOrdersCtrl",permission:b.VIEW_ORDER_FORM,enabled:c.INVENTORY_TAB_ENABLED}).when("/manageReturns",{templateUrl:"views/inventory/manageReturns.html",controller:"ManageReturnsCtrl",permission:b.ISSUE_COMPONENT,enabled:c.INVENTORY_TAB_ENABLED}).when("/recordReturn/:id",{templateUrl:"views/inventory/recordReturn.html",controller:"RecordReturnCtrl",permission:b.ISSUE_COMPONENT,enabled:c.INVENTORY_TAB_ENABLED}).when("/viewReturn/:id",{templateUrl:"views/inventory/viewReturn.html",controller:"ViewReturnCtrl",permission:b.ISSUE_COMPONENT,enabled:c.INVENTORY_TAB_ENABLED}).when("/viewReturns",{templateUrl:"views/inventory/viewReturns.html",controller:"ViewReturnsCtrl",permission:b.VIEW_INVENTORY_INFORMATION,enabled:c.INVENTORY_TAB_ENABLED}).when("/recordTransfusions/:id?",{templateUrl:"views/inventory/recordTransfusions.html",controller:"RecordTransfusionsCtrl",permission:b.ADD_TRANSFUSION_DATA,enabled:c.INVENTORY_TAB_ENABLED}).when("/findTransfusion",{templateUrl:"views/inventory/findTransfusion.html",controller:"FindTransfusionCtrl",permission:b.VIEW_TRANSFUSION_DATA,enabled:c.INVENTORY_TAB_ENABLED}).when("/labelling",{redirectTo:"/findSafeComponents",permission:b.COMPONENT_LABELLING,enabled:c.LABELLING_TAB_ENABLED}).when("/labelComponents",{templateUrl:"views/labelling/labelComponents.html",controller:"LabelComponentsCtrl",permission:b.COMPONENT_LABELLING,enabled:c.LABELLING_TAB_ENABLED,reloadOnSearch:!1}).when("/findSafeComponents",{templateUrl:"views/labelling/findSafeComponents.html",controller:"FindSafeComponentsCtrl",permission:b.COMPONENT_LABELLING,enabled:c.LABELLING_TAB_ENABLED,reloadOnSearch:!1}).when("/reports",{redirectTo:"/aboRhGroupsReport",permission:b.VIEW_REPORTING_INFORMATION,enabled:c.REPORTS_TAB_ENABLED}).when("/aboRhGroupsReport",{templateUrl:"views/reports/aboRhGroupsReport.html",controller:"AboRhGroupsReportCtrl",permission:b.DONATIONS_REPORTING,enabled:c.REPORTS_TAB_ENABLED,reloadOnSearch:!1}).when("/donationTypesReport",{templateUrl:"views/reports/donationTypesReport.html",controller:"DonationTypesReportCtrl",permission:b.DONATIONS_REPORTING,enabled:c.REPORTS_TAB_ENABLED,reloadOnSearch:!1}).when("/ttiPrevalenceReport",{templateUrl:"views/reports/ttiPrevalenceReport.html",controller:"TTIPrevalenceReportCtrl",permission:b.TTI_REPORTING,enabled:c.REPORTS_TAB_ENABLED,reloadOnSearch:!1}).when("/bloodUnitsIssuedReport",{templateUrl:"views/reports/bloodUnitsIssuedReport.html",controller:"BloodUnitsIssuedReportCtrl",permission:b.COMPONENTS_REPORTING,enabled:c.REPORTS_TAB_ENABLED,reloadOnSearch:!1}).when("/donorsDeferredReport",{templateUrl:"views/reports/donorsDeferredReport.html",controller:"DonorsDeferredReportCtrl",permission:b.DONORS_REPORTING,enabled:c.REPORTS_TAB_ENABLED,reloadOnSearch:!1}).when("/unitsDiscardedReport",{templateUrl:"views/reports/unitsDiscardedReport.html",controller:"UnitsDiscardedReportCtrl",permission:b.COMPONENTS_REPORTING,enabled:c.REPORTS_TAB_ENABLED,reloadOnSearch:!1}).when("/componentsProducedReport",{templateUrl:"views/reports/componentsProducedReport.html",controller:"ComponentsProducedReportCtrl",permission:b.COMPONENTS_REPORTING,enabled:c.REPORTS_TAB_ENABLED,reloadOnSearch:!1}).when("/donorsAdverseEventsReport",{templateUrl:"views/reports/donorsAdverseEventsReport.html",controller:"DonorsAdverseEventsReportCtrl",permission:b.DONATIONS_REPORTING,enabled:c.REPORTS_TAB_ENABLED,reloadOnSearch:!1}).when("/transfusionsReport",{templateUrl:"views/reports/transfusionsReport.html",controller:"TransfusionsReportCtrl",permission:b.TRANSFUSIONS_REPORTING,enabled:c.REPORTS_TAB_ENABLED,reloadOnSearch:!1}).when("/whoGdbsReport",{templateUrl:"views/reports/whoGdbsReport.html",controller:"WhoGdbsReportCtrl",permission:b.DONATIONS_REPORTING,enabled:c.REPORTS_TAB_ENABLED,reloadOnSearch:!1}).when("/donationSummaryReport",{templateUrl:"views/reports/donationSummaryReport.html",controller:"DonationSummaryReportCtrl",permission:b.DONATIONS_REPORTING,enabled:c.REPORTS_TAB_ENABLED,reloadOnSearch:!1}).when("/mobile",{redirectTo:"/lookUp",permission:b.VIEW_MOBILE_CLINIC_INFORMATION,enabled:c.MOBILE_CLINIC_TAB_ENABLED,reloadOnSearch:!1}).when("/lookUp",{templateUrl:"views/mobile/lookUp.html",controller:"MobileCtrl",permission:b.VIEW_MOBILE_CLINIC_INFORMATION,enabled:c.MOBILE_CLINIC_TAB_ENABLED,reloadOnSearch:!1}).when("/mobileDonorCounselling",{templateUrl:"views/mobile/donorCounselling.html",controller:"MobileDonorCounsellingCtrl",permission:b.VIEW_MOBILE_CLINIC_INFORMATION,enabled:c.MOBILE_CLINIC_TAB_ENABLED,reloadOnSearch:!1}).when("/mobileClinicExport",{templateUrl:"views/mobile/mobileClinicExport.html",controller:"MobileClinicExportCtrl",permission:b.VIEW_MOBILE_CLINIC_EXPORT,enabled:c.MOBILE_CLINIC_TAB_ENABLED,reloadOnSearch:!1}).when("/settings",{redirectTo:"/accountSettings",permission:b.AUTHENTICATED}).when("/configurations",{templateUrl:"views/settings/configurations.html",controller:"ConfigurationsCtrl",permission:b.MANAGE_GENERAL_CONFIGS}).when("/manageConfiguration/:id?",{templateUrl:"views/settings/manageConfiguration.html",controller:"ManageConfigurationsCtrl",permission:b.MANAGE_GENERAL_CONFIGS}).when("/accountSettings",{templateUrl:"views/settings/accountSettings.html",controller:"AccountSettingsCtrl",permission:b.AUTHENTICATED}).when("/users",{templateUrl:"views/settings/users.html",controller:"UsersCtrl",permission:b.MANAGE_USERS}).when("/manageUser/:id?",{templateUrl:"views/settings/manageUser.html",controller:"ManageUserCtrl",permission:b.MANAGE_USERS}).when("/roles",{templateUrl:"views/settings/roles.html",controller:"RolesCtrl",permission:b.MANAGE_ROLES}).when("/manageRole/:id?",{templateUrl:"views/settings/manageRole.html",controller:"ManageRolesCtrl",permission:b.MANAGE_ROLES}).when("/packTypes",{templateUrl:"views/settings/packTypes.html",controller:"PackTypesCtrl",permission:b.MANAGE_PACK_TYPES}).when("/managePackType/:id?",{templateUrl:"views/settings/managePackType.html",controller:"ManagePackTypesCtrl",permission:b.MANAGE_PACK_TYPES}).when("/deferralReasons",{templateUrl:"views/settings/deferralReasons.html",controller:"DeferralReasonsCtrl",permission:b.MANAGE_DEFERRAL_REASONS}).when("/manageDeferralReason/:id?",{templateUrl:"views/settings/manageDeferralReason.html",controller:"ManageDeferralReasonsCtrl",permission:b.MANAGE_DEFERRAL_REASONS}).when("/discardReasons",{templateUrl:"views/settings/discardReasons.html",controller:"DiscardReasonsCtrl",permission:b.MANAGE_DISCARD_REASONS}).when("/manageDiscardReason/:id?",{templateUrl:"views/settings/manageDiscardReason.html",controller:"ManageDiscardReasonsCtrl",permission:b.MANAGE_DISCARD_REASONS}).when("/donationTypes",{templateUrl:"views/settings/donationTypes.html",controller:"DonationTypesCtrl",permission:b.MANAGE_DONATION_TYPES}).when("/manageDonationType/:id?",{templateUrl:"views/settings/manageDonationType.html",controller:"ManageDonationTypesCtrl",permission:b.MANAGE_DONATION_TYPES}).when("/auditLog",{templateUrl:"views/settings/auditLog.html",controller:"AuditLogCtrl",permission:b.VIEW_AUDIT_LOG}).when("/adverseEventTypes",{templateUrl:"views/settings/adverseEventTypes.html",controller:"AdverseEventTypesCtrl",permission:b.MANAGE_ADVERSE_EVENTS}).when("/addAdverseEventType",{templateUrl:"views/settings/addAdverseEventType.html",controller:"AddAdverseEventTypeCtrl",permission:b.MANAGE_ADVERSE_EVENTS}).when("/editAdverseEventType/:id?",{templateUrl:"views/settings/editAdverseEventType.html",controller:"EditAdverseEventTypeCtrl",permission:b.MANAGE_ADVERSE_EVENTS}).when("/locations",{templateUrl:"views/settings/locations.html",controller:"LocationsCtrl",permission:b.MANAGE_LOCATIONS,reloadOnSearch:!1}).when("/manageLocation/:id?",{templateUrl:"views/settings/manageLocation.html",controller:"ManageLocationCtrl",permission:b.MANAGE_LOCATIONS}).when("/componentTypes",{templateUrl:"views/settings/componentTypes.html",controller:"ComponentTypesCtrl",permission:b.MANAGE_COMPONENT_TYPES}).when("/manageComponentType/:id?",{templateUrl:"views/settings/manageComponentType.html",controller:"ManageComponentTypeCtrl",permission:b.MANAGE_COMPONENT_TYPES}).when("/manageComponentTypeCombination/:id?",{templateUrl:"views/settings/manageComponentTypeCombination.html",controller:"ManageComponentTypeCombinationCtrl",permission:b.MANAGE_COMPONENT_COMBINATIONS}).when("/componentTypeCombinations",{templateUrl:"views/settings/componentTypeCombinations.html",controller:"ComponentTypeCombinationsCtrl",permission:b.MANAGE_COMPONENT_COMBINATIONS}).when("/divisions",{templateUrl:"views/settings/divisions.html",controller:"DivisionsCtrl",permission:b.MANAGE_DIVISIONS,reloadOnSearch:!1}).when("/manageDivision",{templateUrl:"views/settings/manageDivision.html",controller:"ManageDivisionCtrl",permission:b.MANAGE_DIVISIONS}).when("/manageDivision/:id",{templateUrl:"views/settings/manageDivision.html",controller:"ManageDivisionCtrl",permission:b.MANAGE_DIVISIONS}).when("/bloodTests",{templateUrl:"views/settings/bloodTests.html",controller:"BloodTestsCtrl",permission:b.MANAGE_BLOOD_TESTS}).when("/manageBloodTest/:id?",{templateUrl:"views/settings/manageBloodTest.html",controller:"ManageBloodTestCtrl",permission:b.MANAGE_BLOOD_TESTS}).when("/bloodTestingRules",{templateUrl:"views/settings/bloodTestingRules.html",controller:"BloodTestingRulesCtrl",permission:b.MANAGE_BLOOD_TESTING_RULES}).when("/manageBloodTestingRule/:id?",{templateUrl:"views/settings/manageBloodTestingRule.html",controller:"ManageBloodTestingRuleCtrl",permission:b.MANAGE_BLOOD_TESTING_RULES}).when("/transfusionReactionTypes",{templateUrl:"views/settings/transfusionReactionTypes.html",controller:"TransfusionReactionTypesCtrl",permission:b.MANAGE_TRANSFUSION_REACTION_TYPES}).when("/manageTransfusionReactionType/:id?",{templateUrl:"views/settings/manageTransfusionReactionType.html",controller:"ManageTransfusionReactionTypeCtrl",permission:b.MANAGE_TRANSFUSION_REACTION_TYPES}).when("/dataExport",{templateUrl:"views/settings/dataExport.html",controller:"DataExportCtrl",permission:b.DATA_EXPORT}).otherwise({redirectTo:"/home"})}]).config(["uibDatepickerConfig",function(a){a.formatYear="yy",a.showWeeks=!1,a.startingDay=1}]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1}]).run(["editableOptions",function(a){a.theme="bs3"}]).run(["gettextCatalog","SYSTEMCONFIG",function(a,b){a.setCurrentLanguage(b.language),b.languageDebug&&(a.debug=b.languageDebug)}]).run(["$rootScope","$location","AuthService",function(a,b){a.$on("$routeChangeStart",function(c,d){(a.accessDenied!==!0||"/home"!=b.path())&&(a.accessDenied=!1);var e=d.$$route.permission,f=d.$$route.enabled;("false"===f||f===!1)&&(a.accessDenied=!0,b.path("/home")),f!==!0&&angular.isDefined(e)&&a.sessionUserPermissions.indexOf(e)<=-1&&(a.accessDenied=!0,b.path("/home"))})}]).run(["$rootScope","$location","AuthService","PERMISSIONS",function(a,b,c,d){a.$on("$locationChangeStart",function(){var e=c.getSession();if(a.displayHeader=!1,e){var f=Date.now();f>=e.expires?(c.logout(),b.path("/login")):(c.refreshSession(),"/login"==b.path()&&b.path("/home"),c.getLoggedOnUser().passwordReset&&b.path("/passwordReset"))}else-1===["/login","/forgotPassword"].indexOf(b.path())&&b.path("/login");"/testing"===b.path()&&(-1!==a.sessionUserPermissions.indexOf(d.VIEW_TEST_BATCH)?b.path("/manageTestBatches"):-1!==a.sessionUserPermissions.indexOf(d.VIEW_TEST_OUTCOME)?b.path("/viewTestSample"):b.path("/home")),"/donors"===b.path()&&(a.sessionUserPermissions.indexOf(d.VIEW_DONOR)>-1?b.path("/findDonor"):a.sessionUserPermissions.indexOf(d.VIEW_DONATION_BATCH)>-1?b.path("/manageDonationBatches"):a.sessionUserPermissions.indexOf(d.EXPORT_CLINIC_DATA)>-1?b.path("/exportDonorList"):b.path("/home")),"/components"===b.path()&&(a.sessionUserPermissions.indexOf(d.ADD_COMPONENT_BATCH)>-1?b.path("/addComponentBatch"):a.sessionUserPermissions.indexOf(d.VIEW_COMPONENT_BATCH)>-1?b.path("/viewComponentBatches"):a.sessionUserPermissions.indexOf(d.ADD_COMPONENT)>-1?b.path("/recordComponents"):a.sessionUserPermissions.indexOf(d.VIEW_COMPONENT)>-1?b.path("/findComponents"):a.sessionUserPermissions.indexOf(d.DISCARD_COMPONENT)>-1?b.path("/discardComponents"):a.sessionUserPermissions.indexOf(d.VIEW_DISCARDS)>-1?b.path("/findDiscards"):b.path("/home")),"/inventory"===b.path()&&(a.sessionUserPermissions.indexOf(d.VIEW_INVENTORY_INFORMATION)>-1?b.path("/findInventory"):a.sessionUserPermissions.indexOf(d.VIEW_INVENTORY_INFORMATION)>-1&&b.path("/viewStockLevels")),"/reports"===b.path()&&(a.sessionUserPermissions.indexOf(d.DONATIONS_REPORTING)>-1?b.path("/aboRhGroupsReport"):a.sessionUserPermissions.indexOf(d.TTI_REPORTING)>-1?b.path("/ttiPrevalenceReport"):a.sessionUserPermissions.indexOf(d.COMPONENTS_REPORTING)>-1?b.path("/bloodUnitsIssuedReport"):b.path("/home"))})}]).directive("bsisTabTo",[function(){return{restrict:"A",link:function(a,b,c){b.bind("keyup",function(){if(this.value.length===this.maxLength){var a=document.getElementById(c.bsisTabTo);a&&a.focus()}})}}}]).directive("capitalizeFirstLetter",function(){return{require:"ngModel",link:function(a,b,c,d){var e=function(a){if(a){var b=a.charAt(0).toUpperCase()+a.substring(1);return b!==a&&(d.$setViewValue(b),d.$render()),b}return a};d.$parsers.push(e)}}}).directive("dateselect",["$compile",function(a){return{restrict:"E",require:"^ngModel",replace:"true",scope:{ngModel:"=",ngRequired:"=",ngDisabled:"=",dateOptions:"=",minDate:"=",maxDate:"=",format:"=",initDate:"="},link:function(b,c){b.calIcon=b.calIcon||"fa-calendar",b.open=function(a){a.preventDefault(),a.stopPropagation(),b.opened=!0},b.clear=function(){b.ngModel=null};var d=b.$watch("ngDisabled",function(d,e){d!==e&&a(c.contents())(b)});b.$on("$destroy",function(){d()})},templateUrl:"views/template/dateselect.html"}}]).directive("dateselectEnd",["$compile",function(a){return{restrict:"E",require:["^ngModel"],replace:"true",scope:{ngModel:"=",ngRequired:"=",ngDisabled:"=",dateOptions:"=",minDate:"=",maxDate:"=",format:"=",initDate:"="},link:function(b,c,d,e){b.calIcon=b.calIcon||"fa-calendar",b.open=function(a){a.preventDefault(),a.stopPropagation(),b.opened=!0},b.clear=function(){b.ngModel=null};var f=e[0];if(f){b.$watch(function(){return f.$modelValue},function(a){if(a){var b=moment(a).endOf("day").toDate();f.$setViewValue(b),f.$render()}},!0);var g=b.$watch("ngDisabled",function(d,e){d!==e&&a(c.contents())(b)});b.$on("$destroy",function(){g()})}},templateUrl:"views/template/dateselect.html"}}]).directive("haemoglobinValue",["ConfigurationsService","DONATION",function(a,b){return{replace:"true",restrict:"E",scope:{hbUnit:"=?",haemoglobinCount:"=",hbNumericValue:"=?",haemoglobinLevel:"=",hbQualitativeValue:"=?"},link:function(c){angular.isUndefined(c.hbUnit)&&(c.hbUnit=b.HBUNIT),angular.isUndefined(c.hbNumericValue)&&(c.hbNumericValue=a.getBooleanValue("donation.hbNumericValue")),angular.isUndefined(c.hbQualitativeValue)&&(c.hbQualitativeValue=a.getBooleanValue("donation.hbQualitativeValue"))},templateUrl:function(){return"views/template/haemoglobin.html"}}}]).directive("hasPermission",["$rootScope",function(a){return{link:function(b,c,d){function e(b,d){var e=!1;a.sessionUserPermissions.indexOf(b)>-1&&(e=!0),"true"===d?c.attr("disabled",!e):"false"===d?c.attr("disabled",!0):e||c.remove()}if(""!==d.hasPermission){var f=d.hasPermission.split(":"),g=f[0],h=f[1];e(g,h)}}}}]).directive("hasPermissions",["$rootScope",function(a){return{link:function(b,c,d){function e(b){var d=!0;for(var e in b)a.sessionUserPermissions.indexOf(b[e])<0&&(d=!1);d||c.remove()}if(""!==d.hasPermissions){var f=d.hasPermissions.split(";");e(f)}}}}]).directive("calculateAge",["$timeout",function(a){return{restrict:"EA",scope:{dob:"@",age:"="},link:function(b){function c(){a(function(){var a="";if(""===b.dob)b.age="",c();else{var d=new Date,e=new Date(b.dob);a=d.getFullYear()-e.getFullYear();var f=d.getMonth()-e.getMonth();(0>f||0===f&&d.getDate()<e.getDate())&&a--,b.age=a}},100)}c()}}}]).directive("selectOnFocus",function(){return{restrict:"A",link:function(a,b){b.on("click",function(){this.select()})}}}).directive("integer",["REGEX",function(a){var b=a.INTEGER;return{require:"ngModel",link:function(a,c,d,e){e.$validators.integer=function(a,c){return e.$isEmpty(a)?!0:b.test(c)?!0:!1}}}}]).directive("decimal",["REGEX",function(a){var b=a.DECIMAL;return{require:"ngModel",link:function(a,c,d,e){e.$validators.decimal=function(a,c){return e.$isEmpty(a)?!0:b.test(c)?!0:!1}}}}]).directive("alphaName",["REGEX",function(a){var b=a.NAME;return{require:"ngModel",link:function(a,c,d,e){e.$validators.alphaName=function(a,c){return e.$isEmpty(a)?!0:b.test(c)?!0:!1}}}}]).directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(a,b,c,d){d.$validators.compareTo=function(b){return b==a.otherModelValue},a.$watch("otherModelValue",function(){d.$validate()})}}}).directive("uiSelectRequired",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.uiSelectRequired=function(b,d){if(c.uiSelectRequired){var e=a.$eval(c.uiSelectRequired);if(0==e)return!0}var f;if(angular.isArray(b))f=b;else{if(!angular.isArray(d))return!1;f=d}return f.length>0}}}}).directive("uiDateRange",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.datesOutOfRange=function(a){if(!a)return!0;var b=c.uiDateStart,d=c.uiDateEnd;if(b?d||(d=a):b=a,b&&d){var e=moment(b).startOf("day"),f=moment(d).startOf("day");if(c.uiDateRange){var g=c.uiDateRange.split(",");if(f.isAfter(e.add(g[0],g[1])))return!1}}return!0},d.$validators.invalidDateRange=function(a){if(!a)return!0;var b=c.uiDateStart,d=c.uiDateEnd;if(b?d||(d=a):b=a,b&&d){var e=moment(b).startOf("day"),f=moment(d).startOf("day");if(e.isAfter(f))return!1}return!0},a.$watch(function(){return c.uiDateStart},function(){d.$validate()}),a.$watch(function(){return c.uiDateEnd},function(){d.$validate()})}}}).directive("timeIsAfter",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.invalidTimeRange=function(a){if(!a)return!0;var b=new Date(c.timeIsAfter),d=new Date(a);return d>=b};var e=a.$watch(function(){return c.timeIsAfter},function(){d.$validate()});a.$on("$destroy",function(){e()})}}}).directive("timeNotSameAs",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.sameTimeEntered=function(a){if(!a)return!0;var b=new Date(c.timeNotSameAs),d=new Date(a);return moment.duration(moment(d).diff(moment(b))).asMinutes()>=1};var e=a.$watch(function(){return c.timeNotSameAs},function(){d.$validate()});a.$on("$destroy",function(){e()})}}}).directive("dateTimeNotInFuture",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.dateInFuture=function(a){if(!a)return!0;var b=c.dateTimeNotInFuture,d=angular.copy(new Date(a)),e=angular.copy(new Date(b));b||(e=d);var f=moment(d).hour(e.getHours()).minutes(e.getMinutes());return f<=moment().toDate()};var e=a.$watch(function(){return c.dateTimeNotInFuture},function(){d.$validate()});a.$on("$destroy",function(){e()})}}}).directive("dateTimeAfter",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.dateTimeAfter=function(a){if(!a)return!0;var b=angular.copy(new Date(c.dateTimeAfter)),d=angular.copy(new Date(a));return d>b};var e=a.$watch(function(){return c.dateAfter},function(){d.$validate()});a.$on("$destroy",function(){e()})}}}).directive("maxDecimalDigits",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.maxDecimalDigits=function(a){if(!a)return!0;var b=c.maxDecimalDigits,d=(a.toString().split(".")[1]||[]).length;return b>=d};var e=a.$watch(function(){return c.maxDecimalDigits},function(){d.$validate()});a.$on("$destroy",function(){e()})}}}),UI={ADDRESS:{}},DONATION={DONOR:{}};!function(){function a(a){var b={backend:{version:"unknown",buildNumber:"unknown"},frontend:{version:"unknown",buildNumber:"unknown"}};app.constant("VERSION",b);var c=angular.injector(["ng"]),d=c.get("$http"),e=c.get("$log");return d.get(a+"/version").then(function(a){return a.data.version&&(b.backend.version=a.data.version.version,b.backend.buildNumber=a.data.version.buildNumber),d.get("version.json").then(function(a){b.frontend.version=a.data.version,b.frontend.buildNumber=a.data.buildNumber},function(a){e.error(a)})},function(a){e.error(a)})}function b(b){app.constant("SYSTEMCONFIG",b.data);var c=angular.injector(["ng"]),d=c.get("$http"),e="http://"+b.data.apiHost+":"+b.data.apiPort+"/"+b.data.apiApp;return d.get(e+"/configurations").then(function(b){app.constant("USERCONFIG",b.data),app.constant("UI",UI),app.constant("DONATION",DONATION);for(var c=b.data.configurations,d=0,f=c.length;f>d;d++)"dateFormat"==c[d].name?app.constant("DATEFORMAT",c[d].value):"dateTimeFormat"==c[d].name?app.constant("DATETIMEFORMAT",c[d].value):"timeFormat"==c[d].name?app.constant("TIMEFORMAT",c[d].value):"ui.donorsTabEnabled"==c[d].name?UI.DONORS_TAB_ENABLED=c[d].value:"ui.componentsTabEnabled"==c[d].name?UI.COMPONENTS_TAB_ENABLED=c[d].value:"ui.testingTabEnabled"==c[d].name?UI.TESTING_TAB_ENABLED=c[d].value:"ui.labellingTabEnabled"==c[d].name?UI.LABELLING_TAB_ENABLED=c[d].value:"ui.inventoryTabEnabled"==c[d].name?UI.INVENTORY_TAB_ENABLED=c[d].value:"ui.reportsTabEnabled"==c[d].name?UI.REPORTS_TAB_ENABLED=c[d].value:"ui.mobileClinicTabEnabled"==c[d].name?UI.MOBILE_CLINIC_TAB_ENABLED=c[d].value:"ui.address.addressLine1.enabled"==c[d].name?UI.ADDRESS.ADDRESS_LINE_1_ENABLED=c[d].value:"ui.address.addressLine1.displayName"==c[d].name?UI.ADDRESS.ADDRESS_LINE_1_NAME=c[d].value:"ui.address.addressLine2.enabled"==c[d].name?UI.ADDRESS.ADDRESS_LINE_2_ENABLED=c[d].value:"ui.address.addressLine2.displayName"==c[d].name?UI.ADDRESS.ADDRESS_LINE_2_NAME=c[d].value:"ui.address.cityTownVillage.enabled"==c[d].name?UI.ADDRESS.CITY_ENABLED=c[d].value:"ui.address.cityTownVillage.displayName"==c[d].name?UI.ADDRESS.CITY_NAME=c[d].value:"ui.address.province.enabled"==c[d].name?UI.ADDRESS.PROVINCE_ENABLED=c[d].value:"ui.address.province.displayName"==c[d].name?UI.ADDRESS.PROVINCE_NAME=c[d].value:"ui.address.state.enabled"==c[d].name?UI.ADDRESS.STATE_ENABLED=c[d].value:"ui.address.state.displayName"==c[d].name?UI.ADDRESS.STATE_NAME=c[d].value:"ui.address.districtRegion.enabled"==c[d].name?UI.ADDRESS.DISTRICT_REGION_ENABLED=c[d].value:"ui.address.districtRegion.displayName"==c[d].name?UI.ADDRESS.DISTRICT_REGION_NAME=c[d].value:"ui.address.country.enabled"==c[d].name?UI.ADDRESS.COUNTRY_ENABLED=c[d].value:"ui.address.country.displayName"==c[d].name?UI.ADDRESS.COUNTRY_NAME=c[d].value:"ui.address.postalCode.enabled"==c[d].name?UI.ADDRESS.POSTAL_CODE_ENABLED=c[d].value:"ui.address.postalCode.displayName"==c[d].name?UI.ADDRESS.POSTAL_CODE_NAME=c[d].value:"donation.bpUnit"==c[d].name?DONATION.BPUNIT=c[d].value:"donation.hbUnit"==c[d].name?DONATION.HBUNIT=c[d].value:"donation.weightUnit"==c[d].name?DONATION.WEIGHTUNIT=c[d].value:"donation.pulseUnit"==c[d].name?DONATION.PULSEUNIT=c[d].value:"donation.donor.bpSystolicMin"==c[d].name?DONATION.DONOR.BP_SYSTOLIC_MIN=c[d].value:"donation.donor.bpSystolicMax"==c[d].name?DONATION.DONOR.BP_SYSTOLIC_MAX=c[d].value:"donation.donor.bpDiastolicMin"==c[d].name?DONATION.DONOR.BP_DIASTOLIC_MIN=c[d].value:"donation.donor.bpDiastolicMax"==c[d].name?DONATION.DONOR.BP_DIASTOLIC_MAX=c[d].value:"donation.donor.hbMin"==c[d].name?DONATION.DONOR.HB_MIN=c[d].value:"donation.donor.hbMax"==c[d].name?DONATION.DONOR.HB_MAX=c[d].value:"donation.donor.weightMin"==c[d].name?DONATION.DONOR.WEIGHT_MIN=c[d].value:"donation.donor.weightMax"==c[d].name?DONATION.DONOR.WEIGHT_MAX=c[d].value:"donation.donor.pulseMin"==c[d].name?DONATION.DONOR.PULSE_MIN=c[d].value:"donation.donor.pulseMax"==c[d].name?DONATION.DONOR.PULSE_MAX=c[d].value:"donation.dinLength"==c[d].name&&(DONATION.DIN_LENGTH=c[d].value);return a(e)},function(){app.constant("CONFIGAPI","No Config Loaded")})}function c(){var a="config/bsis.json",c="bsis.json",d=angular.injector(["ng"]),e=d.get("$http");return e.get(c).then(function(a){return b(a)},function(){return e.get(a).then(function(a){return b(a)},function(){app.constant("SYSTEMCONFIG","No Config Loaded")})})}function d(){angular.element(document).ready(function(){angular.bootstrap(document,["bsis"])})}c().then(d)}(),
angular.module("bsis").factory("AuthService",["$http","$rootScope","AUTH_EVENTS","ROLES","Api","Authinterceptor","Base64",function(a,b,c,d,e,f,g){function h(){var a=(new Date).getTime(),c=new Date(a+36e5),d=[];for(var e in k.roles){var f=k.roles[e];for(var g in f.permissions){var h=f.permissions[g];d.indexOf(h.name)<0&&d.push(h.name)}}var i=k.firstName||"",j=k.lastName||"",m=i+" "+j;l={sessionUser:k.username,sessionUserName:m,sessionUserPermissions:d,expires:c.getTime()},b.displayHeader=!0,b.sessionUserName=l.sessionUserName,b.sessionUserPermissions=l.sessionUserPermissions,localStorage.setItem("consoleSession",angular.toJson(l))}function i(a){b.user=a,k=a,localStorage.setItem("loggedOnUser",angular.toJson(k)),h()}function j(){k=null,l=null,localStorage.removeItem("loggedOnUser"),localStorage.removeItem("consoleSession")}var k=angular.fromJson(localStorage.getItem("loggedOnUser")),l=angular.fromJson(localStorage.getItem("consoleSession"));return{login:function(d,h,j){var k=g.encode(d.username+":"+d.password);a.defaults.headers.common.authorization="Basic "+k,e.User.get({},function(a){i(a),f.setCredentials(k),b.$broadcast(c.loginSuccess),h(a)},function(a){b.user={},b.displayHeader=!1,b.$broadcast(c.loginFailed),j(a.status)})},logout:function(){j(),f.clearCredentials(),a.defaults.headers.common.authorization="",b.user={id:"",userId:"",role:d.guest},b.displayHeader=!1,b.sessionUserName="",b.sessionUserPermissions="",b.$broadcast(c.logoutSuccess)},getSession:function(){return l},refreshSession:function(){h()},getLoggedOnUser:function(){return k},hasPermission:function(a){return null!=l&&-1!=l.sessionUserPermissions.indexOf(a)?!0:!1},setLoggedOnUser:function(a){i(a)},__setLoggedOnUser:function(a){k=a}}}]),angular.module("bsis").factory("Alerting",function(){var a,b={};return{alertAddMsg:function(c,d,e,f){a=c,b[d]||(b[d]=[]);var g={type:e,msg:f};b[d].push(g)},alertAddServerMsg:function(a){var c;switch(a){case 403:c="The request has been forbidden by the server. Please contact the server administrator";break;case 404:c="The request resource could not be found";break;default:c="A server-side error has occurred. Please contact the server administrator"}b.server||(b.server=[]);var d={type:"danger",msg:c};b.server.push(d)},alertReset:function(a){a?b&&(b[a]=void 0):b={}},alertClose:function(a,c){b[a].splice(c,1)},getAlerts:function(){return a=!1,b},setPersistErrors:function(b){a=b},getPersistErrors:function(){return a}}}).run(["$rootScope","$location","Alerting",function(a,b,c){var d=a;d.$on("$routeChangeStart",function(){c.getPersistErrors()||c.alertReset()})}]),angular.module("bsis").factory("Authinterceptor",function(){var a=localStorage.getItem("auth");return{setCredentials:function(b){a=b,localStorage.setItem("auth",a)},clearCredentials:function(){a=null,localStorage.removeItem("auth")},getCredentials:function(){return a},request:function(b){return a?(b.headers.authorization="Basic "+a,b):b}}}).config(["$httpProvider",function(a){a.interceptors.push("Authinterceptor")}]),angular.module("bsis").factory("Api",["$resource","$http","SYSTEMCONFIG",function(a,b,c){var d="http://"+c.apiHost+":"+c.apiPort+"/"+c.apiApp;return{User:a(d+"/users/login-user-details",{},{get:{method:"GET"}}),Users:a(d+"/users/:id",null,{update:{method:"PUT"}}),Roles:a(d+"/roles/:id",null,{update:{method:"PUT"}}),Permissions:a(d+"/roles/permissions"),Donor:a(d+"/donors/:id",null,{update:{method:"PUT"}}),Deferrals:a(d+"/deferrals/:id",null,{update:{method:"PUT"},end:{url:d+"/deferrals/:id/end",method:"PUT",params:{id:"@id"}}}),deferralReasons:a(d+"/deferralreasons/:id",null,{update:{method:"PUT"}}),Donations:a(d+"/donations/:id",{id:"@id"},{update:{method:"PUT"},bloodTypingResolutions:{method:"POST",url:d+"/donations/bloodTypingResolutions"},getEditForm:{method:"GET",url:d+"/donations/:id/form"},findByDin:{method:"GET",url:d+"/donations"},search:{method:"GET",url:d+"/donations/search"}}),DonationBatches:a(d+"/donationbatches/:id",null,{update:{method:"PUT"}}),TestBatches:a(d+"/testbatches/:id",{id:"@id"},{update:{method:"PUT"},getTestBatchDonations:{method:"GET",url:d+"/testbatches/:id/donations",params:{id:"@id",bloodTypingMatchStatus:"@bloodTypingMatchStatus"}},getTestBatchForm:{method:"GET",url:d+"/testbatches/form"},search:{method:"GET",url:d+"/testbatches/search"},addDonationsToTestBatch:{method:"PUT",url:d+"/testbatches/:id/addDonations",params:{id:"@id"}},removeDonationsFromTestBatch:{method:"PUT",url:d+"/testbatches/:id/removeDonations",params:{id:"@id"}}}),ComponentBatches:a(d+"/componentbatches/:id",null,{update:{method:"PUT"}}),ComponentBatchesSearch:a(d+"/componentbatches/search",{},{query:{method:"GET",params:{startCollectionDate:"@startCollectionDate",endCollectionDate:"@endCollectionDate"}}}),DonorFormFields:a(d+"/donors/form"),DonationsFormFields:a(d+"/donations/form"),DeferralsFormFields:a(d+"/deferrals/form"),DonorCommunicationsFormFields:a(d+"/donorcommunications/form"),ComponentTypes:a(d+"/componenttypes/:id",{id:"@id"},{getAll:{method:"GET",url:d+"/componenttypes/search"},update:{method:"PUT"}}),DonationBatchFormFields:a(d+"/donationbatches/form"),TTITestingFormFields:a(d+"/ttitests/form"),BloodGroupTestingFormFields:a(d+"/bloodgroupingtests/form"),ComponentBatchesFormFields:a(d+"/componentbatches/form"),Donors:a(d+"/donors/:id",{id:"@id"}),FindDonors:a(d+"/donors/search",{},{query:{method:"GET",params:{firstName:"@firstName",lastName:"@lastName",donorNumber:"@donorNumber",donationIdentificationNumber:"@donationIdentificationNumber",usePhraseMatch:"@usePhraseMatch"}}}),DonorOverview:a(d+"/donors/:id/overview"),DonorDonations:a(d+"/donors/:id/donations"),DonorDeferrals:a(d+"/donors/:id/deferrals"),DonorBarcode:a(d+"/donors/:id/print"),DonorCommunicationsSearch:a(d+"/donorcommunications/search",{},{query:{method:"GET",params:{bloodGroups:"@bloodGroups",venues:"@venues",clinicDate:"@clinicDate",lastDonationFromDate:"@lastDonationFromDate",lastDonationToDate:"@lastDonationToDate",anyBloodGroup:"@anyBloodGroup",noBloodGroup:"@noBloodGroup"}}}),DonorSummaries:a(d+"/donors/summaries"),AllDonorDuplicates:a(d+"/donors/duplicates/all"),DonorDuplicates:a(d+"/donors/duplicates",{},{query:{method:"GET",params:{donorNumber:"@donorNumber"}}}),DonorPreviewMergeDuplicates:a(d+"/donors/duplicates/merge/preview",{},{query:{method:"POST",params:{donorNumbers:"@donorNumbers"}}}),DonorMergeDuplicates:a(d+"/donors/duplicates/merge",{},{query:{method:"POST",params:{donorNumber:"@donorNumber"}}}),Components:a(d+"/components/:id",{id:"@id"},{find:{method:"GET",url:d+"/components"},findByDIN:{method:"GET",url:d+"/components/donations/:donationIdentificationNumber"},search:{method:"GET",url:d+"/components/search"},record:{method:"POST",url:d+"/components/recordcombinations"},getComponentForm:{method:"GET",url:d+"/components/form"},getDiscardForm:{method:"GET",url:d+"/components/discard/form"},discard:{method:"PUT",url:d+"/components/discard"},unprocess:{method:"PUT",url:d+"/components/:id/unprocess"},undiscard:{method:"PUT",url:d+"/components/undiscard"},preProcess:{method:"PUT",url:d+"/components/:id/preprocess",params:{id:"@id"}},recordChildWeight:{method:"PUT",url:d+"/components/:id/recordchildweight",params:{id:"@id"}}}),Labelling:a(d+"/labels/",{},{search:{method:"GET",url:d+"/labels/components/search"},getComponentForm:{method:"GET",url:d+"/labels/components/form"},getComponents:{method:"GET",url:d+"/labels/donations/:donationIdentificationNumber/components",params:{componentType:"@componentType"}},getSafeComponents:{method:"GET",url:d+"/labels/components"},printPackLabel:{method:"GET",url:d+"/labels/print/packlabel/:componentId"},printDiscardLabel:{method:"GET",url:d+"/labels/print/discardlabel/:componentId"},verifyPackLabel:{method:"GET",url:d+"/labels/verify/packlabel",params:{componentId:"@componentId",prePrintedDIN:"@prePrintedDIN",packLabelDIN:"@packLabelDIN"}}}),FindDonationBatches:a(d+"/donationbatches/search",{},{query:{method:"GET",params:{isClosed:"@isClosed",venues:"@venues"}}}),TestResults:a(d+"/testresults/:donationIdentificationNumber",{din:"@donationIdentificationNumber"},{form:{method:"GET",url:d+"/testresults/form"},getTestSample:{method:"GET",url:d+"/testresults/:donationIdentificationNumber/sample"},search:{method:"GET",url:d+"/testresults/search"},overview:{method:"GET",url:d+"/testresults/overview"},report:{method:"GET",url:d+"/testresults/report"},saveResults:{method:"POST",url:d+"/testresults"}}),Locations:a(d+"/locations/:id",{id:"@id"},{update:{method:"PUT"},getSearchForm:{method:"GET",url:d+"/locations/search/form"},search:{method:"GET",url:d+"/locations/search"},getForm:{method:"GET",url:d+"/locations/form"}}),Configurations:a(d+"/configurations/:id",null,{update:{method:"PUT"}}),PackTypes:a(d+"/packtypes/:id",null,{update:{method:"PUT"}}),DiscardReasons:a(d+"/discardreasons/:id",null,{update:{method:"PUT"}}),DonationTypes:a(d+"/donationtypes/:id",null,{update:{method:"PUT"}}),PasswordResets:a(d+"/passwordresets"),AuditRevisions:a(d+"/auditrevisions"),DonorPostDonationCounselling:a(d+"/donors/:donorId/postdonationcounselling"),PostDonationCounsellings:a(d+"/postdonationcounsellings/:id",{id:"@id"},{getForm:{method:"GET",url:d+"/postdonationcounsellings/form"},getSearchForm:{method:"GET",url:d+"/postdonationcounsellings/searchForm"},update:{method:"PUT"}}),AdverseEventTypes:a(d+"/adverseevents/types/:id",{id:"@id"},{update:{method:"PUT"}}),MobileClinicDonors:a(d+"/mobileclinic",{},{getForm:{method:"GET",url:d+"/mobileclinic/form"},search:{method:"GET",url:d+"/mobileclinic/search"},"export":{method:"GET",url:d+"/mobileclinic/export"},getDonorOutcomesForm:{method:"GET",url:d+"/mobileclinic/donoroutcomes/form"},getDonorOutcomes:{method:"GET",url:d+"/mobileclinic/donoroutcomes"}}),DonationsReport:a(d+"/reports/collecteddonations/generate",{},{getForm:{method:"GET",url:d+"/reports/collecteddonations/form"}}),TTIPrevalenceReport:a(d+"/reports/ttiprevalence/generate",{},{getForm:{method:"GET",url:d+"/reports/ttiprevalence/form"}}),StockLevelsReport:a(d+"/reports/stockLevels",{},{generate:{method:"GET",url:d+"/reports/stockLevels/generate"},getForm:{method:"GET",url:d+"/reports/stockLevels/form"}}),BloodUnitsIssuedReport:a(d+"/reports/unitsissued",{},{generate:{method:"GET",url:d+"/reports/unitsissued/generate"},getForm:{method:"GET",url:d+"/reports/unitsissued/form"}}),DonorsDeferredReport:a(d+"/reports/donorsdeferred",{},{generate:{method:"GET",url:d+"/reports/donorsdeferred/generate"},getForm:{method:"GET",url:d+"/reports/donorsdeferred/form"}}),UnitsDiscardedReport:a(d+"/reports/discardedunits",{},{generate:{method:"GET",url:d+"/reports/discardedunits/generate"},getForm:{method:"GET",url:d+"/reports/discardedunits/form"}}),ComponentProductionReport:a(d+"/reports/componentsprocessed",{},{generate:{method:"GET",url:d+"/reports/componentsprocessed/generate"},getForm:{method:"GET",url:d+"/reports/componentsprocessed/form"}}),DonorsAdverseEventsReport:a(d+"/reports/donorsadverseevents",{},{generate:{method:"GET",url:d+"/reports/donorsadverseevents/generate"},getForm:{method:"GET",url:d+"/reports/donorsadverseevents/form"}}),TransfusionsReport:a(d+"/reports/transfusionsummary",{},{generate:{method:"GET",url:d+"/reports/transfusionsummary/generate"},getForm:{method:"GET",url:d+"/reports/transfusionsummary/form"}}),WhoReport:a(d+"/reports/whoreport",{},{generate:{method:"GET",url:d+"/reports/whoreport/generate"},getForm:{method:"GET",url:d+"/reports/whoreport/form"}}),DonationSummaryReport:a(d+"/reports/donationreport",{},{generate:{method:"GET",url:d+"/reports/donationreport/generate"},getForm:{method:"GET",url:d+"/reports/donationreport/form"}}),OrderForms:a(d+"/orderforms/:id",{id:"@id"},{update:{method:"PUT"},search:{method:"GET",url:d+"/orderforms/search"},getForm:{method:"GET",url:d+"/orderforms/form"},getItemsForm:{method:"GET",url:d+"/orderforms/items/form"}}),ReturnForms:a(d+"/returnforms/:id",{id:"@id"},{update:{method:"PUT"},search:{method:"GET",url:d+"/returnforms/search"},getForm:{method:"GET",url:d+"/returnforms/form"}}),Inventories:a(d+"/inventories/",{},{search:{method:"GET",url:d+"/inventories/search"},getSearchForm:{method:"GET",url:d+"/inventories/search/form"},getInventory:{method:"GET",url:d+"/inventories"}}),Divisions:a(d+"/divisions/:id",{id:"@id"},{search:{method:"GET",url:d+"/divisions/search"},update:{method:"PUT"}}),TransfusionReactionTypes:a(d+"/transfusionreactiontypes/:id",{id:"@id"},{search:{method:"GET",url:d+"/transfusionreactiontypes/search"},add:{method:"POST",url:d+"/transfusionreactiontypes"},update:{method:"PUT"}}),Transfusion:a(d+"/transfusions/:id",{id:"@id"},{getForm:{method:"GET",url:d+"/transfusions/form"},save:{method:"POST"},getSearchForm:{method:"GET",url:d+"/transfusions/search/form"},search:{method:"GET",url:d+"/transfusions/search"},update:{method:"PUT"}}),DataExport:{download:function(){return b.get(d+"/dataexport",{responseType:"arraybuffer"})}},ComponentTypeCombinations:a(d+"/componenttypecombinations/:id",{id:"@id"},{search:{method:"GET",url:d+"/componenttypecombinations/search"},update:{method:"PUT"},getForm:{method:"GET",url:d+"/componenttypecombinations/form"}}),BloodTests:a(d+"/bloodtests/:id",{id:"@id"},{search:{method:"GET",url:d+"/bloodtests/search"},getForm:{method:"GET",url:d+"/bloodtests/form"},update:{method:"PUT"}}),BloodTestingRules:a(d+"/bloodtestingrules/:id",{id:"@id"},{search:{method:"GET",url:d+"/bloodtestingrules/search"},getForm:{method:"GET",url:d+"/bloodtestingrules/form"},save:{method:"POST"},update:{method:"PUT"}})}}]),angular.module("bsis").factory("DonorService",["$http","Api","ConfigurationsService","gettextCatalog","$uibModal",function(a,b,c,d,e){var f={},g={},h={};return{findDonor:function(a,c,d){var e={firstName:a.firstName,middleName:a.middleName,lastName:a.lastName,donorNumber:a.donorNumber,phoneNumber:a.phoneNumber,donationIdentificationNumber:a.donationIdentificationNumber,usePhraseMatch:a.usePhraseMatch};b.FindDonors.query(e,function(a){h=a.donors,c(a)},d)},addDonor:function(a,c,d){var e=new b.Donor;angular.copy(a,e),e.$save(function(a){f=a.donor,c(a.donor)},function(a){d(a.data)})},updateDonor:function(a,c,d){b.Donor.update({id:a.id},a,function(a){f=a.donor,c(f)},function(a){d(a.data)})},getDonor:function(){return f},getDonorById:function(a,c,d){b.Donor.get({id:a},function(a){c(a.donor)},function(a){d(a.data)})},getDonationBatch:function(){return g},getDonationBatchById:function(a,c,d){b.DonationBatches.get({id:a},function(a){c(a.donationBatch)},function(a){d(a.data)})},getDonors:function(){return h},getDonorFormFields:function(a){b.DonorFormFields.get({},function(b){a(b)},function(){a(!1)})},getDonorOverview:function(a,c){b.DonorOverview.get({id:a},function(a){c(a)},function(){c(!1)})},getDonorListFormFields:function(a){b.DonorCommunicationsFormFields.get({},function(b){a(b)},function(){a(!1)})},findDonorListDonors:function(a,c,d){var e=b.DonorCommunicationsSearch.query({bloodGroups:a.bloodGroups,venues:a.venues,clinicDate:a.clinicDate,lastDonationFromDate:a.lastDonationFromDate,lastDonationToDate:a.lastDonationToDate,anyBloodGroup:a.anyBloodGroup,noBloodGroup:a.noBloodGroup},function(){c(e.donors)},function(a){d(a.data)})},setDonor:function(a){f=a},setDonationBatch:function(a){g=a},setDonors:function(a){h=a},getDonationsFormFields:function(a){b.DonationsFormFields.get({},function(b){a(b)},function(){a(!1)})},addDonationToBatch:function(a,c,d){var e=new b.Donations;angular.copy(a,e),e.$save(function(){b.DonationBatches.get({id:g.id},function(a){g=a.donationBatch,a.donationBatch.donationBatchDate=new Date(a.donationBatch.donationBatchDate),c(a.donationBatch)})},function(a){d(a.data)})},addDonation:function(a,c,d){var e=new b.Donations;angular.copy(a,e),e.adverseEvent&&!e.adverseEvent.type&&(e.adverseEvent=null),e.$save(function(){c(!0)},function(a){d(a.data)})},updateDonation:function(a,c,d){var e=b.Donations.get({id:a.id},function(){e=e.donation,angular.copy(a,e),e.adverseEvent&&!e.adverseEvent.type&&(e.adverseEvent=null),b.Donations.update({id:a.id},e,function(a){c(a.donation)},function(a){d(a.data)})})},deleteDonation:function(a,c,d){b.Donations["delete"]({id:a},c,d)},getDeferralsFormFields:function(a){b.DeferralsFormFields.get({},function(b){a(b)},function(){a(!1)})},addDeferral:function(a,c){var d=new b.Deferrals;angular.copy(a,d),d.$save(function(){c(!0)},function(){c(!1)})},getDeferrals:function(a,c){b.DonorDeferrals.get({id:a},function(a){c(a)},function(){c(!1)})},deleteDonorDeferral:function(a,c,d){b.Deferrals["delete"]({id:a},c,d)},endDonorDeferral:function(a,c,d,e){b.Deferrals.end({id:a},c,function(a){d(a.deferral)},function(a){e(a.data)})},updateDonorDeferral:function(a,c,d){b.Deferrals.update({id:a.id},a,function(a){c(a.deferral)},function(a){d(a.data)})},getDonations:function(a,c){b.DonorDonations.get({id:a},function(a){c(a)},function(){c(!1)})},getDonorBarcode:function(a,c){b.DonorBarcode.get({id:a},function(a){c(a);var b=document.createElement("a");b.href="data:attachment/zpl,"+encodeURI(a.labelZPL),b.target="_blank",b.download="barcode"+moment(new Date)+".bc",b.click()},function(){c(!1)})},getDonationBatchDonations:function(){return a.get("/getDonationBatch")},getDonationBatchFormFields:function(a,c){b.DonationBatchFormFields.get({},a,function(a){c(a.data)})},getOpenDonationBatches:function(a){b.FindDonationBatches.query({isClosed:!1},function(b){a(b)},function(){a(!1)})},getRecentDonationBatches:function(a,c,d){b.FindDonationBatches.query(a,function(a){c(a)},function(a){d(a.data)})},addDonationBatch:function(a,c,d){var e=new b.DonationBatches;angular.copy(a,e),e.$save(function(){c(!0)},function(a){d(a.data)})},closeDonationBatch:function(a,c,d){b.DonationBatches.get({id:a.id},function(e){var f=e.donationBatch;f.isClosed=!0,f.venue=f.venue.id,b.DonationBatches.update({id:a.id},f,function(a){c(a.donationBatch)},function(a){d(a.data)})})},reopenDonationBatch:function(a,c,d){b.DonationBatches.get({id:a.id},function(e){var f=e.donationBatch;f.donationBatchDate=a.donationBatchDate,f.venue=a.venue.id,f.isClosed=!1,b.DonationBatches.update({id:a.id},f,function(a){c(a.donationBatch)},function(a){d(a.data)})})},updateDonationBatch:function(a,c,d){b.DonationBatches.get({id:a.id},function(e){var f=e.donationBatch;f.donationBatchDate=a.donationBatchDate,f.venue=a.venue.id,b.DonationBatches.update({id:a.id},f,function(a){c(a.donationBatch)},function(a){d(a.data)})})},deleteDonationBatch:function(a,c,d){b.DonationBatches["delete"]({id:a},c,d)},getDonorSummaries:function(a,c,d){b.DonorSummaries.get({donorNumber:a},c,d)},getDonorPostDonationCounselling:function(a,c,d){b.DonorPostDonationCounselling.get({donorId:a},c,d)},deleteDonor:function(a,c,d){b.Donors["delete"]({id:a},c,d)},findAllDonorDuplicates:function(a){b.AllDonorDuplicates.get({},function(b){a(b)},function(){a(!1)})},findDonorDuplicates:function(a,c){b.DonorDuplicates.get({donorNumber:a},function(a){c(a)},function(){c(!1)})},mergePreviewDonorsDuplicate:function(a,c,d,e){var f=new b.DonorPreviewMergeDuplicates;angular.copy(c,f),f.$save({donorNumber:a},function(a){d(a)},function(a){e(a.data)})},mergeDonorsDuplicate:function(a,c,d,e){var f=new b.DonorMergeDuplicates;angular.copy(c,f),f.$save({donorNumber:a},function(a){d(a.donor)},function(a){e(a.data)})},getDonation:function(a,c,d){return b.Donations.get({id:a},c,d)},checkDonorAge:function(a){var b,f=c.getIntValue("donors.minimumAge"),g=c.getIntValue("donors.maximumAge")||100,h=moment().subtract(g,"years"),i=moment().subtract(f,"years"),j=moment(a);if(j.isBefore(h))b=d.getString("This donor is over the maximum age of {{maxAge}}",{maxAge:g})+".";else{if(!j.isAfter(i))return Promise.resolve(null);b=d.getString("This donor is below the minimum age of {{minAge}}",{minAge:f})+"."}b+=" ",b+=d.getString("Are you sure that you want to continue?");var k=e.open({animation:!1,templateUrl:"views/confirmModal.html",controller:"ConfirmModalCtrl",resolve:{confirmObject:{title:d.getString("Invalid donor"),button:d.getString("Add"),message:b}}});return k.result}}}]),angular.module("bsis").factory("DonationsService",["Api",function(a){return{getEditForm:a.Donations.getEditForm,findByDin:a.Donations.findByDin,search:a.Donations.search}}]),angular.module("bsis").factory("ComponentService",["$http","Api",function(a,b){return{getComponentsFormFields:function(a){b.Components.getComponentForm({},function(b){a(b)},function(){a(!1)})},getComponentsByDIN:function(a,c){var d=b.Components.findByDIN({donationIdentificationNumber:a},function(){c(d)},function(){c(!1)})},findComponent:function(a,c,d){b.Components.find(a,function(a){c(a.component)},function(a){d(a.data)})},ComponentsSearch:function(a,c){var d=b.Components.search({donationIdentificationNumber:a.donationIdentificationNumber,componentTypes:a.componentTypes,locationId:a.locationId,status:a.status,donationDateFrom:a.donationDateFrom,donationDateTo:a.donationDateTo},function(){c(d)},function(){c(!1)})},recordComponents:function(a,c){b.Components.record(a,function(a){c(a)},function(){c(!1)})},getDiscardForm:b.Components.getDiscardForm,discard:b.Components.discard,unprocess:b.Components.unprocess,undiscard:b.Components.undiscard,preProcess:b.Components.preProcess,recordChildWeight:b.Components.recordChildWeight}}]),angular.module("bsis").factory("TestingService",["$http","Api",function(a,b){return{getTestBatchFormFields:function(a){b.TestBatches.getTestBatchForm({},function(b){a(b)},function(){a(!1)})},getTTITestingFormFields:function(a){b.TTITestingFormFields.get({},function(b){a(b)},function(){a(!1)})},getBloodGroupTestingFormFields:function(a){b.BloodGroupTestingFormFields.get({},function(b){a(b)},function(){a(!1)})},getTestBatchById:function(a,c,d){b.TestBatches.get({id:a},function(a){c(a)},function(a){d(a.data)})},getOpenTestBatches:function(a){b.TestBatches.search({status:["OPEN","RELEASED"]},function(b){a(b)},function(){a(!1)})},addTestBatch:function(a,c,d){b.TestBatches.save({},a,c,d)},closeTestBatch:function(a,c,d){a.status="CLOSED",b.TestBatches.update({},a,function(a){c(a)},function(){d(!1)})},reopenTestBatch:function(a,c,d){a.status="RELEASED",b.TestBatches.update({},a,function(a){c(a)},function(){d(!1)})},releaseTestBatch:function(a,c,d){a.status="RELEASED",b.TestBatches.update({},a,c,d)},updateTestBatch:function(a,c,d){b.TestBatches.update({},a,function(a){c(a)},function(a){d(a.data)})},deleteTestBatch:function(a,c,d){b.TestBatches["delete"]({id:a},c,d)},getRecentTestBatches:function(a,c,d){b.TestBatches.search(a,function(a){c(a)},function(a){d(a.data)})},getTestBatchDonations:function(a,c,d,e){b.TestBatches.getTestBatchDonations({id:a,bloodTypingMatchStatus:c},function(a){d(a)},function(a){e(a)})},getTestResultsForm:b.TestResults.form,getTestResultsByDIN:b.TestResults.get,getTestSampleByDIN:b.TestResults.getTestSample,getTestBatchOverviewById:b.TestResults.overview,getTestBatchOutcomesReport:b.TestResults.report,getTestOutcomesByBatchIdAndBloodTestType:b.TestResults.search,saveTestResults:b.TestResults.saveResults,saveBloodTypingResolutions:b.Donations.bloodTypingResolutions,addDonationsToTestBatch:b.TestBatches.addDonationsToTestBatch,removeDonationsFromTestBatch:b.TestBatches.removeDonationsFromTestBatch}}]),angular.module("bsis").factory("InventoriesService",["Api",function(a){return{search:a.Inventories.search,getSearchForm:a.Inventories.getSearchForm,getInventoryComponentByCodeAndDIN:a.Inventories.getInventory}}]),angular.module("bsis").factory("LabellingService",["$http","Api",function(a,b){return{search:b.Labelling.search,getComponentForm:b.Labelling.getComponentForm,getComponents:b.Labelling.getComponents,getSafeComponents:function(a,c){var d=b.Labelling.getSafeComponents({donationIdentificationNumber:a.donationIdentificationNumber,componentCode:a.componentCode,componentTypeId:a.componentTypeId,locationId:a.locationId,bloodGroups:a.bloodGroups,startDate:a.startDate,endDate:a.endDate,inventoryStatus:a.inventoryStatus},function(){c(d)},function(){c(!1)})},verifyPackLabel:function(a,c,d){b.Labelling.verifyPackLabel(a,function(a){c(a)},function(a){d(a.data)})},printPackLabel:function(a,c,d){b.Labelling.printPackLabel({componentId:a},function(a){c(a);var b=document.createElement("a");b.href="data:attachment/zpl,"+encodeURI(a.labelZPL),b.target="_blank",b.download="label"+moment(new Date)+".zpl",b.click()},function(a){d(a.data)})},printDiscardLabel:function(a,c,d){b.Labelling.printDiscardLabel({componentId:a},function(a){c(a);var b=document.createElement("a");b.href="data:attachment/zpl,"+encodeURI(a.labelZPL),b.target="_blank",b.download="label"+moment(new Date)+".zpl",b.click()},function(a){d(a.data)})}}}]),angular.module("bsis").factory("ReportsService",["$http","Api",function(a,b){return{generateDonationsReport:function(a,c,d){b.DonationsReport.get({startDate:a.startDate,endDate:a.endDate},function(a){c(a)},function(a){d(a.data)})},generateTTIPrevalenceReport:function(a,c,d){b.TTIPrevalenceReport.get({startDate:a.startDate,endDate:a.endDate},function(a){c(a)},function(a){d(a.data)})},getDonationsReportForm:b.DonationsReport.getForm,generateStockLevelsReport:b.StockLevelsReport.generate,getStockLevelsReportForm:b.StockLevelsReport.getForm,getBloodUnitsIssuedReportForm:b.BloodUnitsIssuedReport.getForm,generateBloodUnitsIssuedReport:b.BloodUnitsIssuedReport.generate,generateDonorsDeferredReport:b.DonorsDeferredReport.generate,getDonorsDeferredReportForm:b.DonorsDeferredReport.getForm,generateUnitsDiscardedReport:b.UnitsDiscardedReport.generate,getUnitsDiscardedReportForm:b.UnitsDiscardedReport.getForm,generateComponentProductionReport:b.ComponentProductionReport.generate,getComponentProductionReportForm:b.ComponentProductionReport.getForm,generateDonorsAdverseEventsReport:b.DonorsAdverseEventsReport.generate,getDonorsAdverseEventsReportForm:b.DonorsAdverseEventsReport.getForm,generateTransfusionsReport:b.TransfusionsReport.generate,getTransfusionsReportForm:b.TransfusionsReport.getForm,getTTIPrevalenceReportForm:b.TTIPrevalenceReport.getForm,generateWhoReport:b.WhoReport.generate,getWhoReportForm:b.WhoReport.getForm,generateDonationSummaryReport:b.DonationSummaryReport.generate,getDonationSummaryReportForm:b.DonationSummaryReport.getForm}}]),angular.module("bsis").factory("ModalsService",["$uibModal",function(a){return{showConfirmation:function(b){var c=a.open({animation:!1,templateUrl:"views/confirmModal.html",controller:"ConfirmModalCtrl",resolve:{confirmObject:b}});return c.result}}}]),angular.module("bsis").factory("ReportsLayoutService",["LogosService","$filter","gettextCatalog",function(a,b,c){return{generatePdfPageHeader:function(b,c,d,e){var f=450;"landscape"===b&&(f=690);var g=[{image:a.getHeaderLogo1,height:54,width:105,margin:[30,10,0,0]}];return a.getHeaderLogo2&&g.push({image:a.getHeaderLogo2,height:54,width:105,margin:[f,-54,0,0]}),g.push({text:c,fontSize:11,bold:!0,alignment:"center",margin:[30,-35,30,0]}),d&&g.push({text:d,fontSize:9,alignment:"center"}),e&&g.push({text:e,fontSize:9,alignment:"center"}),g},generatePdfPageFooter:function(d,e,f,g,h){var i=150,j=260,k=350;"landscape"===h&&(i+=130,j+=130,k+=130);var l=[];return d&&l.push({text:c.getString("Total {{recordsName}}: {{totalRecords}}",{recordsName:d,totalRecords:e}),width:"auto"}),l.push({text:c.getString("Date generated: {{date}}",{date:b("bsisDateTime")(new Date)}),width:"auto"}),f&&l.push({text:c.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:f,pageCount:g}),alignment:"right"}),[{image:a.getFooterLogo1,width:72,height:38,margin:[i,0]},{text:c.getString("Powered by"),margin:[j,-20]},{image:a.getFooterLogo2,width:74,height:38,margin:[k,-8]},{columns:l,columnGap:10,margin:[30,18]}]},pdfTableHeaderStyle:{fontSize:8,bold:!0,margin:[-2,0,0,0]},pdfTableBodyBoldStyle:{fontSize:8,bold:!0},pdfTableBodyGreyBoldStyle:{fillColor:"lightgrey",fontSize:8,bold:!0},pdfDefaultStyle:{fontSize:8,margin:[-2,0,0,0]},pdfPortraitMaxGridWidth:450,pdfLandscapeMaxGridWidth:650,paginatePdf:function(a,b){if(b.pageMargins=[30,70,30,75],1===b.content[0].table.body.length)return b.content.splice(0,0,{text:c.getString("No data for date range selected"),fontSize:9,alignment:"center"}),b;var d=angular.copy(b.content[1]),e=b.content[0].table.body.splice(0,1),f=b.content[0].table.body,g=b.content[0];b.content=[];do{var h=f.length>a?a:f.length,i=angular.copy(e).concat(f.splice(0,h)),j=angular.copy(g);j.table.body=i,f.length>0&&(j.pageBreak="after"),b.content.push(j)}while(f.length>0);if(d){var k=a-b.content[b.content.length-1].table.body.length,l=d.table.body.length;l>k&&(d.pageBreak="before"),b.content.push(d)}return b},highlightTotalRows:function(a,b,c){return c.styles.greyBoldCell=this.pdfTableBodyGreyBoldStyle,angular.forEach(c.content,function(c){angular.forEach(c.table.body,function(c){c[b]===a&&angular.forEach(c,function(a,b){c[b]={text:""+a,style:"greyBoldCell"}})})}),c},highlightPercentageRows:function(a,b,c){return c.styles.boldCell=this.pdfTableBodyBoldStyle,angular.forEach(c.content,function(c){angular.forEach(c.table.body,function(c){c[b]===a&&angular.forEach(c,function(a,b){c[b]={text:""+a,style:"boldCell"}})})}),c},addPercentages:function(a,b){return-1!==a.field.indexOf("rate")?b+"%":b},addSummaryContent:function(a,b){var c=angular.copy(b.content[0]),d=c.table.body.splice(0,1);return c.table.body=d.concat(a),b.content.push(c),b},formatPercentageColumnsAndConvertAllValuesToText:function(a,c){return angular.forEach(a,function(a){angular.forEach(a,function(d,e){-1!==c.indexOf(e)?a[e]=b("number")(d,2)+"%":a[e]=""+d})}),a},formatPercentageRowsAndConvertAllValuesToText:function(a,c,d){return angular.forEach(a,function(a){angular.forEach(a,function(e,f){a[d]===c&&""!==a[f]?a[f]=b("number")(e,2)+"%":a[f]=""+e})}),a},convertAllValuesToText:function(a){return angular.forEach(a,function(a){angular.forEach(a,function(b,c){a[c]=""+b})}),a},hyphenateLongWords:function(a,b){var c="";return angular.forEach(a.split(" "),function(a){var d="",e=new RegExp(".{1,"+b+"}","g");angular.forEach(a.match(e),function(a){d.length>0&&(d+="-"),d+=a}),c.length>0&&(c+=" "),c+=d}),c}}}]),angular.module("bsis").factory("ReportGeneratorService",["$filter",function(a){function b(b,c){return a("filter")(b.cohorts,{category:c})[0]}function c(b){return a("filter")(b.who)}function d(a){var b=[];return angular.forEach(a,function(a){var c=[];angular.forEach(a,function(b,d){c.push(""+a[d])}),b.push(c)}),b}return{getCohort:function(a,c){return b(a,c)},getWho:function(a){return this.getWho(a)},generateDataRowsGroupingByLocation:function(a,b,c,d){var e=0,f={};angular.forEach(a,function(a){var g=f[a.location.name];g||(e+=1,g=c(b),f[a.location.name]=g),d(g,a)});var g=[];angular.forEach(f,function(a){g.push(a)});var h=[];return h.push(g),h.push(e),h},generateDataRowsGroupingByDonor:function(a,b,c,d){var e=0,f={};angular.forEach(a,function(a){var g=f[a.donor.name];g||(e+=1,g=c(b),f[a.donor.name]=g),d(g,a)});var g=[];angular.forEach(f,function(a){g.push(a)});var h=[];return h.push(g),h.push(e),h},generateDataRowsGroupingByLocationAndCohort:function(a,c,d,e,f,g){var h=0,i={};angular.forEach(a,function(a){var f=b(a,c);if(f){var g=f.option,j=!1,k=i[a.location.name];k||(h+=1,k={},i[a.location.name]=k,j=!0);var l=k[g];l||(l=d(a,j),k[g]=l),e(l,a)}});var j=[];angular.forEach(i,function(a){angular.forEach(a,function(a){j.push(a)}),f&&j.push(f(a)),g&&j.push(g(a))});var k=[];return k.push(j),k.push(h),k},generateDataRowsGroupingByDonorAndCohort:function(a,b,d,e){var f=0,g={};angular.forEach(a,function(a){var h=c(a,b);if(h){var i=h.option,j=!1,k=g[a.donor.name];k||(f+=1,k={},g[a.donor.name]=k,j=!0);var l=k[i];l||(l=d(a,j),k[i]=l),e(l,a)}});var h=[];angular.forEach(g,function(a){angular.forEach(a,function(a){h.push(a)})});var i={};return i.push(h),i.push(f),i},generateWhoReportByDate:function(a,b,c){var d=[];angular.forEach(a,function(a){var e=b(),f=c(e,a);d.push(f)});var e=[];return e.push(d),e},generateDonationSummaryReportByDate:function(a,b,c){var d=[];angular.forEach(a,function(a){var e=b(),f=c(e,a);d.push(f)});var e=[];return e.push(d),e},generateSummaryRowsGroupingByCohort:function(a,c,e,f,g,h){
var i={};angular.forEach(a,function(a){var d=b(a,c);if(d){var g=d.option,h=i[g];h||(h=e(),i[g]=h),f(h,a)}});var j=[];return angular.forEach(i,function(a){j.push(a)}),g&&j.push(g(j)),h&&j.push(h(j)),d(j)},generateSummaryRow:function(a,b,c,d){var e=c(b);return angular.forEach(a,function(a){d(e,a)}),e},generateWhoRow:function(a,b,c,d){var e=c(b);return angular.forEach(a,function(a){d(e,a)}),e}}}]),angular.module("bsis").factory("MobileService",["Api",function(a){return{getMobileClinicLookUpFormFields:a.MobileClinicDonors.getForm,mobileClinicLookUp:a.MobileClinicDonors.search,mobileClinicExport:a.MobileClinicDonors["export"],getDonorOutcomesForm:a.MobileClinicDonors.getDonorOutcomesForm,getDonorOutcomes:a.MobileClinicDonors.getDonorOutcomes}}]),angular.module("bsis").factory("LocationsService",["Api",function(a){return{addLocation:a.Locations.save,updateLocation:a.Locations.update,getLocationById:a.Locations.get,getSearchForm:a.Locations.getSearchForm,search:a.Locations.search,getForm:a.Locations.getForm}}]),angular.module("bsis").factory("ConfigurationsService",["$http","Api","$filter","USERCONFIG","UI","DONATION",function(a,b,c,d,e,f){var g={};return{getConfigurations:function(a){b.Configurations.get({},function(b){d=b,a(b.configurations)},function(){a(!1)})},getConfigurationById:function(a,c,d){b.Configurations.get({id:a},function(a){c(a)},function(a){d(a.data)})},setConfiguration:function(a){g=a},getConfiguration:function(){return g},addConfiguration:function(a,c){var d=new b.Configurations;angular.copy(a,d),d.$save(function(a){c(a)},function(a){c(!1,a.data)})},updateConfiguration:function(a,c){var d=angular.copy(a),e=[];b.Configurations.update({id:a.id},d,function(a){g=a.configuration,c(g),e.push(d);for(var b=0,h=e.length;h>b;b++)"dateFormat"==e[b].name?angular.module("bsis").constant("DATEFORMAT",e[b].value):"dateTimeFormat"==e[b].name?angular.module("bsis").constant("DATETIMEFORMAT",e[b].value):"timeFormat"==e[b].name&&angular.module("bsis").constant("TIMEFORMAT",e[b].value),"donation.bpUnit"==e[b].name?f.BPUNIT=e[b].value:"donation.hbUnit"==e[b].name?f.HBUNIT=e[b].value:"donation.weightUnit"==e[b].name?f.WEIGHTUNIT=e[b].value:"donation.pulseUnit"==e[b].name&&(f.PULSEUNIT=e[b].value),"donation.donor.bpSystolicMin"==e[b].name?f.DONOR.BP_SYSTOLIC_MIN=e[b].value:"donation.donor.bpSystolicMax"==e[b].name?f.DONOR.BP_SYSTOLIC_MAX=e[b].value:"donation.donor.bpDiastolicMin"==e[b].name?f.DONOR.BP_DIASTOLIC_MIN=e[b].value:"donation.donor.bpDiastolicMax"==e[b].name?f.DONOR.BP_DIASTOLIC_MAX=e[b].value:"donation.donor.hbMin"==e[b].name?f.DONOR.HB_MIN=e[b].value:"donation.donor.hbMax"==e[b].name?f.DONOR.HB_MAX=e[b].value:"donation.donor.weightMin"==e[b].name?f.DONOR.WEIGHT_MIN=e[b].value:"donation.donor.weightMax"==e[b].name?f.DONOR.WEIGHT_MAX=e[b].value:"donation.donor.pulseMin"==e[b].name?f.DONOR.PULSE_MIN=e[b].value:"donation.donor.pulseMax"==e[b].name&&(f.DONOR.PULSE_MAX=e[b].value)},function(a){c(!1,a.data)})},removeConfiguration:function(a,c){var d=new b.Configurations;angular.copy(a,d),d.$delete({id:a.id},function(a){c(a)},function(a){c(!1,a.data)})},getBooleanValue:function(a){for(var b=d.configurations,c=0;c<b.length;c++)if(b[c].name===a){var e=b[c].value;return angular.isString(e)&&"true"===angular.lowercase(e)}return!1},getIntValue:function(a){for(var b=d.configurations,c=0;c<b.length;c++)if(b[c].name===a){var e=b[c].value;return parseInt(e,10)}return 0},getStringValue:function(a){var b=d.configurations;if(!b)return null;for(var c=0;c<b.length;c++)if(b[c].name===a)return b[c].value;return null}}}]),angular.module("bsis").factory("UsersService",["$http","Api","Authinterceptor","AuthService","Base64",function(a,b,c,d,e){var f={},g={};return{getUsers:function(a){b.Users.get({},function(b){a(b.users)},function(){a(!1)})},getUserById:function(a,c,d){b.Users.get({id:a},function(a){c(a.user)},function(a){d(a.data)})},addUser:function(a,c){var d=new b.Users;angular.copy(a,d),d.$save(function(a){c(a)},function(a){c(!1,a.data)})},updateUser:function(a,c){var d=angular.copy(a);b.Users.update({id:a.id},d,function(a){g=a.role,c(g)},function(a){c(!1,a.data)})},deleteUser:function(a,c){var d=new b.Users;angular.copy(a,d),d.$delete({id:a.id},function(a){c(a)},function(a){c(!1,a.data)})},setUser:function(a){g=a},getUser:function(){return g},setRoles:function(a){f=a},getRoles:function(){return f},getLoggedOnUser:function(a,c){return b.User.get(a,c)},updateLoggedOnUser:function(a,f,g){var h=angular.copy(a);return delete h.$promise,delete h.$resolved,b.Users.update({},h,function(a){if(d.setLoggedOnUser(a),h.modifyPassword){var b=e.encode(a.username+":"+h.password);c.setCredentials(b)}f.apply(this,arguments)},g)}}}]),angular.module("bsis").factory("RolesService",["$http","Api",function(a,b){var c={},d={};return{getRoles:function(a){b.Roles.get({},function(b){a(b.roles)},function(){a(!1)})},getAllPermissions:function(a){b.Permissions.get({},function(b){a(b)},function(){a(!1)})},getRoleById:function(a,c,d){b.Roles.get({id:a},function(a){c(a.role)},function(a){d(a.data)})},updateRole:function(a,d){var e=angular.copy(a);a.permissions.forEach(function(a){e.permissions.push(""+a.id)}),b.Roles.update({id:a.id},a,function(a){c=a.role,d(c)},function(a){d(!1,a.data)})},addRole:function(a,c){var d=new b.Roles;angular.copy(a,d),d.$save(function(a){c(a)},function(a){c(!1,a.data)})},removeRole:function(a,c){var d=b.Roles.remove({id:a.id},function(){c(d)},function(){c(!1)})},setRole:function(a){c=a},getRole:function(){return c},setPermissions:function(a){d=a},getPermissions:function(){return d}}}]),angular.module("bsis").factory("PackTypesService",["$http","Api",function(a,b){var c={};return{getPackTypes:function(a){b.PackTypes.get({},function(b){a(b.allPackTypes)},function(){a(!1)})},getPackTypeById:function(a,c,d){b.PackTypes.get({id:a},function(a){c(a.packtype)},function(a){d(a.data)})},setPackType:function(a){c=a},getPackType:function(){return c},addPackType:function(a,c,d){var e=new b.PackTypes;angular.copy(a,e),e.$save(c,function(a){d(a.data)})},updatePackType:function(a,c,d){b.PackTypes.update({id:a.id},a,c,function(a){d(a.data)})}}}]),angular.module("bsis").factory("ComponentTypesService",["Api",function(a){return{getComponentTypes:a.ComponentTypes.getAll,getComponentTypeById:a.ComponentTypes.get,updateComponentType:a.ComponentTypes.update,createComponentType:a.ComponentTypes.save}}]),angular.module("bsis").factory("ComponentTypeCombinationsService",["Api",function(a){return{getComponentTypeCombinations:a.ComponentTypeCombinations.search,updateComponentTypeCombinations:a.ComponentTypeCombinations.update,getComponentTypeCombinationsForm:a.ComponentTypeCombinations.getForm,createComponentTypeCombinations:a.ComponentTypeCombinations.save,getComponentTypeCombinationById:a.ComponentTypeCombinations.get}}]),angular.module("bsis").factory("BloodTestsService",["Api",function(a){return{getBloodTests:a.BloodTests.search,getBloodTestsForm:a.BloodTests.getForm,createBloodTest:a.BloodTests.save,updateBloodTest:a.BloodTests.update,getBloodTestById:a.BloodTests.get}}]),angular.module("bsis").factory("BloodTestingRulesService",["Api",function(a){return{getBloodTestingRules:a.BloodTestingRules.search,getBloodTestingRuleForm:a.BloodTestingRules.getForm,createBloodTestingRule:a.BloodTestingRules.save,updateBloodTestingRule:a.BloodTestingRules.update,getBloodTestingRuleById:a.BloodTestingRules.get}}]),angular.module("bsis").factory("DeferralReasonsService",["$http","Api",function(a,b){var c={};return{getDeferrals:function(a){b.deferralReasons.get({},function(b){a(b.allDeferralReasons)},function(){a(!1)})},getDeferralReasonById:function(a,c,d){b.deferralReasons.get({id:a},function(a){c(a.reason)},function(a){d(a.data)})},setDeferralReason:function(a){c=a},getDeferralReason:function(){return c},addDeferralReason:function(a,c){var d=new b.deferralReasons;angular.copy(a,d),d.$save(function(a){c(a.reason)},function(a){c(!1,a.data)})},updateDeferralReason:function(a,d){var e=angular.copy(a);b.deferralReasons.update({id:a.id},e,function(a){c=a.reason,d(c)},function(a){d(!1,a.data)})},removeDeferralReason:function(a,c){var d=new b.deferralReasons;angular.copy(a,d),d.$delete({id:a.id},function(a){c(a)},function(a){c(!1,a.data)})}}}]),angular.module("bsis").factory("Base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}}),angular.module("bsis").factory("DiscardReasonsService",["$http","Api",function(a,b){var c={};return{getDiscards:function(a){b.DiscardReasons.get({},function(b){a(b.allDiscardReasons)},function(){a(!1)})},getDiscardReasonById:function(a,c,d){b.DiscardReasons.get({id:a},function(a){c(a.reason)},function(a){d(a.data)})},setDiscardReason:function(a){c=a},getDiscardReason:function(){return c},addDiscardReason:function(a,c){var d=new b.DiscardReasons;angular.copy(a,d),d.$save(function(a){c(a.reason)},function(a){c(!1,a.data)})},updateDiscardReason:function(a,d){var e=angular.copy(a);b.DiscardReasons.update({id:a.id},e,function(a){c=a.reason,d(c)},function(a){d(!1,a.data)})},removeDiscardReason:function(a,c){var d=new b.DiscardReasons;angular.copy(a,d),d.$delete({id:a.id},function(a){c(a)},function(a){c(!1,a.data)})}}}]),angular.module("bsis").factory("DonationTypesService",["$http","Api",function(a,b){var c={};return{getDonationTypes:function(a){b.DonationTypes.get({},function(b){a(b.allDonationTypes)},function(){a(!1)})},getDonationTypeById:function(a,c){var d=b.DonationTypes.get({id:a},function(){c(d.donationType)},function(){c(!1)})},setDonationType:function(a){c=a},getDonationType:function(){return c},addDonationType:function(a,c){var d=new b.DonationTypes;angular.copy(a,d),d.$save(function(a){c(a.donationType)},function(a){c(!1,a.data)})},updateDonationType:function(a,d){var e=angular.copy(a);b.DonationTypes.update({id:a.id},e,function(a){c=a.donationType,d(c)},function(a){d(!1,a.data)})},removeDonationType:function(a,c){var d=new b.DonationTypes;angular.copy(a,d),d.$delete({id:a.id},function(a){c(a)},function(a){c(!1,a.data)})}}}]),angular.module("bsis").factory("PostDonationCounsellingService",["Api",function(a){return{update:a.PostDonationCounsellings.update,getForm:a.PostDonationCounsellings.getForm,getSearchForm:a.PostDonationCounsellings.getSearchForm,search:a.PostDonationCounsellings.get}}]),angular.module("bsis").factory("AdverseEventsService",["Api",function(a){return{getAdverseEventTypes:function(b,c){return a.AdverseEventTypes.query(b,c)},getAdverseEventTypeById:function(b,c,d){return a.AdverseEventTypes.get({id:b},c,d)},createAdverseEventType:function(b,c,d){return a.AdverseEventTypes.save({},b,c,d)},updateAdverseEventType:function(b,c,d){return a.AdverseEventTypes.update({},b,c,d)}}}]),angular.module("bsis").factory("TransfusionReactionTypesService",["Api",function(a){return{getTransfusionReactionTypeById:a.TransfusionReactionTypes.get,getTransfusionReactionTypes:a.TransfusionReactionTypes.get,createTransfusionReactionType:a.TransfusionReactionTypes.save,updateTransfusionReactionType:a.TransfusionReactionTypes.update}}]),angular.module("bsis").factory("RoutingService",["$location",function(a){return{getCurrentPath:function(b){var c=a.path(),d=b.find(function(a){return 0===c.indexOf(a.path)?!0:a.subpaths.some(function(a){return 0===c.indexOf(a)})});return d?d.path:null}}}]),angular.module("bsis").factory("ComponentBatchService",["$http","Api",function(a,b){return{getComponentBatchesFormFields:function(a,c){b.ComponentBatchesFormFields.get({},function(b){a(b)},function(a){c(a.data)})},addComponentBatch:function(a,c,d){var e=new b.ComponentBatches;angular.copy(a,e),e.$save(function(a){c(a)},function(a){d(a.data)})},getComponentBatch:function(a,c,d){b.ComponentBatches.get({id:a},function(a){c(a)},function(a){d(a)})},findComponentBatches:function(a,c,d){b.ComponentBatchesSearch.get({startDate:a.startDate,endDate:a.endDate},function(a){c(a)},function(a){d(a.data)})}}}]),angular.module("bsis").factory("OrderFormsService",["Api",function(a){return{getOrderFormsForm:a.OrderForms.getForm,addOrderForm:a.OrderForms.save,getOrderForm:a.OrderForms.get,updateOrderForm:a.OrderForms.update,deleteOrderForm:a.OrderForms["delete"],getOrderFormItemForm:a.OrderForms.getItemsForm,findOrderForms:a.OrderForms.search}}]),angular.module("bsis").factory("ReturnFormsService",["Api",function(a){return{getReturnFormsForm:a.ReturnForms.getForm,addReturnForm:a.ReturnForms.save,getReturnForm:a.ReturnForms.get,updateReturnForm:a.ReturnForms.update,findReturnForms:a.ReturnForms.search,deleteReturnForm:a.ReturnForms["delete"]}}]),angular.module("bsis").factory("DivisionsService",["Api",function(a){return{getDivision:a.Divisions.get,findDivisions:a.Divisions.search,updateDivision:a.Divisions.update,createDivision:a.Divisions.save}}]),angular.module("bsis").factory("LogosService",["ConfigurationsService",function(a){return{getHeaderLogo1:a.getStringValue("ui.report.base64headerLogo1"),getHeaderLogo2:a.getStringValue("ui.report.base64headerLogo2"),getFooterLogo1:"data:image/png;base64,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",
getFooterLogo2:"data:image/png;base64,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"
}}]),angular.module("bsis").factory("DataExportService",["Api",function(a){return{getDataExport:function(b,c){return a.DataExport.download().then(b,function(a){var b=String.fromCharCode.apply(null,new Uint8Array(a.data)),d=angular.fromJson(b);c(d)})}}}]),angular.module("bsis").factory("UtilsService",function(){return{dateSort:function(a,b){return null===a&&null===b?0:null===b||null!==a&&b>a?-1:null===a||a>b?1:0}}}),angular.module("bsis").factory("TransfusionService",["Api",function(a){return{getTransfusionForm:a.Transfusion.getForm,createTransfusion:a.Transfusion.save,getSearchForm:a.Transfusion.getSearchForm,search:a.Transfusion.search,getTransfusionById:a.Transfusion.get,update:a.Transfusion.update,voidTransfusion:a.Transfusion["delete"]}}]),angular.module("bsis").factory("ComponentValidationService",["ModalsService","$q","gettextCatalog",function(a,b,c){return{showChildComponentWeightConfirmation:function(d,e){return e>d.weight?a.showConfirmation({title:c.getString("Overweight Child Packs"),button:c.getString("Continue"),message:c.getString("Combined weight of components exceeds weight of parent component. Do you want to continue?")}):b.resolve()}}}]),angular.module("bsis").controller("ConfirmModalCtrl",["$scope","$uibModalInstance","$sce","confirmObject",function(a,b,c,d){a.confirmObject=d,a.confirmed=function(){b.close()},a.cancelled=function(){b.dismiss("cancel")},a.renderHtml=function(a){return c.trustAsHtml(a)}}]),angular.module("bsis").controller("ErrorModalCtrl",["$scope","$uibModalInstance","$sce","errorObject",function(a,b,c,d){a.errorObject=d,a.close=function(){b.close()},a.renderHtml=function(a){return c.trustAsHtml(a)}}]),angular.module("bsis").controller("HomeCtrl",["$scope","ICONS","UI","$location",function(a,b,c,d){a.donorsTabEnabled=c.DONORS_TAB_ENABLED,a.componentsTabEnabled=c.COMPONENTS_TAB_ENABLED,a.testingTabEnabled=c.TESTING_TAB_ENABLED,a.labellingTabEnabled=c.LABELLING_TAB_ENABLED,a.inventoryTabEnabled=c.INVENTORY_TAB_ENABLED,a.reportsTabEnabled=c.REPORTS_TAB_ENABLED,a.mobileClinicTabEnabled=c.MOBILE_CLINIC_TAB_ENABLED,a.icons=b,a.go=function(a){d.path(a)},a.isSectionEnabled=function(a){return"disabled"==angular.element(document.querySelector(a)).attr("disabled")?"labelDisabled":void 0}}]),angular.module("bsis").controller("LoginCtrl",["$scope","$location","AuthService","ConfigurationsService","gettextCatalog",function(a,b,c,d,e){a.credentials={username:"",password:""},a.warningMessage=d.getStringValue("ui.header.warningMessage"),"/logout"===b.path()&&(c.logout(),b.path("/login")),a.login=function(d,f){f.$valid?c.login(d,function(){a.loginInvalid=!1,a.credentials.username=null,a.credentials.password=null,f.$setPristine(),b.path("/home")},function(b){a.loginInvalid=!0,401===b&&(a.loginAlert=e.getString("Invalid Username / Password")),0===b&&(a.loginAlert=e.getString("Unable to establish a connection. Please report this issue and try again later"))}):(a.loginInvalid=!0,a.loginAlert=e.getString("Please supply all fields"))}}]),angular.module("bsis").controller("FooterCtrl",["$scope","VERSION",function(a,b){a.copyrightEndyear=(new Date).getFullYear(),a.backendVersion=b.backend.version,a.backendBuildNumber=b.backend.buildNumber,a.frontEndVersion=b.frontend.version,a.frontEndBuildNumber=b.frontend.buildNumber}]),angular.module("bsis").controller("PasswordResetCtrl",["$scope","$location","UsersService","AuthService",function(a,b,c,d){a.setPassword=function(a){if(!a.passwordResetForm.$invalid){var e=d.getLoggedOnUser();if(!e)return void b.path("/login");var f=angular.copy(e);f.modifyPassword=!0,f.password=a.newPassword,f.confirmPassword=a.confirmPassword,c.updateLoggedOnUser(f,function(){b.path("/home")},function(){a.errorMessage="Setting your new password failed. Please try again."})}}}]),angular.module("bsis").controller("ForgotPasswordCtrl",["$scope","Api","gettextCatalog",function(a,b,c){a.username="",a.resetting=!1,a.messageStyle="",a.message="",a.resetPassword=function(){return a.forgotPasswordForm.$invalid?(a.messageStyle="danger",void(a.message=c.getString("You need to provide a username"))):(a.resetting=!0,void b.PasswordResets.save({username:a.username},function(){a.resetting=!1,a.username="",a.forgotPasswordForm.$setPristine(),a.forgotPasswordForm.$setUntouched(),a.messageStyle="success",a.message=c.getString("Your password has been reset. Please check your email for the new password")+"."},function(){a.resetting=!1,a.messageStyle="danger",a.message=c.getString("Password reset failed. Please make sure that you have entered the correct username and try again")+"."}))}}]),angular.module("bsis").controller("LabellingSidebarCtrl",["$scope","RoutingService","ICONS",function(a,b,c){var d=[{path:"/findSafeComponents",subpaths:[]},{path:"/labelComponents",subpaths:[]}];a.icons=c,a.currentPath=b.getCurrentPath(d)}]),angular.module("bsis").controller("LabelComponentsCtrl",["$scope","$location","$log","$routeParams","$timeout","LabellingService","gettextCatalog",function(a,b,c,d,e,f,g){function h(){f.getComponentForm({},function(b){a.componentTypes=b.componentTypes},c.error)}a.serverErrorMessage=null,a.searchResults=null,a.search={donationIdentificationNumber:angular.isDefined(d.donationIdentificationNumber)?d.donationIdentificationNumber:null,componentType:angular.isDefined(d.componentType)?d.componentType:null},a.componentTypes=[],a.verificationParams={componentId:null,prePrintedDIN:null,packLabelDIN:null},a.verifyComponent=null,a.verifying=!1,a.rescanning=!1,a.getComponents=function(d){d&&d.$invalid||(a.verifyComponent=null,a.serverErrorMessage=null,b.search(angular.extend({search:!0},a.search)),a.searching=!0,a.searchResults=!1,f.getComponents(a.search,function(b){a.components=b.components,a.searchResults=!0,a.searching=!1,a.clearLabelVerificationForm()},function(b){c.error(b),a.searching=!1}))},d.search&&a.getComponents(),a.verifyPackLabel=function(b,d){return a.verifying=!0,d.$invalid?void(a.verifying=!1):a.verificationParams.prePrintedDIN===a.verificationParams.packLabelDIN?(d.packLabelDIN.$setValidity("sameDinScanned",!1),a.verifying=!1,void(a.rescanning=!0)):(a.verificationParams.componentId=b.id,void f.verifyPackLabel(a.verificationParams,function(c){c.labelVerified?(b.verificationStatus="verified",a.clearLabelVerificationForm(d),a.verifying=!1,a.verifyComponent=null):(d.packLabelDIN.$setValidity("notVerified",!1),a.rescanning=!0,a.verifying=!1)},function(b){c.error(b),a.verifying=!1}))},a.printPackLabel=function(b){a.serverErrorMessage=null,f.printPackLabel(b.id,function(d){a.labelZPL=d.labelZPL,c.debug("$scope.labelZPL: ",a.labelZPL),a.verifyComponent=b},function(b){"CONFLICT"===b.errorCode&&(a.serverErrorMessage=g.getString("This component cannot be labelled - please check the status of the donor and donation")),c.error(b)})},a.printDiscardLabel=function(b){f.printDiscardLabel(b,function(b){a.labelZPL=b.labelZPL,c.debug("$scope.labelZPL: ",a.labelZPL)},function(a){c.error(a)})},a.clear=function(c){c&&(c.$setUntouched(),c.$setPristine()),b.search({}),a.search={},a.searchResults=null,a.serverErrorMessage=null,a.verifyComponent=null,a.clearLabelVerificationForm()},a.clearLabelVerificationForm=function(b){a.verificationParams={},a.verificationParams.prePrintedDIN=null,a.verificationParams.packLabelDIN=null,a.rescanning=!1,a.verifying=!1,b&&(b.$setUntouched(),b.$setPristine())},a.rescanPackLabel=function(b){a.clearLabelVerificationForm(b),a.verifying=!1,a.rescanning=!1,b.packLabelDIN.$setValidity("sameDinScanned",null),b.packLabelDIN.$setValidity("notVerified",null),e(function(){document.getElementById("prePrintedDIN").focus()},0)},a.onTextClick=function(a){a.target.select()},h()}]),angular.module("bsis").controller("FindSafeComponentsCtrl",["$scope","$log","$filter","gettextCatalog","LabellingService","UtilsService","BLOODGROUP","DATEFORMAT",function(a,b,c,d,e,f,g,h){function i(){a.searchParams=angular.copy(j),a.submitted=!1,a.searching=!1,e.getComponentForm(function(b){b!==!1&&(a.locations=b.locations,a.componentTypes=b.componentTypes,a.bloodGroups=g.options)})}var j={donationIdentificationNumber:null,componentCode:null,locationId:null,bloodGroups:[],componentTypeId:null,allSites:!0,allComponentTypes:!0,anyBloodGroup:!0,inventoryStatus:"NOT_IN_STOCK",startDate:moment().subtract(28,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()};a.search=angular.copy(j);var k=[{name:"DIN",displayName:d.getString("DIN"),field:"donationIdentificationNumber",width:"**",maxWidth:"100"},{name:"Component Code",displayName:d.getString("Component Code"),field:"componentCode",width:"**",maxWidth:"150"},{name:"Date Collected",displayName:d.getString("Date Collected"),field:"createdOn",cellFilter:"bsisDate",width:"**",maxWidth:"130"},{name:"Component Type",displayName:d.getString("Component Type"),field:"componentType.componentTypeName",width:"**"},{name:"Component Status",displayName:d.getString("Component Status"),field:"status",cellFilter:"titleCase | translate",width:"**",maxWidth:"150"},{name:"Inventory Status",displayName:d.getString("Inventory Status"),field:"inventoryStatus",cellFilter:"titleCase | translate",width:"150",maxWidth:"150"},{name:"Expiry Status",displayName:d.getString("Expiry Status"),field:"daysToExpire",cellFilter:"daysToExpire",width:"**",maxWidth:"200",sortingAlgorithm:function(a,b,c,d){return f.dateSort(c.entity.expiresOn,d.entity.expiresOn)}},{name:"Site",displayName:d.getString("Site"),field:"location.name",width:"**",maxWidth:"350"},{name:"Blood Group",displayName:d.getString("Blood Group"),field:"bloodGroup",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.bloodAbo}}{{row.entity.bloodRh}}</div>',width:"**",maxWidth:"150"}];a.dateFormat=h,a.searchParams={},a.submitted=!1,a.searching=!1,a.dinSearch=!1,a.componentTypes=[],a.locations=[],a.gridOptions={data:[],paginationPageSize:8,paginationPageSizes:[10],paginationTemplate:"views/template/pagination.html",minRowsToShow:8,columnDefs:k,exporterPdfOrientation:"portrait",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:{fontSize:4,margin:[-2,0,0,0]},exporterPdfTableHeaderStyle:{fontSize:5,bold:!0,margin:[-2,0,0,0]},exporterPdfMaxGridWidth:400,exporterFieldCallback:function(a,b,e,f){return"createdOn"===e.field?c("bsisDate")(f):"bloodGroup"===e.field?b.entity.bloodAbo+b.entity.bloodRh:"status"===e.field?d.getString(c("titleCase")(f)):"inventoryStatus"===e.field?d.getString(c("titleCase")(f)):"daysToExpire"===e.field?d.getString(c("daysToExpire")(f)):f},exporterPdfHeader:function(){var a=[{text:d.getString("Safe components"),fontSize:10,bold:!0,margin:[30,20,0,0]}];return a},exporterPdfTableStyle:{margin:[-10,10,0,0]},exporterPdfFooter:function(b,e){var f=[{text:d.getString("Number of components: {{componentNumber}}",{componentNumber:a.gridOptions.data.length}),width:"auto"},{text:d.getString("Date generated: {{date}}",{date:c("bsisDateTime")(new Date)}),width:"auto"},{text:d.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:b,pageCount:e}),style:{alignment:"right"}}];return{columns:f,columnGap:10,margin:[30,0],fontSize:6}},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},a.findSafeComponents=function(b){a.findSafeComponentsForm.$invalid||(a.submitted=!0,a.searching=!0,a.gridOptions.paginationCurrentPage=1,""===b.componentCode&&(b.componentCode=null),e.getSafeComponents(b,function(b){a.gridOptions.data=b.components,a.searching=!1}))},function(c){a.gridOptions.data=[],b.error(c),a.searching=!1},a.updateDinSearch=function(){var b=a.searchParams.donationIdentificationNumber;a.searchParams=angular.copy(j),b&&b.length>0?(a.dinSearch=!0,a.searchParams.donationIdentificationNumber=b,a.searchParams.startDate=null,a.searchParams.endDate=null,a.searchParams.inventoryStatus=null):a.dinSearch=!1},a.updateAllSites=function(){a.searchParams.locationId&&(a.searchParams.allSites=!1)},a.clearLocationId=function(){a.searchParams.locationId=null},a.updateAllComponentTypes=function(){a.searchParams.componentTypeId&&(a.searchParams.allComponentTypes=!1)},a.clearComponentTypeId=function(){a.searchParams.componentTypeId=null},a.updateAnyBloodGroup=function(){a.searchParams.bloodGroups&&0!==a.searchParams.bloodGroups.length?a.searchParams.anyBloodGroup=!1:a.searchParams.anyBloodGroup=!0},a.clearBloodGroups=function(){a.searchParams.bloodGroups=[]},a.clearSearch=function(b){a.gridOptions.data=[],a.searchParams=angular.copy(j),a.submitted=!1,a.searching=!1,a.dinSearch=!1,b.$setPristine()},i()}]),angular.module("bsis").controller("AboRhGroupsReportCtrl",["$scope","$log","$filter","ReportsService","ReportsLayoutService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g){function h(a,b,c){var d=angular.copy(a);return d.venue=b,d.cohorts=c,d.aPlus=0,d.aMinus=0,d.bPlus=0,d.bMinus=0,d.abPlus=0,d.abMinus=0,d.oPlus=0,d.oMinus=0,d.empty=0,d.total=0,d}function i(a,b){var c=angular.copy(a);return c.venue="",c.cohorts="All",c.aPlus=a.aPlus+b.aPlus,c.aMinus=a.aMinus+b.aMinus,c.bPlus=a.bPlus+b.bPlus,c.bMinus=a.bMinus+b.bMinus,c.abPlus=a.abPlus+b.abPlus,c.abMinus=a.abMinus+b.abMinus,c.oPlus=a.oPlus+b.oPlus,c.oMinus=a.oMinus+b.oMinus,c.empty=a.empty+b.empty,c.total=a.total+b.total,c}function j(a,b,c){var d=angular.copy(b);return"A+"===c?d.aPlus+=a.value:"A-"===c?d.aMinus+=a.value:"B+"===c?d.bPlus+=a.value:"B-"===c?d.bMinus+=a.value:"AB+"===c?d.abPlus+=a.value:"AB-"===c?d.abMinus+=a.value:"O+"===c?d.oPlus+=a.value:"O-"===c?d.oMinus+=a.value:"nullnull"!==c&&c||(d.empty+=a.value),d.total=d.aPlus+d.aMinus+d.bPlus+d.bMinus+d.abPlus+d.abMinus+d.oPlus+d.oMinus+d.empty,d}function k(a,b){n[o]=a,o+=1,n[o]=b,o+=1,n[o]=i(a,b),o+=1}function l(){var a=g.getString("Male"),b=g.getString("Female");p=[[g.getString("All venues"),b,0,0,0,0,0,0,0,0,0,0],["",a,0,0,0,0,0,0,0,0,0,0],["",g.getString("All"),0,0,0,0,0,0,0,0,0,0]];var c=null;angular.forEach(n,function(d){d.cohorts===b&&(c=p[0]),d.cohorts===a&&(c=p[1]),d.cohorts===g.getString("All")&&(c=p[2]),c[2]=c[2]+d.aPlus,c[3]=c[3]+d.aMinus,c[4]=c[4]+d.bPlus,c[5]=c[5]+d.bMinus,c[6]=c[6]+d.abPlus,c[7]=c[7]+d.abMinus,c[8]=c[8]+d.oPlus,c[9]=c[9]+d.oMinus,c[10]=c[10]+d.empty,c[11]=c[11]+d.total}),p=e.convertAllValuesToText(p)}function m(b){var d="",e={},f={};o=0,n=[],angular.forEach(b,function(b){var c=b.cohorts,g=c[1].option,i=c[2].option;b.cohorts=g,b.location.name!==d&&(a.venuesNumber+=1,""!==d&&k(e,f),d=b.location.name,e=h(b,d,"female"),f=h(b,"","male")),"female"===g&&(e=j(b,e,i)),"male"===g&&(f=j(b,f,i))}),k(e,f),a.gridOptions.data=n,angular.forEach(a.gridOptions.data,function(a){a.cohorts=g.getString(c("titleCase")(a.cohorts))})}var n=[],o={},p=[],q={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()};a.dateFormat=f,a.search=angular.copy(q),a.clearSearch=function(b){a.search=angular.copy(q),b.$setPristine(),b.$setUntouched(),a.gridOptions.data=[],a.submitted=!1},a.getReport=function(c){if(c.$valid){var e={};if(a.search.startDate){var f=moment(a.search.startDate).startOf("day").toDate();e.startDate=f}if(a.search.endDate){var g=moment(a.search.endDate).endOf("day").toDate();e.endDate=g}a.searching=!0,d.generateDonationsReport(e,function(b){a.searching=!1,a.venuesNumber=0,b.dataValues.length>0?(m(b.dataValues),a.gridOptions.paginationCurrentPage=1):a.gridOptions.data=[],a.submitted=!0},function(c){a.searching=!1,b.log(c)})}};var r=[{name:"Venue",displayName:g.getString("Venue"),field:"venue"},{name:"Gender",displayName:g.getString("Gender"),field:"cohorts"},{name:"A+",field:"aPlus",width:55},{name:"A-",field:"aMinus",width:55},{name:"B+",field:"bPlus",width:55},{name:"B-",field:"bMinus",width:55},{name:"AB+",displayName:"AB+",field:"abPlus",width:65},{name:"AB-",displayName:"AB-",field:"abMinus",width:65},{name:"O+",field:"oPlus",width:55},{name:"O-",field:"oMinus",width:55},{name:"NTD",displayName:g.getString("NTD"),field:"empty",width:65},{name:"Total",displayName:g.getString("Total"),field:"total"}];a.gridOptions={data:[],paginationPageSize:9,paginationTemplate:"views/template/pagination.html",columnDefs:r,minRowsToShow:9,exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:e.pdfDefaultStyle,exporterPdfTableHeaderStyle:e.pdfTableHeaderStyle,exporterPdfMaxGridWidth:e.pdfLandscapeMaxGridWidth,exporterPdfCustomFormatter:function(b){return a.venuesNumber>1&&(l(),b=e.addSummaryContent(p,b)),b=e.highlightTotalRows(g.getString("All"),1,b),b=e.paginatePdf(27,b)},exporterPdfHeader:function(){var b=e.generatePdfPageHeader(a.gridOptions.exporterPdfOrientation,g.getString("ABO Rh Blood Grouping Report"),g.getString("Date Period: {{fromDate}} to {{toDate}}",{fromDate:c("bsisDate")(a.search.startDate),toDate:c("bsisDate")(a.search.endDate)}));return b},exporterPdfFooter:function(b,c){return e.generatePdfPageFooter(g.getString("venues"),a.venuesNumber,b,c,a.gridOptions.exporterPdfOrientation)},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")}}]),angular.module("bsis").controller("DonationTypesReportCtrl",["$scope","$log","$filter","ReportsService","ReportGeneratorService","ReportsLayoutService","gettextCatalog","DATEFORMAT",function(a,b,c,d,e,f,g,h){function i(a,b){var c={},d="";return b&&(d=a.location.name),c.venue=d,c.gender="",angular.forEach(q,function(a){c[a.type]=0}),c.total=0,c}function j(a,b){var d=g.getString(c("titleCase")(e.getCohort(b,"Gender").option)),f=e.getCohort(b,"Donation Type").option;a.gender=d,a[f]+=b.value,a.total+=b.value}function k(a){var b=i();return b.gender=g.getString("All"),angular.forEach(a,function(c,d){angular.forEach(q,function(c){b[c.type]+=a[d][c.type]}),b.total+=a[d].total}),b}function l(a){var b=angular.copy(k(a));return b.gender=g.getString("%"),angular.forEach(q,function(a){b[a.type]=c("number")(b[a.type]/b.total*100,2)+"%"}),b.total=c("number")(b.total/b.total*100,2)+"%",b}function m(){var a=[{name:"Venue",displayName:g.getString("Venue"),field:"venue",width:"**",minWidth:"250"},{name:"Gender",displayName:g.getString("Gender"),field:"gender",width:"**",minWidth:"150"}];return angular.forEach(q,function(b){a.push({name:b.type,field:b.type,width:"**",minWidth:"125"})}),a.push({name:"Total",displayName:g.getString("Total"),field:"total",width:"**",minWidth:"125"}),a}function n(){a.gridOptions={data:[],paginationPageSize:8,paginationTemplate:"views/template/pagination.html",columnDefs:s,minRowsToShow:8,exporterPdfOrientation:"portrait",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:f.pdfDefaultStyle,exporterPdfTableHeaderStyle:f.pdfTableHeaderStyle,exporterPdfMaxGridWidth:f.pdfPortraitMaxGridWidth,exporterPdfHeader:function(){var b=f.generatePdfPageHeader(a.gridOptions.exporterPdfOrientation,g.getString("Donations Collected By Type Report"),g.getString("Date Period: {{fromDate}} to {{toDate}}",{fromDate:c("bsisDate")(a.search.startDate),toDate:c("bsisDate")(a.search.endDate)}));return b},exporterPdfCustomFormatter:function(b){if(a.venuesNumber>1){var c=e.generateSummaryRowsGroupingByCohort(r,"Gender",i,j,k,l);c[0][0]=g.getString("All venues"),b=f.addSummaryContent(c,b)}return b=f.highlightTotalRows(g.getString("All"),1,b),b=f.highlightPercentageRows(g.getString("%"),1,b),b=f.paginatePdf(44,b)},exporterPdfFooter:function(b,c){return f.generatePdfPageFooter(g.getString("venues"),a.venuesNumber,b,c,a.gridOptions.exporterPdfOrientation)},onRegisterApi:function(b){a.gridApi=b}}}function o(){d.getDonationsReportForm(function(a){q=a.donationTypes,s=m(),n()},b.error)}var p={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()},q=null;a.dateFormat=h,a.search=angular.copy(p);var r=null;a.clearSearch=function(b){a.search=angular.copy(p),b.$setPristine(),b.$setUntouched(),a.gridOptions.data=[],a.submitted=!1},a.getReport=function(c){if(c.$valid){var f={};if(a.search.startDate){var g=moment(a.search.startDate).startOf("day").toDate();f.startDate=g}if(a.search.endDate){var h=moment(a.search.endDate).endOf("day").toDate();f.endDate=h}a.searching=!0,d.generateDonationsReport(f,function(b){if(a.searching=!1,a.venuesNumber=0,b.dataValues.length>0){r=b.dataValues;var c=e.generateDataRowsGroupingByLocationAndCohort(r,"Gender",i,j,k,l);a.gridOptions.data=c[0],a.venuesNumber=c[1],a.gridOptions.paginationCurrentPage=1}else a.gridOptions.data=[];a.submitted=!0},function(c){a.searching=!1,b.log(c)})}};var s=[];a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},o()}]),angular.module("bsis").controller("TTIPrevalenceReportCtrl",["$scope","$log","$filter","ReportsService","ReportGeneratorService","ReportsLayoutService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g,h){function i(a,b){var c={},d="";return b&&(d=a.location.name),c.venue=d,c.gender="",angular.forEach(p,function(a){c[a.testName]=0}),c.totalPos=0,c.total=0,c.ttiRate="0%",angular.forEach(p,function(a){c[a.testName+"Rate"]="0%"}),c}function j(){var a=h.getString("+"),b=h.getString("%"),c=[{name:"Venue",displayName:h.getString("Venue"),field:"venue",width:"**",minWidth:"200"},{name:"Gender",displayName:h.getString("Gender"),field:"gender",width:"**",maxWidth:"130"}];return angular.forEach(p,function(b){c.push({name:b.testName,displayName:b.testName+" "+a,field:b.testName,width:"**",maxWidth:"80"})}),c=c.concat([{name:"TotalPos",displayName:h.getString("Total")+" "+a,field:"totalPos",width:"**",maxWidth:"80"},{name:"Total",displayName:h.getString("Total"),field:"total",width:"**",maxWidth:"80"},{name:"TTIRate",displayName:h.getString("TTI")+" "+b,field:"ttiRate",width:"**",maxWidth:"80"}]),angular.forEach(p,function(a){c.push({name:a.testName+"Rate",displayName:a.testName+" "+b,field:a.testName+"Rate",width:"**",maxWidth:"80"})}),c}function k(a,b){return c("number")(a/b*100,2)+"%"}function l(a,b){var d=e.getCohort(b,"Gender").option;if(a.gender=h.getString(c("titleCase")(d)),"totalUnitsTested"===b.id)a.total+=b.value;else if("totalUnsafeUnitsTested"===b.id)a.totalPos+=b.value,a.ttiRate=k(a.totalPos,a.total);else{var f=e.getCohort(b,"Blood Test").option,g=e.getCohort(b,"Blood Test Result").option;"POS"===g&&(a[f]+=b.value,a[f+"Rate"]=k(a[f],a.total))}}function m(a){var b=i();return b.gender=h.getString("All"),angular.forEach(a,function(a){b.total+=a.total,b.totalPos+=a.totalPos,angular.forEach(p,function(c){b[c.testName]+=a[c.testName]})}),b.ttiRate=k(b.totalPos,b.total),angular.forEach(p,function(a){b[a.testName+"Rate"]=k(b[a.testName],b.total)}),b}function n(){d.getTTIPrevalenceReportForm(function(b){p=b.ttiBloodTests,a.gridOptions.columnDefs=j()},b.error)}var o={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()},p=null,q=null;a.dateFormat=g,a.search=angular.copy(o),a.clearSearch=function(b){a.search=angular.copy(o),b.$setPristine(),b.$setUntouched(),a.gridOptions.data=[],a.submitted=!1},a.getReport=function(c){if(c.$valid){var f={};if(a.search.startDate){var g=moment(a.search.startDate).startOf("day").toDate();f.startDate=g}if(a.search.endDate){var h=moment(a.search.endDate).endOf("day").toDate();f.endDate=h}a.searching=!0,d.generateTTIPrevalenceReport(f,function(b){if(a.searching=!1,a.venuesNumber=0,b.dataValues.length>0){q=b.dataValues;var c=e.generateDataRowsGroupingByLocationAndCohort(q,"Gender",i,l,m);a.gridOptions.data=c[0],a.venuesNumber=c[1],a.gridOptions.paginationCurrentPage=1}else a.gridOptions.data=[];a.submitted=!0},function(c){a.searching=!1,b.log(c)})}},a.gridOptions={data:[],paginationPageSize:9,paginationTemplate:"views/template/pagination.html",minRowsToShow:9,exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:f.pdfDefaultStyle,exporterPdfTableHeaderStyle:f.pdfTableHeaderStyle,exporterPdfMaxGridWidth:f.pdfLandscapeMaxGridWidth,exporterPdfHeader:function(){var b=f.generatePdfPageHeader(a.gridOptions.exporterPdfOrientation,h.getString("TTI Prevalence Report"),h.getString("Date Period: {{fromDate}} to {{toDate}}",{fromDate:c("bsisDate")(a.search.startDate),toDate:c("bsisDate")(a.search.endDate)}));return b},exporterPdfCustomFormatter:function(b){if(a.venuesNumber>1){var c=e.generateSummaryRowsGroupingByCohort(q,"Gender",i,l,m);c[0][0]=h.getString("All venues"),b=f.addSummaryContent(c,b)}return b=f.highlightTotalRows(h.getString("All"),1,b),b=f.paginatePdf(27,b)},exporterPdfFooter:function(b,c){return f.generatePdfPageFooter(h.getString("venues"),a.venuesNumber,b,c,a.gridOptions.exporterPdfOrientation)},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},n()}]),angular.module("bsis").controller("BloodUnitsIssuedReportCtrl",["$scope","$log","$filter","DATEFORMAT","ReportsService","ReportGeneratorService","ReportsLayoutService","gettextCatalog",function(a,b,c,d,e,f,g,h){function i(a,b){var d={},e="";return b&&(e=a.location.name),d.distributionSite=e,d.componentType="",d.bulkOrder=0,d.bulkIssue=0,d.bulkGap=0,d.bulkRate=c("number")(0,2),d.patientOrder=0,d.patientIssue=0,d.patientGap=0,d.patientRate=c("number")(0,2),d}function j(a,b){var d=f.getCohort(b,"Component Type").option,e=f.getCohort(b,"Order Type").option;a.componentType=d,"unitsOrdered"===b.id?"PATIENT_REQUEST"===e?a.patientOrder=a.patientOrder+b.value:a.bulkOrder=a.bulkOrder+b.value:"unitsIssued"===b.id&&("PATIENT_REQUEST"===e?a.patientIssue=a.patientIssue+b.value:a.bulkIssue=a.bulkIssue+b.value),a.bulkGap=a.bulkOrder-a.bulkIssue,a.bulkRate=c("number")(a.bulkIssue/a.bulkOrder*100,2),a.patientGap=a.patientOrder-a.patientIssue,a.patientRate=c("number")(a.patientIssue/a.patientOrder*100,2)}function k(a){var b=i();return b.componentType=h.getString("Total Blood Units"),angular.forEach(a,function(c,d){b.bulkOrder+=a[d].bulkOrder,b.bulkIssue+=a[d].bulkIssue,b.patientOrder+=a[d].patientOrder,b.patientIssue+=a[d].patientIssue}),b.bulkGap=b.bulkOrder-b.bulkIssue,b.bulkRate=c("number")(b.bulkIssue/b.bulkOrder*100,2),b.patientGap=b.patientOrder-b.patientIssue,b.patientRate=c("number")(b.patientIssue/b.patientOrder*100,2),b}var l={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()};a.dateFormat=d,a.search=angular.copy(l);var m=null;a.clearSearch=function(b){a.search=angular.copy(l),b.$setPristine(),b.$setUntouched(),a.gridOptions.data=[],a.submitted=!1},a.getReport=function(c){if(c.$valid){var d={};if(a.search.startDate){var g=moment(a.search.startDate).startOf("day").toDate();d.startDate=g}if(a.search.endDate){var h=moment(a.search.endDate).endOf("day").toDate();d.endDate=h}a.searching=!0,e.generateBloodUnitsIssuedReport(d,function(b){if(a.searching=!1,b.dataValues.length>0){m=b.dataValues;var c=f.generateDataRowsGroupingByLocationAndCohort(m,"Component Type",i,j,k);a.gridOptions.data=c[0],a.sitesNumber=c[1],a.gridOptions.paginationCurrentPage=1}else a.gridOptions.data=[],a.sitesNumber=0,m=null;a.submitted=!0},function(c){a.searching=!1,b.error(c)})}};var n=[{displayName:h.getString("Distribution Site"),field:"distributionSite",width:"**",minWidth:200},{displayName:h.getString("Component Type"),field:"componentType",width:"**",minWidth:200},{displayName:h.getString("Ordered"),field:"bulkOrder",width:100},{displayName:h.getString("Issued"),field:"bulkIssue",width:100},{displayName:h.getString("Gap"),field:"bulkGap",width:100},{displayName:h.getString("% Issued vs Ordered"),field:"bulkRate",width:100},{displayName:h.getString("Patient Requests"),field:"patientOrder",width:100},{displayName:h.getString("Issued"),field:"patientIssue",width:100},{displayName:h.getString("Gap"),field:"patientGap",width:100},{displayName:h.getString("% Issued vs Requests"),field:"patientRate",width:100}];a.gridOptions={data:[],paginationPageSize:12,paginationTemplate:"views/template/pagination.html",columnDefs:n,minRowsToShow:12,exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:g.pdfDefaultStyle,exporterPdfTableHeaderStyle:g.pdfTableHeaderStyle,exporterPdfMaxGridWidth:g.pdfLandscapeMaxGridWidth,exporterPdfCustomFormatter:function(b){if(a.sitesNumber>1){var c=f.generateSummaryRowsGroupingByCohort(m,"Component Type",i,j,k);c[0][0]=h.getString("All Sites"),b=g.addSummaryContent(c,b)}return b=g.highlightTotalRows(h.getString("Total Blood Units"),1,b),b=g.paginatePdf(33,b)},exporterFieldCallback:function(a,b,c,d){return d=g.addPercentages(c,d)},exporterPdfHeader:function(){var b=h.getString("Distribution Sites")+": "+a.sitesNumber,d=g.generatePdfPageHeader(a.gridOptions.exporterPdfOrientation,h.getString("Blood Units Issued Summary Report"),[h.getString("Date Period: {{fromDate}} to {{toDate}}",{fromDate:c("bsisDate")(a.search.startDate),toDate:c("bsisDate")(a.search.endDate)})],b);return d},exporterPdfFooter:function(b,c){return g.generatePdfPageFooter(h.getString("sites"),a.sitesNumber,b,c,a.gridOptions.exporterPdfOrientation)},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")}}]),angular.module("bsis").controller("DonorsDeferredReportCtrl",["$scope","$log","$filter","ReportsService","gettextCatalog","ReportsLayoutService","DATEFORMAT","uiGridConstants",function(a,b,c,d,e,f,g,h){function i(b,c){var d={venue:b,gender:c};return angular.forEach(a.deferralReasons,function(a){d[a]=0}),d.total=0,d}function j(b,c){var d={venue:"",gender:e.getString("All"),total:b.total+c.total};return angular.forEach(a.deferralReasons,function(a){d[a]=b[a]+c[a]}),d}function k(a){var b=[];for(var c in a)b.push(""+a[c]);return b}function l(b){var c=[],d=null,f=null,g=null,h=i(e.getString("All Venues"),e.getString("Female")),l=i("",e.getString("Female")),m=i("",e.getString("All"));angular.forEach(b,function(b){var k=b.cohorts[0].option,n=b.cohorts[1].option;b.location.name!==d&&(a.venuesNumber+=1,null!==d&&(c.push(f),c.push(g),c.push(j(f,g))),f=i(b.location.name,e.getString("Female")),g=i("",e.getString("Male")),d=b.location.name),"female"===k?(f[n]=b.value,f.total+=b.value,h[n]+=b.value,h.total+=b.value):"male"===k&&(g[n]=b.value,g.total+=b.value,l[n]+=b.value,l.total+=b.value),m[n]+=b.value,m.total+=b.value}),c.push(f),c.push(g),c.push(j(f,g)),a.gridOptions.data=c,a.gridOptions.summaryData=[k(h),k(l),k(m)]}function m(){a.gridOptions={data:[],paginationPageSize:9,paginationTemplate:"views/template/pagination.html",columnDefs:p,minRowsToShow:9,exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:f.pdfDefaultStyle,exporterPdfTableHeaderStyle:f.pdfTableHeaderStyle,exporterPdfMaxGridWidth:f.pdfLandscapeMaxGridWidth,exporterPdfHeader:function(){return f.generatePdfPageHeader(a.gridOptions.exporterPdfOrientation,e.getString("Donors Deferred Summary Report"),e.getString("Date Period: {{fromDate}} to {{toDate}}",{fromDate:c("bsisDate")(a.search.startDate),toDate:c("bsisDate")(a.search.endDate)}))},exporterPdfCustomFormatter:function(b){return a.venuesNumber>1&&(b=f.addSummaryContent(a.gridOptions.summaryData,b)),b=f.highlightTotalRows(e.getString("All"),1,b),b=f.paginatePdf(27,b)},exporterPdfFooter:function(b,c){return f.generatePdfPageFooter(e.getString("venues"),a.venuesNumber,b,c,a.gridOptions.exporterPdfOrientation)},onRegisterApi:function(b){a.gridApi=b}}}function n(){d.getDonorsDeferredReportForm(function(b){angular.forEach(b.deferralReasons,function(b){a.deferralReasons.push(b.reason),p.splice(-1,0,{displayName:b.reason,field:b.reason,width:"**",maxWidth:"125"})}),a.gridApi&&a.gridApi.core.notifyDataChange(h.dataChange.COLUMN),m()},function(a){b.error(a)})}var o={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()};a.deferralReasons=[],a.venuesNumber=0;var p=[{displayName:e.getString("Venue"),field:"venue",width:"**",minWidth:"250"},{displayName:e.getString("Gender"),field:"gender",width:"**",
maxWidth:"150"},{displayName:e.getString("Total"),field:"total",width:"**",maxWidth:"125"}];a.dateFormat=g,a.search=angular.copy(o),a.clearSearch=function(b){a.search=angular.copy(o),b.$setPristine(),b.$setUntouched(),a.gridOptions.data=[],a.submitted=!1},a.getReport=function(c){if(c.$valid){var e={};if(a.search.startDate){var f=moment(a.search.startDate).startOf("day").toDate();e.startDate=f}if(a.search.endDate){var g=moment(a.search.endDate).endOf("day").toDate();e.endDate=g}a.searching=!0,a.venuesNumber=0,a.gridOptions.data=[],d.generateDonorsDeferredReport(e,function(b){a.searching=!1,b.dataValues.length>0&&(l(b.dataValues),a.gridOptions.paginationCurrentPage=1),a.submitted=!0},function(c){a.searching=!1,b.log(c)})}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},n()}]),angular.module("bsis").controller("UnitsDiscardedReportCtrl",["$scope","$log","$filter","ReportsService","ReportsLayoutService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g){function h(a){var b={};return b.venue="",b.componentType=a,angular.forEach(p,function(a){b[a.reason]=0}),b.total=0,b}function i(a){var b=angular.copy(a[0]);a.splice(0,1),a.push(b),angular.forEach(a,function(a){n.push(a)})}function j(a,b,c){var d=b.cohorts,e=d[0].option,f=d[1].option;return a[c]||(a[c]=h(e)),1===c&&(a[c].venue=b.location.name),a[c][f]+=b.value,a[c].total+=b.value,a[0][f]+=b.value,a[0].total+=b.value,a}function k(){var a=angular.copy(q[0]);q.splice(0,1),q.push(a);var b=[];angular.forEach(q,function(a){var c=[];for(var d in a)c.push(""+a[d]);b.push(c)}),q=b}function l(b){var c="",d="",e=[],f=0,l=0,m={};n=[],a.venuesNumber=0,q[0]=h(g.getString("Total")),angular.forEach(b,function(b){b.location.name!==c&&(a.venuesNumber+=1,""!=c&&i(e),c=b.location.name,e=[],e[0]=h(g.getString("Total")),f=0,d=""),d!==b.cohorts[0].option&&(f+=1,d=b.cohorts[0].option);var k=b.cohorts[0].option;m[k]||(l+=1,m[k]=l),j(e,b,f),b.location.name=g.getString("All Processing Sites"),j(q,b,m[k])}),i(e),k(),a.gridOptions.data=n}function m(){d.getUnitsDiscardedReportForm(function(b){a.processingSites=b.processingSites,p=b.discardReasons,angular.forEach(p,function(a){r.splice(-1,0,{displayName:a.reason,field:a.reason,width:"**",minWidth:80,maxWidth:100})})},b.error)}var n=[],o={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate(),allSites:!0,processingSite:null},p=[],q=[];a.search=angular.copy(o),a.dateFormat=f,a.clearSearch=function(b){a.search=angular.copy(o),b.$setPristine(),b.$setUntouched(),a.gridOptions.data=[],a.submitted=!1},a.clearProcessingSite=function(){a.search.processingSite=null},a.updateAllSites=function(){a.search.processingSite&&(a.search.allSites=!1)},a.getReport=function(c){c.$valid&&(q=[],a.searching=!0,d.generateUnitsDiscardedReport(a.search,function(b){a.searching=!1,b.dataValues.length>0?(l(b.dataValues),a.gridOptions.paginationCurrentPage=1):(a.gridOptions.data=[],a.venuesNumber=0),a.submitted=!0},function(c){a.searching=!1,b.log(c)}))};var r=[{name:"Site",displayName:g.getString("Site"),field:"venue",width:"**",minWidth:150},{name:"Component Type",displayName:g.getString("Component Type"),field:"componentType",width:"**",minWidth:150},{name:"Total",displayName:g.getString("Total"),field:"total",width:55}];a.gridOptions={data:[],paginationPageSize:8,paginationTemplate:"views/template/pagination.html",columnDefs:r,minRowsToShow:8,exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:e.pdfDefaultStyle,exporterPdfTableHeaderStyle:e.pdfTableHeaderStyle,exporterPdfMaxGridWidth:e.pdfLandscapeMaxGridWidth,exporterPdfCustomFormatter:function(b){return a.venuesNumber>1&&(b=e.addSummaryContent(q,b)),b=e.highlightTotalRows("Total",1,b),b=e.paginatePdf(26,b)},exporterPdfHeader:function(){var b=g.getString("Number of processing sites: {{sitesNumber}}",{sitesNumber:a.venuesNumber});return e.generatePdfPageHeader(a.gridOptions.exporterPdfOrientation,g.getString("Discards Summary Report"),g.getString("Date Period: {{fromDate}} to {{toDate}}",{fromDate:c("bsisDate")(a.search.startDate),toDate:c("bsisDate")(a.search.endDate)}),b)},exporterPdfFooter:function(b,c){return e.generatePdfPageFooter(g.getString("sites"),a.venuesNumber,b,c,a.gridOptions.exporterPdfOrientation)},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},m()}]),angular.module("bsis").controller("ComponentsProducedReportCtrl",["$scope","$log","$filter","ReportsService","gettextCatalog","ReportsLayoutService","DATEFORMAT",function(a,b,c,d,e,f,g){function h(a){var b=[{}];angular.forEach(o,function(c,d){var e={};0!==d?e.venue="":e.venue=a,e.componentType=c.componentTypeName,e["A+"]=0,e["A-"]=0,e["B+"]=0,e["B-"]=0,e["AB+"]=0,e["AB-"]=0,e["O+"]=0,e["O-"]=0,e.empty=0,e.total=0,b[d]=e});var c={};return c.venue="",c.componentType="Total",c["A+"]=0,c["A-"]=0,c["B+"]=0,c["B-"]=0,c["AB+"]=0,c["AB-"]=0,c["O+"]=0,c["O-"]=0,c.empty=0,c.total=0,b[o.length+1]=c,b}function i(a){angular.forEach(a,function(a){m.push(a)})}function j(){var a=[];angular.forEach(p,function(b){var c=[];for(var d in b)c.push(""+b[d]);a.push(c)}),p=a}function k(b){var c="",d=[];m=[],p=h(e.getString("All Processing Sites")),a.sitesNumber=0,angular.forEach(b,function(b){var e=b.cohorts,f=e[0].option,g=e[1].option;"nullnull"!=g&&g||(g="empty"),b.cohorts=f,b.location.name!==c&&(a.sitesNumber+=1,""!=c&&i(d),c=b.location.name,d=h(c)),angular.forEach(o,function(a,c){f===a.componentTypeName&&(d[c][g]+=b.value,d[c].total+=b.value,d[o.length+1][g]+=b.value,d[o.length+1].total+=b.value,p[c][g]+=b.value,p[c].total+=b.value,p[o.length+1][g]+=b.value,p[o.length+1].total+=b.value)})}),i(d),j(),a.gridOptions.data=m}function l(){d.getComponentProductionReportForm(function(b){a.processingSites=b.processingSites,o=b.componentTypes},function(a){b.error(a)})}var m=[],n={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate(),allSites:!0,processingSite:null},o=[],p=[];a.search=angular.copy(n),a.dateFormat=g,a.clearSearch=function(b){a.search=angular.copy(n),b.$setPristine(),b.$setUntouched(),a.gridOptions.data=[],a.submitted=!1},a.clearProcessingSite=function(){a.search.processingSite=null},a.updateAllSites=function(){a.search.processingSite&&(a.search.allSites=!1)},a.getReport=function(c){c.$valid&&(a.searching=!0,d.generateComponentProductionReport(a.search,function(b){a.searching=!1,b.dataValues.length>0?(k(b.dataValues),a.gridOptions.paginationCurrentPage=1):(a.gridOptions.data=[],a.sitesNumber=0),a.submitted=!0},function(c){a.searching=!1,b.log(c)}))};var q=[{name:"Site",displayName:e.getString("Site"),field:"venue"},{name:"Component Type",displayName:e.getString("Component Type"),field:"componentType"},{name:"A+",field:"A+",width:55},{name:"A-",field:"A-",width:55},{name:"B+",field:"B+",width:55},{name:"B-",field:"B-",width:55},{name:"AB+",displayName:"AB+",field:"AB+",width:65},{name:"AB-",displayName:"AB-",field:"AB-",width:65},{name:"O+",field:"O+",width:55},{name:"O-",field:"O-",width:55},{name:"NTD",displayName:e.getString("NTD"),field:"empty",width:55},{name:"Total",displayName:e.getString("Total"),field:"total",width:55}];a.gridOptions={data:[],paginationPageSize:12,paginationTemplate:"views/template/pagination.html",columnDefs:q,minRowsToShow:12,exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:f.pdfDefaultStyle,exporterPdfTableHeaderStyle:f.pdfTableHeaderStyle,exporterPdfMaxGridWidth:f.pdfLandscapeMaxGridWidth,exporterPdfCustomFormatter:function(b){a.sitesNumber>1&&(b=f.addSummaryContent(p,b)),b=f.highlightTotalRows(e.getString("Total"),1,b);var c=Math.min(o.length+1,27);return b=f.paginatePdf(c,b)},exporterPdfHeader:function(){var b=e.getString("Number of processing sites: {{sitesNumber}}",{sitesNumber:a.sitesNumber});return f.generatePdfPageHeader(a.gridOptions.exporterPdfOrientation,e.getString("Components Produced Summary Report"),e.getString("Date Period: {{fromDate}} to {{toDate}}",{fromDate:c("bsisDate")(a.search.startDate),toDate:c("bsisDate")(a.search.endDate)}),b)},exporterPdfFooter:function(b,c){return f.generatePdfPageFooter(e.getString("sites"),a.sitesNumber,b,c,a.gridOptions.exporterPdfOrientation)},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},l()}]),angular.module("bsis").controller("DonorsAdverseEventsReportCtrl",["$scope","$log","$filter","ReportsService","gettextCatalog","ReportsLayoutService","DATEFORMAT",function(a,b,c,d,e,f,g){function h(){var a={};return a.venue="",angular.forEach(p,function(b){a[b.name]=0}),a.total=0,a}function i(a,b,c){var d=c.cohorts,e=d[0].option;a.venue=c.location.name,a[e]+=c.value,a.total+=c.value,b[e]+=c.value,b.total+=c.value}function j(a){angular.forEach(a,function(a){n.push(a)})}function k(b){var c={},d=h();n=[],a.venuesNumber=0,angular.forEach(b,function(b){var e=c[b.location.name];e||(a.venuesNumber+=1,e=h(),c[b.location.name]=e),i(e,d,b)}),j(c),a.venuesNumber>1&&(d.venue=e.getString("Total All Venues"),n.push(d)),a.gridOptions.data=n}function l(){a.gridOptions={data:[],paginationPageSize:8,paginationTemplate:"views/template/pagination.html",columnDefs:q,minRowsToShow:8,exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:f.pdfDefaultStyle,exporterPdfTableHeaderStyle:f.pdfTableHeaderStyle,exporterPdfMaxGridWidth:f.pdfLandscapeMaxGridWidth,exporterPdfCustomFormatter:function(a){return a=f.highlightTotalRows(e.getString("Total All Venues"),0,a),a=f.paginatePdf(27,a)},exporterPdfHeader:function(){var b=e.getString("Number of venues: {{venuesNumber}}",{venuesNumber:a.venuesNumber});return f.generatePdfPageHeader(a.gridOptions.exporterPdfOrientation,e.getString("Donors Adverse Events Summary Report"),e.getString("Date Period: {{fromDate}} to {{toDate}}",{fromDate:c("bsisDate")(a.search.startDate),toDate:c("bsisDate")(a.search.endDate)}),b)},exporterPdfFooter:function(b,c){return f.generatePdfPageFooter(e.getString("venues"),a.venuesNumber,b,c,a.gridOptions.exporterPdfOrientation)},onRegisterApi:function(b){a.gridApi=b}}}function m(){d.getDonorsAdverseEventsReportForm(function(b){a.venues=b.venues,p=b.adverseEventTypes,angular.forEach(p,function(a){var b=f.hyphenateLongWords(a.name,11);q.splice(-1,0,{displayName:b,field:a.name,width:"**",minWidth:80,maxWidth:100})}),l()},b.error)}var n=[],o={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate(),allVenues:!0,venue:null},p=[];a.search=angular.copy(o),a.dateFormat=g,a.clearSearch=function(b){a.search=angular.copy(o),b.$setPristine(),b.$setUntouched(),a.gridOptions.data=[],a.submitted=!1},a.clearVenue=function(){a.search.venue=null},a.updateAllVenues=function(){a.search.venue&&(a.search.allVenues=!1)},a.getReport=function(c){c.$valid&&(a.searching=!0,d.generateDonorsAdverseEventsReport(a.search,function(b){a.searching=!1,b.dataValues.length>0?(k(b.dataValues),a.gridOptions.paginationCurrentPage=1):(a.gridOptions.data=[],a.venuesNumber=0),a.submitted=!0},function(c){a.searching=!1,b.log(c)}))};var q=[{displayName:e.getString("Venue"),field:"venue",width:"**",minWidth:150},{displayName:e.getString("Total Adverse Events"),field:"total",width:55}];a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},m()}]),angular.module("bsis").controller("TransfusionsReportCtrl",["$scope","$log","$filter","ReportsService","ReportsLayoutService","ReportGeneratorService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g,h){function i(){var a=m.length>12?6:m.length>8?8:12;n.push({displayName:h.getString("Usage Site"),field:"usageSite",width:"**",minWidth:150,maxWidth:250});var b=e.hyphenateLongWords(h.getString("Total Transfused Uneventfully"),a);n.push({displayName:b,field:"totalTransfusedUneventfully"});var c=e.hyphenateLongWords(h.getString("Total Not Transfused"),a);n.push({displayName:c,field:"totalNotTransfused"}),angular.forEach(m,function(b){var c=e.hyphenateLongWords(b.name,a);n.push({displayName:c,field:b.name})});var d=e.hyphenateLongWords(h.getString("Total Reactions"),a);n.push({displayName:d,field:"totalReactions"});var f=e.hyphenateLongWords(h.getString("Total Unknown"),a);n.push({displayName:f,field:"totalUnknown"})}function j(a){var b={};return b.usageSite="",b.totalTransfusedUneventfully=0,b.totalNotTransfused=0,angular.forEach(a,function(a){b[a.name]=0}),b.totalReactions=0,b.totalUnknown=0,b}function k(a,b){a.usageSite=b.location.name;var c=f.getCohort(b,"Transfusion Outcome").option;if("TRANSFUSED_UNEVENTFULLY"===c)a.totalTransfusedUneventfully+=b.value;else if("NOT_TRANSFUSED"===c)a.totalNotTransfused+=b.value;else if("UNKNOWN"===c)a.totalUnknown+=b.value;else if("TRANSFUSION_REACTION_OCCURRED"===c){var d=f.getCohort(b,"Transfusion Reaction Type").option;a[d]+=b.value,a.totalReactions+=b.value}}function l(){d.getTransfusionsReportForm(function(b){a.usageSites=b.usageSites,m=b.transfusionReactionTypes,i(),a.usageSitesNumber=0},b.error)}var m=[],n=[],o={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()};a.search=angular.copy(o),a.dateFormat=g,a.allSites=!0,a.gridOptions={data:[],paginationPageSize:8,paginationTemplate:"views/template/pagination.html",columnDefs:n,minRowsToShow:8,exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:e.pdfDefaultStyle,exporterPdfTableHeaderStyle:e.pdfTableHeaderStyle,exporterPdfMaxGridWidth:600,exporterPdfHeader:function(){var b=h.getString("Usage Sites: {{count}}",{count:a.usageSitesNumber});return e.generatePdfPageHeader(a.gridOptions.exporterPdfOrientation,h.getString("Transfusions Summary Report"),h.getString("Date Period: {{fromDate}} to {{toDate}}",{fromDate:c("bsisDate")(a.search.startDate),toDate:c("bsisDate")(a.search.endDate)}),b)},exporterPdfCustomFormatter:function(a){return a=e.highlightTotalRows(h.getString("All Sites"),0,a),a=e.paginatePdf(27,a)},exporterPdfFooter:function(b,c){return e.generatePdfPageFooter(h.getString("sites"),a.usageSitesNumber,b,c,a.gridOptions.exporterPdfOrientation)},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},a.clearSearch=function(b){a.search=angular.copy(o),b.$setPristine(),b.$setUntouched(),a.gridOptions.data=[],a.submitted=!1,a.allSites=!0},a.clearUsageSite=function(){a.search.transfusionSiteId=null},a.updateAllSites=function(){a.search.transfusionSiteId&&(a.allSites=!1)},a.getReport=function(c){c.$valid&&(a.searching=!0,d.generateTransfusionsReport(a.search,function(b){if(a.searching=!1,b.dataValues.length>0){var c=f.generateDataRowsGroupingByLocation(b.dataValues,m,j,k);if(a.gridOptions.data=c[0],a.usageSitesNumber=c[1],a.usageSitesNumber>1){var d=f.generateSummaryRow(b.dataValues,m,j,k);d.usageSite=h.getString("All Sites"),a.gridOptions.data.push(d)}a.gridOptions.paginationCurrentPage=1}else a.gridOptions.data=[],a.usageSitesNumber=0;a.submitted=!0},function(c){a.searching=!1,b.log(c)}))},l()}]),angular.module("bsis").controller("DonationSummaryReportCtrl",["$scope","$log","$filter","ReportsService","ReportsLayoutService","ReportGeneratorService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g,h){function i(){var a={};return a.donationnumber=0,a.firstname="",a.middlename="",a.lastname="",a.totaldonationsnumber=0,a}function j(a,b){return a.donationnumber=b[0],a.firstname=b[1],a.middlename=b[2],a.lastname=b[3],a.totaldonationsnumber=b[4],a}var k=[],l={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()};a.dateFormat=g,a.search=angular.copy(l);a.clearSearch=function(b){a.search=angular.copy(l),b.$setPristine(),b.$setUntouched(),a.gridOptions.data=[],a.submitted=!1},a.getReport=function(c){if(c.$valid){var e={};if(a.search.startDate){var g=moment(a.search.startDate).startOf("day").toDate();e.startDate=g}if(a.search.endDate){var h=moment(a.search.endDate).endOf("day").toDate();e.endDate=h}a.searching=!0,d.generateDonationSummaryReport(e,function(b){a.searching=!1,console.log("kjhkjbkhjb",b.donationreport);var c=b.donationreport;if(b.donationreport.length>0){var d=f.generateDonationSummaryReportByDate(c,i,j);a.gridOptions.data=d[0],a.gridOptions.paginationCurrentPage=1}else a.gridOptions.data=[];a.submitted=!0},function(c){a.searching=!1,b.error(c)})}};var k=[{displayName:h.getString("Donation Number"),field:"donationnumber",width:"**",minWidth:200},{displayName:h.getString("First Name"),field:"firstname",width:"**",minWidth:200},{displayName:h.getString("Middle Name"),field:"middlename",width:"**",minWidth:200},{displayName:h.getString("Last Name"),field:"lastname",width:"**",minWidth:200},{displayName:h.getString("Total Donations Number"),field:"totaldonationsnumber",width:"**",minWidth:200}];a.gridOptions={data:[],paginationPageSize:12,paginationTemplate:"views/template/pagination.html",columnDefs:k,minRowsToShow:12,exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:e.pdfDefaultStyle,exporterPdfTableHeaderStyle:e.pdfTableHeaderStyle,exporterPdfMaxGridWidth:e.pdfLandscapeMaxGridWidth,exporterPdfHeader:function(){return e.generatePdfPageHeader(a.gridOptions.exporterPdfOrientation,"WHO GDBS Summary Report",["Date Period: ",c("bsisDate")(a.search.startDate)," to ",c("bsisDate")(a.search.endDate)])},exporterPdfCustomFormatter:function(b){return a.venuesNumber>1&&(b=e.addSummaryContent(a.gridOptions.summaryData,b)),b=e.highlightTotalRows("All",1,b),b=e.paginatePdf(27,b)},exporterPdfFooter:function(b,c){return e.generatePdfPageFooter("venues",a.venuesNumber,b,c,a.gridOptions.exporterPdfOrientation)},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")}}]),angular.module("bsis").controller("WhoGdbsReportCtrl",["$scope","$log","$filter","ReportsService","ReportsLayoutService","ReportGeneratorService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g,h){function i(){var a={};return a.totaldonors=0,a.voluntarydonations=0,a.permanentdeferral=0,a.temporarydeferral=0,a.lowweight=0,a.lowhaemoglobin=0,a.medicalcondition=0,a.highriskbehaviour=0,a.travelhistory=0,a.testoutcomes=0,a.otherreasons=0,a.maledonations=0,a.femaledonations=0,a.under18donations=0,a.under24donations=0,a.under44donations=0,a.under64donations=0,a.over64donations=0,a}function j(a,b){return a.totaldonors=b.totaldonors,a.voluntarydonations=b.voluntarydonations,a.permanentdeferral=b.permanentdeferral,a.temporarydeferral=b.temporarydeferral,a.lowweight=b.lowweight,a.lowhaemoglobin=b.lowhaemoglobin,a.medicalcondition=b.medicalcondition,a.highriskbehaviour=b.highriskbehaviour,a.travelhistory=b.travelhistory,a.testoutcomes=b.testoutcomes,a.otherreasons=b.otherreasons,a.maledonations=b.maledonations,a.femaledonations=b.femaledonations,a.under18donations=b.under18donations,a.under24donations=b.under24donations,a.under44donations=b.under44donations,a.under64donations=b.under64donations,a.over64donations=b.over64donations,a}var k=[],l={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()};a.dateFormat=g,a.search=angular.copy(l);a.clearSearch=function(b){a.search=angular.copy(l),b.$setPristine(),b.$setUntouched(),a.gridOptions.data=[],a.submitted=!1},a.getReport=function(c){if(c.$valid){var e={};if(a.search.startDate){var g=moment(a.search.startDate).startOf("day").toDate();e.startDate=g}if(a.search.endDate){var h=moment(a.search.endDate).endOf("day").toDate();e.endDate=h}a.searching=!0,d.generateWhoReport(e,function(b){a.searching=!1,console.log("kjhkjbkhjb",b);var c=[];if(c.push(b),c.length>0){var d=f.generateWhoReportByDate(c,i,j);a.gridOptions.data=d[0],a.gridOptions.paginationCurrentPage=1}else a.gridOptions.data=[];a.submitted=!0},function(c){a.searching=!1,b.error(c)})}};var k=[{displayName:h.getString("Total number of voluntary non-remunerated donors"),field:"totaldonors",width:"**",minWidth:200},{displayName:h.getString("Voluntary non-remunerated donations"),field:"voluntarydonations",width:"**",minWidth:200},{displayName:h.getString("Number of Permanent deferral"),field:"permanentdeferral",width:"**",minWidth:200},{displayName:h.getString("Number of Temporary deferral"),field:"temporarydeferral",width:"**",minWidth:200},{displayName:h.getString("Low weight"),field:"lowweight",width:"**",minWidth:200},{displayName:h.getString("Low haemoglobin"),field:"lowhaemoglobin",width:"**",minWidth:200},{displayName:h.getString("Other medical conditions"),field:"medicalcondition",width:"**",minWidth:200},{displayName:h.getString("High-risk behaviour"),field:"highriskbehaviour",width:"**",minWidth:200},{displayName:h.getString("Travel history"),field:"travelhistory",width:"**",minWidth:200},{displayName:h.getString("Test Outcomes"),field:"testoutcomes",width:100},{displayName:h.getString("Other reasons"),field:"otherreasons",width:100},{displayName:h.getString("Male donors"),field:"maledonations",width:100},{displayName:h.getString("Female donors"),field:"femaledonations",width:100},{displayName:h.getString("under 18 years"),field:"under18donations",width:100},{displayName:h.getString("18 to 24 years"),field:"under24donations",width:100},{displayName:h.getString("25 to 44 years"),field:"under44donations",width:100},{displayName:h.getString("45 to 64 years"),field:"under64donations",width:100},{displayName:h.getString("65 years or older"),field:"over64donations",width:100}];a.gridOptions={data:[],paginationPageSize:12,paginationTemplate:"views/template/pagination.html",columnDefs:k,minRowsToShow:12,exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:e.pdfDefaultStyle,exporterPdfTableHeaderStyle:e.pdfTableHeaderStyle,exporterPdfMaxGridWidth:e.pdfLandscapeMaxGridWidth,exporterPdfHeader:function(){return e.generatePdfPageHeader(a.gridOptions.exporterPdfOrientation,"WHO GDBS Summary Report",["Date Period: ",c("bsisDate")(a.search.startDate)," to ",c("bsisDate")(a.search.endDate)])},exporterPdfCustomFormatter:function(b){return a.venuesNumber>1&&(b=e.addSummaryContent(a.gridOptions.summaryData,b)),b=e.highlightTotalRows("All",1,b),b=e.paginatePdf(27,b)},exporterPdfFooter:function(b,c){return e.generatePdfPageFooter("venues",a.venuesNumber,b,c,a.gridOptions.exporterPdfOrientation)},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")}}]),angular.module("bsis").controller("ReportsSidebarCtrl",["$scope","RoutingService","ICONS",function(a,b,c){var d=[{path:"/aboRhGroupsReport",subpaths:[]},{path:"/donationTypesReport",subpaths:[]},{path:"/ttiPrevalenceReport",subpaths:[]},{path:"/bloodUnitsIssuedReport",subpaths:[]},{path:"/donorsDeferredReport",subpaths:[]},{path:"/unitsDiscardedReport",subpaths:[]},{path:"/componentsProducedReport",subpaths:[]},{path:"/donorsAdverseEventsReport",subpaths:[]},{path:"/transfusionsReport",subpaths:[]}];a.icons=c,a.currentPath=b.getCurrentPath(d)}]),angular.module("bsis").controller("MobileCtrl",["$scope","$filter","$location","$routeParams","MobileService","uiGridExporterConstants","gettextCatalog","DATEFORMAT",function(a,b,c,d,e,f,g,h){a.dateFormat=h,a.venues=[],a.error={message:null},a.currentSearch=null,e.getMobileClinicLookUpFormFields(function(b){a.venues=b.venues},function(b){a.error.message=b.userMessage});var i=a.master={venue:null,clinicDate:null};a.search={venue:angular.isUndefined(d.venueId)?i.venue:d.venueId,clinicDate:angular.isUndefined(d.clinicDate)?i.clinicDate:new Date(d.clinicDate)};var j=[{field:"donorNumber",displayName:g.getString("Donor Number")},{field:"firstName",displayName:g.getString("First Name")},{field:"lastName",displayName:g.getString("Last Name")},{field:"gender",displayName:g.getString("Gender"),cellFilter:"titleCase | translate"},{name:"Date of Birth",displayName:g.getString("Date of Birth"),field:"birthDate",cellFilter:"bsisDate"},{field:"bloodType",displayName:g.getString("Blood Type")},{name:"Eligibility",displayName:g.getString("Eligibility"),field:"eligibility",cellFilter:"eligibility | translate"}];a.gridOptions={enableSorting:!1,data:[],paginationPageSize:10,paginationPageSizes:[10],paginationTemplate:"views/template/pagination.html",columnDefs:j,exporterPdfMaxGridWidth:680,exporterFieldCallback:function(a,c,d,e){return"birthDate"===d.field?b("bsisDate")(e):"eligibility"===d.field?g.getString(b("eligibility")(e)):"gender"===d.field?g.getString(b("titleCase")(e)):e},exporterPdfHeader:function(){var c;angular.forEach(a.venues,function(b){b.id===a.currentSearch.venue&&(c=b.name)});var d=[{text:g.getString("Venue")+": "+c,width:"auto"}];if(a.currentSearch.clinicDate){var e=b("bsisDate")(a.currentSearch.clinicDate);d.push({text:g.getString("Clinic Date")+": "+e,width:"auto"})}return d.push({text:g.getString("Eligible Donors: {{numberEligibleDonors}} out of {{totalDonors}} ({{percentage}}%)",{numberEligibleDonors:a.numberEligibleDonors,totalDonors:a.gridOptions.data.length,percentage:a.percentageEligibleDonor}),width:"auto"}),[{text:g.getString("Mobile Clinic Look Up"),bold:!0,margin:[30,10,30,0]},{columns:d,columnGap:10,margin:[30,0]}]},exporterPdfFooter:function(c,d){var e=[{text:g.getString("Total donors: {{total}}",{total:a.gridOptions.data.length}),width:"auto"},{text:g.getString("Date generated: {{date}}",{date:b("bsisDateTime")(new Date)}),width:"auto"},{text:g.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:c,pageCount:d}),style:{alignment:"right"}}];return{columns:e,columnGap:10,margin:[30,0,50,0]}},onRegisterApi:function(b){a.gridApi=b}};var k=function(a){var b=0;return a.forEach(function(a){a.eligibility&&b++}),b},l=function(a,b){return b>0?Math.round(a/b*100):0};a.onSearch=function(d){if(!d||!d.$invalid){a.currentSearch=angular.copy(a.search);var f={venueId:a.currentSearch.venue,clinicDate:b("isoString")(a.currentSearch.clinicDate)};c.search(angular.extend({search:!0},f)),a.searching=!0,e.mobileClinicLookUp(f,function(b){a.gridOptions.data=b.donors,a.numberEligibleDonors=k(a.gridOptions.data),a.percentageEligibleDonor=l(a.numberEligibleDonors,a.gridOptions.data.length),a.gridOptions.paginationCurrentPage=1,a.searching=!1},function(b){a.error.message=b.data.userMessage,a.searching=!1})}},a.onClear=function(b){a.currentSearch=null,a.error.message=null,a.search=angular.copy(i),c.search({}),b.$setPristine()},d.search&&a.onSearch(),a["export"]=function(b){"pdf"===b&&a.gridApi.exporter.pdfExport(f.ALL,f.ALL)}}]),angular.module("bsis").controller("MobileDonorCounsellingCtrl",["$scope","$log","$filter","$location","$routeParams","$timeout","MobileService","uiGridConstants","uiGridExporterConstants","gettextCatalog","DATEFORMAT",function(a,b,c,d,e,f,g,h,i,j,k){function l(){g.getDonorOutcomesForm(function(b){a.venues=b.venues,angular.forEach(b.bloodTestNames,function(a){q[a]=0,n.push({displayName:a,field:a,visible:!1})}),a.gridApi&&a.gridApi.core.notifyDataChange(h.dataChange.COLUMN),e.search&&(a.search={venueId:e.venueId,startDate:new Date(e.startDate),endDate:new Date(e.endDate)},f(function(){a.getDonorOutcomes()}))},function(a){b.error(a)})}function m(a){var b={};return angular.forEach(a,function(a){var c=a.bloodTest.positiveResults,d=a.bloodTest.negativeResults;-1!==c.indexOf(a.result)?b[a.bloodTest.testNameShort]=2:-1!==d.indexOf(a.result)?b[a.bloodTest.testNameShort]=1:b[a.bloodTest.testNameShort]=0}),b}var n=[{field:"donorNumber",displayName:j.getString("Donor Number")},{field:"firstName",displayName:j.getString("First Name")},{field:"lastName",displayName:j.getString("Last Name")},{field:"gender",displayName:j.getString("Gender"),cellFilter:"titleCase|translate"},{field:"birthDate",displayName:j.getString("Birth Date"),cellFilter:"bsisDate"},{field:"donationDate",displayName:j.getString("Donation Date"),cellFilter:"bsisDate"},{field:"donationIdentificationNumber",displayName:j.getString("DIN")},{field:"bloodAbo",displayName:j.getString("ABO")},{field:"bloodRh",displayName:j.getString("Rh")}],o={venueId:null,startDate:moment().subtract(30,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()},p=null,q={};a.venues=[],a.searching=!1,a.search=angular.copy(o),a.dateFormat=k,a.gridOptions={data:null,columnDefs:n,paginationPageSize:10,paginationPageSizes:[10],paginationTemplate:"views/template/pagination.html",onRegisterApi:function(b){a.gridApi=b},exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:{fontSize:4,margin:[-2,0,0,0]},exporterPdfTableHeaderStyle:{fontSize:5,bold:!0,margin:[-2,0,0,0]},exporterPdfMaxGridWidth:500,exporterFieldCallback:function(a,b,d,e){return"birthDate"===d.field||"donationDate"===d.field?c("bsisDate")(e):"gender"===d.field?j.getString(c("titleCase")(e)):e},exporterPdfHeader:function(){var b="";angular.forEach(a.venues,function(a){a.id===p.venueId&&(b=a.name)});var d=c("bsisDate")(p.startDate),e=c("bsisDate")(p.endDate);return[{text:j.getString("Donor Counselling"),fontSize:10,bold:!0,margin:[30,10,30,0]},{columns:[{text:j.getString("Venue")+": "+b,width:"auto"},{text:j.getString("Start Date")+": "+d,width:"auto"},{text:j.getString("End Date")+": "+e,width:"auto"}],columnGap:10,fontSize:6,margin:[30,0]}]},exporterPdfFooter:function(b,d){var e=[{text:j.getString("Total donors: {{total}}",{total:a.gridOptions.data.length}),width:"auto"},{text:j.getString("Date generated: {{date}}",{date:c("bsisDateTime")(new Date)}),width:"auto"},{text:j.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:b,pageCount:d}),style:{alignment:"right"}}];return{columns:e,columnGap:10,fontSize:6,margin:[30,0,50,0]}}},a.getDonorOutcomes=function(){a.donorCounsellingForm&&a.donorCounsellingForm.$invalid||(a.searching=!0,p=angular.copy(a.search),d.search({search:!0,venueId:p.venueId,startDate:c("isoString")(p.startDate),endDate:c("isoString")(p.endDate)}),g.getDonorOutcomes(a.search,function(b){var c=[];angular.forEach(b.donorOutcomes,function(a){var b={donorNumber:a.donorNumber,lastName:a.lastName,firstName:a.firstName,gender:a.gender,birthDate:a.birthDate,donationDate:a.donationDate,donationIdentificationNumber:a.donationIdentificationNumber,bloodAbo:a.bloodAbo,bloodRh:a.bloodRh},d=m(a.bloodTestResults);angular.merge(b,q,d),c.push(b)}),a.gridOptions.data=c,a.searching=!1,a.gridOptions.paginationCurrentPage=1},function(c){b.error(c),a.searching=!1}))},a.clearSearch=function(){p=null,a.gridOptions.data=null,a.search=angular.copy(o),a.donorCounsellingForm.$setPristine(),d.search({})},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport(i.ALL,i.ALL):"csv"===b&&a.gridApi.exporter.csvExport(i.ALL,i.ALL)},l()}]),angular.module("bsis").controller("MobileClinicExportCtrl",["$scope","$filter","$location","$routeParams","$log","gettextCatalog","MobileService","uiGridExporterConstants","DATEFORMAT",function(a,b,c,d,e,f,g,h,i){function j(){g.getMobileClinicLookUpFormFields(function(b){if(a.venues=b.venues,a.search.clinicDate=angular.isUndefined(d.clinicDate)?k.clinicDate:new Date(d.clinicDate),d.venues){var c=angular.isArray(d.venues)?d.venues:[d.venues];a.search.venues=c.map(function(a){return a})}else a.search.venues=k.venues;a.toggleAllVenues()},function(b){e.error(b),b&&b.userMessage?a.error.message=b.userMessage:a.error.message=f.getString("An error occurred.")})}a.dateFormat=i,a.venues=[],a.search={},a.searching=!1,a.submitted=!1,a.error={};var k={venues:[],allVenues:!0,clinicDate:null},l=[{field:"venue.name",name:"venue",displayName:f.getString("Venue"),width:"**"},{field:"donorNumber",name:"donorNumber",displayName:f.getString("Donor Number"),width:"**",maxWidth:"125"
},{field:"firstName",name:"firstName",displayName:f.getString("First Name"),width:"**"},{field:"lastName",name:"lastName",displayName:f.getString("Last Name"),width:"**"},{field:"gender",name:"gender",displayName:f.getString("Gender"),cellFilter:"titleCase | translate",width:"**",maxWidth:"80"},{field:"birthDate",name:"birthDate",displayName:f.getString("Date of Birth"),cellFilter:"bsisDate",maxWidth:"150"},{field:"bloodType",name:"bloodType",displayName:f.getString("Blood Type"),maxWidth:"100"},{field:"eligibility",name:"eligibility",displayName:f.getString("Eligibility"),cellFilter:"eligibility | translate",maxWidth:"150"}];a.gridOptions={data:[],enableSorting:!1,paginationPageSize:10,paginationTemplate:"views/template/pagination.html",columnDefs:l,exporterFieldCallback:function(a,c,d,e){return"birthDate"===d.field?b("bsisDate")(e):"eligibility"===d.field?f.getString(b("eligibility")(e)):"gender"===d.field?f.getString(b("titleCase")(e)):e},onRegisterApi:function(b){a.gridApi=b}},a.exportMobileClinics=function(){if(!a.mobileClinicExportForm||!a.mobileClinicExportForm.$invalid){c.search(angular.extend({search:!0},a.search));var d={venueIds:a.search.venues,clinicDate:b("isoString")(a.search.clinicDate)};a.searching=!0,g.mobileClinicExport(d,function(b){a.gridOptions.paginationCurrentPage=1,a.gridOptions.data=b.donors,a.searching=!1,a.submitted=!0},function(b){a.error.message=b.data.userMessage,a.searching=!1})}},a.clear=function(){a.gridOptions.data=null,a.gridOptions.enableSorting=!1,a.error={},a.search=angular.copy(k),a.searching=!1,a.submitted=!1,c.search({}),a.mobileClinicExportForm.$setPristine()},a.toggleAllVenues=function(){a.search.venues&&0!==a.search.venues.length?a.search.allVenues=!1:a.search.allVenues=!0},a.clearVenues=function(){a.search.venues=[]},a["export"]=function(b){"csv"===b&&a.gridApi.exporter.csvExport(h.ALL,h.ALL)},j()}]),angular.module("bsis").controller("MobileSidebarCtrl",["$scope","RoutingService","ICONS",function(a,b,c){var d=[{path:"/lookUp",subpaths:[]},{path:"/mobileDonorCounselling",subpaths:[]},{path:"/mobileClinicExport",subpaths:[]}];a.icons=c,a.currentPath=b.getCurrentPath(d)}]),angular.module("bsis").controller("HeaderCtrl",["$scope","$location","AuthService","ConfigurationsService","ICONS","PERMISSIONS","UI","gettextCatalog",function(a,b,c,d,e,f,g,h){function i(a,b){return b.some(function(b){return new RegExp("^"+b+"$").test(a)})}a.icons=e;var j="[0-9a-f\\-]*";a.warningMessage=d.getStringValue("ui.header.warningMessage"),a.isPasswordReset=function(){var a=c.getLoggedOnUser();return a&&a.passwordReset},a.sectionList=[{title:h.getString("HOME"),href:"#home",icon:e.HOME,permission:f.AUTHENTICATED,sectionEnabled:"true"},{title:h.getString("DONORS"),href:"#donors",icon:e.DONORS,permission:f.VIEW_DONOR_INFORMATION,sectionEnabled:g.DONORS_TAB_ENABLED},{title:h.getString("COMPONENTS"),href:"#components",icon:e.COMPONENTS,permission:f.VIEW_COMPONENT_INFORMATION,sectionEnabled:g.COMPONENTS_TAB_ENABLED},{title:h.getString("TESTING"),href:"#testing",icon:e.TESTING,permission:f.VIEW_TESTING_INFORMATION,sectionEnabled:g.TESTING_TAB_ENABLED},{title:h.getString("LABELLING"),href:"#labelling",icon:e.LABELLING,permission:f.LABEL_COMPONENT,sectionEnabled:g.LABELLING_TAB_ENABLED},{title:h.getString("INVENTORY"),href:"#inventory",icon:e.INVENTORY,permission:f.VIEW_INVENTORY_INFORMATION,sectionEnabled:g.INVENTORY_TAB_ENABLED},{title:h.getString("REPORTS"),href:"#reports",icon:e.REPORTS,permission:f.VIEW_REPORTING_INFORMATION,sectionEnabled:g.REPORTS_TAB_ENABLED},{title:h.getString("MOBILE CLINIC"),href:"#mobile",icon:e.MOBILE,permission:f.VIEW_MOBILE_CLINIC_INFORMATION,sectionEnabled:g.MOBILE_CLINIC_TAB_ENABLED},{title:h.getString("SETTINGS"),href:"#settings",icon:e.SETTINGS,permission:f.AUTHENTICATED,sectionEnabled:"true"}];var k=["/donors","/findDonor","/duplicateDonors","/manageDuplicateDonors","/manageDonors","/addDonor","/viewDonor/"+j,"/addDonation","/manageDonationBatches","/manageClinic","/donorCounselling","/exportDonorList","/donorCounselling/"+j,"/manageClinic/"+j],l=["/components","/findComponents","/recordComponents","/findDiscards","/discardComponents","/addComponentBatch","/viewComponentBatch/"+j,"/viewComponentBatches"],m=["/testing","/viewTestSample","/findTestSamples","/manageTestBatches","/manageTestBatch/"+j,"/recordTTIOutcomes/"+j+"/\\w+","/reenterTTIOutcomes/"+j+"/\\w+","/reenterABORhOutcomes/"+j+"/\\w+","/recordRepeatTTIOutcomes/"+j+"/\\w+","/recordABORhOutcomes/"+j+"/\\w+","/recordRepeatABORhOutcomes/"+j+"/\\w+","/resolveAmbiguousABORhOutcomes/"+j],n=["/inventory","/findInventory","/viewStockLevels","/manageOrders","/fulfilOrder/"+j,"/viewOrder/"+j,"/viewOrders","/manageReturns","/recordReturn/"+j,"/viewReturn/"+j,"/viewReturns","/recordTransfusions","/findTransfusion"],o=["/labelling","/findSafeComponents","/labelComponents"],p=["/reports","/aboRhGroupsReport","/donationTypesReport","/ttiPrevalenceReport","/bloodUnitsIssuedReport","/donorsDeferredReport","/unitsDiscardedReport","/componentsProducedReport","/donorsAdverseEventsReport","/transfusionsReport"],q=["/mobile","/lookUp","/mobileDonorCounselling","/mobileClinicExport"],r=["/settings","/accountSettings","/locations","/manageLocation/?"+j,"/componentTypes","/manageComponentType/?"+j,"/manageComponentTypeCombination/?"+j,"/deferralReasons","/manageDeferralReason/?"+j,"/discardReasons","/manageDiscardReason/?"+j,"/configurations","/manageConfiguration/?"+j,"/users","/manageUser/?"+j,"/roles","/manageRole/?"+j,"/donationTypes","/manageDonationType/?"+j,"/packTypes","/managePackType/?"+j,"/auditLog","/adverseEventTypes","/addAdverseEventType","/editAdverseEventType/?"+j,"/divisions","/manageDivision","/manageDivision/?"+j,"/dataExport","/componentTypeCombinations","/bloodTests","/manageBloodTest/?"+j,"/bloodTestingRules","/manageBloodTestingRule/?"+j,"/transfusionReactionTypes","/manageTransfusionReactionType/?"+j],s=function(){i(b.path(),k)?a.currentSection=h.getString("DONORS"):i(b.path(),l)?a.currentSection=h.getString("COMPONENTS"):i(b.path(),m)?a.currentSection=h.getString("TESTING"):i(b.path(),n)?a.currentSection=h.getString("INVENTORY"):i(b.path(),o)?a.currentSection=h.getString("LABELLING"):i(b.path(),p)?a.currentSection=h.getString("REPORTS"):i(b.path(),q)?a.currentSection=h.getString("MOBILE CLINIC"):i(b.path(),r)?a.currentSection=h.getString("SETTINGS"):a.currentSection=h.getString("HOME")},t=a.$on("$locationChangeStart",s);a.$on("$destroy",function(){t()}),a.status={isopen:!1},a.toggleDropdown=function(b){b.preventDefault(),b.stopPropagation(),a.status.isopen=!a.status.isopen},a.logout=function(){c.logout(),b.path("/")},s()}]),angular.module("bsis").controller("DonorCommunicationsCtrl",["$scope","$filter","$location","$routeParams","BLOODGROUP","DATEFORMAT","DonorService","gettextCatalog",function(a,b,c,d,e,f,g,h){function i(a){return angular.isUndefined(a)?null:angular.isArray(a)?a:[a]}a.dateFormat=f,a.venues=[],a.bloodGroups=[],a.error={message:null},a.currentSearch=null,g.getDonationBatchFormFields(function(b){a.bloodGroups=e.options,a.venues=b.venues,a.search.venues=a.search.venues.map(function(b){var c=a.venues;for(var d in c)if(c[d].id===b.id)return c[d];return b}),a.currentSearch&&a.currentSearch.venues&&(a.currentSearch.venues=a.currentSearch.venues.map(function(b){var c=a.venues;for(var d in c)if(c[d].id===b.id)return c[d];return b}))},function(b){a.error.message=b.userMessage});var j=a.master={venues:[],bloodGroups:[],anyBloodGroup:!0,noBloodGroup:!1,lastDonationFromDate:null,lastDonationToDate:null,clinicDate:null};a.search={venues:(i(d.venues)||j.venues).map(function(a){return{id:a}}),bloodGroups:i(d.bloodGroups)||j.bloodGroups,anyBloodGroup:angular.isUndefined(d.anyBloodGroup)?j.anyBloodGroup:d.anyBloodGroup===!0,noBloodGroup:angular.isUndefined(d.noBloodGroup)?j.noBloodGroup:d.noBloodGroup===!0,lastDonationFromDate:angular.isUndefined(d.lastDonationFromDate)?j.lastDonationFromDate:new Date(d.lastDonationFromDate),lastDonationToDate:angular.isUndefined(d.lastDonationToDate)?j.lastDonationToDate:new Date(d.lastDonationToDate),clinicDate:angular.isUndefined(d.clinicDate)?j.clinicDate:new Date(d.clinicDate)};var k=[{displayName:h.getString("Donor Number"),field:"donorNumber"},{displayName:h.getString("First Name"),field:"firstName"},{displayName:h.getString("Middle Name"),field:"middleName"},{displayName:h.getString("Last Name"),field:"lastName"},{displayName:h.getString("Mobile Number"),field:"contact.mobileNumber"},{displayName:h.getString("Date of Last Donation"),field:"dateOfLastDonation",cellFilter:"bsisDate"},{displayName:h.getString("Blood Group"),field:"bloodGroup"},{displayName:h.getString("Venue"),field:"venue.name"}];a.gridOptions={data:[],paginationPageSize:10,paginationPageSizes:[10],paginationTemplate:"views/template/pagination.html",columnDefs:k,exporterFieldCallback:function(a,c,d,e){return"dateOfLastDonation"===d.field?b("bsisDate")(e):e},exporterPdfHeader:function(){var c=a.currentSearch.venues.map(function(a){return a.name}),d=angular.copy(a.currentSearch.bloodGroups);a.currentSearch.anyBloodGroup&&d.push(h.getString("Any")),a.currentSearch.noBloodGroup&&d.push(h.getString("None"));var e=[{text:h.getString("Venues")+": "+c.join(", "),width:"auto"},{text:h.getString("Blood Groups")+": "+d.join(", "),width:"auto"}];if(a.currentSearch.lastDonationFromDate&&a.currentSearch.lastDonationToDate){var f=b("bsisDate")(a.currentSearch.lastDonationFromDate),g=b("bsisDate")(a.currentSearch.lastDonationToDate);e.push({text:h.getString("Date of Last Donation")+": "+h.getString("{{fromDate}} to {{toDate}}",{fromDate:f,toDate:g}),width:"auto"})}if(a.currentSearch.clinicDate){var i=b("bsisDate")(a.currentSearch.clinicDate);e.push({text:h.getString("Due To Donate")+": "+i,width:"auto"})}return[{text:h.getString("Donors List"),bold:!0,margin:[30,10,30,0]},{columns:e,columnGap:10,margin:[30,0]}]},exporterPdfFooter:function(c,d){var e=[{text:h.getString("Total donors")+": "+a.gridOptions.data.length,width:"auto"},{text:h.getString("Date generated: {{date}}",{date:b("bsisDateTime")(new Date)}),width:"auto"},{text:h.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:c,pageCount:d}),style:{alignment:"right"}}];return{columns:e,columnGap:10,margin:[30,0]}},onRegisterApi:function(b){a.gridApi=b}},a.onSearch=function(b){if(!b||!b.$invalid){a.currentSearch=angular.copy(a.search);var d=angular.extend({},a.currentSearch,{venues:a.currentSearch.venues.map(function(a){return a.id})});c.search(angular.extend({},d,{search:!0})),a.searching=!0,g.findDonorListDonors(d,function(b){a.gridOptions.paginationCurrentPage=1,a.gridOptions.data=b,a.searching=!1},function(b){a.error.message=b.userMessage,a.searching=!1})}},a.onClear=function(b){a.currentSearch=null,a.error.message=null,a.search=angular.copy(j),c.search({}),b.$setPristine()},a.onAnyBloodGroupChange=function(){a.search.anyBloodGroup&&(a.search.bloodGroups=[])},a.onBloodGroupSelect=function(){a.search.anyBloodGroup=!1},d.search&&a.onSearch(),a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")}}]),angular.module("bsis").controller("ViewDonorCtrl",["$scope","$location","$log","$filter","$q","ngTableParams","$timeout","$routeParams","DonorService","DonationsService","TestingService","ConfigurationsService","ModalsService","AuthService","gettextCatalog","ICONS","MONTH","TITLE","GENDER","DATEFORMAT","UI","DONATION","PERMISSIONS",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(){i.getDonorById(h.id,function(b){i.setDonor(b),a.donor=b,a.donorPermissions.canDelete=b.permissions.canDelete},function(){b.path("/findDonor")})}function y(){i.getDonorFormFields(function(b){b!==!1&&(a.data=b,a.addressTypes=a.data.addressTypes,a.languages=a.data.languages,a.venues=a.data.venues,a.idTypes=a.data.idTypes,a.preferredContactMethods=a.data.preferredContactMethods,a.title=r.options,a.month=q.options,a.gender=s.options)})}function z(){i.getDonorOverview(h.id,function(b){b!==!1&&(a.data=b,a.flaggedForCounselling=a.data.flaggedForCounselling,a.hasCounselling=a.data.hasCounselling,a.currentlyDeferred=a.data.currentlyDeferred,a.lastDeferral=a.data.deferral,a.deferredUntil=a.data.deferredUntil,a.lastDonation=a.data.lastDonation,a.dateOfFirstDonation=a.data.dateOfFirstDonation,a.totalDonations=a.data.totalDonations,a.dueToDonate=a.data.dueToDonate,a.totalAdverseEvents=b.totalAdverseEvents,a.donorPermissions.canDelete=b.canDelete,a.isEligible=b.isEligible,a.donorInitialized=!0)})}function A(a){return H.id===a.packType.id?e.resolve():m.showConfirmation({title:o.getString("Pack Type Update"),button:o.getString("Continue"),message:o.getString("The pack type has been updated - this will affect the initial components created with this donation. Do you want to continue?")})}function B(){i.getOpenDonationBatches(function(b){b!==!1&&(a.donationBatches=b.donationBatches,a.openDonationBatches=a.donationBatches.length>0)})}function C(){i.getDonationsFormFields(function(b){b!==!1&&(a.data=b,a.packTypes=a.data.packTypes,a.donationTypes=a.data.donationTypes,a.donation=a.data.addDonationForm,H=angular.copy(a.donation.packType),a.haemoglobinLevels=a.data.haemoglobinLevels,a.adverseEventTypes=b.adverseEventTypes)})}function D(b,c){return a.isEligible||!c.backEntry||b.packType.countAsDonation===!1?e.resolve(null):m.showConfirmation({title:o.getString("Ineligible Donor"),button:o.getString("Continue"),message:o.getString("This donor is not eligible to donate. Components for this donation will be flagged as unsafe. Do you want to continue?")})}function E(){i.getDeferralsFormFields(function(b){b!==!1&&(a.data=b,a.deferralReasons=a.data.deferralReasons,a.venues=a.data.venues)})}function F(){a.currentlyDeferred=!1;var b=new Date;b.setHours(23,59,59,0),a.deferredUntilDate=b,a.deferredUntil=o.getString("No current deferrals")}function G(b){var c=new Date(b.deferredUntil);c.setHours(0,0,0,0),a.deferredUntilDate.getTime()<c.getTime()&&(a.currentlyDeferred=!0,a.deferredUntilDate=c,a.deferredUntil=b.deferredUntil)}a.icons=p,a.getBooleanValue=l.getBooleanValue,a.ui=u,a.dateFormat=t,a.data={},a.age="",a.deferralsData={},a.donationsData={},a.donorPermissions={canDelete:!1},a.hstep=1,a.mstep=5,a.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]},a.bpUnit=v.BPUNIT,a.hbUnit=v.HBUNIT,a.weightUnit=v.WEIGHTUNIT,a.pulseUnit=v.PULSEUNIT,a.weightMin=v.DONOR.WEIGHT_MIN,a.weightMax=v.DONOR.WEIGHT_MAX,a.hbMin=v.DONOR.HB_MIN,a.hbMax=v.DONOR.HB_MAX,a.bpSystolicMin=v.DONOR.BP_SYSTOLIC_MIN,a.bpSystolicMax=v.DONOR.BP_SYSTOLIC_MAX,a.bpDiastolicMin=v.DONOR.BP_DIASTOLIC_MIN,a.bpDiastolicMax=v.DONOR.BP_DIASTOLIC_MAX,a.pulseMin=v.DONOR.PULSE_MIN,a.pulseMax=v.DONOR.PULSE_MAX,a.postalSameAsHome=!1,a.workSameAsHome=!1,a.dinLength=v.DIN_LENGTH,a.formErrors=[],a.errorObject={},a.invalidDeferredUntilDate=!1;var H=null;a.sameAsHome=function(a,b){"Postal"==b&&(a.postalAddressLine1.$setViewValue(a.postalSameAsHome.$viewValue===!1?"":a.homeAddressLine1.$modelValue),a.postalAddressLine1.$render(),a.postalAddressLine2.$setViewValue(a.postalSameAsHome.$viewValue===!1?"":a.homeAddressLine2.$modelValue),a.postalAddressLine2.$render(),a.postalAddressCity.$setViewValue(a.postalSameAsHome.$viewValue===!1?"":a.homeAddressCity.$modelValue),a.postalAddressCity.$render(),a.postalAddressDistrict.$setViewValue(a.postalSameAsHome.$viewValue===!1?"":a.homeAddressDistrict.$modelValue),a.postalAddressDistrict.$render(),a.postalAddressState.$setViewValue(a.postalSameAsHome.$viewValue===!1?"":a.homeAddressState.$modelValue),a.postalAddressState.$render(),a.postalAddressProvince.$setViewValue(a.postalSameAsHome.$viewValue===!1?"":a.homeAddressProvince.$modelValue),a.postalAddressProvince.$render(),a.postalAddressCountry.$setViewValue(a.postalSameAsHome.$viewValue===!1?"":a.homeAddressCountry.$modelValue),a.postalAddressCountry.$render(),a.postalAddressZipcode.$setViewValue(a.postalSameAsHome.$viewValue===!1?null:a.homeAddressZipcode.$modelValue),a.postalAddressZipcode.$render()),"Work"==b&&(a.workAddressLine1.$setViewValue(a.workSameAsHome.$viewValue===!1?"":a.homeAddressLine1.$modelValue),a.workAddressLine1.$render(),a.workAddressLine2.$setViewValue(a.workSameAsHome.$viewValue===!1?"":a.homeAddressLine2.$modelValue),a.workAddressLine2.$render(),a.workAddressCity.$setViewValue(a.workSameAsHome.$viewValue===!1?"":a.homeAddressCity.$modelValue),a.workAddressCity.$render(),a.workAddressDistrict.$setViewValue(a.workSameAsHome.$viewValue===!1?"":a.homeAddressDistrict.$modelValue),a.workAddressDistrict.$render(),a.workAddressState.$setViewValue(a.workSameAsHome.$viewValue===!1?"":a.homeAddressState.$modelValue),a.workAddressState.$render(),a.workAddressProvince.$setViewValue(a.workSameAsHome.$viewValue===!1?"":a.homeAddressProvince.$modelValue),a.workAddressProvince.$render(),a.workAddressCountry.$setViewValue(a.workSameAsHome.$viewValue===!1?"":a.homeAddressCountry.$modelValue),a.workAddressCountry.$render(),a.workAddressZipcode.$setViewValue(a.workSameAsHome.$viewValue===!1?null:a.homeAddressZipcode.$modelValue),a.workAddressZipcode.$render())},a.confirmDelete=function(b){return m.showConfirmation({title:o.getString("Delete Donor"),button:o.getString("Delete"),message:o.getString('Are you sure you wish to delete the donor "{{firstName}}, {{middleName}}, {{lastName}} {{donorNumber}}"?',{firstName:b.firstName,middleName:b.middleName,lastName:b.lastName,donorNumber:b.donorNumber})}).then(function(){a.deleteDonor(b)},function(){})},a.deleteDonor=function(a){i.deleteDonor(a.id,function(){b.path("findDonor").search({})},function(a){c.err(a)})},a.getDonations=function(b){a.confirmDelete=!1,a.donationsView="viewDonations",i.getDonations(b,function(b){b!==!1?(a.donationsData=b.allDonations,a.donationResults=a.donationsData.length>0):a.donationResults=!1}),a.donationTableParams=new f({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:a.donationsData.length,getData:function(b,c){var e=a.donationsData,f=c.sorting()?d("orderBy")(e,c.orderBy()):e;c.total(f.length),b.resolve(f.slice((c.page()-1)*c.count(),c.page()*c.count()))}}),a.$watch("donationsData",function(){g(function(){a.donationTableParams.reload()})})},a.showTestResults=!1,a.viewDonationSummary=function(b){a.donation=d("filter")(a.donationsData,{donationIdentificationNumber:b})[0],H=angular.copy(a.donation.packType),a.commentFieldDisabled=!a.donation.adverseEvent,i.getDonationsFormFields(function(b){b!==!1&&(a.haemoglobinLevels=b.haemoglobinLevels,a.packTypes=b.packTypes,a.adverseEventTypes=[null].concat(b.adverseEventTypes))}),a.donation.packType.testSampleProduced===!0&&n.hasPermission(w.VIEW_TEST_OUTCOME)?k.getTestResultsByDIN({donationIdentificationNumber:a.donation.donationIdentificationNumber},function(b){a.testResults=b.testResults.recentTestResults},function(a){c.error(a)}):a.testResults=null,a.donationsView="viewDonationSummary"},a.toggleShowResults=function(b){a.showTestResults=b},a.returnToListView=function(){a.donationsView="viewDonations"},a.updateCommentFieldDisabledState=function(b){a.commentFieldDisabled=!b.adverseEventType.$viewValue,b.adverseEventType.$viewValue||(b.adverseEventComment.$setViewValue(null),b.adverseEventComment.$render())},a.updateDonation=function(b){return A(b).then(function(){var d=e.defer();return i.updateDonation(b,function(b){a.donation.permissions=b.permissions,a.addDonationSuccess=!0,a.donation={},H=null,a.err=null,a.viewDonationSummary(b.donationIdentificationNumber),d.resolve()},function(b){c.error(b),a.err=b,a.addDonationSuccess=!1,d.reject("Server Error")}),d.promise})},a.editDonation=function(b){j.getEditForm({id:a.donation.id},function(c){a.packTypes=c.packTypes,a.adverseEventTypes=[null].concat(c.adverseEventTypes),a.testBatchStatus=c.testBatchStatus,b.$show()},function(a){c.error(a)})},a.cancelEditDonation=function(b){a.formErrors=[],a.errorObject=[],b.$cancel()},a.checkBleedTimes=function(b){return null===b.bleedEndTime?(a.clearError("emptyBleedEndTime"),a.raiseError("emptyBleedEndTime",o.getString("Enter a valid time")),a.getError("emptyBleedEndTime")):a.clearError("emptyBleedEndTime"),null===b.bleedStartTime?(a.clearError("emptyBleedStartTime"),a.raiseError("emptyBleedStartTime",o.getString("Enter a valid time")),a.getError("emptyBleedStartTime")):a.clearError("emptyBleedStartTime"),new Date(b.bleedEndTime)<new Date(b.bleedStartTime)&&0===a.formErrors.length?(a.clearError("endTimeBeforeStartTime"),a.raiseError("endTimeBeforeStartTime",o.getString("End time should be after Start time")),a.getError("endTimeBeforeStartTime")):a.clearError("endTimeBeforeStartTime"),a.formErrors.length>0?"error ":void 0},a.deleteDonation=function(b){i.deleteDonation(b,function(){a.donationsData=a.donationsData.filter(function(a){return a.id!==b}),z()},function(b){c.error(b),a.confirmDelete=!1})},a.viewAddDonationForm=function(){a.donorDonationError=null,a.addDonationSuccess=!0,a.bleedStartTime=new Date,a.bleedEndTime=new Date,a.adverseEvent={type:null,comment:""},a.donationsView="addDonation",C(),B()},a.addDonationSuccess="",a.resetAdverseEventComment=function(){a.adverseEvent.type||(a.adverseEvent.comment=null)};var I=function(){a.donorDonationDINError=null,a.invalidDonorDonationError=null};a.addDonation=function(b,c,d,e,f){f?i.checkDonorAge(a.donor.birthDate).then(function(){return D(b,c)}).then(function(){a.addDonationSuccess="",b.venue=c.venue,b.donationDate=c.donationBatchDate,b.donationBatchNumber=c.batchNumber,b.donorNumber=a.donor.donorNumber,b.bleedStartTime=d,b.bleedEndTime=e,a.adverseEvent.type&&(b.adverseEvent=a.adverseEvent),a.addingDonation=!0,I(),i.addDonation(b,function(){a.addDonationSuccess=!0,a.donation={},H=null,a.getDonations(a.donor.id),a.donationsView="viewDonations",a.submitted="",z(),a.addingDonation=!1},function(b){a.donorDonationError=b,a.addDonationSuccess=!1,angular.isDefined(b.fieldErrors)&&(angular.isDefined(b.fieldErrors["donation.donationIdentificationNumber"])&&(a.donorDonationDINError=b.fieldErrors["donation.donationIdentificationNumber"][0]),angular.isDefined(b.fieldErrors["donation.donor"])&&(a.invalidDonorDonationError=b.fieldErrors["donation.donor"][0])),z(),a.addingDonation=!1})},function(){}):a.submitted=!0},a.printDonorBarcode=function(){i.getDonorBarcode(a.donor.id,function(b){b!==!1&&(a.labelZPL=b.labelZPL,c.debug("$scope.labelZPL: ",a.labelZPL))})},a.getDeferrals=function(b){a.deletingDeferral=!1,a.deferralView="viewDeferrals",i.getDeferrals(b,function(b){b!==!1?(a.deferralsData=b.allDonorDeferrals,a.deferralResults=!0):a.deferralResults=!1}),a.deferralTableParams=new f({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:a.deferralsData.length,getData:function(b,c){var e=a.deferralsData,f=c.sorting()?d("orderBy")(e,c.orderBy()):e;c.total(f.length),b.resolve(f.slice((c.page()-1)*c.count(),c.page()*c.count()))}}),a.$watch("deferralsData",function(){g(function(){a.deferralTableParams.reload()})}),a.endDonorDeferral=function(b,c,d){if(d.$valid){var e={};e.comment=c,i.endDonorDeferral(b.id,e,function(b){F(),z();var c=b;angular.forEach(a.deferralsData,function(a){a.id===c.id&&(a.permissions&&(a.permissions=c.permissions),a.deferredUntil=c.deferredUntil,a.deferralReasonText=c.deferralReasonText),G(a)})},function(b){a.err=b})}},a.updateDonorDeferralReason=function(a,b){var c=new Date;"PERMANENT"===b.durationType?c.setFullYear(2100,0,1):c.setDate(c.getDate()+b.defaultDuration),a.deferredUntil=c},a.deleteDonorDeferral=function(b){var c="";c="PERMANENT"===b.deferralReason.durationType?o.getString("Are you sure you want to void this permanent deferral? The donor may be eligible to donate as a result of this action."):o.getString("Are you sure you want to void this deferral?");var d={title:o.getString("Void Deferral"),button:o.getString("Void"),message:c};m.showConfirmation(d).then(function(){a.deletingDeferral=!0,i.deleteDonorDeferral(b.id,function(){F(),z();var c=a.deferralsData.filter(function(a){return a.id===b.id?!1:(G(a),!0)});a.deferralsData=c,a.deletingDeferral=!1},function(b){a.err=b,a.deletingDeferral=!1})})["catch"](function(){a.deletingDeferral=!1})}},a.updateDonor=function(b){var c=e.defer();return b.birthDate=moment(b.birthDate).format("YYYY-MM-DD"),i.updateDonor(b,function(b){a.donor=b,a.err=null,c.resolve(),a.donorPermissions&&(a.donorPermissions.canDelete=b.permissions.canDelete)},function(d){a.donor=b,a.err=d,c.reject("Server Error")}),c.promise},a.checkIdentifier=function(b){return!b.idNumber||angular.isUndefined(b.idType)?(a.clearError("identifier"),a.raiseError("identifier",o.getString("Please enter a valid identifier")),a.getError("identifier")," "):void a.clearError("identifier")},a.validateForm=function(a){return a.$valid?!0:o.getString("This form is not valid")},a.raiseError=function(b,c){a.formErrors.push({name:b,error:c})},a.clearError=function(b){a.errorObject[b]=[],a.formErrors=a.formErrors.filter(function(a){return a.name!==b})},a.getError=function(b){a.errorObject[b]=a.formErrors.filter(function(a){return a.name==b})},a.checkErrors=function(a,b){return a||b?" ":void 0},a.populateEndDate=function(a){var b=a.deferralReason;a.deferredUntil="PERMANENT"===b.durationType?moment("2100-01-01").toDate():moment().add(b.defaultDuration,"days").toDate()},a.manageDeferral=function(b){a.format=t,a.calIcon="fa-calendar",a.dateToOpen=!0,a.deferralView="manageDeferral",a.deferral={},a.submitted="",b&&(b.deferredUntil=new Date(b.deferredUntil),a.deferral=b)};var J=function(b,c){i.updateDonorDeferral(b,function(d){var e=d;b.permissions&&(b.permissions=e.permissions),F(),angular.forEach(a.deferralsData,function(a){G(a)}),a.getDeferrals(a.donor.id),z(),a.submitted="",a.deferral={},c.$setPristine(),a.savingDeferral=!1},function(b){a.err=b,a.savingDeferral=!1})},K=function(b,c){b.deferredDonor=a.donor,i.addDeferral(b,function(b){b===!0&&(a.getDeferrals(a.donor.id),z(),a.submitted="",a.deferral={},c.$setPristine()),a.savingDeferral=!1})};a.saveDeferral=function(b,c){a.invalidDeferredUntilDate=!1,b.deferralDate||(b.deferralDate=new Date),new Date(b.deferredUntil)<new Date(b.deferralDate)&&(a.invalidDeferredUntilDate=!0),c.$valid&&!a.invalidDeferredUntilDate?(a.addingDeferral=!0,b.id?J(b,c):K(b,c)):a.submitted=!0},x(),y(),E(),z()}]),angular.module("bsis").controller("FindDonorsCtrl",["$scope","$location","$routeParams","ngTableParams","$filter","$timeout","DonorService","DATEFORMAT","Alerting",function(a,b,c,d,e,f,g,h,i){a.donorSearch=c;var j=[{}];a.data=j,a.canAddDonors=!1,a.donorSearch.usePhraseMatch=!0,a.isDonorSearchValid=function(){var b=a.donorSearch;return b.firstName||b.middleName||b.lastName||b.donorNumber||b.donationIdentificationNumber||b.phoneNumber},a.findDonor=function(c){(!c||c.$valid)&&(a.donorSearch.search=!0,i.setPersistErrors(!1),b.search(a.donorSearch),a.searching=!0,g.findDonor(a.donorSearch,function(b){j=b.donors,a.searchResults=!0,a.data=b.donors,a.canAddDonors=b.canAddDonors,a.searching=!1,a.tableParams.$params.page=1},function(){a.searchResults=!1,a.searching=!1}))},a.viewDonor=function(c){a.donor=c,g.setDonor(c),a.format=h,a.initDate=c.birthDate,a.calIcon="fa-calendar",a.donorBirthDateOpen=!1,b.path("/viewDonor/"+c.id).search({})},c.search&&a.findDonor(),a.$watch("data",function(){f(function(){a.tableParams.reload()})}),a.clear=function(b){b&&b.$setPristine(),a.donorSearch={},a.donorSearch.usePhraseMatch=!0},a.tableParams=new d({page:1,count:8,sorting:{}},{defaultSort:"asc",counts:[],total:j.length,getData:function(a,b){var c=b.sorting()?e("orderBy")(j,b.orderBy()):j;b.total(c.length),a.resolve(c.slice((b.page()-1)*b.count(),b.page()*b.count()))}})}]),angular.module("bsis").controller("AddDonorCtrl",["$scope","$location","$routeParams","DonorService","DATEFORMAT","MONTH","TITLE","GENDER",function(a,b,c,d,e,f,g,h){function i(){d.getDonorFormFields(function(b){b!==!1&&(a.data=b,a.addressTypes=a.data.addressTypes,a.languages=a.data.languages,a.venues=a.data.venues,a.donor=a.data.addDonorForm,a.searchDonor=d.getDonor(),a.donor.firstName=c.firstName,a.donor.middleName=c.middleName,a.donor.lastName=c.lastName,a.title=g.options,a.month=f.options,a.gender=h.options)})}a.addDonor=function(c,f,g){if(g){var h=moment(f.year+"-"+f.month+"-"+f.dayOfMonth,"YYYY-M-D");c.birthDate=h.format("YYYY-MM-DD"),moment(h).isValid()?d.checkDonorAge(h).then(function(){a.addingDonor=!0,d.addDonor(c,function(c){a.format=e,a.initDate=a.donor.birthDate,a.donorBirthDateOpen=!1,a.submitted="",b.path("/viewDonor/"+c.id).search({})},function(b){a.errorMessage=b.userMessage,a.err=b,b["donor.birthDate"]&&(a.dobValid=!1),a.addingDonor=!1})}):(a.dobValid=!1,a.addingDonor=!1)}else a.submitted=!0},i()}]),angular.module("bsis").controller("ViewDonationBatchCtrl",["$scope","$location","$log","DonorService","DonationsService","TestingService","ConfigurationsService","ModalsService","AuthService","$q","$filter","$routeParams","ICONS","DATEFORMAT","DONATION","PERMISSIONS","gettextCatalog",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(){d.getDonationBatchById(l.id,function(b){a.donationBatch=b,w=b.donations,a.gridOptions.data=b.donations,a.data=w,d.getDonationBatchFormFields(function(b){a.venues=b.venues},c.error),a.donationBatchDate={date:new Date(a.donationBatch.donationBatchDate),time:new Date(a.donationBatch.donationBatchDate)}},c.error)}function s(b){a.donation=b,v=angular.copy(b.packType),a.donationBatchView="viewDonationSummary",a.commentFieldDisabled=!b.adverseEvent,d.getDonationsFormFields(function(b){b!==!1&&(a.haemoglobinLevels=b.haemoglobinLevels,a.packTypes=b.packTypes,a.adverseEventTypes=[null].concat(b.adverseEventTypes))}),a.donation.packType.testSampleProduced===!0&&i.hasPermission(p.VIEW_TEST_OUTCOME)?f.getTestResultsByDIN({donationIdentificationNumber:a.donation.donationIdentificationNumber},function(b){a.testResults=b.testResults.recentTestResults},function(a){c.error(a)}):a.testResults=null}function t(b){return a.donorSummary.eligible||a.donationBatch.backEntry===!1||b.packType.countAsDonation===!1?j.resolve(null):h.showConfirmation({title:q.getString("Ineligible Donor"),button:q.getString("Continue"),message:q.getString("This donor is not eligible to donate. Components for this donation will be flagged as unsafe. Do you want to continue?")})}function u(a){return v.id===a.packType.id?j.resolve():h.showConfirmation({title:q.getString("Pack Type Update"),button:q.getString("Continue"),message:q.getString("The pack type has been updated - this will affect the initial components created with this donation. Do you want to continue?")})}a.icons=m,a.dateFormat=n,a.bpUnit=o.BPUNIT,a.hbUnit=o.HBUNIT,a.weightUnit=o.WEIGHTUNIT,a.pulseUnit=o.PULSEUNIT,a.weightMin=o.DONOR.WEIGHT_MIN,a.weightMax=o.DONOR.WEIGHT_MAX,a.hbMin=o.DONOR.HB_MIN,a.hbMax=o.DONOR.HB_MAX,a.bpSystolicMin=o.DONOR.BP_SYSTOLIC_MIN,a.bpSystolicMax=o.DONOR.BP_SYSTOLIC_MAX,a.bpDiastolicMin=o.DONOR.BP_DIASTOLIC_MIN,a.bpDiastolicMax=o.DONOR.BP_DIASTOLIC_MAX,a.pulseMin=o.DONOR.PULSE_MIN,a.pulseMax=o.DONOR.PULSE_MAX,a.dinLength=o.DIN_LENGTH;var v=null;a.getBooleanValue=g.getBooleanValue;var w=[{}];a.data=w,a.errorObject={},a.formErrors=[],a.addDonationSuccess="",a.showTestResults=!1,a.today=new Date;var x=[{name:"Donor Number",displayName:q.getString("Donor Number"),field:"donorNumber"},{name:"DIN",displayName:q.getString("DIN"),field:"donationIdentificationNumber"},{name:"Pack Type",displayName:q.getString("Pack Type"),field:"packType.packType"},{name:"Donation Type",displayName:q.getString("Donation Type"),field:"donationType.type"}];a.gridOptions={data:[],paginationPageSize:10,paginationPageSizes:[10],paginationTemplate:"views/template/pagination.html",rowTemplate:"views/template/clickablerow.html",columnDefs:x,exporterFieldCallback:function(a,b,c,d){return"Date of Last Donation"===c.name?k("bsisDate")(d):d},exporterPdfHeader:function(){var b,c=a.donationBatch.venue.name,d=k("bsisDate")(a.donationBatch.donationBatchDate),e=k("bsisDate")(a.donationBatch.lastUpdated);b=a.donationBatch.isClosed?q.getString("Closed"):q.getString("Open");
var f=[{text:q.getString("Batch Status")+": "+b,width:"auto"},{text:q.getString("Venue")+": "+c,width:"auto"},{text:q.getString("Date Created")+": "+d,width:"auto"},{text:q.getString("Last Updated")+": "+e,width:"auto"}];return[{text:q.getString("Donation Batch Report"),bold:!0,margin:[30,10,30,0]},{columns:f,columnGap:10,margin:[30,0]}]},exporterPdfFooter:function(b,c){var d=[{text:q.getString("Total donations")+": "+a.gridOptions.data.length,width:"auto"},{text:q.getString("Date generated: {{date}}",{date:k("bsisDateTime")(new Date)}),width:"auto"},{text:q.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:b,pageCount:c}),style:{alignment:"right"}}];return{columns:d,columnGap:10,margin:[30,0]}},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},a.returnToListView=function(){a.format=n,a.initDate="",a.calIcon="fa-calendar",r(),a.donationBatchView="viewDonationBatch"},a.validateDonationBatchEditableForm=function(b){return b.donationBatchDate.$error.dateInFuture||b.donationBatchDate.$error.required||b.donationBatchDateTime.$invalid?"invalid":(a.confirmEdit=!1,!0)},a.cancelDonationBatchEditing=function(){r()},a.updateDonationBatch=function(b,e){e?d.reopenDonationBatch(b,function(c){b.isClosed=c.isClosed,a.refreshDonationBatch(b,c)},function(a){c.error(a)}):(b.donationBatchDate=a.donationBatchDate.date,d.updateDonationBatch(b,function(c){a.refreshDonationBatch(b,c)},function(a){c.error(a)}))},a.updateTimeOnDonationBatchDate=function(){a.donationBatchDate.time&&(a.donationBatchDate.date=moment(a.donationBatchDate.date).hour(a.donationBatchDate.time.getHours()).minutes(a.donationBatchDate.time.getMinutes()).toDate())},a.refreshDonationBatch=function(b,c){b.permissions&&(b.permissions=c.permissions),b.donations=c.donations,w=b.donations,a.gridOptions.data=b.donations,a.data=w,a.donation&&(a.donation=k("filter")(a.data,{donationIdentificationNumber:a.donation.donationIdentificationNumber})[0],v=angular.copy(a.donation.packType))},a.closeDonationBatch=function(a){d.closeDonationBatch(a,function(){b.path("/manageDonationBatches")},function(a){c.error(a)})},a.deleteDonationBatch=function(a){d.deleteDonationBatch(a,function(){b.path("/manageDonationBatches")},function(a){c.error(a)})},a.onRowClick=function(a){d.getDonation(a.entity.id,function(a){s(a.donation)},function(a){c.error(a)})},a.updateCommentFieldDisabledState=function(b){a.commentFieldDisabled=!b.adverseEventType.$viewValue,b.adverseEventType.$viewValue||(b.adverseEventComment.$setViewValue(null),b.adverseEventComment.$render())},a.toggleShowResults=function(b){a.showTestResults=b},a.viewAddDonationForm=function(){a.err={},a.addDonationSuccess=null,a.donation={},v=angular.copy(a.donation.packType),a.donorSummary={},a.donorSummaryLoading=!1,a.adverseEvent={type:null,comment:""},a.$watch("donation.donorNumber",function(){a.donation.donorNumber&&(a.donorSummaryLoading=!0,d.getDonorSummaries(a.donation.donorNumber,function(b){a.donorSummary=b.donor,a.donorSummary.eligible=b.eligible,a.donorSummaryLoading=!1}))}),a.bleedStartTime=new Date,a.bleedEndTime=new Date,a.donationBatchView="addDonation",d.getDonationsFormFields(function(b){b!==!1&&(a.data=b,a.venues=b.venues,a.packTypes=a.data.packTypes,a.donationTypes=a.data.donationTypes,a.donation=a.data.addDonationForm,v=angular.copy(a.donation.packType),a.haemoglobinLevels=a.data.haemoglobinLevels,a.adverseEventTypes=b.adverseEventTypes)})},a.resetAdverseEventComment=function(){a.adverseEvent.type||(a.adverseEvent.comment=null)};var y=function(){a.donationIdentificationNumberError=null,a.invalidDonorError=null};a.addDonation=function(b,e,f,g){g?d.checkDonorAge(a.donorSummary.birthDate).then(function(){return t(b)}).then(function(){a.addDonationSuccess="",d.setDonationBatch(a.donationBatch),b.venue=a.donationBatch.venue,b.donationDate=a.donationBatch.donationBatchDate,b.donationBatchNumber=a.donationBatch.batchNumber,b.bleedStartTime=e,b.bleedEndTime=f,a.adverseEvent.type&&(b.adverseEvent=a.adverseEvent),a.addingDonation=!0,y(),d.addDonationToBatch(b,function(b){a.addDonationSuccess=!0,a.donation={},v=null,a.donationBatchView="viewDonationBatch",a.donationBatch=b,a.gridOptions.data=a.donationBatch.donations,a.submitted="",a.err={},a.addingDonation=!1},function(b){a.err=b,a.addDonationSuccess=!1,a.addingDonation=!1,angular.isDefined(b.fieldErrors)&&(c.debug(b.fieldErrors),angular.isDefined(b.fieldErrors["donation.donationIdentificationNumber"])&&(a.donationIdentificationNumberError=b.fieldErrors["donation.donationIdentificationNumber"][0]),angular.isDefined(b.fieldErrors["donation.donor"])&&(a.invalidDonorError=b.fieldErrors["donation.donor"][0]))})},function(){}):a.submitted=!0},a.viewDonationBatch=function(){a.donation={},v=null,a.donationBatchView="viewDonationBatch"},a.updateDonation=function(b){return u(b).then(function(){d.updateDonation(b,function(){a.addDonationSuccess=!0,a.donation={},v=null,s(b)},function(b){c.error(b),a.addDonationSuccess=!1})})},a.deleteDonation=function(b){d.deleteDonation(b,function(){w=w.filter(function(a){return a.id!==b}),a.donorClinicTableParams.reload()},function(b){c.error(b),a.confirmDelete=!1})},a.validateForm=function(a){return a.$valid?!0:q.getString("This form is not valid")},a.raiseError=function(b,c){a.formErrors.push({name:b,error:c})},a.clearError=function(b){a.errorObject[b]=[],a.formErrors=a.formErrors.filter(function(a){return a.name!==b})},a.getError=function(b){a.errorObject[b]=a.formErrors.filter(function(a){return a.name==b})},a.checkErrors=function(a,b){return a||b?" ":void 0},a.editDonation=function(b){e.getEditForm({id:a.donation.id},function(c){a.packTypes=c.packTypes,a.adverseEventTypes=[null].concat(c.adverseEventTypes),a.testBatchStatus=c.testBatchStatus,b.$show()},function(a){c.error(a)})},a.cancelEditDonation=function(b){a.formErrors=[],a.errorObject=[],b.$cancel()},a.checkBleedTimes=function(b){return null===b.bleedEndTime?(a.clearError("emptyBleedEndTime"),a.raiseError("emptyBleedEndTime",q.getString("Enter a valid time")),a.getError("emptyBleedEndTime")):a.clearError("emptyBleedEndTime"),null===b.bleedStartTime?(a.clearError("emptyBleedStartTime"),a.raiseError("emptyBleedStartTime",q.getString("Enter a valid time")),a.getError("emptyBleedStartTime")):a.clearError("emptyBleedStartTime"),new Date(b.bleedEndTime)<new Date(b.bleedStartTime)&&0===a.formErrors.length?(a.clearError("endTimeBeforeStartTime"),a.raiseError("endTimeBeforeStartTime",q.getString("End time should be after Start time")),a.getError("endTimeBeforeStartTime")):a.clearError("endTimeBeforeStartTime"),a.formErrors.length>0?" ":void 0},r()}]),angular.module("bsis").controller("DonorCounsellingCtrl",["$scope","$location","$routeParams","$log","$filter","gettextCatalog","PostDonationCounsellingService","DATEFORMAT",function(a,b,c,d,e,f,g,h){function i(){if(c.venue){var b=angular.isArray(c.venue)?c.venue:[c.venue];a.search.selectedVenues=b.map(function(a){return a})}if(c.startDate){var d=new Date(c.startDate);a.search.startDate=d}if(c.endDate){var e=new Date(c.endDate);a.search.endDate=e}if(c.counsellingStatus){var f=c.counsellingStatus;a.search.counsellingStatus=f}if(c.flaggedForCounselling){var g=c.flaggedForCounselling;a.search.flaggedForCounselling=angular.lowercase(g)===!0}if(a.search.referred=null,c.referred){var h=c.referred;a.search.referred=angular.lowercase(h)===!0}if(a.search.notReferred=null,c.notReferred){var i=c.notReferred;a.search.notReferred=angular.lowercase(i)===!0}c.search&&a.refresh()}function j(){g.getSearchForm(function(b){a.venues=b.venues,a.counsellingStatuses=b.counsellingStatuses,i()},function(a){d.error(a)})}var k={selectedVenues:[],startDate:null,endDate:null,anyDate:!0,allVenues:!0,counsellingStatuses:[],referred:!0,notReferred:!0,flaggedForCounselling:!1};a.search=angular.copy(k),a.dateFormat=h,a.donations=[],a.searched=!1,c.startDate&&(a.search.startDate=new Date(c.startDate)),c.endDate&&(a.search.endDate=new Date(c.endDate)),a.clearSearch=function(){b.search({}),a.searched=!1,a.search=angular.copy(k)},a.updateAllVenues=function(){a.search.allVenues=!1},a.clearDates=function(){a.search.startDate=null,a.search.endDate=null},a.updateAnyDate=function(){(a.search.startDate||a.search.endDate)&&(a.search.anyDate=!1)},a.clearVenues=function(){a.search.selectedVenues=[]},a.viewDonorCounselling=function(a){b.path("/donorCounselling/"+a.donorId)},a.refresh=function(){if(a.findDonorCounsellingForm.$valid){var c={search:!0},f={};if(a.search.startDate){var h=e("isoString")(a.search.startDate);f.startDate=h,c.startDate=h}if(a.search.endDate){var i=e("isoString")(a.search.endDate);f.endDate=i,c.endDate=i}a.search.selectedVenues.length>0&&(f.venue=a.search.selectedVenues,c.venue=a.search.selectedVenues,a.search.allVenues=!1),f.flaggedForCounselling=a.search.flaggedForCounselling,c.flaggedForCounselling=a.search.flaggedForCounselling,f.counsellingStatus=a.search.counsellingStatus,c.counsellingStatus=a.search.counsellingStatus,0==a.search.flaggedForCounselling&&"RECEIVED_COUNSELLING"!==a.search.counsellingStatus?(f.referred=null,c.referred=null,f.notReferred=null,c.notReferred=null):(f.referred=a.search.referred,c.referred=a.search.referred,f.notReferred=a.search.notReferred,c.notReferred=a.search.notReferred),b.search(c),a.searching=!0,a.gridOptions.data=[],g.search(f,function(b){a.searched=!0,a.donations=b.counsellings,a.gridOptions.data=b.counsellings,a.searching=!1,a.gridOptions.paginationCurrentPage=1},function(b){d.error(b),a.searching=!1})}},a.onRowClick=function(a){b.path("donorCounselling/"+a.entity.donorId).search({})},a.clearCounsellingStatusReferredAndNotReferred=function(){a.search.counsellingStatus=null,a.search.referred=null,a.search.notReferred=null},a.updateReferredAndNotReferredState=function(){"RECEIVED_COUNSELLING"!==a.search.counsellingStatus?(a.search.referred=null,a.search.notReferred=null):(a.search.referred=!1,a.search.notReferred=!1)};var l=[{name:"Donor Number",displayName:f.getString("Donor Number"),field:"donorNumber"},{name:"First Name",displayName:f.getString("First Name"),field:"firstName"},{name:"Middle Name",displayName:f.getString("Middle Name"),field:"middleName"},{name:"Last Name",displayName:f.getString("Last Name"),field:"lastName"},{name:"Gender",displayName:f.getString("Gender"),field:"gender",cellFilter:"titleCase | translate"},{name:"Date of Birth",displayName:f.getString("Date of Birth"),field:"birthDate",cellFilter:"bsisDate"},{name:"Blood Group",displayName:f.getString("Blood Group"),field:"bloodGroup"},{name:"DIN",displayName:f.getString("DIN"),field:"donationIdentificationNumber"},{name:"Date of Donation",displayName:f.getString("Date of Donation"),field:"donationDate",cellFilter:"bsisDate"},{name:"Venue",displayName:f.getString("Venue"),field:"venue.name"},{name:"Referred",displayName:f.getString("Referred"),field:"referred",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity["referred"] ? (row.entity["referred"] | translate) : "" }}</div>'},{name:"Counselled",displayName:f.getString("Counselled"),field:"counselled",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity["counselled"] ? (row.entity["counselled"] | translate) : "" }}</div>'},{name:"Date",displayName:f.getString("Date"),field:"counsellingDate",cellFilter:"bsisDate"}];a.gridOptions={data:[],paginationPageSize:10,paginationPageSizes:[10],paginationTemplate:"views/template/pagination.html",rowTemplate:"views/template/clickablerow.html",columnDefs:l,exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0},exporterFieldCallback:function(a,b,c,d){return-1!==c.name.indexOf("Date")?e("bsisDate")(d):"gender"===c.field?f.getString(e("titleCase")(d)):"counselled"===c.field?d?f.getString(d):"":"referred"===c.field?d?f.getString(d):"":d},exporterPdfMaxGridWidth:650,exporterPdfHeader:function(){var b=a.search.selectedVenues.map(function(b){for(var c in a.venues)if(a.venues[c].id===b)return a.venues[c].name}),c=[{text:f.getString("Venue")+": "+(b.join(",")||f.getString("Any")),width:"auto",fontSize:10}];if(a.search.startDate&&a.search.endDate){var d=e("bsisDate")(a.search.startDate),g=e("bsisDate")(a.search.endDate);c.push({text:f.getString("Donation Period")+": "+d+f.getString("to")+g,width:"auto",fontSize:10})}return[{text:f.getString("List of donors for post donation counselling"),bold:!0,margin:[30,10,30,0],fontSize:12},{columns:c,columnGap:10,margin:[30,0]}]},exporterPdfFooter:function(b,c){var d=[{text:f.getString("Total donors: {{total}}",{total:a.gridOptions.data.length}),width:"auto"},{text:f.getString("Date generated: {{date}}",{date:e("bsisDateTime")(new Date)}),width:"auto"},{text:f.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:b,pageCount:c}),style:{alignment:"right"}}];return{columns:d,columnGap:10,margin:[30,0]}},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},j()}]),angular.module("bsis").controller("DonorCounsellingDetailsCtrl",["$scope","$window","$routeParams","$log","DonorService","PostDonationCounsellingService","TestingService","ICONS","DATEFORMAT",function(a,b,c,d,e,f,g,h,i){a.icons=h,a.dateFormat=i,a.postDonationCounselling={},a.donation={},a.donor={},a.counsellingStatuses=[],a.referralSites=[],a.testResults=[],a.today=moment().startOf("day").toDate(),a.goBack=function(){b.history.back()},a.updateReferralSites=function(){a.postDonationCounselling.referralSite=null},a.updateReferredEnabled=function(){"RECEIVED_COUNSELLING"===a.postDonationCounselling.counsellingStatus?(a.referredEnabled=!0,null===a.postDonationCounselling.referred&&(a.postDonationCounselling.referred=!1)):(a.referredEnabled=!1,a.postDonationCounselling.referred=null,a.postDonationCounselling.referralSite=null)},a.updatePostDonationCounselling=function(){if(a.postDonationCounselling.counsellingDate&&a.postDonationCounselling.counsellingStatus&&!a.postDonationCounsellingForm.$invalid){var b={id:a.postDonationCounselling.id,counsellingStatus:a.postDonationCounselling.counsellingStatus,counsellingDate:a.postDonationCounselling.counsellingDate,notes:a.postDonationCounselling.notes,referred:a.postDonationCounselling.referred,referralSite:a.postDonationCounselling.referralSite};a.updatingCounselling=!0,f.update(b,function(){a.goBack(),a.updatingCounselling=!1},function(b){d.error(b),a.updatingCounselling=!1})}},f.getForm(function(b){a.counsellingStatuses=b.counsellingStatuses,a.referralSites=b.referralSites},function(a){d.error(a)}),a.removeStatus=function(){a.updatingCounselling=!0,f.update({id:a.postDonationCounselling.id,flaggedForCounselling:!0},function(){a.goBack(),a.updatingCounselling=!1},function(b){d.error(b.data),a.updatingCounselling=!1})},e.getDonorPostDonationCounselling(c.donorId,function(b){a.postDonationCounselling=b,a.donation=b.donation,a.donor=b.donor,null!==a.postDonationCounselling.counsellingStatus&&"RECEIVED_COUNSELLING"===a.postDonationCounselling.counsellingStatus&&(a.referredEnabled=!0),b.counsellingDate?a.postDonationCounselling.counsellingDate=new Date(b.counsellingDate):a.postDonationCounselling.counsellingDate=new Date,g.getTestResultsByDIN({donationIdentificationNumber:b.donation.donationIdentificationNumber},function(b){a.testResults=b.testResults.recentTestResults},function(a){d.error(a)})},function(a){d.error(a)})}]),angular.module("bsis").controller("DonorsDuplicateCtrl",["$scope","$location","DonorService","$filter","ngTableParams","$timeout",function(a,b,c,d,e,f){a.hasDuplicates=!1,a.findDonorDuplicates=function(){c.findAllDonorDuplicates(function(b){b!==!1&&(a.data=b.duplicates,a.duplicateDonorCount=b.duplicates.length,a.duplicateDonorCount>0&&(a.hasDuplicates=!0))})},a.findDonorDuplicates(),a.duplicateDonorTableParams=new e({page:1,count:12,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:a.duplicateDonorCount,getData:function(b,c){var e=c.sorting()?d("orderBy")(a.data,c.orderBy()):a.data;c.total(e.length),b.resolve(e.slice((c.page()-1)*c.count(),c.page()*c.count()))}}),a.$watch("data",function(){f(function(){a.duplicateDonorTableParams.reload()})}),a.viewDuplicates=function(a){b.path("/manageDuplicateDonors").search({groupKey:a.groupKey})}}]),angular.module("bsis").controller("ManageDonorsDuplicateCtrl",["$scope","$window","$location","$routeParams","DonorService","$filter","ngTableParams","$timeout","$log","ICONS","UI","DONATION","gettextCatalog",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.icons=j,a.ui=k,a.weightUnit=l.WEIGHTUNIT;var n=[{}];a.duplicatesData=n,a.duplicateCount=0;var o=[{}];a.donationsData=o;var p=[{}];a.deferralsData=p;var q="1";d.groupKey&&(q=d.groupKey);var r=1;a.currentStep=r,a.lastStep=7;var s={};a.donorFields=s;var t=[{}];a.selectedDonorsData=t;var u={};a.mergedDonorData=u;var v={};a.mergedDonor=v,a.manageDonorDuplicates=function(){e.findDonorDuplicates(q,function(b){if(b!==!1){n=[];var c=b.duplicates;angular.forEach(c,function(a){a.merge=null,n.push(a)})}a.duplicatesData=n,a.donor=n[0],a.duplicateCount=a.duplicatesData.length,a.groupKey=q})},a.manageDonorDuplicates(),a.manageDuplicateDonorTableParams=new g({page:1,count:100,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:a.duplicatesData.length,getData:function(a,b){var c=b.filter()?f("filter")(n,b.filter()):n,d=b.sorting()?f("orderBy")(c,b.orderBy()):n;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("duplicatesData",function(){h(function(){a.manageDuplicateDonorTableParams.reload()})}),a.manageSelectedDuplicateDonorTableParams=new g({page:1,count:100,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:a.selectedDonorsData.length,getData:function(a,b){var c=b.filter()?f("filter")(t,b.filter()):t,d=b.sorting()?f("orderBy")(c,b.orderBy()):t;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("selectedDonorsData",function(){h(function(){a.manageSelectedDuplicateDonorTableParams.reload()})}),a.previewMerge=function(){e.mergePreviewDonorsDuplicate(q,a.copyMergedDonor(),function(b){o=b.allDonations,a.donationsData=o,a.donationResults=0!==o.length,p=b.allDeferrals,a.deferralResults=0!==p.length,a.deferralsData=p;var c=p.slice();c.sort(function(a,b){return a.deferredUntil-b.deferredUntil}),c.length>0?(a.lastDeferral=c[0],a.durationType=a.lastDeferral.deferralReason.durationType):a.lastDeferral=null,a.updatedMergedDonor=b.mergedDonor,v.dateOfFirstDonation=b.mergedDonor.dateOfFirstDonation,v.dueToDonate=b.mergedDonor.dueToDonate,v.dateOfLastDonation=b.mergedDonor.dateOfLastDonation},function(b){a.hasMessage=!0,a.message=m.getString("Error merging the duplicate Donors."),i.log("More information: "+b.moreInfo+" ... "+angular.toJson(b))})},a.copyMergedDonor=function(){var a=angular.copy(v);return a.firstName=t[0].firstName,a.middleName=t[0].middleName,a.lastName=t[0].lastName,a.gender=t[0].gender,a.birthDate=t[0].birthDate,a.duplicateDonorNumbers=[],angular.forEach(t,function(b){a.duplicateDonorNumbers.push(b.donorNumber)}),a},a.manageDuplicateDonorDonationsTableParams=new g({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:a.donationsData.length,getData:function(a,b){var c=b.filter()?f("filter")(o,b.filter()):o,d=b.sorting()?f("orderBy")(c,b.orderBy()):o;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("donationsData",function(){h(function(){a.manageDuplicateDonorDonationsTableParams.reload()})}),a.manageDuplicateDonorDeferralTableParams=new g({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:a.deferralsData.length,getData:function(b,c){var d=a.deferralsData,e=c.filter()?f("filter")(p,c.filter()):d,g=c.sorting()?f("orderBy")(e,c.orderBy()):d;c.total(g.length),b.resolve(g.slice((c.page()-1)*c.count(),c.page()*c.count()))}}),a.$watch("deferralsData",function(){h(function(){a.manageDuplicateDonorDeferralTableParams.reload()})}),a.goBack=function(){b.history.back()},a.step=function(b,c,d){if(a.invalid=!1,a.hasMessage=!1,a.message="",a.currentStep<c&&!d.$valid)return void(a.invalid=!0);if(1==b&&2==c){t=[],s={},s.idNumber=!1,s.title=!1,s.callingName=!1,s.preferredLanguage=!1,s.venue=!1,s.contactMethodType=!1,s.email=!1,s.mobileNumber=!1,s.homeNumber=!1,s.workNumber=!1;var e=!1;if(angular.forEach(n,function(a){a.merge&&(null!==a.idNumber&&""!==a.idNumber&&(s.idNumber=!0),null!==a.title&&""!==a.title&&(s.title=!0),null!==a.callingName&&""!==a.callingName&&(s.callingName=!0),null!==a.preferredLanguage&&""!==a.preferredLanguage&&(s.preferredLanguage=!0),null!==a.venue&&""!==a.venue&&(s.venue=!0),null!==a.contactMethodType&&""!==a.contactMethodType&&(s.contactMethodType=!0),null!==a.contact.email&&""!==a.contact.email&&(s.email=!0),null!==a.contact.mobileNumber&&""!==a.contact.mobileNumber&&(s.mobileNumber=!0),null!==a.contact.homeNumber&&""!==a.contact.homeNumber&&(s.homeNumber=!0),null!==a.contact.workNumber&&""!==a.contact.workNumber&&(s.workNumber=!0),null!==a.preferredAddressType&&""!==a.preferredAddressType&&(s.preferredAddressType=!0),null!==a.address.homeAddressLine1&&""!==a.address.homeAddressLine1&&(s.homeAddress=!0),null!==a.address.workAddressLine1&&""!==a.address.workAddressLine1&&(s.workAddress=!0),null!==a.address.postalAddressLine1&&""!==a.address.postalAddressLine1&&(s.postalAddress=!0),v.bloodRh?a.bloodRh&&v.bloodRh!=a.bloodRh&&(e=!0):v.bloodRh=a.bloodRh,v.bloodAbo?a.bloodAbo&&v.bloodAbo!=a.bloodAbo&&(e=!0):v.bloodAbo=a.bloodAbo,t.push(a))}),a.selectedDonorsData=t,a.donorFields=s,null===t||t.length<=1)return a.message=m.getString("Please select at least two donors."),a.invalid=!0,void(a.hasMessage=!0);if(e){if(!a.bloodTypingMismatchCheck)return a.message=m.getString("The selected donors do not have the same blood group. If you continue, the merged donor will not be assigned a blood group, and will be considered a first time donor."),a.invalid=!0,a.hasMessage=!0,void(a.bloodTypingMismatchCheck=!0);v.bloodAbo="",v.bloodRh=""}}else 2==b&&3==c?(v.notes="",angular.forEach(t,function(a){a.id==u.title&&(v.title=a.title),a.id==u.callingName&&(v.callingName=a.callingName),a.id==u.preferredLanguage&&(v.preferredLanguage=a.preferredLanguage),a.id==u.venue&&(v.venue=a.venue),a.id==u.idNumber&&(v.idType=a.idType,v.idNumber=a.idNumber),u.noteSelection&&u.noteSelection[a.id]&&(v.notes?(v.notes.length>0&&(v.notes=v.notes.concat(", ")),v.notes=v.notes.concat(a.notes)):v.notes=a.notes)})):3==b&&4==c?(v.contact={},angular.forEach(t,function(a){a.id==u.contactMethodType&&(v.contactMethodType=a.contactMethodType),a.id==u.email&&(v.contact.email=a.contact.email),a.id==u.mobileNumber&&(v.contact.mobileNumber=a.contact.mobileNumber),a.id==u.homeNumber&&(v.contact.homeNumber=a.contact.homeNumber),a.id==u.workNumber&&(v.contact.workNumber=a.contact.workNumber)})):4==b&&5==c&&(v.address={},angular.forEach(t,function(a){a.id==u.preferredAddressType&&(v.preferredAddressType=a.preferredAddressType),a.id==u.homeAddress&&(v.address.homeAddressLine1=a.address.homeAddressLine1,v.address.homeAddressLine2=a.address.homeAddressLine2,v.address.homeAddressCity=a.address.homeAddressCity,v.address.homeAddressProvince=a.address.homeAddressProvince,v.address.homeAddressDistrict=a.address.homeAddressDistrict,v.address.homeAddressCountry=a.address.homeAddressCountry,v.address.homeAddressState=a.address.homeAddressState,v.address.homeAddressZipcode=a.address.homeAddressZipcode),a.id==u.postalAddress&&(v.address.postalAddressLine1=a.address.postalAddressLine1,v.address.postalAddressLine2=a.address.postalAddressLine2,v.address.postalAddressCity=a.address.postalAddressCity,v.address.postalAddressProvince=a.address.postalAddressProvince,v.address.postalAddressDistrict=a.address.postalAddressDistrict,v.address.postalAddressCountry=a.address.postalAddressCountry,v.address.postalAddressState=a.address.postalAddressState,v.address.postalAddressZipcode=a.address.postalAddressZipcode),a.id==u.workAddress&&(v.address.workAddressLine1=a.address.workAddressLine1,v.address.workAddressLine2=a.address.workAddressLine2,v.address.workAddressCity=a.address.workAddressCity,v.address.workAddressProvince=a.address.workAddressProvince,v.address.workAddressDistrict=a.address.workAddressDistrict,v.address.workAddressCountry=a.address.workAddressCountry,v.address.workAddressState=a.address.workAddressState,v.address.workAddressZipcode=a.address.workAddressZipcode)}),a.previewMerge());a.currentStep=c},a.merge=function(){e.mergeDonorsDuplicate(q,a.copyMergedDonor(),function(a){c.path("/viewDonor/"+a.id).search({})},function(b){a.hasMessage=!0,a.message=m.getString("Error merging the duplicate Donors."),i.log("More information: "+b.moreInfo+" ... "+angular.toJson(b))})},a.cancel=function(){c.path("/duplicateDonors")},a.viewDonor=function(a){c.path("/viewDonor/"+a.id).search({})}}]),angular.module("bsis").controller("DonorsSidebarCtrl",["$scope","RoutingService","ICONS",function(a,b,c){var d=[{path:"/findDonor",subpaths:["/viewDonor","/addDonor"]},{path:"/duplicateDonors",subpaths:["/manageDuplicateDonors"]},{path:"/manageDonationBatches",subpaths:["/manageClinic"]},{path:"/donorCounselling",subpaths:[]},{path:"/exportDonorList",subpaths:[]}];a.icons=c,a.currentPath=b.getCurrentPath(d)}]),angular.module("bsis").controller("ManageDonationBatchesCtrl",["$scope","$location","$log","DonorService","ICONS","$q","$filter","DATEFORMAT","ngTableParams","$timeout",function(a,b,c,d,e,f,g,h,i,j){function k(){d.getOpenDonationBatches(function(b){b!==!1&&(l=b.donationBatches,a.data=l,d.getDonationBatchFormFields(function(b){a.venues=b.venues,angular.forEach(l,function(b){angular.forEach(a.venues,function(c,d){c.name==b.venue.name&&(a.venues[d].disabled=!0)})})},c.error),a.openDonationBatches=l.length>0)})}var l=[],m=null,n={isClosed:!0,selectedVenues:[],startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()};a.data=l,a.recentDonationBatchData=m,a.openDonationBatches=!1,a.recentDonationBatches=!1,a.newDonationBatch={backEntry:!1,donationBatchDate:moment().toDate()},a.maxDonationBatchDate=moment().endOf("day").toDate(),a.dateFormat=h,a.icons=e,a.updateDonationBatchDate=function(){a.newDonationBatch.backEntry?a.newDonationBatch.donationBatchDate=null:a.newDonationBatch.donationBatchDate=moment().toDate()},a.clearDates=function(){a.search.startDate=null,a.search.endDate=null},a.clearVenues=function(){a.search.selectedVenues=[]},a.clearDonationBatchForm=function(b){a.newDonationBatch={backEntry:!1,donationBatchDate:moment().toDate()},b.$setPristine(),b.$setUntouched(),a.err=null},a.clearSearch=function(c){b.search({}),a.search=angular.copy(n),c.$setPristine(),c.$setUntouched()},a.search=angular.copy(n),a.getRecentDonationBatches=function(b){if(b.$valid){var e=angular.copy(a.search);if(a.search.startDate){var f=moment(a.search.startDate).startOf("day").toDate();e.startDate=f}if(a.search.endDate){var g=moment(a.search.endDate).endOf("day").toDate();e.endDate=g}a.search.selectedVenues.length>0&&(e.venues=a.search.selectedVenues),a.searching=!0,d.getRecentDonationBatches(e,function(b){a.searching=!1,b!==!1&&(a.recentDonationBatchesTableParams.$params.page=1,m=b.donationBatches,a.recentDonationBatchData=m,a.recentDonationBatches=m.length>0)},function(b){a.searching=!1,c.log(b)})}},a.donationBatchTableParams=new i({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:l.length,getData:function(a,b){var c=b.filter()?g("filter")(l,b.filter()):l,d=b.sorting()?g("orderBy")(c,b.orderBy()):l;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("data",function(){j(function(){a.donationBatchTableParams.reload()})}),a.recentDonationBatchesTableParams=new i({page:1,count:8,filter:{},sorting:{}},{defaultSort:"asc",counts:[],getData:function(a,b){var c=b.filter()?g("filter")(m,b.filter()):m,d=b.sorting()?g("orderBy")(c,b.orderBy()):m;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("recentDonationBatchData",function(){j(function(){a.recentDonationBatchesTableParams.reload()})}),a.addDonationBatch=function(b,e){e.$valid&&(a.addingDonationBatch=!0,d.addDonationBatch(b,function(){k(),a.clearDonationBatchForm(e),a.addingDonationBatch=!1},function(b){a.err=b,c.log(b),a.addingDonationBatch=!1}))},a.manageClinic=function(a){b.path("/manageClinic/"+a.id)},a.selectTab=function(){a.$applyAsync()},k()}]),angular.module("bsis").controller("ReenterTestOutcomesCtrl",["$scope","$location","$log","TestingService","$uibModal","$sce","$filter","ngTableParams","$timeout","$routeParams","gettextCatalog",function(a,b,c,d,e,f,g,h,i,j,k){a.data=[],a.go=function(a){b.path(a+"/"+j.id)};var l=function(){a.bloodTestType=j.bloodTestType,"BASIC_TTI"===a.bloodTestType?(a.showTTIStatus=!0,d.getTTITestingFormFields(function(b){b!==!1&&(a.testNames=b.basicTTITestNames)})):"BASIC_BLOODTYPING"===a.bloodTestType?d.getBloodGroupTestingFormFields(function(b){b!==!1&&(a.testNames=b.basicBloodTypingTests)}):"REPEAT_BLOODTYPING"===a.bloodTestType?d.getBloodGroupTestingFormFields(function(b){b!==!1&&(a.testNames=b.repeatBloodTypingTests)}):"REPEAT_TTI"===a.bloodTestType?(a.showTTIStatus=!1,d.getTTITestingFormFields(function(b){b!==!1&&(a.testNames=b.repeatTTITestNames)})):"CONFIRMATORY_TTI"===a.bloodTestType&&(a.showTTIStatus=!1,d.getTTITestingFormFields(function(b){b!==!1&&(a.testNames=b.confirmatoryTTITestNames)}))},m=function(){d.getTestOutcomesByBatchIdAndBloodTestType({testBatch:j.id,bloodTestType:j.bloodTestType},function(b){a.data=b.testResults,a.testBatchCreatedDate=b.testBatchCreatedDate,a.reEnteredTestOutcomes={},angular.forEach(a.data,function(b){var c=b.donation.donationIdentificationNumber;a.reEnteredTestOutcomes[c]={donationIdentificationNumber:c,testResults:{}},angular.forEach(b.recentTestResults,function(d){d.reEntryRequired===!1?a.reEnteredTestOutcomes[c].testResults[d.bloodTest.id]=d.result:b.editableRow=!0})}),a.data=a.data.filter(function(a){return a.editableRow===!0}),a.numberOfDonations=a.data.length},function(a){c.error(a)})};l(),m();var n=0,o=0,p=0;a.reEntryConfirmations={};var q={},r=function(){n=0,o=0,p=0,angular.forEach(a.data,function(b){var c=!1,d=b.donation.donationIdentificationNumber;q[d]={donationIdentificationNumber:d,testResults:{}},angular.forEach(b.recentTestResults,function(b){b.reEntryRequired===!0&&(p++,a.reEnteredTestOutcomes[d].testResults[b.bloodTest.id]&&(c=!0,q[d].testResults[b.bloodTest.id]=a.reEnteredTestOutcomes[d].testResults[b.bloodTest.id],b.result===a.reEnteredTestOutcomes[d].testResults[b.bloodTest.id]?n++:a.reEntryConfirmations[d]&&a.reEntryConfirmations[d][b.bloodTest.id]?n++:o++))}),c||delete q[d]})},s=function(){a.savingTestOutcomes=!0;var e={};e.testOutcomesForDonations=[],angular.forEach(q,function(a){e.testOutcomesForDonations.push(a)}),d.saveTestResults({reEntry:!0},e,function(){b.path("/manageTestBatch/"+j.id)},function(b){c.error(b),a.savingTestOutcomes=!1})},t=function(){var a={title:k.getString("Save test outcomes"),button:k.getString("Save"),message:k.getString("Re-entry completed for {{reEntriesConfirmed}} of {{totalReEntries}} outcomes.",{reEntriesConfirmed:n,totalReEntries:p})+" <br/>"+k.getString("Re-entry required for {{reEntriesNotConfirmed}} of {{totalReEntries}} outcomes.",{totalReEntries:p,reEntriesNotConfirmed:p-n})},b=e.open({animation:!1,templateUrl:"views/confirmModal.html",controller:"ConfirmModalCtrl",resolve:{confirmObject:function(){return a}}});b.result.then(function(){s()},function(){})};a.validateSaveTestOutcomesForm=function(){r(),o>0?a.showAlert=!0:(a.showAlert=!1,t())},a.resetPreviousConfirmations=function(b,c,d){a.reEntryConfirmations[b]&&a.reEntryConfirmations[b][c]&&a.reEnteredTestOutcomes[b].testResults[c]===d&&(a.reEntryConfirmations[b][c]=!1)},a.testOutcomesTableParams=new h({page:1,count:10,filter:{},sorting:{"donation.donationIdentificationNumber":"asc"}},{defaultSort:"asc",counts:[],
total:a.data.length,getData:function(b,c){var d=c.sorting()?g("orderBy")(a.data,c.orderBy()):a.data;c.total(d.length),b.resolve(d.slice((c.page()-1)*c.count(),c.page()*c.count()))}}),a.$watch("data",function(){i(function(){a.testOutcomesTableParams.reload()})})}]),angular.module("bsis").controller("TestingSidebarCtrl",["$scope","RoutingService","ICONS",function(a,b,c){var d=[{path:"/manageTestBatches",subpaths:["/manageTestBatch","/recordTTIOutcomes","/reenterTTIOutcomes","/reenterABORhOutcomes","/recordRepeatTTIOutcomes","/recordRepeatABORhOutcomes","/recordABORhOutcomes","/resolveAmbiguousABORhOutcomes"]},{path:"/viewTestSample",subpaths:[]}];a.icons=c,a.currentPath=b.getCurrentPath(d)}]),angular.module("bsis").controller("ResolveAmbiguousABORhOutcomesCtrl",["$scope","$location","$log","TestingService","$filter","ngTableParams","$timeout","$routeParams","BLOODABO","BLOODRH",function(a,b,c,d,e,f,g,h,i,j){a.bloodAboOptions=i,a.bloodRhOptions=j,a.data=[],a.go=function(a){b.path(a+"/"+h.id)};var k=function(){d.getTestBatchDonations(h.id,"AMBIGUOUS",function(b){a.data=b.donations,a.testBatchCreatedDate=b.testBatchDate,a.numberOfDonations=a.data.length,a.bloodTypingResolutions={},angular.forEach(a.data,function(b){var c=b.donationIdentificationNumber;a.bloodTypingResolutions[c]={},a.bloodTypingResolutions[c].donationIdentificationNumber=c,a.bloodTypingResolutions[c].bloodAbo=b.bloodAbo,a.bloodTypingResolutions[c].bloodRh=b.bloodRh,a.bloodTypingResolutions[c].resolved=!1,a.bloodTypingResolutions[c].noTypeDetermined=!1,a.bloodTypingResolutions[c].id=b.id})},function(a){c.error(a)})};k(),a.saveBloodTypingResolutions=function(e){a.savingTestResults=!0;var f={};f.bloodTypingResolutions=[],angular.forEach(e,function(a){if(a.resolved||a.noTypeDetermined){var b="RESOLVED";a.noTypeDetermined&&(b="NO_TYPE_DETERMINED"),a.status=b;var c={};c.status=a.status,c.bloodAbo=a.bloodAbo,c.bloodRh=a.bloodRh,c.donationId=a.id,f.bloodTypingResolutions.push(c)}}),d.saveBloodTypingResolutions(f,function(){b.path("/manageTestBatch/"+h.id)},function(b){c.error(b),a.savingTestResults=!1})},a.testOutcomesTableParams=new f({page:1,count:10,filter:{},sorting:{"donation.donationIdentificationNumber":"asc"}},{defaultSort:"asc",counts:[],total:a.data.length,getData:function(b,c){var d=c.sorting()?e("orderBy")(a.data,c.orderBy()):a.data;c.total(d.length),b.resolve(d.slice((c.page()-1)*c.count(),c.page()*c.count()))}}),a.$watch("data",function(){g(function(){a.testOutcomesTableParams.reload()})})}]),angular.module("bsis").controller("ManageTestBatchCtrl",["$scope","$location","$log","$filter","$timeout","$routeParams","$q","$route","DONATION","uiGridConstants","gettextCatalog","TestingService","ModalsService","DATEFORMAT",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b){angular.forEach(b.basicTtiTestNames,function(a){s.push({name:a,displayName:a,field:"testResults",visible:!1,width:"80"})}),angular.forEach(b.repeatTtiTestNames,function(a){s.push({name:a,displayName:a,field:"testResults",visible:!1,width:"80"})}),angular.forEach(b.confirmatoryTtiTestNames,function(a){s.push({name:a,displayName:a,field:"testResults",visible:!1,width:"80"})}),angular.forEach(b.basicBloodTypingTestNames,function(a){s.push({name:a,displayName:a,field:"testResults",visible:!1,width:"65"})}),angular.forEach(b.repeatBloodTypingTestNames,function(a){s.push({name:a,displayName:a,field:"testResults",visible:!1,width:"70"})}),a.gridApi.core.notifyDataChange(j.dataChange.COLUMN)}function p(b){a.dinsToAdd=null,a.dinsIgnored=null,l.removeDonationsFromTestBatch({id:f.id},{testBatchId:f.id,donationIds:b},function(b){a.testBatch=b,a.refreshCurrentTestBatch(b)},function(b){c.error(b),a.hasErrors=!1,404!==b.status&&500!==b.status&&"true"===b.data.hasErrors&&(a.hasErrors=!0)}),a.removingSamples=!1}a.dateFormat=n,a.today=new Date,a.dinLength=i.DIN_LENGTH;var q=[],r={toDIN:null,fromDIN:null};a.dinRange=angular.copy(r),a.exportOptions=[{id:"allSamples",value:k.getString("All Samples"),reportName:k.getString("Test Batch Outcomes Summary Report"),filterKeys:[],columns:["ttistatus","bloodTypingStatus","bloodTypingMatchStatus"],matchType:!0},{id:"ttiUnsafeSample",value:k.getString("TTI Unsafe or Incomplete"),reportName:k.getString("Test Batch Outcomes Summary Report - TTI Unsafe and Tests Outstanding"),filterKeys:["SAFE"],columns:["ttistatus"],matchType:!1},{id:"testingIncompleteSamples",value:k.getString("Blood Typing Issues or Incomplete"),reportName:k.getString("Test Batch Outcomes Summary Report - Blood Typing Issues and Tests Outstanding"),filterKeys:["MATCH","RESOLVED"],columns:["bloodTypingMatchStatus"],matchType:!1}],a.dataExportType=a.exportOptions[0],a.getCurrentTestBatch=function(){l.getTestBatchById(f.id,function(b){a.testBatch=b.testBatch,a.refreshCurrentTestBatch(b),a.refreshEditTestBatchForm()},function(a){c.error(a)})},a.refreshCurrentTestBatch=function(b){var c=0;angular.forEach(a.testBatch.donations,function(a){a.released&&c++}),angular.isDefined(b.donations)?a.gridOptions.data=b.donations:a.gridOptions.data=a.testBatch.donations,a.testBatch.numReleasedSamples=c,a.testBatchDate={date:new Date(a.testBatch.testBatchDate),time:new Date(a.testBatch.testBatchDate)}},a.refreshEditTestBatchForm=function(){l.getTestBatchFormFields(function(b){b!==!1&&(a.locations=b.testingSites)})},a.getCurrentTestBatch(),a.getCurrentTestBatchOverview=function(){l.getTestBatchOverviewById({testBatch:f.id},function(b){a.testBatchOverview=b,a.hasPendingRepeatBloodTypingTests=b.hasPendingRepeatBloodTypingTests,a.hasPendingRepeatTTITests=b.hasPendingRepeatTTITests,a.hasPendingConfirmatoryTTITests=b.hasPendingConfirmatoryTTITests,a.hasPendingBloodTypingConfirmations=b.hasPendingBloodTypingConfirmations,a.hasRepeatBloodTypingTests=b.hasRepeatBloodTypingTests,a.hasConfirmatoryTTITests=b.hasConfirmatoryTTITests,a.hasRepeatTTITests=b.hasRepeatTTITests,a.hasReEntryRequiredTTITests=b.hasReEntryRequiredTTITests,a.hasReEntryRequiredBloodTypingTests=b.hasReEntryRequiredBloodTypingTests,a.hasReEntryRequiredRepeatBloodTypingTests=b.hasReEntryRequiredRepeatBloodTypingTests,a.hasReEntryRequiredRepeatTTITests=b.hasReEntryRequiredRepeatTTITests,a.hasReEntryRequiredConfirmatoryTTITests=b.hasReEntryRequiredConfirmatoryTTITests},function(a){c.error(a)})},a.getCurrentTestBatchOverview();var s=[{name:"DIN",displayName:k.getString("DIN"),field:"donationIdentificationNumber",visible:!0,width:"**",maxWidth:"120",sort:{direction:"asc"}},{name:"Date Bled",displayName:k.getString("Date Bled"),field:"donationDate",cellFilter:"bsisDate",visible:!0,width:"**",maxWidth:"150"},{name:"Pack Type",displayName:k.getString("Pack Type"),field:"packType.packType",visible:!0,width:"**",maxWidth:"100"},{name:"Venue",displayName:k.getString("Venue"),field:"venue.name",visible:!0,width:"**"},{name:"Released",displayName:k.getString("Released"),field:"released",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity["released"] ? "'+k.getString("Y")+'" : "'+k.getString("N")+'"}}</div>',visible:!0,width:"**",maxWidth:"100"},{name:"ttistatus",displayName:k.getString("TTI Status"),field:"ttistatus",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity["ttistatus"] | titleCase | translate}}</div>',visible:!0,width:"**",maxWidth:"150"},{name:"bloodTypingStatusBloodTypingMatchStatus",displayName:k.getString("Blood Group Serology"),field:"bloodTypingStatusBloodTypingMatchStatus",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity["bloodTypingStatus"] | titleCase | translate }} - {{row.entity["bloodTypingMatchStatus"] | titleCase | translate }} <em>({{row.entity["bloodRh"] === "" ? "" : row.entity["bloodAbo"]}}{{row.entity["bloodAbo"] === "" ? "" : row.entity["bloodRh"]}})</em></div>',visible:!0,width:"**"},{name:"previousDonationAboRhOutcome",displayName:k.getString("Previous ABO/Rh"),field:"previousDonationAboRhOutcome",visible:!1,width:"100"}];a.gridOptions={data:[],paginationPageSize:10,paginationPageSizes:[10],paginationTemplate:"views/template/pagination.html",columnDefs:s,enableRowSelection:!0,multiSelect:!0,enableSelectAll:!1,exporterPdfOrientation:"landscape",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:{fontSize:4,margin:[-2,0,0,0]},exporterPdfTableHeaderStyle:{fontSize:5,bold:!0,margin:[-2,0,0,0]},exporterPdfMaxGridWidth:500,exporterSuppressColumns:["Venue"],exporterFieldCallback:function(a,b,c,e){if("Date Bled"===c.name)return d("bsisDate")(e);if("ttistatus"===c.name)return e=e,k.getString(d("titleCase")(e));if("bloodAboRh"===c.name){var f="";return"NOT_DONE"!==b.entity.bloodTypingStatus&&(f=k.getString(d("titleCase")(b.entity.bloodTypingMatchStatus))),f}if("previousDonationAboRhOutcome"===c.name)return null===b.entity.previousDonationAboRhOutcome?"":b.entity.previousDonationAboRhOutcome;if("bloodTypingStatusBloodTypingMatchStatus"===c.name){var g=(""===b.entity.bloodRh?"":b.entity.bloodAbo)+(""===b.entity.bloodAbo?"":b.entity.bloodRh);return k.getString(d("titleCase")(b.entity.bloodTypingStatus))+" - "+k.getString(d("titleCase")(b.entity.bloodTypingMatchStatus))+" ("+g+")"}if("Released"===c.name)return e===!0?k.getString("Y"):k.getString("N");if("DIN"!==c.name&&"Pack Type"!==c.name&&"Venue"!==c.name&&"Released"!==c.name&&"TTI Status"!==c.name&&"bloodTypingStatusBloodTypingMatchStatus"!==c.name&&"previousDonationAboRhOutcome"!==c.name){for(var h in e)if(h===c.name)return e[h]||"";return""}return e},exporterPdfHeader:function(){var b=[{text:a.reportName,fontSize:10,bold:!0,margin:[30,20,0,0]}];return b},exporterPdfTableStyle:{margin:[-10,10,0,0]},exporterPdfFooter:function(b,c){var e=[{text:k.getString("Number of Samples: {{sampleNumber}}",{sampleNumber:a.gridOptions.data.length}),width:"auto"},{text:k.getString("Date generated: {{date}}",{date:d("bsisDateTime")(new Date)}),width:"auto"},{text:k.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:b,pageCount:c}),style:{alignment:"right"}}];return{columns:e,columnGap:10,margin:[30,0],fontSize:6}},enableFiltering:!1,isRowSelectable:function(b){return a.testBatch.permissions.canEditDonations&&"RELEASED"!==b.entity.status},onRegisterApi:function(b){a.gridApi=b,b.selection.on.rowSelectionChanged(a,function(){q=b.selection.getSelectedRows(),a.isRemoveSamplesEnabled=q.length>0})}},a.filter=function(b){a.dataExportType=b,a.getCurrentTestBatch(),a.gridApi.grid.registerRowsProcessor(a.singleFilter,200)},a.resetGrid=function(){h.reload()},a.singleFilter=function(b){return a.filteredData=[],b.forEach(function(b){var c=!1;a.dataExportType.columns.forEach(function(d){0===a.dataExportType.filterKeys.length?c=!0:-1!==a.dataExportType.filterKeys.indexOf(b.entity[d])&&(c=!0)}),c!=a.dataExportType.matchType?b.visible=!1:a.filteredData.push(b.entity)}),a.gridOptions.data=a.filteredData,b},a["export"]=function(b){l.getTestBatchOutcomesReport({testBatch:f.id},function(c){o(c),angular.forEach(a.gridOptions.data,function(b,d){angular.forEach(c.donationTestOutcomesReports,function(c){b.donationIdentificationNumber===c.donationIdentificationNumber&&(a.gridOptions.data[d].testResults=c.bloodTestOutcomes,a.gridOptions.data[d].previousDonationAboRhOutcome=c.previousDonationAboRhOutcome)})}),a.reportName=a.dataExportType.reportName,"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},function(a){c.error(a)})},a.closeTestBatch=function(a){var d={title:k.getString("Confirm Close"),button:k.getString("Close"),message:k.getString("Are you sure that you want to close this test batch?")};m.showConfirmation(d).then(function(){l.closeTestBatch(a,function(){b.path("/manageTestBatches")},function(a){c.error(a)})})},a.reopenTestBatch=function(b){var d={title:k.getString("Confirm Reopen"),button:k.getString("Reopen"),message:k.getString("Are you sure that you want to reopen this test batch?")};m.showConfirmation(d).then(function(){l.reopenTestBatch(b,function(a){b.permissions&&(b.permissions=a.permissions,b.status=a.status)},function(b){a.err=b,c.error(b)})})},a.deleteTestBatch=function(d){var e={title:k.getString("Confirm Void"),button:k.getString("Void"),message:k.getString("Are you sure that you want to void this test batch?")};m.showConfirmation(e).then(function(){l.deleteTestBatch(d,function(){b.path("/manageTestBatches")},function(b){a.err=b,c.error(b)})})},a.releaseTestBatch=function(b){var d;d=b.readyForReleaseCount<b.numSamples?k.getString("{{count}} of {{total}} samples will be released, the remaining samples require discrepancies to be resolved. Once you release these samples you will no longer be able to add DINs to this batch. Are you sure that you want to release this test batch?",{count:b.readyForReleaseCount,total:b.numSamples}):k.getString("{{count}} of {{total}} samples will be released. Once you release these samples you will no longer be able to add DINs to this batch. Are you sure that you want to release this test batch?",{count:b.readyForReleaseCount,total:b.numSamples});var e={title:k.getString("Confirm Release"),button:k.getString("Release"),message:d};m.showConfirmation(e).then(function(){l.releaseTestBatch(b,function(b){a.testBatch=b,a.refreshCurrentTestBatch(b)},function(b){a.err=b,c.error(b)})})},a.updateTestBatch=function(b){b.testBatchDate=a.testBatchDate.date,l.updateTestBatch(b,function(b){a.testBatch=b,a.refreshCurrentTestBatch(b),a.err=""},function(b){a.err=b,c.error(b)})},a.validateForm=function(b){return b.$invalid?"invalid":(a.confirmEdit=!1,!0)},a.updateTimeOnTestBatchDate=function(){a.testBatchDate.time&&(a.testBatchDate.date=moment(a.testBatchDate.date).hour(a.testBatchDate.time.getHours()).minutes(a.testBatchDate.time.getMinutes()).toDate())},a.validateDINRange=function(){a.dinRange.toDIN&&a.dinRange.fromDIN>a.dinRange.toDIN?a.addDonationToTestBatchForm.toDIN.$setValidity("invalidDINRange",!1):a.addDonationToTestBatchForm.toDIN.$setValidity("invalidDINRange",!0)},a.addSampleToTestBatch=function(){var b={testBatchId:f.id,fromDIN:a.dinRange.fromDIN,toDIN:a.dinRange.toDIN};if(a.validateDINRange(),!a.addDonationToTestBatchForm.$invalid){a.dinRange.toDIN||(b.toDIN=a.dinRange.fromDIN);var d=a.testBatch.donations.length;l.addDonationsToTestBatch({id:b.testBatchId},b,function(b){a.testBatch=b,a.refreshCurrentTestBatch(b),a.clearAddDonationToTestBatchForm(a.addDonationToTestBatchForm),a.dinsToAdd=b.donations.length+b.dinsWithoutTestSamples.length+b.dinsInOtherTestBatches.length+b.dinsInOpenDonationanBatch.length-d,a.dinsAdded=b.donations.length-d,a.dinsIgnored=b.dinsWithoutTestSamples.length+b.dinsInOtherTestBatches.length+b.dinsInOpenDonationanBatch.length},function(b){c.error(b),a.hasErrors=!1,404!==b.status&&500!==b.status&&"true"===b.data.hasErrors&&(a.hasErrors=!0)})}},a.clearAddDonationToTestBatchForm=function(b){b.$setPristine(),b.$setUntouched(),a.dinRange=angular.copy(r),a.hasErrors=!1},a.removeSamplesFromTestBatch=function(){a.removingSamples=!0;var b=!1,d=[];if(angular.forEach(q,function(a){c.info(a.donationIdentificationNumber),d.push(a.id),("NOT_DONE"!==a.ttistatus||"NOT_DONE"!==a.bloodTypingStatus||"NOT_DONE"!==a.bloodTypingMatchStatus)&&(b=!0)}),!b)return void p(d);var e={title:k.getString("Remove Test Sample(s)"),button:k.getString("Remove"),message:k.getString("Test outcomes have been recorded for one or more samples. Removing these from the test batch will clear all outcomes for those samples. Are you sure you want to continue?")};m.showConfirmation(e).then(function(){p(d)})["catch"](function(){a.removingSamples=!1})}}]),angular.module("bsis").controller("FindTestSamplesCtrl",["$scope","$location","$log","DonationsService","TestingService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g){a.dateFormat=f;var h={din:null,venueId:null,allVenues:!0,packTypeId:null,allPackTypes:!0,startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()},i=[{name:"DonationIdentificationNumber",displayName:g.getString("DIN"),field:"donationIdentificationNumber",width:"**"},{name:"Venue",displayName:g.getString("Venue"),field:"venue.name",cellFilter:"translate",width:"**"},{name:"Donation Date",displayName:g.getString("Collection Date"),field:"donationDate",cellFilter:"bsisDate",width:"**"},{name:"Pack Type",displayName:g.getString("Pack Type"),field:"packType.packType",width:"**"},{name:"TTI Status",displayName:g.getString("TTI Status"),field:"ttistatus",width:"**"},{name:"Blood Typing Match Status",displayName:g.getString("Blood Group Serology"),field:"bloodTypingMatchStatus",width:"**"}];a.searchParams={},a.venues=[],a.packTypes=[],a.searching=!1,a.submitted=!1,a.gridOptions={data:[],paginationPageSize:5,paginationTemplate:"views/template/pagination.html",minRowsToShow:5,columnDefs:i,onRegisterApi:function(b){a.gridApi=b}},a.updateDinSearch=function(){var b=a.searchParams.din;b&&b.length>0?(a.dinSearch=!0,a.searchParams.startDate=null,a.searchParams.endDate=null):(a.dinSearch=!1,a.searchParams=angular.copy(h))},a.updateAllVenues=function(){a.searchParams.venueId&&(a.searchParams.allVenues=!1)},a.updateAllPackTypes=function(){a.searchParams.packTypeId&&(a.searchParams.allPackTypes=!1)},a.clearVenue=function(){a.searchParams.venueId=null},a.clearPackType=function(){a.searchParams.packTypeId=null},a.findTestSamples=function(){a.findTestSamplesForm.$valid&&(a.searching=!0,a.submitted=!0,a.searchParams.din?(c.info(a.searchParams.din),d.findByDin({din:a.searchParams.din},function(b){a.gridOptions.data=b.donations,a.searching=!1,a.gridOptions.paginationCurrentPage=1},function(b){a.searching=!1,c.error(b)})):d.search(a.searchParams,function(b){a.gridOptions.data=b.donations,a.searching=!1,a.gridOptions.paginationCurrentPage=1},function(b){a.searching=!1,c.error(b)}))},a.reset=function(b){a.gridOptions.data=[],a.searchParams=angular.copy(h),a.submitted=!1,a.searching=!1,a.dinSearch=null,b&&b.$setPristine()},a.init=function(){a.reset(),e.getTestResultsForm(function(b){a.venues=b.venues,a.packTypes=b.packTypes},c.error)},a.init()}]),angular.module("bsis").controller("ViewTestSampleCtrl",["$scope","$location","$routeParams","$timeout","$log","TestingService",function(a,b,c,d,e,f){a.searching=!1,a.testSample=null,a.testOutcomes=[],a.search={donationIdentificationNumber:c.donationIdentificationNumber||null},a.findTestSample=function(){a.viewTestSampleForm.$invalid||(b.search(angular.extend({search:!0},a.search)),a.searching=!0,f.getTestSampleByDIN({donationIdentificationNumber:a.search.donationIdentificationNumber},function(b){a.testSample=b.testSample,a.testOutcomes=b.testSample.testOutcomes,a.searching=!1},function(b){e.error(b),a.testSample=null,a.testOutcomes=[],a.searching=!1}))},a.clear=function(){b.search({}),a.searching=!1,a.testSample=null,a.testOutcomes=[],a.search.donationIdentificationNumber=null,a.viewTestSampleForm.$setPristine()},c.search&&d(function(){a.findTestSample(),a.viewTestSampleForm.$setSubmitted()})}]),angular.module("bsis").controller("ManageTestBatchesCtrl",["$scope","$location","TestingService","ngTableParams","$timeout","$filter","$log","DATEFORMAT","ICONS",function(a,b,c,d,e,f,g,h,i){function j(a,b){return moment(a).hour(b.getHours()).minutes(b.getMinutes()).toDate()}a.icons=i,a.maxDate=moment().toDate();var k=[{}];a.openTestBatches=!1;var l={testBatchDate:null,location:null,backEntry:!1},m={date:moment().toDate(),time:moment().toDate()};a.testBatch=angular.copy(l),a.testBatchDate=angular.copy(m),a.clearAddTestBatchForm=function(c){b.search({}),c.$setPristine(),a.submitted="",a.testBatch=angular.copy(l),a.testBatchDate=angular.copy(m),a.searchResults="",a.addingTestBatch=!1},a.applyBackEntryChange=function(){a.testBatch.backEntry?(a.testBatchDate.date=null,a.testBatchDate.time=moment().startOf("day").toDate()):a.testBatchDate=angular.copy(m)},a.clearLocationId=function(){a.search.locationId=null},a.manageTestBatch=function(a){b.path("/manageTestBatch/"+a.id)},a.getOpenTestBatches=function(){c.getOpenTestBatches(function(b){b!==!1&&(k=b.testBatches,a.data=k,a.testBatchTableParams.data.length>=0&&a.testBatchTableParams.reload(),a.openTestBatches=k.length>0)})},a.getTestBatchForm=function(){c.getTestBatchFormFields(function(b){b!==!1&&(a.testingSites=b.testingSites)})},a.getOpenTestBatches(),a.getTestBatchForm(),a.addTestBatch=function(b){b.$valid?(a.addingTestBatch=!0,a.testBatch.testBatchDate=j(a.testBatchDate.date,a.testBatchDate.time),c.addTestBatch(a.testBatch,function(){a.getOpenTestBatches(),a.clearAddTestBatchForm(b)},function(b){g.error(b),a.addingTestBatch=!1})):a.submitted=!0},a.testBatchTableParams=new d({page:1,count:4,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:k.length,getData:function(a,b){var c=b.filter()?f("filter")(k,b.filter()):k,d=b.sorting()?f("orderBy")(c,b.orderBy()):k;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("data",function(){e(function(){a.testBatchTableParams.reload()})}),a.dateFormat=h;var n=null;a.closedTestBatchData=n,a.closedTestBatches=!1;var o={allSites:!0,status:"CLOSED",startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()};a.search=angular.copy(o),a.clearClosedBatchesSearch=function(c){a.searched=!1,b.search({}),a.search=angular.copy(o),c.$setPristine()},a.getClosedTestBatches=function(b){if(b.$valid){var d={status:"CLOSED"};if(a.search.startDate){var e=moment(a.search.startDate).startOf("day").toDate();d.startDate=e}if(a.search.endDate){var f=moment(a.search.endDate).endOf("day").toDate();d.endDate=f}a.search.locationId&&(d.locationId=a.search.locationId),a.searching=!0,c.getRecentTestBatches(d,function(b){a.searching=!1,b!==!1&&(n=b.testBatches,a.closedTestBatchData=n,a.closedTestBatchesTableParams.$params.page=1,a.closedTestBatches=n.length>0)},function(){a.searching=!1})}},a.closedTestBatchesTableParams=new d({page:1,count:8,filter:{},sorting:{}},{defaultSort:"asc",counts:[],getData:function(a,b){var c=b.filter()?f("filter")(n,b.filter()):n,d=b.sorting()?f("orderBy")(c,b.orderBy()):n;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("closedTestBatchData",function(){e(function(){a.closedTestBatchesTableParams.reload()})})}]),angular.module("bsis").controller("RecordTestOutcomesCtrl",["$scope","$location","$log","TestingService","$filter","ngTableParams","$timeout","$routeParams",function(a,b,c,d,e,f,g,h){a.data=[{}],a.go=function(a){b.path(a+"/"+h.id)};var i=function(){a.bloodTestType=h.bloodTestType,"BASIC_TTI"===a.bloodTestType?d.getTTITestingFormFields(function(b){b!==!1&&(a.testNames=b.basicTTITestNames)}):"BASIC_BLOODTYPING"===a.bloodTestType?d.getBloodGroupTestingFormFields(function(b){b!==!1&&(a.testNames=b.basicBloodTypingTests)}):"REPEAT_BLOODTYPING"===a.bloodTestType?d.getBloodGroupTestingFormFields(function(b){b!==!1&&(a.testNames=b.repeatBloodTypingTests)}):"REPEAT_TTI"===a.bloodTestType?d.getTTITestingFormFields(function(b){b!==!1&&(a.testNames=b.repeatTTITestNames)}):"CONFIRMATORY_TTI"===a.bloodTestType&&d.getTTITestingFormFields(function(b){b!==!1&&(a.testNames=b.confirmatoryTTITestNames)})},j=function(){a.allTestOutcomes={};var b=h.bloodTestType;d.getTestOutcomesByBatchIdAndBloodTestType({testBatch:h.id,bloodTestType:b},function(c){a.data=c.testResults,a.testBatchCreatedDate=c.testBatchCreatedDate,angular.forEach(a.data,function(c){var d=c.donation.donationIdentificationNumber,e={};a.allTestOutcomes[d]={donationIdentificationNumber:d,testResults:{}},"REPEAT_TTI"===b?e=c.pendingRepeatTTITestsIds:"CONFIRMATORY_TTI"===b&&(e=c.pendingConfirmatoryTTITestsIds),0!==e.length&&(c.editableRow=!0),angular.forEach(c.recentTestResults,function(b){a.allTestOutcomes[d].testResults[b.bloodTest.id]=b.result,c.editableRow=!0})}),a.data=a.data.filter(function(a){return a.editableRow===!0}),a.numberOfDonations=a.data.length},function(a){c.error(a)})};i(),j(),a.saveTestResults=function(e,f){a.savingTestResults=!0;var g={};g.testOutcomesForDonations=[],angular.forEach(e,function(a){g.testOutcomesForDonations.push(a)}),d.saveTestResults({reEntry:f},g,function(){b.path("/manageTestBatch/"+h.id)},function(b){c.error(b),a.savingTestResults=!1})},a.testOutcomesTableParams=new f({page:1,count:10,sorting:{"donation.donationIdentificationNumber":"asc"}},{defaultSort:"asc",counts:[],total:a.data.length,getData:function(b,c){var d=c.sorting()?e("orderBy")(a.data,c.orderBy()):a.data;c.total(d.length),b.resolve(d.slice((c.page()-1)*c.count(),c.page()*c.count()))}}),a.$watch("data",function(){g(function(){a.testOutcomesTableParams.reload()})})}]),angular.module("bsis").controller("ComponentsSidebarCtrl",["$scope","RoutingService","ICONS",function(a,b,c){var d=[{path:"/recordComponents",subpaths:[]},{path:"/findComponents",subpaths:[]},{path:"/discardComponents",subpaths:[]},{path:"/findDiscards",subpaths:[]},{path:"/receiveComponents",subpaths:["/addComponentBatch","/viewComponentBatch","/viewComponentBatches"]}];a.icons=c,a.currentPath=b.getCurrentPath(d)}]),angular.module("bsis").controller("RecordComponentsCtrl",["$scope","$location","$log","$timeout","$q","$routeParams","gettextCatalog","ComponentService","ComponentValidationService","ModalsService","UtilsService","$uibModal","DATEFORMAT",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){var c="",d="",e="",f=moment.duration(moment(b).diff(moment(a.donationDateTime))).asHours();angular.forEach(t[a.componentTypeCombination.id],function(a){null!=a.maxTimeSinceDonation&&f>=a.maxTimeSinceDonation&&(-1===d.indexOf(a.componentTypeName)&&(d+=e+a.componentTypeName),e=", ")}),d.length>0&&(c=g.getString("Time since donation exceeded, the following components will be flagged as unsafe: {{components}}.",{components:d}));var h="";e="";var i=moment.duration(moment(a.bleedEndTime).diff(moment(a.bleedStartTime))).asMinutes();if(angular.forEach(t[a.componentTypeCombination.id],function(a){null!=a.maxBleedTime&&i>=a.maxBleedTime&&(-1===h.indexOf(a.componentTypeName)&&(h+=e+a.componentTypeName),e=", ")}),h.length>0){var j="";c.length>0&&(j="</br></br>"),c+=j+g.getString("Bleed time exceeded, the following components will be flagged as unsafe: {{components}}.",{components:h})}return c}function o(a,b){var c=n(a,b);return c.length>0?j.showConfirmation({title:g.getString("Time since Donation or Bleed Time exceeded"),button:g.getString("Continue"),message:c}):e.resolve()}function p(b){if(null!=b.packType.maxWeight&&b.weight>b.packType.maxWeight)return j.showConfirmation({title:g.getString("Overweight Pack"),button:g.getString("Continue"),message:g.getString("The pack weight ({{componentWeight}}g) is above the maximum acceptable range ({{packTypeWeight}}g). Components from this donation will be flagged as unsafe. Do you want to continue?",{componentWeight:b.weight,packTypeWeight:b.packType.maxWeight})});if(null!=b.packType.lowVolumeWeight&&b.weight<=b.packType.lowVolumeWeight)return j.showConfirmation({title:g.getString("Underweight Pack"),button:g.getString("Continue"),message:g.getString("The pack weight ({{componentWeight}}g) is below the minimum acceptable range ({{packTypeWeight}}g). Components from this donation will be flagged as unsafe. Do you want to continue?",{componentWeight:b.weight,packTypeWeight:b.packType.lowVolumeWeight})});if(null!=b.packType.minWeight&&b.weight<b.packType.minWeight)return null==b.packType.lowVolumeWeight?j.showConfirmation({title:g.getString("Underweight Pack"),button:g.getString("Continue"),message:g.getString("The pack weight ({{componentWeight}}g) is below the minimum acceptable range ({{packTypeWeight}}g). Components from this donation will be flagged as unsafe. Do you want to continue?",{componentWeight:b.weight,packTypeWeight:b.packType.minWeight})}):j.showConfirmation({title:g.getString("Low Pack Weight"),button:g.getString("Continue"),message:g.getString("The pack weight ({{componentWeight}}g) is low (below {{packTypeWeight}}g). All components from this donation containing plasma will be flagged as Unsafe. Do you want to continue?",{componentWeight:b.weight,packTypeWeight:b.packType.minWeight})});if(null!=b.packType.maxWeight&&null!=b.packType.minWeight){var c=a.gridApi.selection.getSelectedRows()[0];if(null!=c.weight&&(c.weight>b.packType.maxWeight||c.weight<b.packType.minWeight))return j.showConfirmation({title:g.getString("Pack Weight Update"),button:g.getString("Continue"),message:g.getString("The pack weight has changed from an underweight or overweight value to one within the acceptable range. Components from this donation will no longer be flagged as unsafe as a result of the pack weight. Do you want to continue?")})}return e.resolve()}function q(a){for(var b=0,c=0;c<w.length;c++)w[c].id!==a.id&&w[c].parentComponentId===a.parentComponentId&&null!==w[c].weight&&(b+=w[c].weight);return a.weight+b}function r(b){var c=null;return angular.forEach(a.gridOptions.data,function(a){return a.id===b.parentComponentId?void(c=a):void 0}),c}function s(){f.search&&a.getComponentsByDIN(),h.getComponentsFormFields(function(a){a!==!1&&(t=a.producedComponentTypesByCombinationId)})}a.component=null,a.componentsSearch={donationIdentificationNumber:f.donationIdentificationNumber||""},a.savingChildWeight=!1,a.preProcessing=!1,a.unprocessing=!1,a.dateFormat=m,a.maxProcessedOnDate=moment().endOf("day").toDate(),a.processedOn=null,a.IsVisible=!1;var t=null,u=null,v=a.forms={},w=null;a.ShowHide=function(){a.IsVisible=!0},a.clear=function(){a.componentsSearch.donationIdentificationNumber="",b.search({}),a.gridOptions.data=null,angular.forEach(v,function(a){a&&a.$setPristine()})},a.clearRecordComponentForm=function(){a.component&&(a.component.componentTypeCombination=null,a.processedOn={date:moment().toDate(),time:moment().toDate()}),v.recordComponentsForm&&(v.recordComponentsForm.$setPristine(),v.recordComponentsForm.processedOnDate.$setValidity("dateInFuture",!0))},a.clearPreProcessForm=function(){a.component&&(a.component=angular.copy(u)),v.preProcessForm&&v.preProcessForm.$setPristine()},a.clearChildComponentWeightForm=function(){a.component&&(a.component=angular.copy(u)),v.childComponentWeightForm&&v.childComponentWeightForm.$setPristine()};var x=function(){if(v.recordComponentsForm.$valid){var b={parentComponentId:a.component.id,componentTypeCombination:a.component.componentTypeCombination,processedOn:moment(a.processedOn.date).hour(a.processedOn.time.getHours()).minutes(a.processedOn.time.getMinutes())};a.recordingComponents=!0,o(a.component,b.processedOn).then(function(){h.recordComponents(b,function(b){b!==!1?(a.gridOptions.data=b.components,v.recordComponentsForm.$setPristine(),a.component=null,a.recordingComponents=!1):a.recordingComponents=!1})})["catch"](function(){a.recordingComponents=!1})}};a.updateTimeOnProcessedOnDate=function(){angular.isDefined(a.processedOn.time)&&(a.processedOn.date=moment(a.processedOn.date).hour(a.processedOn.time.getHours()).minutes(a.processedOn.time.getMinutes()).toDate())},a.preProcessSelectedComponent=function(){v.preProcessForm.$invalid||(a.preProcessing=!0,p(a.component).then(function(){h.preProcess({},a.component,function(b){a.gridOptions.data=a.gridOptions.data.map(function(a){return a.id===b.component.id?b.component:a}),v.recordComponentsForm&&v.recordComponentsForm.$setPristine(),d(function(){a.gridApi.selection.selectRow(b.component),a.preProcessing=!1})},function(b){c.error(b),a.preProcessing=!1})})["catch"](function(){a.preProcessing=!1}))},a.recordChildWeight=function(){v.childComponentWeightForm.$invalid||(a.savingChildWeight=!0,h.getComponentsByDIN(a.componentsSearch.donationIdentificationNumber,function(b){if(b!==!1){w=b.components;var e=r(a.component),f=q(a.component);i.showChildComponentWeightConfirmation(e,f).then(function(){var b={weight:a.component.weight,id:a.component.id};h.recordChildWeight({},b,function(b){a.gridOptions.data=a.gridOptions.data.map(function(a){return a.id===b.component.id?b.component:a}),v.childComponentWeightForm&&v.childComponentWeightForm.$setPristine(),d(function(){a.gridApi.selection.selectRow(b.component),a.savingChildWeight=!1})},function(b){c.error(b),a.savingChildWeight=!1})})["catch"](function(){a.savingChildWeight=!1;
})}}))},a.unprocessSelectedComponent=function(){var b={title:g.getString("Unprocess Component"),button:g.getString("Continue"),message:g.getString("Unprocessing this component will cause all components that were produced from it to be deleted. Do you want to continue?")};a.unprocessing=!0,j.showConfirmation(b).then(function(){h.unprocess({},a.component,function(){a.getComponentsByDIN(),a.unprocessing=!1},function(b){c.error(b),a.unprocessing=!1})})["catch"](function(){a.unprocessing=!1})},a.getComponentsByDIN=function(){v.findComponentsForm&&v.findComponentsForm.$invalid||(a.componentsSearch.search=!0,b.search(a.componentsSearch),a.searching=!0,h.getComponentsByDIN(a.componentsSearch.donationIdentificationNumber,function(b){b!==!1?(a.gridOptions.data=b.components,w=b.components,a.component=null,a.searching=!1):a.searching=!1}))},a.getParentComponentWeight=function(a){var b=r(a);return null!=b?b.weight:null};var y=[{name:"Component Code",displayName:g.getString("Component Code"),field:"componentCode",width:"**",maxWidth:"150"},{name:"Component Type",displayName:g.getString("Component Type"),field:"componentType.componentTypeName",width:"**",minWidth:"250"},{name:"Status",displayName:g.getString("Status"),field:"status",cellFilter:"titleCase | translate",width:"**",maxWidth:"150"},{name:"Created On",displayName:g.getString("Created On"),field:"createdOn",cellFilter:"bsisDateTime",width:"**",maxWidth:"160"},{name:"Expiry Status",displayName:g.getString("Expiry Status"),field:"daysToExpire",cellFilter:"daysToExpire",width:"**",maxWidth:"200",sortingAlgorithm:function(a,b,c,d){return k.dateSort(c.entity.expiresOn,d.entity.expiresOn)}},{name:"Weight",displayName:g.getString("Weight"),field:"weight",width:"**",maxWidth:"120"}];a.gridOptions={data:null,columnDefs:y,multiSelect:!1,enableRowSelection:!0,paginationTemplate:"views/template/pagination.html",paginationPageSize:5,minRowsToShow:5,enableSelectAll:!1,onRegisterApi:function(b){a.gridApi=b,b.selection.on.rowSelectionChanged(a,function(){var c=b.selection.getSelectedRows();0===c.length?a.component=null:(a.component=angular.copy(c[0]),u=angular.copy(c[0]),a.processedOn={date:moment().toDate(),time:moment().toDate()})})}},a.confirmProcessLabledComponent=function(){if("IN_STOCK"===a.component.inventoryStatus){var b="";b+=g.getString("The selected component has already been labelled. Do you want to continue?");var c={title:g.getString("Process labelled component"),button:g.getString("Continue"),message:b},d=l.open({animation:!1,templateUrl:"views/confirmModal.html",controller:"ConfirmModalCtrl",resolve:{confirmObject:function(){return c}}});d.result.then(function(){x()},function(){})}else x()},s()}]),angular.module("bsis").controller("AddComponentBatchCtrl",["$scope","$location","ComponentBatchService",function(a,b,c){function d(){a.componentBatch.donationBatch={id:""},a.componentBatch.location={id:""},a.componentBatch.bloodTransportBoxes=[],a.componentBatch.deliveryDate=new Date,a.temperature=null,a.emptyTemperatureSubmitted=!1}function e(){c.getComponentBatchesFormFields(function(b){b!==!1&&(a.processingSites=b.processingSites,a.donationBatches=b.donationBatches,a.componentBatch=b.addComponentBatchForm,d())},function(){})}a.addBox=function(b){a.addComponentBatchForm.temperature.$valid&&null!=b?(a.componentBatch.bloodTransportBoxes.push({temperature:b}),a.emptyTemperatureSubmitted=!1,a.temperature=null):a.emptyTemperatureSubmitted=!0},a.clearForm=function(a){d(),a.$setPristine(),b.search({})},a.addComponentBatch=function(d){d.$valid&&a.componentBatch.bloodTransportBoxes.length>0&&(a.adding=!0,c.addComponentBatch(a.componentBatch,function(c){a.clearForm(d),b.path("/viewComponentBatch/"+c.id)},function(){})),a.adding=!1},e()}]),angular.module("bsis").controller("ViewComponentBatchesCtrl",["$scope","$filter","$location","ComponentBatchService","$log","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g){a.dateFormat=f;var h={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()};a.findComponentBatches=function(){a.findComponentBatchesForm.$invalid||(a.searching=!0,a.submitted=!0,d.findComponentBatches(a.period,function(b){a.gridOptions.data=b.componentBatches,a.gridOptions.paginationCurrentPage=1,a.searching=!1},function(b){a.searching=!1,e.log(b)}))},a.init=function(){a.period=angular.copy(h),a.gridOptions.data=[],a.submitted=!1};var i=[{name:"Collection Date",displayName:g.getString("Collection Date"),field:"collectionDate",cellFilter:"bsisDate",width:"**",maxWidth:"250"},{name:"Processing Site",displayName:g.getString("Processing Site"),field:"location.name",width:"**",maxWidth:"350"},{name:"Num Initial Components",displayName:g.getString("Num Initial Components"),field:"numberOfInitialComponents",width:"**",maxWidth:"200"},{name:"Donation Batch Status",displayName:g.getString("Donation Batch Status"),field:"donationBatch.status",cellFilter:"titleCase | translate",width:"**",maxWidth:"200"},{name:"Delivery Date",displayName:g.getString("Delivery Date"),field:"deliveryDate",cellFilter:"bsisDate",width:"**",maxWidth:"250"},{name:"Num Boxes",displayName:g.getString("Num Boxes"),field:"numberOfBoxes",width:"**"}];a.onRowClick=function(a){c.path("/viewComponentBatch/"+a.entity.id)},a.gridOptions={data:[],paginationPageSize:10,paginationPageSizes:[10],paginationTemplate:"views/template/pagination.html",rowTemplate:"views/template/clickablerow.html",columnDefs:i,exporterPdfOrientation:"portrait",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:{fontSize:4,margin:[-2,0,0,0]},exporterPdfTableHeaderStyle:{fontSize:5,bold:!0,margin:[-2,0,0,0]},exporterPdfMaxGridWidth:400,exporterFieldCallback:function(a,c,d,e){return"collectionDate"===d.field||"deliveryDate"===d.field?b("bsisDate")(e):"donationBatch.status"===d.field?g.getString(b("titleCase")(e)):e},exporterPdfHeader:function(){var a=[{text:g.getString("Component Delivery Forms"),fontSize:10,bold:!0,margin:[30,20,0,0]}];return a},exporterPdfTableStyle:{margin:[-10,10,0,0]},exporterPdfFooter:function(c,d){var e=[{text:g.getString("Number of forms: {{count}}",{count:a.gridOptions.data.length}),width:"auto"},{text:g.getString("Date generated: {{date}}",{date:b("bsisDateTime")(new Date)}),width:"auto"},{text:g.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:c,pageCount:d}),style:{alignment:"right"}}];return{columns:e,columnGap:10,margin:[30,0],fontSize:6}},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},a.init()}]),angular.module("bsis").controller("ViewComponentBatchCtrl",["$scope","$routeParams","$filter","$log","gettextCatalog","ComponentBatchService",function(a,b,c,d,e,f){function g(b){f.getComponentBatch(b,function(b){a.componentBatch=b,angular.forEach(a.componentBatch.components,function(b){b.isInitialComponent&&a.components.push(b)}),a.gridOptions.data=a.components},function(a){d.error(a)})}a.donationBatchClosed=e.getString("Closed"),a.donationBatchOpen=e.getString("Open"),a.gridOptions={columnDefs:[{displayName:e.getString("DIN"),name:"donationIdentificationNumber"},{displayName:e.getString("Pack Type"),name:"packType.packType"}],exporterPdfOrientation:"portrait",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:{fontSize:4,margin:[-2,0,0,0]},exporterPdfTableHeaderStyle:{fontSize:5,bold:!0,margin:[-2,0,0,0]},exporterPdfMaxGridWidth:400,exporterPdfHeader:function(){var a=[{text:e.getString("Delivery Note"),fontSize:10,bold:!0,margin:[30,20,0,0]}];return a},exporterPdfTableStyle:{margin:[-10,10,0,0]},exporterPdfCustomFormatter:function(b){var d=[];return d.push({text:e.getString("Date Created")+": ",bold:!0},{text:c("bsisDate")(a.componentBatch.donationBatch.donationBatchDate)},{text:" "+e.getString("Venue")+": ",bold:!0},{text:a.componentBatch.donationBatch.venue.name},{text:" "+e.getString("Number of Donations")+": ",bold:!0},{text:""+a.componentBatch.donationBatch.numDonations},{text:" "+e.getString("Status")+": ",bold:!0},{text:(a.componentBatch.donationBatch.isClosed?a.donationBatchClosed:a.donationBatchOpen)+"\n"}),d.push({text:" "+e.getString("Time of Delivery")+": ",bold:!0},{text:c("bsisDateTime")(a.componentBatch.deliveryDate)},{text:" "+e.getString("Location")+": ",bold:!0},{text:a.componentBatch.location.name},{text:" "+e.getString("Number of Blood Transport Boxes")+": ",bold:!0},{text:""+a.componentBatch.bloodTransportBoxes.length+"\n"}),angular.forEach(a.componentBatch.bloodTransportBoxes,function(a){d.push({text:e.getString("Blood Transport Box Temperature")+": ",bold:!0},{text:a.temperature+"C\n"})}),b.content=[{text:d,margin:[-10,0,0,0],fontSize:7}].concat(b.content),b},exporterPdfFooter:function(b,d){var f=[{text:e.getString("Number of components: {{componentNumber}}",{componentNumber:a.gridOptions.data.length}),width:"auto"},{text:e.getString("Date generated: {{date}}",{date:c("bsisDateTime")(new Date)}),width:"auto"},{text:e.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:b,pageCount:d}),style:{alignment:"right"}}];return{columns:f,columnGap:10,margin:[30,0],fontSize:6}},onRegisterApi:function(b){a.gridApi=b}},a.componentBatch=null,a.components=[],a.printDeliveryNote=function(){a.gridApi.exporter.pdfExport("all","all")},g(b.id)}]),angular.module("bsis").controller("FindComponentsCtrl",["$scope","$location","ComponentService","ICONS","DATEFORMAT","$filter","ngTableParams","$timeout","$routeParams",function(a,b,c,d,e,f,g,h,i){function j(){if(i.findComponentsSearch){if(i.donationIdentificationNumber&&(a.search.donationIdentificationNumber=i.donationIdentificationNumber),i.donationDateFrom){var b=new Date(i.donationDateFrom);a.search.donationDateFrom=b}if(i.donationDateTo){var c=new Date(i.donationDateTo);a.search.donationDateTo=c}if(i.componentTypes){var d=i.componentTypes;angular.isArray(d)||(d=[d]),a.search.componentTypes=d}if(i.locationId){var e=i.locationId;a.search.locationId=e}if(i.status){var f=i.status;a.search.status=f}a.updateDinSearch(),a.findComponents(a.search)}}function k(){c.getComponentsFormFields(function(b){b!==!1&&(a.componentTypes=b.componentTypes,a.locations=b.locations,a.componentStatuses=b.componentStatuses,j())})}a.icons=d,a.format=e,a.startDateOpen=!1,a.endDateOpen=!1;var l=[{}];a.data=l,a.component={};var m={donationIdentificationNumber:"",componentTypes:[],locationId:null,status:null,allSites:!0,allStatuses:!0,donationDateFrom:moment().subtract(7,"days").startOf("day").toDate(),donationDateTo:moment().endOf("day").toDate()};a.searchResults="",a.search=angular.copy(m),a.dinSearch=!1,a.componentsSummaryTableParams=new g({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:l.length,getData:function(a,b){var c=b.filter()?f("filter")(l,b.filter()):l,d=b.sorting()?f("orderBy")(c,b.orderBy()):l;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("data",function(){h(function(){a.componentsSummaryTableParams.reload()})}),a.findComponents=function(d){a.findComponentForm.$valid&&(a.componentsView="viewDonations",d.findComponentsSearch=!0,a.componentsSummaryTableParams.page(1),b.search(d),a.searching=!0,c.ComponentsSearch(d,function(b){b!==!1?(l=b.components,a.data=l,a.searchResults=!0,a.componentsSearchCount=a.data.length,a.searching=!1):(a.searchResults=!1,a.searching=!1)}))},a.clear=function(){a.search=angular.copy(m),a.dinSearch=!1,a.searchResults="",a.findComponentForm.$setPristine(),b.search({})},a.updateDinSearch=function(){var b=a.search.donationIdentificationNumber;b&&b.length>0?(a.dinSearch=!0,a.search.componentTypes=[],a.search.locationId=null,a.search.status=null,a.search.donationDateFrom=null,a.search.donationDateTo=null,a.search.allSites=!0,a.search.allStatuses=!0):(a.dinSearch=!1,a.search.donationDateFrom=moment().subtract(7,"days").startOf("day").toDate(),a.search.donationDateTo=moment().endOf("day").toDate())},a.setcomponentsView=function(b){a.componentsView=b},a.clearLocations=function(){a.search.locationId=null},a.clearComponentStatuses=function(){a.search.status=null},a.updateAllSites=function(){a.search.locationId&&(a.search.allSites=!1)},a.updateAllStatuses=function(){a.search.status&&(a.search.allStatuses=!1)},a.viewComponents=function(b){a.din=b,c.getComponentsByDIN(b,function(b){b!==!1&&(a.components=b.components,a.componentsView="viewComponents")})},k()}]),angular.module("bsis").controller("DiscardComponentsCtrl",["$scope","$location","ComponentService","ICONS","$filter","ngTableParams","$timeout","$routeParams","uiGridConstants","gettextCatalog","$log","ModalsService",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){a.gridApi&&(a.gridApi.selection.clearSelectedRows(),a.selectedAction=null,a.gridApi.core.notifyDataChange(i.dataChange.EDIT))}function n(){h.search&&a.getComponentsByDIN(),c.getComponentsFormFields(function(b){b!==!1&&(a.discardReasons=b.discardReasons)})}var o=[],p=a.forms={};a.selectedAction=null,a.componentsReceived=!0,a.componentsSearch={donationIdentificationNumber:h.donationIdentificationNumber||""},a.discardingComponent=!1,a.undiscarding=!1,a.discard={},a.clearFindComponentsForm=function(){a.componentsSearch.donationIdentificationNumber="",o=[],m(),a.gridOptions.data=null,b.search({}),p.findComponentsForm.$setPristine(),a.discard={}},a.clearDiscardComponentsForm=function(){b.search({}),p.discardComponentsForm.$setPristine(),a.discard={}},a.discardComponents=function(){if(!p.discardComponentsForm.$invalid){var b={title:j.getString("Discard Components"),button:j.getString("Continue"),message:j.getString("Are you sure you want to discard these components?")};l.showConfirmation(b).then(function(){a.discard.componentIds=[],angular.forEach(o,function(b){a.discard.componentIds.push(b.id)}),a.discardingComponent=!0,c.discard({},a.discard,function(){m(),a.discardingComponent=!1,a.discard={},a.gridOptions.data=a.getComponentsByDIN()},function(b){k.error(b),a.discardingComponent=!1})})["catch"](function(){a.discardingComponent=!1})}},a.undiscardComponents=function(){var b={title:j.getString("Undiscard Components"),button:j.getString("Continue"),message:j.getString("Are you sure you want to undiscard these components?")};l.showConfirmation(b).then(function(){var b={};b.componentIds=[],angular.forEach(o,function(a){b.componentIds.push(a.id)}),a.undiscarding=!0,c.undiscard({},b,function(){a.undiscarding=!1,a.getComponentsByDIN()},function(b){k.error(b),a.undiscarding=!1})})["catch"](function(){a.undiscarding=!1})},a.getComponentsByDIN=function(){p.findComponentsForm&&p.findComponentsForm.$invalid||(m(),a.componentsSearch.search=!0,b.search(a.componentsSearch),a.searching=!0,c.getComponentsByDIN(a.componentsSearch.donationIdentificationNumber,function(b){b!==!1?(a.gridOptions.data=b.components,a.searching=!1):a.searching=!1}))};var q=[{name:"Component Code",displayName:j.getString("Component Code"),field:"componentCode",width:"**",maxWidth:"150"},{name:"Component Type",displayName:j.getString("Component Type"),field:"componentType.componentTypeName",width:"**",minWidth:"250"},{name:"Status",displayName:j.getString("Status"),field:"status",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity["status"] | titleCase | translate}}</div>',width:"**",maxWidth:"150"},{name:"Created On",displayName:j.getString("Created On"),field:"createdOn",cellFilter:"bsisDate",width:"**",maxWidth:"150"},{name:"Expiry Status",displayName:j.getString("Expiry Status"),field:"daysToExpire",cellFilter:"daysToExpire",width:"**",maxWidth:"250"},{name:"Weight",displayName:j.getString("Weight"),field:"weight",width:"**",maxWidth:"120"}];a.gridOptions={data:null,columnDefs:q,multiSelect:!0,enableRowSelection:!0,paginationTemplate:"views/template/pagination.html",paginationPageSize:5,minRowsToShow:5,isRowSelectable:function(b){var c=!0;return"DISCARD"===a.selectedAction&&(b.entity.permissions.canDiscard||(c=!1)),"UNDISCARD"===a.selectedAction&&(b.entity.permissions.canUndiscard||(c=!1)),"NONE"===a.selectedAction&&(b.entity.permissions.canDiscard||b.entity.permissions.canUndiscard)&&(c=!1),c},onRegisterApi:function(b){a.gridApi=b,b.selection.on.rowSelectionChanged(a,function(){if(o=b.selection.getSelectedRows(),0===o.length)a.selectedAction=null,a.componentsReceived=!0;else if(1===o.length){var c=angular.copy(o[0]);c.permissions.canDiscard?a.selectedAction="DISCARD":c.permissions.canUndiscard?a.selectedAction="UNDISCARD":a.selectedAction="NONE",c.hasComponentBatch||(a.componentsReceived=!1,a.selectedAction="NONE")}a.gridApi.core.notifyDataChange(i.dataChange.EDIT)})}},n()}]),angular.module("bsis").controller("FindDiscardsCtrl",["$scope","$location","ComponentService","DATEFORMAT","ngTableParams","$timeout","$routeParams","$filter",function(a,b,c,d,e,f,g,h){function i(){if(g.search){if(g.donationIdentificationNumber&&(a.discardsSearch.donationIdentificationNumber=g.donationIdentificationNumber),g.donationDateFrom){var b=new Date(g.donationDateFrom);a.discardsSearch.donationDateFrom=b}if(g.donationDateTo){var c=new Date(g.donationDateTo);a.discardsSearch.donationDateTo=c}if(g.componentTypes){var d=g.componentTypes;angular.isArray(d)||(d=[d]),a.discardsSearch.componentTypes=d}a.updateDinSearch(),a.findDiscards(a.discardsSearch)}}function j(){c.getComponentsFormFields(function(b){b!==!1&&(a.componentTypes=b.componentTypes,i())})}a.dateFormat=d;var k=[{}],l={donationIdentificationNumber:"",componentTypes:[],donationDateFrom:moment().subtract(7,"days").startOf("day").toDate(),donationDateTo:moment().endOf("day").toDate()};a.dinSearch=!1,a.searchResults="",a.format=d,a.startDateOpen=!1,a.endDateOpen=!1,a.componentTypes=[],a.discardsSearch=angular.copy(l),a.clear=function(){a.discardsSearch=angular.copy(l),a.searchResults="",a.dinSearch=!1,a.status=[],b.search({})},a.updateDinSearch=function(){var b=a.discardsSearch.donationIdentificationNumber;b&&b.length>0?(a.dinSearch=!0,a.discardsSearch.componentTypes=[],a.discardsSearch.donationDateFrom=null,a.discardsSearch.donationDateTo=null):(a.dinSearch=!1,(null==a.discardsSearch.donationDateFrom||null==a.discardsSearch.donationDateTo)&&(a.discardsSearch.donationDateFrom=moment().subtract(7,"days").startOf("day").toDate(),a.discardsSearch.donationDateTo=moment().endOf("day").toDate()))},a.findDiscards=function(d){a.findDiscardedComponentsForm.$valid&&(a.componentsView="viewDonations",d.search=!0,a.status=[],a.status.push("DISCARDED"),d.status=a.status,b.search(d),a.searching=!0,c.ComponentsSearch(d,function(b){b!==!1?(k=b.components,a.data=k,a.searchResults=!0,a.componentsSearchCount=a.data.length,a.searching=!1,a.componentsSummaryTableParams.$params.page=1):(a.searchResults=!1,a.searching=!1)}))},a.viewComponents=function(b){a.din=b,c.getComponentsByDIN(b,function(b){b!==!1&&(a.components=b.components,a.componentsView="viewComponents")})},a.componentsSummaryTableParams=new e({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:k.length,getData:function(a,b){var c=b.sorting()?h("orderBy")(k,b.orderBy()):k;b.total(c.length),a.resolve(c.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("data",function(){f(function(){a.componentsSummaryTableParams.reload()})}),a.setcomponentsView=function(b){a.componentsView=b},j()}]),angular.module("bsis").controller("ManageReturnsCtrl",["$scope","$location","$log","ReturnFormsService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f){function g(){a.gridOptions.data=[],d.getReturnFormsForm(function(b){a.distributionSites=b.distributionSites,a.usageSites=b.usageSites},c.error),d.findReturnForms({status:"CREATED"},function(b){a.gridOptions.data=b.returnForms},c.error)}a.dateFormat=e;var h=[{name:"Return Date",displayName:f.getString("Return Date"),field:"returnDate",cellFilter:"bsisDate",width:"**",maxWidth:"200",sort:{direction:"asc"}},{name:"Returned From",displayName:f.getString("Returned From"),field:"returnedFrom.name",width:"**"},{name:"Returned To",displayName:f.getString("Returned To"),field:"returnedTo.name",width:"**"}];a.gridOptions={data:[],paginationPageSize:6,paginationPageSizes:[6],paginationTemplate:"views/template/pagination.html",rowTemplate:"views/template/clickablerow.html",columnDefs:h,minRowsToShow:6,onRegisterApi:function(b){a.gridApi=b}},a.usageSites=[],a.distributionSites=[],a.returnForm={returnDate:new Date,returnedFrom:null,returnedTo:null},a.addingReturnForm=!1,a.onRowClick=function(a){b.path("/viewReturn/"+a.entity.id)},a.clearForm=function(){a.returnForm.returnDate=new Date,a.returnForm.returnedFrom=null,a.returnForm.returnedTo=null,a.addReturnForm.$setPristine()},a.addReturn=function(){if(!a.addReturnForm.$invalid){a.addingReturnForm=!0;var e={status:"CREATED",returnDate:a.returnForm.returnDate,returnedFrom:{id:a.returnForm.returnedFrom},returnedTo:{id:a.returnForm.returnedTo}};d.addReturnForm({},e,function(c){a.addingReturnForm=!1,b.path("/recordReturn/"+c.returnForm.id),a.clearForm()},function(b){c.error(b),a.addingReturnForm=!1})}},g()}]),angular.module("bsis").controller("RecordReturnCtrl",["$scope","$location","$uibModal","$log","$routeParams","ReturnFormsService","ComponentService","UtilsService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g,h,i,j){function k(a){return{donationIdentificationNumber:a.donationIdentificationNumber,componentCode:a.componentCode,componentTypeName:a.componentType.componentTypeName,bloodGroup:a.bloodAbo+a.bloodRh,status:a.status,createdOn:a.createdOn,daysToExpire:a.daysToExpire}}function l(b){a.gridOptions.data=[],angular.forEach(b,function(b){a.gridOptions.data.push(k(b))})}function m(){a.component=angular.copy(o),a.addingComponent=!1,f.getReturnForm({id:e.id},function(b){a.returnForm=b.returnForm,a.components=angular.copy(a.returnForm.components),l(a.components)},d.error)}function n(a){c.open({animation:!1,templateUrl:"views/errorModal.html",controller:"ErrorModalCtrl",resolve:{errorObject:function(){return{title:j.getString("Invalid Component"),button:j.getString("OK"),errorMessage:a}}}})}a.dateFormat=i;var o={din:null,componentCode:null},p=[{name:"donationIdentificationNumber",field:"donationIdentificationNumber",displayName:j.getString("DIN"),width:"**",maxWidth:"100"},{name:"componentCode",displayName:j.getString("Component Code"),field:"componentCode",width:"**",maxWidth:"150"},{name:"componentTypeName",displayName:j.getString("Component Type"),field:"componentTypeName",width:"**",minWidth:"200"},{name:"bloodGroup",displayName:j.getString("Blood Group"),field:"bloodGroup",width:"**",maxWidth:"125"},{name:"status",displayName:j.getString("Status"),field:"status",cellFilter:"titleCase | translate",width:"**",maxWidth:"150"},{name:"createdOn",displayName:j.getString("Created On"),field:"createdOn",cellFilter:"bsisDate",width:"**",maxWidth:"100"},{name:"daysToExpire",displayName:j.getString("Expiry Status"),field:"daysToExpire",cellFilter:"daysToExpire",width:"**",maxWidth:"150",sortingAlgorithm:function(a,b,c,d){return h.dateSort(c.entity.expiresOn,d.entity.expiresOn)}}];a.gridOptions={data:[],paginationPageSize:10,paginationTemplate:"views/template/pagination.html",columnDefs:p,minRowsToShow:10,onRegisterApi:function(b){a.gridApi=b}},a.returnForm=null,a.component=null,a.addingComponent=!1,a.returnedFromSites=[],a.returnedToSites=[],a.editReturnDetails=function(){a.returnDetailsForm=angular.copy(a.returnForm),a.returnDetailsForm.returnDate=moment(a.returnDetailsForm.returnDate).toDate(),f.getReturnFormsForm({},function(b){a.returnedFromSites=b.usageSites,a.returnedToSites=b.distributionSites,a.editingReturnDetails=!0},d.error)},a.selectDate=function(b){b.preventDefault(),b.stopPropagation(),a.selectingDate=!0},a.saveReturnDetails=function(){a.returnDetailsForm.$invalid||(a.savingReturnDetails=!0,f.updateReturnForm({},a.returnDetailsForm,function(b){a.returnForm=b.returnForm,a.savingReturnDetails=!1,a.editingReturnDetails=!1},function(b){d.error(b),a.savingReturnDetails=!1}))},a.clearDetailsForm=function(b){b.preventDefault(),b.stopPropagation(),a.returnDetailsForm=null,a.editingReturnDetails=!1},a.removeComponent=function(b){if(b.$setSubmitted(),!b.$invalid){var c=a.components.filter(function(b){return b.donationIdentificationNumber!==a.component.din&&b.donationIdentificationNumber+b.donationFlagCharacters!==a.component.din||b.componentCode!==a.component.componentCode});c.length===a.components.length?n(j.getString("Component {{DIN}} ({{componentCode}}) was not found in this Return Form.",{DIN:a.component.din,componentCode:a.component.componentCode})):(a.components=c,a.component=angular.copy(o),l(a.components),b.$setPristine())}},a.addComponent=function(){if(!a.addComponentForm.$invalid){a.addingComponent=!0;var b={donationIdentificationNumber:a.component.din,componentCode:a.component.componentCode};g.findComponent(b,function(b){if("ISSUED"!==b.status)n(j.getString("Component {{DIN}} ({{componentCode}}) has not been issued.",{DIN:a.component.din,componentCode:a.component.componentCode}));else{var c=a.components.some(function(a){return a.id===b.id});c?n(j.getString("Component {{DIN}} ({{componentCode}}) has already been added to this Return Form.",{DIN:a.component.din,componentCode:a.component.componentCode})):(a.components.push(b),l(a.components),a.component=angular.copy(o),a.addComponentForm.$setPristine())}a.addingComponent=!1},function(b){"NOT_FOUND"===b.errorCode?n(j.getString("Component with DIN {{DIN}} and ComponentCode {{componentCode}} not found.",{DIN:a.component.din,componentCode:a.component.componentCode})):d.error(b),a.addingComponent=!1})}},a.updateReturn=function(){a.savingForm=!0,a.returnForm.components=angular.copy(a.components),f.updateReturnForm({},a.returnForm,function(c){a.returnForm=c.returnForm,a.components=angular.copy(c.returnForm.components),l(a.components),a.savingForm=!1,b.path("/viewReturn/"+e.id)},function(b){d.error(b),a.savingForm=!1})},a.clearAddComponent=function(b){a.component=angular.copy(o),b.$setPristine()},a.cancel=function(){b.path("/viewReturn/"+e.id)},m()}]),angular.module("bsis").controller("ViewReturnCtrl",["$scope","$location","$log","$filter","$routeParams","$uibModal","ReturnFormsService","ModalsService","UtilsService","gettextCatalog",function(a,b,c,d,e,f,g,h,i,j){function k(a){return{donationIdentificationNumber:a.donationIdentificationNumber,componentCode:a.componentCode,componentTypeName:a.componentType.componentTypeName,bloodGroup:a.bloodAbo+a.bloodRh,status:a.status,createdOn:a.createdOn,daysToExpire:a.daysToExpire}}function l(b){a.gridOptions.data=[],angular.forEach(b.components,function(b){a.gridOptions.data.push(k(b))})}function m(){g.getReturnForm({id:e.id},function(b){a.returnForm=b.returnForm,l(a.returnForm)},c.error)}function n(){var b=f.open({animation:!1,templateUrl:"views/inventory/discardComponentsModal.html",controller:"DiscardComponentsModalCtrl",resolve:{returnFormId:function(){return e.id},componentIds:function(){var b=[];return angular.forEach(a.returnForm.components,function(a){b.push(a.id)}),b}}});b.result.then(function(){m()},function(){})}var o=[{name:"donationIdentificationNumber",field:"donationIdentificationNumber",displayName:j.getString("DIN"),width:"**",maxWidth:"100"},{name:"componentCode",field:"componentCode",displayName:j.getString("Component Code"),width:"**",maxWidth:"150"},{name:"componentTypeName",field:"componentTypeName",displayName:j.getString("Component Type"),width:"**",minWidth:"200"},{name:"bloodGroup",field:"bloodGroup",displayName:j.getString("Blood Group"),width:"**",maxWidth:"125"},{name:"status",field:"status",cellFilter:"titleCase | translate",displayName:j.getString("Status"),width:"**",maxWidth:"150"},{name:"createdOn",field:"createdOn",displayName:j.getString("Created On"),cellFilter:"bsisDate",width:"**",maxWidth:"100"},{name:"daysToExpire",field:"daysToExpire",displayName:j.getString("Expiry Status"),cellFilter:"daysToExpire",width:"**",maxWidth:"150",sortingAlgorithm:function(a,b,c,d){return i.dateSort(c.entity.expiresOn,d.entity.expiresOn)}}];a.gridOptions={data:[],paginationPageSize:10,paginationTemplate:"views/template/pagination.html",columnDefs:o,minRowsToShow:10,exporterPdfOrientation:"portrait",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:{fontSize:4,margin:[-2,0,0,0]},exporterPdfTableHeaderStyle:{fontSize:5,bold:!0,margin:[-2,0,0,0]},exporterPdfMaxGridWidth:400,exporterFieldCallback:function(a,b,c,e){return"createdOn"===c.field?d("bsisDate")(e):e},exporterPdfHeader:function(){var a=[{text:j.getString("Return Note"),fontSize:10,bold:!0,margin:[30,20,0,0]}];return a},exporterPdfTableStyle:{margin:[-10,10,0,0]},exporterPdfCustomFormatter:function(b){var c=[];return c.push({text:j.getString("Return Date")+": ",bold:!0},{text:d("bsisDate")(a.returnForm.returnDate)},{text:" "+j.getString("Returned From")+": ",bold:!0},{text:a.returnForm.returnedFrom.name},{text:" "+j.getString("Returned To")+": ",bold:!0},{text:a.returnForm.returnedTo.name}),b.content=[{text:c,margin:[-10,0,0,0],fontSize:7}].concat(b.content),b},exporterPdfFooter:function(b,c){var e=[{text:j.getString("Number of components: {{componentNumber}}",{componentNumber:a.gridOptions.data.length}),width:"auto"},{text:j.getString("Date generated: {{date}}",{date:d("bsisDateTime")(new Date)}),width:"auto"},{text:j.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:b,pageCount:c}),style:{alignment:"right"}}];return{columns:e,columnGap:10,margin:[30,0],fontSize:6}},onRegisterApi:function(b){a.gridApi=b}},a.exportReturnNote=function(){a.gridApi.exporter.pdfExport("all","all")},a.discardStock=function(){n()},a.deleteReturn=function(){var d={title:j.getString("Void Return"),button:j.getString("Void"),message:j.getString("Are you sure that you want to delete this Return?")};h.showConfirmation(d).then(function(){a.deleting=!0,g.deleteReturnForm({id:a.returnForm.id},function(){b.path("/manageReturns")},function(b){c.error(b),a.deleting=!1})})["catch"](function(){a.deleting=!1})},a["return"]=function(){var b={title:j.getString("Return to Stock"),button:j.getString("Return to Stock"),message:j.getString("Are you sure you want to return all units into inventory?")};h.showConfirmation(b).then(function(){a.returnForm.status="RETURNED",g.updateReturnForm({},a.returnForm,function(b){a.returnForm=b.returnForm,l(a.returnForm)},function(a){c.error(a)})})},a.edit=function(){b.path("/recordReturn/"+e.id)},m()}]),angular.module("bsis").controller("ViewReturnsCtrl",["$scope","$location","$log","ReturnFormsService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f){a.dateFormat=e;var g={returnDateFrom:moment().subtract(7,"days").startOf("day").toDate(),returnDateTo:moment().endOf("day").toDate(),returnedFromId:null,returnedToId:null},h=[{name:"Return Date",displayName:f.getString("Return Date"),field:"returnDate",cellFilter:"bsisDate",width:"**",maxWidth:"200"},{name:"Return Status",displayName:f.getString("Return Status"),field:"status",cellFilter:"titleCase | translate",width:"**",maxWidth:"200"},{name:"Returned From",displayName:f.getString("Returned From"),field:"returnedFrom.name",width:"**"},{name:"Returned To",displayName:f.getString("Returned To"),field:"returnedTo.name",width:"**"}];a.searchParams={},a.returnToSites=[],a.returnFromSites=[],a.searching=!1,a.submitted=!1,a.gridOptions={data:[],paginationPageSize:7,paginationTemplate:"views/template/pagination.html",minRowsToShow:7,columnDefs:h,rowTemplate:"views/template/clickablerow.html",onRegisterApi:function(b){a.gridApi=b}},a.findReturns=function(b){b.$invalid||(a.searching=!0,a.submitted=!0,d.findReturnForms(a.searchParams,function(b){a.gridOptions.data=b.returnForms,a.searching=!1,a.gridOptions.paginationCurrentPage=1},function(b){a.searching=!1,c.error(b)}))},a.onRowClick=function(a){b.path("/viewReturn/"+a.entity.id)},a.init=function(){a.gridOptions.data=[],a.searchParams=angular.copy(g),a.submitted=!1,a.searching=!1,d.getReturnFormsForm(function(b){a.returnFromSites=b.usageSites,a.returnToSites=b.distributionSites},c.error)},a.init()}]),angular.module("bsis").controller("DiscardComponentsModalCtrl",["$scope","$uibModalInstance","$log","componentIds","returnFormId","ComponentService",function(a,b,c,d,e,f){
function g(){f.getDiscardForm(function(b){a.discardReasons=b.discardReasons,h=b.discardComponentsForm},c.error)}a.discard={},a.discardReasons=[],a.discardingComponent=!1;var h={};a.close=function(){a.discardComponentsForm.discardReason.$setValidity("required",!0),b.dismiss()},a.discardComponents=function(){a.discardComponentsForm.$invalid||(a.discardingComponent=!0,h.componentIds=d,h.discardReason=a.discard.discardReason,h.discardReasonText=a.discard.discardReasonText,f.discard({},h,function(){a.discardingComponent=!1,b.close()},function(b){c.error(b),a.discardingComponent=!1}))},g()}]),angular.module("bsis").controller("ManageOrdersCtrl",["$scope","$log","$location","OrderFormsService","GENDER","BLOODGROUP","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g,h){function i(){"TRANSFER"===a.orderForm.type?a.dispatchToSites=k.filter(function(b){return b.id!==a.orderForm.dispatchedFrom}):"ISSUE"===a.orderForm.type||"PATIENT_REQUEST"===a.orderForm.type?a.dispatchToSites=l:a.dispatchToSites=[]}function j(){var c={status:"CREATED"};d.findOrderForms(c,function(b){a.gridOptions.data=b.orderForms},b.error),d.getOrderFormsForm(function(b){a.dispatchFromSites=k=b.distributionSites,l=b.usageSites,i()},b.error),a.genders=e.options,a.bloodGroups=f.options}var k=[],l=[];a.dateFormat=g,a.maxDateOfBirth=moment().endOf("day").toDate(),a.orderForm={orderDate:new Date,type:null,dispatchedFrom:null,dispatchedTo:null,patient:null},a.addingOrderForm=!1,a.dispatchFromSites=[],a.dispatchToSites=[],a.addOrder=function(){if(!a.addOrderForm.$invalid){a.addingOrderForm=!0,"PATIENT_REQUEST"!==a.orderForm.type&&(a.orderForm.patient=null);var e={status:"CREATED",orderDate:a.orderForm.orderDate,type:a.orderForm.type,dispatchedFrom:{id:a.orderForm.dispatchedFrom},dispatchedTo:{id:a.orderForm.dispatchedTo},patient:a.orderForm.patient};d.addOrderForm({},e,function(b){a.addingOrderForm=!1,c.path("/fulfilOrder/"+b.orderForm.id)},function(c){b.error(c),a.addingOrderForm=!1})}},a.clearForm=function(){a.orderForm.orderDate=new Date,a.orderForm.type=null,a.orderForm.dispatchedFrom=null,a.orderForm.dispatchedTo=null,a.orderForm.patient=null,a.addOrderForm.$setPristine()},a.$watch("orderForm.type",function(){i()}),a.$watch("orderForm.dispatchedFrom",function(){i()}),a.onRowClick=function(a){c.path("/viewOrder/"+a.entity.id)};var m=[{displayName:h.getString("Order Date"),field:"orderDate",cellFilter:"bsisDate",width:"**",maxWidth:"200"},{displayName:h.getString("Dispatch Type"),field:"type",cellFilter:"titleCase | translate",width:"**",maxWidth:"200"},{displayName:h.getString("Dispatch From"),field:"dispatchedFrom.name",width:"**"},{displayName:h.getString("Dispatched To"),field:"dispatchedTo.name",width:"**"}];a.gridOptions={data:[],paginationPageSize:6,paginationPageSizes:[6],paginationTemplate:"views/template/pagination.html",rowTemplate:"views/template/clickablerow.html",columnDefs:m,minRowsToShow:6,onRegisterApi:function(b){a.gridApi=b}},j()}]),angular.module("bsis").controller("ViewOrdersCtrl",["$scope","$location","$log","OrderFormsService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f){function g(){"TRANSFER"===a.searchParams.type?a.dispatchToSites=o.filter(function(b){return b.id!==a.searchParams.dispatchedFrom}):"ISSUE"===a.searchParams.type||"PATIENT_REQUEST"===a.searchParams.type?a.dispatchToSites=p:a.dispatchToSites=[]}a.dateFormat=e;var h={orderDateFrom:moment().subtract(7,"days").startOf("day").toDate(),orderDateTo:moment().endOf("day").toDate(),type:null,dispatchedFromId:null,dispatchedToId:null},i=f.getString("Order Date"),j=f.getString("Order Status"),k=f.getString("Dispatch Type"),l=f.getString("Dispatch From"),m=f.getString("Dispatched To"),n=[{name:"Order Date",displayName:i,field:"orderDate",cellFilter:"bsisDate",width:"**",maxWidth:"200"},{name:"Order Status",displayName:j,field:"status",width:"**",maxWidth:"200"},{name:"Dispatch Type",displayName:k,field:"type",width:"**",maxWidth:"200"},{name:"Dispatched From",displayName:l,field:"dispatchedFrom.name",width:"**"},{name:"Dispatched To",displayName:m,field:"dispatchedTo.name",width:"**"}],o=[],p=[];a.searchParams={},a.dispatchToSites=[],a.dispatchFromSites=[],a.searching=!1,a.submitted=!1,a.gridOptions={data:[],paginationPageSize:6,paginationPageSizes:[6],paginationTemplate:"views/template/pagination.html",minRowsToShow:6,columnDefs:n,rowTemplate:"views/template/clickablerow.html",onRegisterApi:function(b){a.gridApi=b}},a.$watch("searchParams.type",function(){g()}),a.$watch("searchParams.dispatchedFrom",function(){g()}),a.findOrders=function(b){b.$invalid||(a.searching=!0,a.submitted=!0,d.findOrderForms(a.searchParams,function(b){a.gridOptions.data=b.orderForms,a.searching=!1,a.gridOptions.paginationCurrentPage=1},function(b){a.searching=!1,c.error(b)}))},a.onRowClick=function(a){b.path("/viewOrder/"+a.entity.id)},a.init=function(){a.gridOptions.data=[],a.searchParams=angular.copy(h),a.submitted=!1,a.searching=!1,d.getOrderFormsForm(function(b){a.dispatchFromSites=o=b.distributionSites,p=b.usageSites,g()},c.error)},a.init()}]),angular.module("bsis").controller("FulfilOrderCtrl",["$scope","$location","$log","$routeParams","$uibModal","OrderFormsService","InventoriesService","BLOODGROUP","GENDER","DATEFORMAT","ModalsService","gettextCatalog",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){null!=a.orderDetailsForm&&("TRANSFER"===a.orderDetailsForm.type?(a.orderDetailsForm.patient=null,a.dispatchToSites=t.filter(function(b){return b.id!==a.orderDetailsForm.dispatchedFrom})):"ISSUE"===a.orderDetailsForm.type?(a.dispatchToSites=u,a.orderDetailsForm.patient=null):"PATIENT_REQUEST"===a.orderDetailsForm.type?a.dispatchToSites=u:(a.orderDetailsForm.patient=null,a.dispatchToSites=[]))}function n(a){return{componentTypeName:a.componentType.componentTypeName,bloodGroup:a.bloodGroup,numberOfUnits:a.numberOfUnits,numberSupplied:0,gap:a.numberOfUnits,itemId:a.id,componentIds:[]}}function o(b,c){return a.gridOptions.data=[],angular.forEach(c,function(c){var d=n(c),e=[];angular.forEach(b,function(a){var b=a.bloodGroup;d.gap>0&&a.componentType.id===c.componentType.id&&b===c.bloodGroup?(d.numberSupplied=d.numberSupplied+1,d.gap=d.gap-1,d.componentIds.push(a.id)):e.push(a)}),b=e,a.gridOptions.data.push(d)}),b}function p(){a.orderItem=angular.copy(r),a.component=angular.copy(s),a.addingComponent=!1,a.bloodGroups=h.options,a.genders=i.options,a.orderForm=null,a.componentTypes=[],a.components=[],a.orderItems=[],f.getOrderForm({id:d.id},function(b){a.orderForm=b.orderForm,a.components=angular.copy(b.orderForm.components),a.orderItems=angular.copy(b.orderForm.items),o(a.components,a.orderItems)},c.error),f.getOrderFormItemForm(function(b){a.componentTypes=b.componentTypes},c.error),f.getOrderFormsForm(function(b){a.dispatchFromSites=t=b.distributionSites,u=b.usageSites,m()},c.error)}function q(a){e.open({animation:!1,templateUrl:"views/errorModal.html",controller:"ErrorModalCtrl",resolve:{errorObject:function(){return{title:l.getString("Invalid Component"),button:l.getString("OK"),errorMessage:a}}}})}var r={componentType:null,bloodGroup:null,numberOfUnits:null},s={din:null,componentCode:null},t=[],u=[],v=null;a.maxDateOfBirth=moment().endOf("day").toDate(),a.format=j,a.forms={orderDetailsForm:null},a.dispatchFromSites=[],a.dispatchToSites=[],a.orderDetailsForm=null,a.editingOrderDetails=!1,a.selectingDate=!1,a.savingOrderDetails=!1,a.$watch("orderDetailsForm.type",function(){m()}),a.$watch("orderDetailsForm.dispatchedFrom",function(){m()}),a.editOrderDetails=function(){a.orderDetailsForm=angular.copy(a.orderForm),a.orderDetailsForm.orderDate=moment(a.orderDetailsForm.orderDate).toDate(),a.orderDetailsForm.patient&&null!==a.orderDetailsForm.patient.dateOfBirth&&(a.orderDetailsForm.patient.dateOfBirth=moment(a.orderDetailsForm.patient.dateOfBirth).toDate()),a.editingOrderDetails=!0},a.selectDate=function(b){b.preventDefault(),b.stopPropagation(),a.selectingDate=!0},a.saveOrderDetails=function(){a.forms.orderDetailsForm.$invalid||(a.savingOrderDetails=!0,f.updateOrderForm({},a.orderDetailsForm,function(b){a.orderForm=b.orderForm,a.savingOrderDetails=!1,a.editingOrderDetails=!1},function(b){c.error(b),a.savingOrderDetails=!1}))},a.clearDetailsForm=function(b){b.preventDefault(),b.stopPropagation(),a.orderDetailsForm=null,a.editingOrderDetails=!1},a.addOrderItem=function(b){b.$valid&&(a.orderItems.push(a.orderItem),a.gridOptions.data.push(n(a.orderItem)),a.orderItem=angular.copy(r),b.$setPristine())},a.removeComponent=function(b){if(b.$setSubmitted(),!b.$invalid){var c=a.components.filter(function(b){return b.donationIdentificationNumber!==a.component.din&&b.donationIdentificationNumber+b.donationFlagCharacters!==a.component.din||b.componentCode!==a.component.componentCode});c.length===a.components.length?q(l.getString("Component {{DIN}} ({{componentCode}}) was not found in this Order Form.",{DIN:a.component.din,componentCode:a.component.componentCode})):(a.components=c,a.component=angular.copy(s),o(a.components,a.orderItems),b.$setPristine())}},a.addComponent=function(b){if(b.$valid){a.addingComponent=!0;var d={donationIdentificationNumber:a.component.din,componentCode:a.component.componentCode};g.getInventoryComponentByCodeAndDIN(d,function(c){var d=!0;if("IN_STOCK"!==c.inventoryStatus)d=!1,q(l.getString("Component {{DIN}} ({{componentCode}}) is not currently in stock.",{DIN:a.component.din,componentCode:a.component.componentCode}));else if(c.location.id!==a.orderForm.dispatchedFrom.id)d=!1,q(l.getString("Component {{DIN}} ({{componentCode}}) is not currently in stock at {{location}}.",{DIN:a.component.din,componentCode:a.component.componentCode,location:a.orderForm.dispatchedFrom.name}));else if("AVAILABLE"!==c.componentStatus)d=!1,q(l.getString("Component {{DIN}} ({{componentCode}}) is not suitable for dispatch.",{DIN:a.component.din,componentCode:a.component.componentCode}));else{var e=a.components.some(function(a){return a.id===c.id});if(e)d=!1,q(l.getString("Component {{DIN}} ({{componentCode}}) has already been added to this Order Form.",{DIN:a.component.din,componentCode:a.component.componentCode}));else{var f=c.orderForms.some(function(b){return b.id!==a.orderForm.id&&"DISPATCHED"!=b.status});f&&(d=!1,q(l.getString("Component {{DIN}} ({{componentCode}}) has already been assigned to another Order Form.",{DIN:a.component.din,componentCode:a.component.componentCode})))}}if(d){var g=angular.copy(a.gridOptions.data),h=angular.copy(a.components);a.components.push(c);var i=o(a.components,a.orderItems);!i||i.length>0?(q(l.getString("Component {{DIN}} ({{componentCode}}) does not match what was ordered.",{DIN:a.component.din,componentCode:a.component.componentCode})),a.gridOptions.data=g,a.components=h):(a.component=angular.copy(s),b.$setPristine())}a.addingComponent=!1},function(b){c.error(b),"NOT_FOUND"===b.data.errorCode&&q(l.getString("Component with DIN {{DIN}} and ComponentCode {{componentCode}} not found.",{DIN:a.component.din,componentCode:a.component.componentCode})),a.addingComponent=!1})}},a.deleteRows=function(){var b={title:l.getString("Delete Rows"),button:l.getString("Continue"),message:l.getString("Are you sure you want to delete the selected rows?")};k.showConfirmation(b).then(function(){angular.forEach(v,function(b){angular.forEach(b.componentIds,function(b){a.components=a.components.filter(function(a){return b!==a.id})}),a.orderItems=a.orderItems.filter(function(a){return!(b.componentTypeName===a.componentType.componentTypeName&&b.bloodGroup===a.bloodGroup&&b.numberOfUnits===a.numberOfUnits)})}),a.areRowsToDelete=!1,o(a.components,a.orderItems)})},a.updateOrder=function(){a.savingForm=!0,a.orderForm.components=a.components,a.orderForm.items=a.orderItems,f.updateOrderForm({},a.orderForm,function(c){a.orderForm=c.orderForm,a.components=angular.copy(c.orderForm.components),a.orderItems=angular.copy(c.orderForm.items),o(a.components,a.orderItems),a.savingForm=!1,b.path("/viewOrder/"+d.id)},function(b){c.error(b),a.savingForm=!1})},a.clearAddOrderItemForm=function(b){a.orderItem=angular.copy(r),b.$setPristine()},a.clearAddComponent=function(b){a.component=angular.copy(s),b.$setPristine()},a.cancel=function(){b.path("/viewOrder/"+d.id)},a.isFieldEmpty=function(a){return a?0===a.length:!0};var w=[{displayName:l.getString("Component Type"),field:"componentTypeName",width:"**"},{displayName:l.getString("Blood Group"),field:"bloodGroup",width:"**",maxWidth:"200"},{displayName:l.getString("Units Ordered"),field:"numberOfUnits",width:"**",maxWidth:"200"},{displayName:l.getString("Units Supplied"),field:"numberSupplied",width:"**",maxWidth:"200"},{displayName:l.getString("Gap"),field:"gap",width:"**",maxWidth:"200"},{field:"itemId",visible:!1},{field:"componentIds",visible:!1}];a.gridOptions={data:[],paginationPageSize:7,paginationPageSizes:[7],paginationTemplate:"views/template/pagination.html",columnDefs:w,minRowsToShow:7,enableSelectAll:!1,onRegisterApi:function(b){a.gridApi=b,b.selection.on.rowSelectionChanged(a,function(){v=b.selection.getSelectedRows(),a.areRowsToDelete=v?v.length>0:!1})}},p()}]),angular.module("bsis").controller("ViewOrderCtrl",["$scope","$location","$log","$filter","$routeParams","OrderFormsService","ModalsService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g,h,i){function j(b){a.unitsOrderedGridOptions.data=[];var c=angular.copy(b.components);angular.forEach(b.items,function(b){var d={componentTypeName:b.componentType.componentTypeName,bloodGroup:b.bloodGroup,numberOfUnits:b.numberOfUnits,numberSupplied:0,gap:b.numberOfUnits},e=[];angular.forEach(c,function(a){var c=a.bloodGroup;d.gap>0&&a.componentType.id===b.componentType.id&&c===b.bloodGroup?(d.numberSupplied=d.numberSupplied+1,d.gap=d.gap-1):e.push(a)}),c=e,a.unitsOrderedGridOptions.data.push(d)})}function k(b){a.unitsSuppliedGridOptions.data=[],angular.forEach(b.components,function(b){var c={donationIdentificationNumber:b.donationIdentificationNumber,componentTypeName:b.componentType.componentTypeName,bloodGroup:b.bloodGroup};a.unitsSuppliedGridOptions.data.push(c)})}function l(){f.getOrderForm({id:e.id},function(b){a.orderForm=b.orderForm,a.orderFormHasPatient=null!==b.orderForm.patient?!0:!1,j(a.orderForm),k(a.orderForm)},c.error)}a.dateFormat=h;var m=[{displayName:i.getString("Component Type"),field:"componentTypeName",width:"**"},{displayName:i.getString("Blood Group"),field:"bloodGroup",width:"**",maxWidth:"200"},{displayName:i.getString("Units Ordered"),field:"numberOfUnits",width:"**",maxWidth:"200"},{displayName:i.getString("Units Supplied"),field:"numberSupplied",width:"**",maxWidth:"200"},{displayName:i.getString("Gap"),field:"gap",width:"**",maxWidth:"200"}],n=[{displayName:i.getString("DIN"),field:"donationIdentificationNumber",width:"**",maxWidth:"200"},{displayName:i.getString("Component Type"),field:"componentTypeName",width:"**"},{displayName:i.getString("Blood Group"),field:"bloodGroup",width:"**",maxWidth:"200"}];a.unitsOrderedGridOptions={data:[],columnDefs:m,paginationPageSize:4,paginationPageSizes:[4],paginationTemplate:"views/template/pagination.html",minRowsToShow:4},a.unitsSuppliedGridOptions={data:[],columnDefs:n,paginationPageSize:4,paginationPageSizes:[4],paginationTemplate:"views/template/pagination.html",minRowsToShow:4};var o=function(){var b=i.getString("Order Date")+": "+d("bsisDate")(a.orderForm.orderDate)+"   "+i.getString("Dispatch From")+": "+a.orderForm.dispatchedFrom.name+"   "+i.getString("Dispatched To")+": "+a.orderForm.dispatchedTo.name+"   "+i.getString("Order Type")+": "+i.getString(d("titleCase")(a.orderForm.type))+"  \n\n";if("PATIENT_REQUEST"===a.orderForm.type){var c=i.getString("Not Specified");b+=i.getString("Blood Bank")+": "+(a.isFieldEmpty(a.orderForm.patient.hospitalBloodBankNumber)?c:a.orderForm.patient.hospitalBloodBankNumber)+"   ",b+=i.getString("Ward Number")+": "+(a.isFieldEmpty(a.orderForm.patient.hospitalWardNumber)?c:a.orderForm.patient.hospitalWardNumber)+"   ",b+=i.getString("Patient Number")+": "+(a.isFieldEmpty(a.orderForm.patient.patientNumber)?c:a.orderForm.patient.patientNumber)+"   ",b+=i.getString("Patient Name")+": "+(a.orderForm.patient.name1+" "+a.orderForm.patient.name2)+"   ",b+=i.getString("Blood Group")+": "+(a.isFieldEmpty(a.orderForm.patient.bloodGroup)?c:a.orderForm.patient.bloodGroup)+"   ",b+=i.getString("Gender")+": "+(a.isFieldEmpty(a.orderForm.patient.gender)?c:i.getString(d("titleCase")(a.orderForm.patient.gender)))+"   ",b+=i.getString("Date of Birth")+": "+(a.isFieldEmpty(a.orderForm.patient.dateOfBirth)?c:d("bsisDate")(a.orderForm.patient.dateOfBirth))+" \n\n"}return b},p=function(b,c){var d=[];return a.unitsSuppliedGridOptions.data.forEach(function(a){a.componentTypeName===b&&a.bloodGroup===c&&d.push(a.donationIdentificationNumber)}),d},q=function(a){var b=p(a.componentTypeName,a.bloodGroup),c=[];return c.push([{rowSpan:b.length,text:a.componentTypeName},{rowSpan:b.length,text:a.bloodGroup},{rowSpan:b.length,text:a.numberOfUnits,alignment:"right"},{rowSpan:b.length,text:a.numberSupplied,alignment:"right"},{text:b[0],alignment:"center"},{rowSpan:b.length,text:a.gap,alignment:"right"}]),b.length>1&&(b.splice(0,1),b.forEach(function(a){c.push(["","","","",{text:a,alignment:"center"},""])})),c},r=function(){var b=[];b.push([{style:"tableHeader",text:i.getString("Component Type")},{style:"tableHeader",text:i.getString("Blood Group")},{style:"tableHeader",text:i.getString("Units Ordered")},{style:"tableHeader",colSpan:2,text:i.getString("Units Supplied")+" / "+i.getString("DIN")},null,{style:"tableHeader",text:i.getString("Gap")}]),a.unitsOrderedGridOptions.data.forEach(function(a){var c=q(a);c.forEach(function(a){b.push(a)})});var c={content:[{text:i.getString("Dispatch Note"),style:"header"},o(),{style:"tableExample",table:{widths:["*",70,80,50,70,50],body:b}}],styles:{header:{fontSize:17,bold:!0,alignment:"center"},tableHeader:{alignment:"center",bold:!0}}};return c};a.exportDispatchNote=function(){pdfMake.createPdf(r()).open()},a.deleteOrder=function(){var d={title:i.getString("Void Order"),button:i.getString("Void"),message:i.getString("Are you sure that you want to delete this Order?")};g.showConfirmation(d).then(function(){a.deleting=!0,f.deleteOrderForm({id:e.id},function(){b.path("/manageOrders")},function(b){c.error(b),a.deleting=!1})})["catch"](function(){a.deleting=!1})},a.dispatch=function(){var b={title:i.getString("Dispatch Order"),button:i.getString("Dispatch Order"),message:i.getString("Are you sure you want to dispatch the order?")};g.showConfirmation(b).then(function(){a.orderForm.status="DISPATCHED",f.updateOrderForm({},a.orderForm,function(b){a.orderForm=b.orderForm,j(a.orderForm),k(a.orderForm)},function(a){c.error(a)})})},a.isFieldEmpty=function(a){return a?0===a.length:!0},a.edit=function(){b.path("/fulfilOrder/"+e.id)},l()}]),angular.module("bsis").controller("FindInventoryCtrl",["$scope","$filter","$log","BLOODGROUP","InventoriesService","UtilsService","DATEFORMAT","gettextCatalog",function(a,b,c,d,e,f,g,h){function i(a,b){return a.componentType.componentTypeCode<b.componentType.componentTypeCode?-1:a.componentType.componentTypeCode>b.componentType.componentTypeCode?1:a.donationIdentificationNumber<b.donationIdentificationNumber?-1:a.donationIdentificationNumber>b.donationIdentificationNumber?1:a.componentCode<b.componentCode?-1:a.componentCode>b.componentCode?1:0}function j(){a.searchParams=angular.copy(k),a.submitted=!1,a.searching=!1,e.getSearchForm(function(b){a.distributionCenters=b.distributionSites,a.componentTypes=b.componentTypes},c.error)}a.dateFormat=g;var k={donationIdentificationNumber:null,allSites:!0,locationId:null,dueToExpireBy:null,bloodGroups:[],anyBloodGroup:!0},l=[{name:"DIN",displayName:h.getString("DIN"),field:"donationIdentificationNumber",width:"**",maxWidth:"150"},{name:"Component Code",displayName:h.getString("Component Code"),field:"componentCode",width:"**",maxWidth:"150"},{name:"Created On",displayName:h.getString("Created On"),field:"createdOn",cellFilter:"bsisDate",width:"**",maxWidth:"150"},{name:"Component Type",displayName:h.getString("Component Type"),field:"componentType.componentTypeName",width:"**"},{name:"Blood Group",displayName:h.getString("Blood Group"),field:"bloodGroup",width:"**",maxWidth:"150"},{name:"Expiry Status",displayName:h.getString("Expiry Status"),field:"daysToExpire",cellFilter:"daysToExpire",width:"**",maxWidth:"200",sortingAlgorithm:function(a,b,c,d){return f.dateSort(c.entity.expiresOn,d.entity.expiresOn)}},{name:"Location",displayName:h.getString("Location"),field:"location.name",width:"**",maxWidth:"350"}];a.distributionCenters=[],a.componentTypes=[],a.bloodGroups=d.options,a.searchParams={},a.submitted=!1,a.searching=!1,a.gridOptions={data:[],paginationPageSize:8,paginationPageSizes:[10],paginationTemplate:"views/template/pagination.html",minRowsToShow:8,columnDefs:l,exporterPdfOrientation:"portrait",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:{fontSize:4,margin:[-2,0,0,0]},exporterPdfTableHeaderStyle:{fontSize:5,bold:!0,margin:[-2,0,0,0]},exporterPdfMaxGridWidth:400,exporterFieldCallback:function(a,c,d,e){return"createdOn"===d.field?b("bsisDate")(e):e},exporterPdfHeader:function(){var a=[{text:h.getString("Inventory"),fontSize:10,bold:!0,margin:[30,20,0,0]}];return a},exporterPdfTableStyle:{margin:[-10,10,0,0]},exporterPdfFooter:function(c,d){var e=[{text:h.getString("Number of components: {{componentNumber}}",{componentNumber:a.gridOptions.data.length}),width:"auto"},{text:h.getString("Date generated: {{date}}",{date:b("bsisDateTime")(new Date)}),width:"auto"},{text:h.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:c,pageCount:d}),style:{alignment:"right"}}];return{columns:e,columnGap:10,margin:[30,0],fontSize:6}},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},a.findInventory=function(b){b.$invalid||(a.submitted=!0,a.searching=!0,e.search(a.searchParams,function(b){a.gridOptions.paginationCurrentPage=1,a.gridOptions.data=b.inventories.sort(i),a.searching=!1},function(b){a.gridOptions.data=[],c.error(b),a.searching=!1}))},a.updateAllSites=function(){a.searchParams.locationId&&(a.searchParams.allSites=!1)},a.clearLocationId=function(){a.searchParams.locationId=null},a.updateAnyBloodGroup=function(){a.searchParams.anyBloodGroup=!1},a.clearBloodGroups=function(){a.searchParams.bloodGroups=[]},a.clearFields=function(){a.searchParams.locationId=null,a.searchParams.allSites=!0,a.searchParams.componentTypeId=null,a.searchParams.bloodGroups=[],a.searchParams.anyBloodGroup=!0,a.searchParams.dueToExpireBy=null},a.clearSearch=function(b){a.gridOptions.data=[],a.searchParams=angular.copy(k),a.submitted=!1,a.searching=!1,b.$setPristine()},j()}]),angular.module("bsis").controller("ViewStockLevelsCtrl",["$scope","$location","$filter","$log","ReportsService","gettextCatalog",function(a,b,c,d,e,f){function g(){return o&&"IN_STOCK"===o.inventoryStatus?!0:!1}function h(b){var c=[];if(o.distributionCenter){var d=a.distributionCenters.filter(function(a){return o.distributionCenter===a.id.toString()});c.push({text:f.getString("Distribution Center")+": ",fontSize:8,bold:!0},{text:d[0].name})}else c.push({text:f.getString("All Sites"),fontSize:8,bold:!0});return b.content=[{text:c,margin:[-10,0,0,0],fontSize:7}].concat(b.content),b}function i(){return[{text:f.getString("Stock Levels")+": "+(g()?f.getString("In Stock"):f.getString("Not Labelled")),fontSize:10,bold:!0,margin:[30,20,0,0]}]}function j(a,b,d){var e=[{text:f.getString("Date generated: {{date}}",{date:c("bsisDateTime")(new Date)}),width:"auto"},{text:f.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:b,pageCount:d}),style:{alignment:"right"}}];return{columns:e,columnGap:10,margin:[30,0]}}function k(a,b){return{componentType:b,aPlus:0,aMinus:0,bPlus:0,bMinus:0,abPlus:0,abMinus:0,oPlus:0,oMinus:0,empty:0,total:0}}function l(a,b){var c=a.cohorts,d=c[1].option;return"A+"===d?b.aPlus=a.value:"A-"===d?b.aMinus=a.value:"B+"===d?b.bPlus=a.value:"B-"===d?b.bMinus=a.value:"AB+"===d?b.abPlus=a.value:"AB-"===d?b.abMinus=a.value:"O+"===d?b.oPlus=a.value:"O-"===d?b.oMinus=a.value:"nullnull"!==d&&d||(b.empty=a.value),b.total=b.total+a.value,b}function m(a){var b="",c=[],d={};return angular.forEach(a,function(a){var e=a.cohorts,f=e[0].option;f!==b&&(d=k(a,f),c.push(d),b=f),d=l(a,d)}),c}function n(){a.search=angular.copy(p),a.searched=!1,e.getStockLevelsReportForm(function(b){a.distributionCenters=b.distributionSites},d.error)}a.distributionCenters=null;var o={};a.searched=!1,a.searching=!1;var p={inventoryStatus:"IN_STOCK",allSites:!0},q=f.getString("Component Type"),r=f.getString("Total"),s=[{name:"Component Type",displayName:q,field:"componentType",width:"**"},{name:"A+",displayName:"A+",field:"aPlus",width:55},{name:"A-",displayName:"A-",field:"aMinus",width:55},{name:"B+",displayName:"B+",field:"bPlus",width:55},{name:"B-",displayName:"B-",field:"bMinus",width:55},{name:"AB+",displayName:"AB+",field:"abPlus",width:65},{name:"AB-",displayName:"AB-",field:"abMinus",width:65},{name:"O+",displayName:"O+",field:"oPlus",width:55},{name:"O-",displayName:"O-",field:"oMinus",width:55},{name:"Total",displayName:r,field:"total",width:95}],t=[{name:"Component Type",displayName:q,field:"componentType",width:"**"},{name:"A+",displayName:"A+",field:"aPlus",width:55},{name:"A-",displayName:"A-",field:"aMinus",width:55},{name:"B+",displayName:"B+",field:"bPlus",width:55},{name:"B-",displayName:"B-",field:"bMinus",width:55},{name:"AB+",displayName:"AB+",field:"abPlus",width:65},{name:"AB-",displayName:"AB-",field:"abMinus",width:65},{name:"O+",displayName:"O+",field:"oPlus",width:55},{name:"O-",displayName:"O-",field:"oMinus",width:55},{name:"NTD",displayName:"NTD",field:"empty",width:65},{name:"Total",displayName:r,field:"total",width:95}];a.gridOptions={data:[],columnDefs:[],paginationPageSize:10,paginationPageSizes:[10],paginationTemplate:"views/template/pagination.html",minRowsToShow:10,exporterPdfOrientation:"portrait",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:{fontSize:6,margin:[-2,0,0,0]},exporterPdfTableHeaderStyle:{fontSize:6,bold:!0,margin:[-2,0,0,0]},exporterPdfMaxGridWidth:400,exporterPdfCustomFormatter:function(a){return h(a)},exporterPdfHeader:function(){return i()},exporterPdfFooter:function(b,c){return j(a.gridOptions,b,c)},onRegisterApi:function(b){a.gridApi=b}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},a.clearSearch=function(c){a.search=angular.copy(p),a.searched=!1,c.$setPristine(),b.search({})},a.clearDistributionCenter=function(){a.search.distributionCenter=null},a.updateAllSites=function(){a.search.distributionCenter?a.search.allSites=!1:a.search.allSites=!0},a.viewStockLevels=function(b){b.$invalid||(a.searched=!1,a.searching=!0,o=angular.copy(a.search),e.generateStockLevelsReport({location:o.distributionCenter,inventoryStatus:o.inventoryStatus},function(b){a.gridOptions.data=m(b.dataValues),a.gridOptions.columnDefs=g()?s:t,a.searched=!0,a.searching=!1,a.gridOptions.paginationCurrentPage=1},function(b){a.searching=!1,d.error(b)}))},n()}]),angular.module("bsis").controller("RecordTransfusionsCtrl",["$scope","$location","$log","$timeout","$routeParams","TransfusionService","ModalsService","gettextCatalog","BLOODGROUP","GENDER","DATEFORMAT",function(a,b,c,d,e,f,g,h,i,j,k){function l(){f.getTransfusionForm(function(b){b!==!1&&(a.format=k,a.componentTypes=b.componentTypes,a.locations=b.usageSites,a.transfusionOutcomes=b.transfusionOutcomes,a.genders=j.options,a.transfusionReactionTypes=b.transfusionReactionTypes,a.bloodGroups=i.options,e.id?f.getTransfusionById({id:e.id},function(b){a.transfusion=b.transfusion,a.transfusion.componentCode=b.transfusion.component.componentCode,a.transfusion.componentType=b.transfusion.component.componentType,a.transfusion.dateTransfused=new Date(b.transfusion.dateTransfused),a.transfusion.patient.dateOfBirth=new Date(b.transfusion.patient.dateOfBirth)},c.error):a.transfusion=angular.copy(a.masterDetails))})}function m(b){if(b){var c=a.componentTypes.filter(function(a){return b===a.id});return c[0].componentTypeCode}}function n(b){b.data&&b.data.donationIdentificationNumber&&a.recordTransfusionsForm.donationIdentificationNumber.$setValidity("invalid",!1),b.data&&b.data.componentCode&&("errors.invalid.componentStatus"===b.data.fieldErrors.componentCode[0].code?a.recordTransfusionsForm.componentCode.$setValidity("invalidComponentCode",!1):"errors.invalid"===b.data.fieldErrors.componentCode[0].code&&a.recordTransfusionsForm.componentCode.$setValidity("invalid",!1)),b.data&&b.data.componentType&&("errors.invalid.noComponents"===b.data.fieldErrors.componentType[0].code?a.recordTransfusionsForm.componentType.$setValidity("noComponents",!1):"errors.invalid.multipleComponents"===b.data.fieldErrors.componentType[0].code?(a.transfusion.componentCode=m(a.transfusion.componentType.id),a.recordTransfusionsForm.componentType.$setValidity("multipleComponents",!1)):"errors.invalid.componentStatus"!==b.data.fieldErrors.componentType[0].code||a.transfusion.componentCode?"errors.invalid"===b.data.fieldErrors.componentType[0].code&&a.recordTransfusionsForm.componentType.$setValidity("invalid",!1):a.recordTransfusionsForm.componentType.$setValidity("invalidComponentStatus",!1)),b.data&&b.data.dateTransfused&&("errors.invalid.dateTransfusedAfterComponentCreated"===b.data.fieldErrors.dateTransfused[0].code?a.recordTransfusionsForm.dateTransfused.$setValidity("dateTransfusedAfterComponentCreated",!1):"errors.invalid"===b.data.fieldErrors.dateTransfused[0].code&&a.recordTransfusionsForm.dateTransfused.$setValidity("invalid",!1))}a.submitted=!1,a.componentTypes=null,a.locations=null,a.transfusionOutcomes=null,a.transfusionReactionTypes=null,a.genders=null,a.bloodGroups=null,a.today=moment().startOf("day").toDate(),a.masterDetails={donationIdentificationNumber:null,componentCode:null,componentType:{id:null},patient:{dateOfBirth:null},transfusionOutcome:null,transfusionReactionType:{id:null},notes:null,receivedFrom:{id:null},dateTransfused:a.today},a.$watch("transfusion.donationIdentificationNumber",function(){d(function(){a.recordTransfusionsForm.donationIdentificationNumber.$setValidity("invalid",!0)})}),a.$watch("transfusion.componentCode",function(){d(function(){a.recordTransfusionsForm.componentCode.$setValidity("invalid",!0),a.recordTransfusionsForm.componentCode.$setValidity("invalidComponentCode",!0)})}),a.$watch("transfusion.componentType.id",function(){d(function(){a.recordTransfusionsForm.componentType.$setValidity("invalid",!0),a.recordTransfusionsForm.componentType.$setValidity("noComponents",!0),a.recordTransfusionsForm.componentType.$setValidity("multipleComponents",!0),a.recordTransfusionsForm.componentType.$setValidity("invalidComponentStatus",!0)})}),a.$watch("transfusion.dateTransfused",function(){d(function(){a.recordTransfusionsForm.dateTransfused.$setValidity("invalid",!0),a.recordTransfusionsForm.dateTransfused.$setValidity("dateTransfusedAfterComponentCreated",!0)})}),a.setComponentType=function(b){if(b){var c=a.componentTypes.filter(function(a){return-1!==b.indexOf(a.componentTypeCode)});c.length>0?(a.transfusion.componentType.id=c[0].id,a.recordTransfusionsForm.componentType.$setValidity("multipleComponents",!0)):a.transfusion.componentType.id=null}else a.transfusion.componentCode=null},a.updateReactionType=function(b){b&&"TRANSACTION_REACTION_OCCURED"!==b&&(a.transfusion.transfusionReactionType=null)},a.recordTransfusion=function(){if(!a.recordTransfusionsForm.$invalid){a.submitted=!0,a.savingTransfusionForm=!0;var c=angular.copy(a.transfusion);e.id?f.update(c,function(){a.savingTransfusionForm=!1,b.search({din:c.donationIdentificationNumber,componentCode:c.componentCode}).path("/findTransfusion")},function(b){n(b),a.savingTransfusionForm=!1}):f.createTransfusion(c,function(c){a.savingTransfusionForm=!1;var d=c.transfusion;
b.search({din:d.donationIdentificationNumber,componentCode:d.component.componentCode}).path("/findTransfusion")},function(b){n(b),a.savingTransfusionForm=!1})}},a.voidTransfusion=function(){var d={title:h.getString("Void Tranfusion"),button:h.getString("Void"),message:h.getString("Are you sure that you want to void this Tranfusion?")};g.showConfirmation(d).then(function(){a.deleting=!0,f.voidTransfusion({id:e.id},function(){b.path("/findTransfusion")},function(b){c.error("Error when voiding transfusion: "),c.error(b),a.deleting=!1})})["catch"](function(){a.deleting=!1})},a.clear=function(){a.transfusion=angular.copy(a.masterDetails),a.savingTransfusionForm=!1,a.submitted=!1,a.recordTransfusionsForm.$setPristine()},l()}]),angular.module("bsis").controller("FindTransfusionCtrl",["$scope","$location","$filter","$log","$routeParams","TransfusionService","gettextCatalog","DATEFORMAT",function(a,b,c,d,e,f,g,h){function i(){a.searchParams=angular.copy(j),a.submitted=!1,a.searching=!1,f.getSearchForm(function(b){a.componentTypes=b.componentTypes,a.transfusionSites=b.usageSites,a.transfusionOutcomes=b.transfusionOutcomes},d.error),e.din&&(a.searchParams.donationIdentificationNumber=e.din,a.searchParams.componentCode=e.componentCode,a.findTransfusion(a.searchForm))}a.dateFormat=h,a.transfusionOutcomes=[],a.componentTypes=[],a.transfusionSites=[],a.searchParams={},a.submitted=!1,a.searching=!1,a.searchForm={},a.clearFields=function(){a.searchParams.receivedFromId=null,a.searchParams.transfusionOutcome=null,a.searchParams.donationIdentificationNumber?(a.searchParams.startDate=null,a.searchParams.endDate=null):(a.searchParams.startDate=moment().subtract(7,"days").startOf("day").toDate(),a.searchParams.endDate=moment().endOf("day").toDate())};var j={donationIdentificationNumber:null,componentCode:null,componentTypeId:null,receivedFromId:null,transfusionOutcome:null,startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()},k=[{name:"DIN",displayName:g.getString("DIN"),field:"donationIdentificationNumber",width:"**",maxWidth:"150"},{name:"Component Code",displayName:g.getString("Component Code"),field:"componentCode",width:"**",maxWidth:"150"},{name:"Component Type",displayName:g.getString("Component Type"),field:"componentType",width:"**"},{name:"Transfused On",displayName:g.getString("Transfused On"),field:"dateTransfused",cellFilter:"bsisDate",width:"**",maxWidth:"150"},{name:"Outcome",displayName:g.getString("Outcome"),field:"transfusionOutcome",cellFilter:"titleCase | translate",width:"**"},{name:"Transfusion Site",displayName:g.getString("Transfusion Site"),field:"receivedFrom.name",width:"**"}];a.gridOptions={data:[],paginationPageSize:8,paginationPageSizes:[10],paginationTemplate:"views/template/pagination.html",minRowsToShow:8,columnDefs:k,rowTemplate:"views/template/clickablerow.html",exporterPdfOrientation:"portrait",exporterPdfPageSize:"A4",exporterPdfDefaultStyle:{fontSize:4,margin:[-2,0,0,0]},exporterPdfTableStyle:{margin:[-10,10,0,0]},exporterPdfTableHeaderStyle:{fontSize:5,bold:!0,margin:[-2,0,0,0]},exporterPdfMaxGridWidth:400,exporterFieldCallback:function(a,b,d,e){return"dateTransfused"===d.field?c("bsisDate")(e):"transfusionOutcome"===d.field?g.getString(c("titleCase")(e)):e},exporterPdfHeader:function(){var a=[{text:g.getString("Component Transfusion Information"),fontSize:10,bold:!0,margin:[30,20,0,0]}];return a},exporterPdfCustomFormatter:function(b){var d=c("filter")(a.componentTypes,function(b){return b.id===a.searchParams.componentTypeId}),e=c("filter")(a.transfusionSites,function(b){return b.id===a.searchParams.receivedFromId}),f=a.searchParams.transfusionOutcome,h=g.getString("All"),i=[{text:[{text:g.getString("Component Type")+": ",bold:!0},(d&&d[0]?d[0].componentTypeName:h)+"          ",{text:g.getString("Transfusion Site")+": ",bold:!0},(e&&e[0]?e[0].name:h)+"          ",{text:g.getString("Transfusion Outcome")+": ",bold:!0},f?f:h],margin:[-10,0,0,0],fontSize:7}];return b.content=i.concat(b.content),b},exporterPdfFooter:function(b,d){var e=[{text:g.getString("Total Units: {{total}}",{total:a.gridOptions.data.length}),width:"auto"},{text:g.getString("Date generated: {{date}}",{date:c("bsisDateTime")(new Date)}),width:"auto"},{text:g.getString("Page {{currentPage}} of {{pageCount}}",{currentPage:b,pageCount:d}),style:{alignment:"right"}}];return{columns:e,columnGap:10,margin:[30,0],fontSize:6}},onRegisterApi:function(b){a.gridApi=b}},a.onRowClick=function(a){b.search({}).path("/recordTransfusions/"+a.entity.id)},a.findTransfusion=function(b){b.$invalid||(a.submitted=!0,a.searching=!0,a.gridOptions.data=[],f.search(a.searchParams,function(b){a.gridOptions.paginationCurrentPage=1,a.gridOptions.data=b.transfusions,a.searching=!1},function(b){d.error(b),a.searching=!1}))},a.setComponentType=function(b){if(b){var c=a.componentTypes.filter(function(a){return-1!==b.indexOf(a.componentTypeCode)});c.length>0?a.searchParams.componentTypeId=c[0].id:a.searchParams.componentTypeId=null}},a["export"]=function(b){"pdf"===b?a.gridApi.exporter.pdfExport("all","all"):"csv"===b&&a.gridApi.exporter.csvExport("all","all")},a.clearSearch=function(c){a.gridOptions.data=[],a.searchParams=angular.copy(j),a.submitted=!1,a.searching=!1,b.search({}),c.$setPristine()},i()}]),angular.module("bsis").controller("InventorySidebarCtrl",["$scope","RoutingService","ICONS",function(a,b,c){var d=[{path:"/findInventory",subpaths:[]},{path:"/viewStockLevels",subpaths:[]},{path:"/manageOrders",subpaths:["/fulfilOrder","/viewOrder","/viewOrders"]},{path:"/manageReturns",subpaths:["/recordReturn","/viewOrder","/viewReturn","/viewReturns"]},{path:"/recordTransfusions",subpaths:[]},{path:"/findTransfusion",subpaths:[]}];a.icons=c,a.currentPath=b.getCurrentPath(d)}]),angular.module("bsis").controller("AccountSettingsCtrl",["$scope","UsersService","gettextCatalog",function(a,b,c){a.masterDetails={firstName:"",lastName:"",emailId:"",username:"",modifyPassword:!1,currentPassword:"",password:"",confirmPassword:""},a.userDetails={},a.resetUserDetails=function(){a.userDetails=angular.copy(a.masterDetails),a.detailsMessage=null,a.userDetailsForm&&(a.userDetailsForm.$setPristine(),a.userDetailsForm.$setUntouched())},a.updateUserDetails=function(){return a.userDetailsForm.$invalid?(a.detailsStyle="danger",void(a.detailsMessage=c.getString("Please complete all of the required fields"))):(a.updatingUser=!0,void b.updateLoggedOnUser(a.userDetails,function(b){a.masterDetails=b,a.resetUserDetails(),a.detailsStyle="success",a.detailsMessage=c.getString("Your details were successfully updated"),a.updatingUser=!1},function(b){a.detailsStyle="danger",b.data&&b.data["user.password"]?a.detailsMessage=b.data["user.password"]:a.detailsMessage=c.getString("Updating details failed. Please try again"),a.updatingUser=!1}))},b.getLoggedOnUser(function(b){angular.extend(a.masterDetails,b,{modifyPassword:!1,currentPassword:"",password:"",confirmPassword:""}),a.resetUserDetails()},function(){a.detailsStyle="danger",a.detailsMessage=c.getString("Loading details failed. Please try refreshing")})}]),angular.module("bsis").controller("ConfigurationsCtrl",["$scope","$location","ConfigurationsService","ngTableParams","$timeout","$filter","ICONS",function(a,b,c,d,e,f,g){a.icons=g;var h=[{}];a.data=h,a.configurations={},a.clear=function(){},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.getConfigurations=function(){c.getConfigurations(function(b){b!==!1&&(h=b,a.data=h,a.configurations=h,a.configurationsCount=a.configurations.length)})},a.configurationsTableParams=new d({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:h.length,getData:function(a,b){var c=b.filter()?f("filter")(h,b.filter()):h,d=b.sorting()?f("orderBy")(c,b.orderBy()):h;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("data",function(){e(function(){a.configurationsTableParams.reload()})}),a.addNewConfiguration=function(){c.setConfiguration(""),b.path("/manageConfiguration")},a.manageConfiguration=function(d){a.configuration=d,c.setConfiguration(d),b.path("/manageConfiguration/"+d.id)},a.getConfigurations()}]).controller("ManageConfigurationsCtrl",["$scope","$location","$log","ConfigurationsService","ICONS","DATATYPES","$routeParams",function(a,b,c,d,e,f,g){a.icons=e,a.selection="/manageConfiguration",a.password={value:""},a.getConfig=function(){d.getConfigurationById(g.id,function(b){a.configuration=b,a.disableConfigurationname=!0},function(a){c.log(a)})},g.id?(a.getConfig(),a.password.value=""):a.configuration={},a.clearPassword=function(){a.password.value=a.configuration.value},a.setPassword=function(){a.configuration.value=a.password.value},a.dataTypes=f.options,a.saveConfiguration=function(b,c){c.$valid?angular.isDefined(b)&&(angular.isDefined(b.id)?a.updateConfiguration(b,c):a.addConfiguration(b,c)):a.submitted=!0},a.serverError={},a.$watch("configuration.dataType.id",function(b,c){var d=parseInt(b)-1;isNaN(d)||(a.datatype=f.options[d].datatype,null!=c&&(a.configuration.value=null,a.configurationForm.value.$setPristine()))}),a.updateConfiguration=function(b,c){c.$valid?(a.savingConfiguration=!0,d.updateConfiguration(b,function(b,c){b!==!1?a.go("/configurations"):(c.value&&(a.configurationValueInvalid="ng-invalid",a.serverError.value=c.value),c.name&&(a.configurationNameInvalid="ng-invalid",a.serverError.name=c.name)),a.savingConfiguration=!1})):a.submitted=!0},a.addConfiguration=function(b,c){c.$valid?d.addConfiguration(b,function(b,d){b!==!1?(a.configuration={name:"",description:""},c.$setPristine(),a.submitted="",a.go("/configurations")):(d.value&&(a.configurationValueInvalid="ng-invalid",a.serverError.value=d.value),d.name&&(a.configurationNameInvalid="ng-invalid",a.serverError.name=d.name))}):a.submitted=!0},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.cancel=function(c){a.clearForm(c),b.path("/configurations")},a.go=function(a){b.path(a)}}]),angular.module("bsis").controller("AdverseEventTypesCtrl",["$scope","$filter","$location","$log","ICONS","AdverseEventsService","ngTableParams",function(a,b,c,d,e,f,g){a.icons=e,a.tableParams=new g({page:1,count:6},{counts:[],getData:function(a,c){f.getAdverseEventTypes(function(d){var e=c.sorting()?b("orderBy")(d,c.orderBy()):d;c.total(e.length),a.resolve(e.slice((c.page()-1)*c.count(),c.page()*c.count()))},function(b){d.error(b),a.reject(b)})}}),a.editAdverseEventType=function(a){c.path("/editAdverseEventType/"+a)}}]),angular.module("bsis").controller("TransfusionReactionTypesCtrl",["$scope","$filter","$location","$log","gettextCatalog","$timeout","ICONS","TransfusionReactionTypesService",function(a,b,c,d,e,f,g,h){a.icons=g,a.transfusionReactionTypes={};var i=[{name:"Name",field:"name",displayName:e.getString("Name"),width:"**",maxWidth:"300"},{name:"Description",displayName:e.getString("Description"),field:"description",width:"**"},{name:"Enabled",field:"isDeleted",displayName:e.getString("Enabled"),cellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="!row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARECHECK}}"></i></span><span ng-show="row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARE}}"></i></span></div>',width:"**",maxWidth:"100"}];a.getTransfusionReactionTypes=function(){h.getTransfusionReactionTypes(function(b){a.gridOptions.data=b.transfusionReactionTypes,a.transfusionReactionTypes=b.transfusionReactionTypes,a.transfusionReactionTypesCount=a.transfusionReactionTypes.length},d.error)},a.onRowClick=function(a){c.path("/manageTransfusionReactionType/"+a.entity.id)},a.gridOptions={data:[],paginationPageSize:10,paginationTemplate:"views/template/pagination.html",minRowsToShow:10,columnDefs:i,rowTemplate:"views/template/clickablerow.html",onRegisterApi:function(b){a.gridApi=b}},a.getTransfusionReactionTypes()}]),angular.module("bsis").controller("ManageTransfusionReactionTypeCtrl",["$scope","$location","$log","$timeout","$routeParams","TransfusionReactionTypesService",function(a,b,c,d,e,f){function g(b){b.data&&b.data.name&&a.transfusionReactionTypeForm.name.$setValidity("duplicate",!1),a.savingTransfusionReactionType=!1}function h(){e.id&&f.getTransfusionReactionTypeById({id:e.id},function(b){a.transfusionReactionType=b.transfusionReactionType},c.error)}a.transfusionReactionType={isDeleted:!1,name:"",description:""},a.cancel=function(){b.path("/transfusionReactionTypes")},a.$watch("transfusionReactionType.name",function(){d(function(){a.transfusionReactionTypeForm.name.$setValidity("duplicate",!0)})}),a.saveTransfusionReactionType=function(){a.transfusionReactionTypeForm.$invalid||(a.savingTransfusionReactionType=!0,e.id?f.updateTransfusionReactionType(a.transfusionReactionType,function(){b.path("/transfusionReactionTypes")},function(a){g(a)}):f.createTransfusionReactionType(a.transfusionReactionType,function(){b.path("/transfusionReactionTypes")},function(a){g(a)}))},h()}]),angular.module("bsis").controller("AddAdverseEventTypeCtrl",["$scope","$location","$log","AdverseEventsService",function(a,b,c,d){a.adverseEventType={name:"",description:"",isDeleted:!1},a.forms={},a.$watch("adverseEventType.name",function(){a.forms.adverseEventTypeForm&&a.forms.adverseEventTypeForm.name.$setValidity("duplicate",!0)}),a.saveAdverseEventType=function(e){if(!e.$invalid){var f={name:a.adverseEventType.name,description:a.adverseEventType.description,isDeleted:a.adverseEventType.isDeleted};a.savingAdverseEventType=!0,d.createAdverseEventType(f,function(){b.path("/adverseEventTypes")},function(b){b.data&&b.data.name?e.name.$setValidity("duplicate",!1):c.error(b),a.savingAdverseEventType=!1})}}}]),angular.module("bsis").controller("EditAdverseEventTypeCtrl",["$scope","$location","$log","$routeParams","AdverseEventsService",function(a,b,c,d,e){a.adverseEventType={id:d.id,name:"",description:"",isDeleted:!1},a.forms={},a.$watch("adverseEventType.name",function(){a.forms.adverseEventTypeForm&&a.forms.adverseEventTypeForm.name.$setValidity("duplicate",!0)}),e.getAdverseEventTypeById(d.id,function(b){a.adverseEventType=b},function(a){c.error(a)}),a.saveAdverseEventType=function(d){if(!d.$invalid){var f={id:a.adverseEventType.id,name:a.adverseEventType.name,description:a.adverseEventType.description,isDeleted:a.adverseEventType.isDeleted};a.savingAdverseEventType=!0,e.updateAdverseEventType(f,function(){b.path("/adverseEventTypes")},function(b){b.data&&b.data.name?d.name.$setValidity("duplicate",!1):c.error(b),a.savingAdverseEventType=!1})}}}]),angular.module("bsis").controller("UsersCtrl",["$scope","$location","UsersService","RolesService","ICONS","$filter","ngTableParams","$timeout",function(a,b,c,d,e,f,g,h){a.icons=e,a.isCurrent=function(c){return c.length>1&&b.path().substr(0,c.length)===c?(b.path(c),a.selection=c,!0):b.path()===c?!0:!("/settings"!==b.path()||"/users"!==c)};var i=[];a.data=i,a.users={},a.clear=function(){},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.getUsers=function(){c.getUsers(function(b){b!==!1&&(i=b,a.data=i,a.usersCount=a.data.length)})},a.getUsers(),a.removeUserCheck=function(b){a.userToRemove=b.id},a.cancelRemoveUser=function(){a.userToRemove=""},a.removeUser=function(d){d.isDeleted=!0,c.deleteUser(d,function(c){c!==!1&&(a.getUsers(),b.path("/users"))})},a.addNewUser=function(){c.setUser(""),b.path("/manageUser")},a.manageUser=function(e){a.user=e,c.setUser(e),d.getRoles(function(d){d!==!1&&(a.roleList=d,c.setRoles(d),b.path("/manageUser/"+e.id))})},a.usersTableParams=new g({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:i.length,getData:function(a,b){var c=b.filter()?f("filter")(i,b.filter()):i,d=b.sorting()?f("orderBy")(c,b.orderBy()):i;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("data",function(){h(function(){a.usersTableParams.reload()})})}]).controller("ManageUserCtrl",["$scope","$rootScope","UsersService","RolesService","ICONS","$location","ngTableParams","$timeout","$routeParams","$log",function(a,b,c,d,e,f,g,h,i,j){a.icons=e,a.selection="/manageUser",a.getUser=function(){c.getUserById(i.id,function(b){a.user=b,a.disableUsername=!0;for(var c in a.user.roles)a.user.roles[c].permissions=[]},function(a){j.error(a)})},i.id?a.getUser():(a.user={},a.user.modifyPassword=!0,a.emailRequired="required",a.passwordRequired="required"),a.saveUser=function(b,c){c.$valid?(a.roleRequired=!1,angular.isDefined(b)&&angular.isDefined(b.roles)&&b.roles.length>0?angular.isDefined(b.id)?a.updateUser(b,c):a.addUser(b,c):a.roleRequired=!0):a.submitted=!0},d.getRoles(function(b){a.roleList=b;for(var c in a.roleList)a.roleList[c].permissions=[]}),a.updateUser=function(b,d){d.$valid?(a.savingUser=!0,c.updateUser(b,function(b,c){if(b!==!1)a.go("/users");else{var d="username";c[d]&&(a.usernameInvalid="ng-invalid",a.serverError=c[d])}a.savingUser=!1})):a.submitted=!0},a.addUser=function(b,d){d.$valid?(a.savingUser=!0,c.addUser(b,function(b,c){if(b!==!1)a.user={name:"",description:""},d.$setPristine(),a.submitted="",a.go("/users");else{var e="username";c[e]&&(a.usernameInvalid="ng-invalid",a.serverError=c[e],a.err=c.fieldErrors.username[0].code)}a.savingUser=!1})):a.submitted=!0},a.go=function(a){f.path(a)}}]),angular.module("bsis").controller("RolesCtrl",["$scope","$location","RolesService","ICONS","$filter","ngTableParams","$timeout",function(a,b,c,d,e,f,g){a.icons=d,a.data={};var h=[];a.roles={},a.clear=function(){},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.getRoles=function(){c.getRoles(function(b){b!==!1&&(h=b,a.data=b,a.rolesCount=a.data.length)}),a.rolesTableParams=new f({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:a.data.length,getData:function(a,b){var c=b.filter()?e("filter")(h,b.filter()):h,d=b.sorting()?e("orderBy")(c,b.orderBy()):h;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("data",function(){g(function(){a.rolesTableParams.reload()})})},a.addNewRole=function(){c.setRole(""),c.setPermissions(""),b.path("/manageRole")},a.manageRole=function(d){c.getAllPermissions(function(e){e!==!1&&(a.permissionList=e.permissions,c.setPermissions(e.permissions),a.role=d,c.setRole(d),b.path("/manageRole/"+d.id))})},a.getRoles()}]).controller("ManageRolesCtrl",["$scope","$location","RolesService","ICONS","$routeParams",function(a,b,c,d,e){a.icons=d,a.saveRole=function(b,c){a.permissionsRequired=!1,angular.isDefined(b)&&angular.isDefined(b.permissions)&&b.permissions.length>0?"updateRole"===a.manageRoleType?a.updateRole(b):"addRole"===a.manageRoleType&&a.addRole(b,c):(a.submitted=!0,a.permissionsRequired=!0)},a.addRole=function(b,d){d.$valid?(a.savingRole=!0,c.addRole(b,function(b,c){b!==!1?(a.role={name:"",description:""},d.$setPristine(),a.submitted="",a.go("/roles")):(a.nameInvalid="ng-invalid",a.err=c.fieldErrors.name[0].code),a.savingRole=!1})):a.submitted=!0},a.go=function(a){b.path(a)},a.someSelected=function(a){return Object.keys(a).some(function(b){return a[b]})},a.updateRole=function(d){a.savingRole=!0,c.updateRole(d,function(d,e){if(d!==!1)c.setRole(""),c.setPermissions(""),b.path("/roles");else{a.nameInvalid="ng-invalid";var f="name";a.serverError=e[f]}a.savingRole=!1})},a.loadPermissions=function(){c.getAllPermissions(function(b){b!==!1&&(a.permissionList=b.permissions)})},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.cancel=function(c){a.clearForm(c),b.path("/roles")},a.getRole=function(){c.getRoleById(e.id,function(b){a.role=b,a.loadPermissions()},function(b){a.err=b})},e.id?(a.getRole(),a.manageRoleType="updateRole"):(a.role={permissions:[]},a.loadPermissions(),a.manageRoleType="addRole")}]),angular.module("bsis").controller("DeferralReasonsCtrl",["$scope","$location","DeferralReasonsService","ngTableParams","$timeout","$filter","ICONS",function(a,b,c,d,e,f,g){a.icons=g;var h=[{}];a.data=h,a.deferralReasons={},a.clear=function(){},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.getDeferrals=function(){c.getDeferrals(function(b){b!==!1&&(h=b,a.data=h,a.deferralReasons=h,a.deferralReasonsCount=a.deferralReasons.length)})},a.deferralsTableParams=new d({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:h.length,getData:function(a,b){var c=b.filter()?f("filter")(h,b.filter()):h,d=b.sorting()?f("orderBy")(c,b.orderBy()):h;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("data",function(){e(function(){a.deferralsTableParams.reload()})}),a.addNewDeferralReason=function(){c.setDeferralReason(""),b.path("/manageDeferralReason")},a.manageDeferralReason=function(d){a.deferral=d,c.setDeferralReason(d),b.path("/manageDeferralReason/"+d.id)},a.getDeferrals()}]).controller("ManageDeferralReasonsCtrl",["$scope","$location","DeferralReasonsService","ICONS","DATATYPES","$routeParams",function(a,b,c,d,e,f){a.icons=d,a.selection="/manageDeferralReason",a.getDeferralReason=function(){c.getDeferralReasonById(f.id,function(b){a.deferral=b},function(b){a.err=b})},f.id?(a.getDeferralReason(),a.disableDeferralname=!0):a.deferral={isDeleted:!1},a.dataTypes=e.options,a.saveDeferralReason=function(b,c){c.$valid?angular.isDefined(b)&&(angular.isDefined(b.id)?a.updateDeferralReason(b,c):a.addDeferralReason(b,c)):a.submitted=!0},a.serverError={},a.updateDeferralReason=function(b,d){d.$valid?c.updateDeferralReason(b,function(b,c){b!==!1?a.go("/deferralReasons"):c.reason&&(a.deferralReasonInvalid="ng-invalid",a.serverError.reason=c.reason)}):a.submitted=!0},a.addDeferralReason=function(b,d){d.$valid?(b.isDeleted=!1,c.addDeferralReason(b,function(b,c){b!==!1?(a.deferral={reason:"",isDeleted:!1},d.$setPristine(),a.submitted="",a.go("/deferralReasons")):c.reason&&(a.deferralReasonInvalid="ng-invalid",a.serverError.reason=c.reason)})):a.submitted=!0},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.cancel=function(c){a.clearForm(c),b.path("/deferralReasons")},a.handleDurationTypeChange=function(){a.deferral.defaultDuration="PERMANENT"===a.deferral.durationType?null:0},a.go=function(a){b.path(a)}}]),angular.module("bsis").controller("DiscardReasonsCtrl",["$scope","$location","DiscardReasonsService","ngTableParams","$timeout","$filter","ICONS",function(a,b,c,d,e,f,g){a.icons=g;var h=[{}];a.data=h,a.discardReasons={},a.clear=function(){},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.getDiscards=function(){c.getDiscards(function(b){b!==!1&&(h=b,a.data=h,a.discardReasons=h,a.discardReasonsCount=a.discardReasons.length)})},a.discardsTableParams=new d({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:h.length,getData:function(a,b){var c=b.filter()?f("filter")(h,b.filter()):h,d=b.sorting()?f("orderBy")(c,b.orderBy()):h;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("data",function(){e(function(){a.discardsTableParams.reload()})}),a.addNewDiscardReason=function(){c.setDiscardReason(""),b.path("/manageDiscardReason")},a.manageDiscardReason=function(d){a.discard=d,c.setDiscardReason(d),b.path("/manageDiscardReason/"+d.id)},a.getDiscards()}]).controller("ManageDiscardReasonsCtrl",["$scope","$location","DiscardReasonsService","ICONS","DATATYPES","$routeParams",function(a,b,c,d,e,f){a.icons=d,a.selection="/manageDiscardReason",a.getDiscardReason=function(){c.getDiscardReasonById(f.id,function(b){a.discard=b},function(b){a.err=b})},f.id?(a.getDiscardReason(),a.disableDiscardname=!0):a.discard={isDeleted:!1},a.dataTypes=e.options,a.saveDiscardReason=function(b,c){c.$valid?angular.isDefined(b)&&(angular.isDefined(b.id)?a.updateDiscardReason(b,c):a.addDiscardReason(b,c)):a.submitted=!0},a.serverError={},a.updateDiscardReason=function(b,d){d.$valid?(a.savingDiscardReason=!0,c.updateDiscardReason(b,function(b,c){b!==!1?a.go("/discardReasons"):c.reason&&(a.discardReasonInvalid="ng-invalid",a.serverError.reason=c.reason),a.savingDiscardReason=!1})):a.submitted=!0},a.addDiscardReason=function(b,d){d.$valid?(b.isDeleted=!1,a.savingDiscardReason=!0,c.addDiscardReason(b,function(b,c){b!==!1?(a.discard={reason:"",isDeleted:!1},d.$setPristine(),a.submitted="",a.go("/discardReasons")):c.reason&&(a.discardReasonInvalid="ng-invalid",a.serverError.reason=c.reason),a.savingDiscardReason=!1})):a.submitted=!0},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.cancel=function(c){a.clearForm(c),b.path("/discardReasons")},a.go=function(a){b.path(a)}}]),angular.module("bsis").controller("DonationTypesCtrl",["$scope","$location","DonationTypesService","ngTableParams","$timeout","$filter","ICONS",function(a,b,c,d,e,f,g){a.icons=g;var h=[{}];a.data=h,a.donationTypes={},a.clear=function(){},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.getDonationTypes=function(){c.getDonationTypes(function(b){b!==!1&&(h=b,a.data=h,a.donationTypes=h,a.donationTypesCount=a.donationTypes.length)})},a.donationTypesTableParams=new d({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:h.length,getData:function(a,b){var c=b.filter()?f("filter")(h,b.filter()):h,d=b.sorting()?f("orderBy")(c,b.orderBy()):h;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("data",function(){e(function(){a.donationTypesTableParams.reload()})}),a.addNewDonationType=function(){c.setDonationType(""),b.path("/manageDonationType")},a.manageDonationType=function(d){a.donationType=d,c.setDonationType(d),b.path("/manageDonationType/"+d.id)},a.getDonationTypes()}]).controller("ManageDonationTypesCtrl",["$scope","$location","DonationTypesService","ICONS","$routeParams",function(a,b,c,d,e){a.icons=d,a.selection="/manageDonationType",a.getDonationType=function(){c.getDonationTypeById(e.id,function(b){a.donationType=b},function(b){a.err=b})},e.id?(a.getDonationType(),a.disableDonationTypename=!0):a.donationType={isDeleted:!1},a.saveDonationType=function(b,c){c.$valid?angular.isDefined(b)&&(angular.isDefined(b.id)?a.updateDonationType(b,c):a.addDonationType(b,c)):a.submitted=!0},a.serverError={},a.updateDonationType=function(b,d){d.$valid?(a.savingDonationType=!0,c.updateDonationType(b,function(b,c){b!==!1?a.go("/donationTypes"):c.type&&(a.typeInvalid="ng-invalid",a.serverError.type=c.type),a.savingDonationType=!1})):a.submitted=!0},a.addDonationType=function(b,d){d.$valid?(b.isDeleted=!1,a.savingDonationType=!0,c.addDonationType(b,function(b,c){b!==!1?(a.donationType={donationType:"",isDeleted:!1},d.$setPristine(),a.submitted="",a.go("/donationTypes")):c.type&&(a.typeInvalid="ng-invalid",a.serverError.type=c.type),a.savingDonationType=!1})):a.submitted=!0},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.cancel=function(c){a.clearForm(c),b.path("/donationTypes")},a.go=function(a){b.path(a)}}]),angular.module("bsis").controller("AuditLogCtrl",["$scope","$filter","$q","Api","ngTableParams","gettextCatalog","DATEFORMAT",function(a,b,c,d,e,f,g){function h(a){var b=[];return angular.forEach(a,function(a){angular.forEach(a.entityModifications,function(c){b.push({id:a.id,revisionDate:a.revisionDate,user:a.user,revisionType:c.revisionType,entityName:c.entityName})})}),b}function i(a){var b=[];return angular.forEach(a,function(a){var c=!1;angular.forEach(b,function(b){c||a.id!==b.id||a.entityName!==b.entityName||a.revisionType!==b.revisionType||(c=!0,b.count+=1)}),c||b.push(angular.extend({count:1},a))}),b}a.dateFormat=g,a.dateRange={startDate:moment().subtract(7,"days").startOf("day").toDate(),endDate:moment().endOf("day").toDate()};var j=a.$watch("dateRange",function(){a.dateRange.startDate&&a.dateRange.endDate&&(a.tableParams.$params.page=1,a.tableParams.reload())},!0);a.$on("$destroy",function(){j()}),a.getRevisionTypes=function(){var a=c.defer();return a.resolve([{id:"ADD",title:f.getString("Added")},{id:"MOD",title:f.getString("Modified")},{id:"DEL",title:f.getString("Deleted")}]),a},a.tableParams=new e({page:1,count:10,sorting:{revisionDate:"desc"}},{counts:[],getData:function(c,e){var f=a.dateRange.endDate,g={startDate:b("isoString")(a.dateRange.startDate),endDate:b("isoString")(f)},j=angular.copy(e.filter()||{});j.user&&(g.search=j.user),delete j.user,d.AuditRevisions.query(g,function(a){var d=i(h(a));d=b("filter")(d,j),e.sorting()&&(d=b("orderBy")(d,e.orderBy())),e.total(d.length),c.resolve(d.slice((e.page()-1)*e.count(),e.page()*e.count()))},c.reject)}})}]),angular.module("bsis").controller("PackTypesCtrl",["$scope","$rootScope","$location","$log","PackTypesService","ICONS","$filter","ngTableParams","$timeout",function(a,b,c,d,e,f,g,h,i){a.icons=f,a.isCurrent=function(b){return b.length>1&&c.path().substr(0,b.length)===b?(c.path(b),a.selection=b,!0):c.path()===b?!0:!("/settings"!==c.path()||"/packTypes"!==b)};var j=[];a.data=j,a.packTypes={},a.clear=function(){},a.managePackType=function(b){a.packType=b,e.setPackType(b),c.path("/managePackType/"+b.id)},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.getPackTypes=function(){e.getPackTypes(function(b){b!==!1?(j=b,a.data=j,a.packTypes=j,a.packTypesCount=a.data.length):d.error("failed to get pack types")})},a.getPackTypes(),a.addNewPackType=function(){e.setPackType(""),c.path("/managePackType")},a.packTypesTableParams=new h({page:1,count:6,filter:{},sorting:{}},{defaultSort:"asc",counts:[],total:j.length,getData:function(a,b){var c=b.filter()?g("filter")(j,b.filter()):j,d=b.sorting()?g("orderBy")(c,b.orderBy()):j;b.total(d.length),a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),a.$watch("data",function(){i(function(){a.packTypesTableParams.reload()})})}]).controller("ManagePackTypesCtrl",["$scope","$location","$log","PackTypesService","ICONS","ComponentTypesService","$routeParams","$timeout",function(a,b,c,d,e,f,g,h){a.icons=e,a.selection="/managePackType",a.packType=d.getPackType(),a.serverError=null,""===a.packType&&(a.packType={countAsDonation:!1}),f.getComponentTypes({},function(b){a.componentTypes=b.componentTypes},function(a){c.error(a)}),a.$watch("packType.packType",function(){h(function(){a.packTypeForm&&a.packTypeForm.packType.$setValidity("duplicate",!0)})}),a.$watch("packType.countAsDonation",function(){h(function(){a.packTypeForm&&a.packTypeForm.countAsDonation.$setValidity("invalid",!0)})}),a.savePackType=function(b,c){c.$valid?angular.isDefined(b.id)?a.updatePackType(b,c):a.addPackType(b,c):a.submitted=!0},a.addPackType=function(b){b.canPool=null,b.canSplit=null,b.countAsDonation||delete b.componentType,a.savingPackType=!0,d.addPackType(b,function(){a.go("/packTypes")},function(b){b&&b.fieldErrors.packType&&"name.exists"===b.fieldErrors.packType[0].code&&a.packTypeForm.packType.$setValidity("duplicate",!1),a.savingPackType=!1})},a.switchCountAsDonation=function(){a.packType.countAsDonation?(a.packType.componentType=a.tempComponentType,a.tempComponentType=""):(a.tempComponentType=a.packType.componentType,a.packType.componentType="")},a.handleTestSampleProducedToggle=function(){a.packType.testSampleProduced||(a.packType.countAsDonation=!1,a.switchCountAsDonation())},a.updatePackType=function(b){b.countAsDonation||delete b.componentType,a.savingPackType=!0,d.updatePackType(b,function(){a.go("/packTypes")},function(b){b&&b.fieldErrors.packType&&"name.exists"===b.fieldErrors.packType[0].code&&a.packTypeForm.packType.$setValidity("duplicate",!1),a.savingPackType=!1})},a.clear=function(){},a.go=function(a){b.path(a)},a.clearForm=function(b){b.$setPristine(),a.submitted=""},a.getPackType=function(){d.getPackTypeById(g.id,function(b){a.packType=b},function(b){a.serverError=b})},g.id?(a.getPackType(),a.managePackType="updatePackType"):(a.managePackType="addPackType",a.packType={testSampleProduced:!0,countAsDonation:!0,isDeleted:!1})}]),angular.module("bsis").controller("ManageLocationCtrl",["$scope","$location","$log","LocationsService","DivisionsService","$timeout","$routeParams",function(a,b,c,d,e,f,g){function h(){d.getForm(function(b){a.level1Divisions=b.level1Divisions},c.error),g.id&&d.getLocationById({id:g.id},function(b){a.location=b.location},c.error)}a.location={isDeleted:!1,
divisionLevel1:null,divisionLevel2:null,divisionLevel3:null},a.locationForm={},a.level2Divisions=[],a.level3Divisions=[],a.$watch("location.name",function(){f(function(){a.locationForm.name.$setValidity("duplicate",!0)})}),a.cancel=function(){b.path("/locations")},a.$watch("location.divisionLevel1.id",function(b,d){b&&e.findDivisions({parentId:b},function(b){a.level2Divisions=b.divisions},function(a){c.error(a)}),d&&(a.location.divisionLevel2=null,a.location.divisionLevel3=null,a.level3Divisions=[])}),a.$watch("location.divisionLevel2.id",function(b,d){b&&e.findDivisions({parentId:b},function(b){a.level3Divisions=b.divisions},function(a){c.error(a)}),d&&(a.location.divisionLevel3=null)}),a.saveLocation=function(){a.locationForm.$invalid||(a.savingLocation=!0,a.location.divisionLevel3.parent.parent=a.location.divisionLevel1,g.id?d.updateLocation(a.location,function(a){b.path("/locations").search({search:!0,name:a.location.name})},function(b){b.data&&b.data.name&&a.locationForm.name.$setValidity("duplicate",!1),a.savingLocation=!1}):d.addLocation(a.location,function(a){b.path("/locations").search({search:!0,name:a.name})},function(b){b.data&&b.data.name&&a.locationForm.name.$setValidity("duplicate",!1),a.savingLocation=!1}))},a.validateLocationType=function(){return a.location.isVenue||a.location.isUsageSite||a.location.isProcessingSite||a.location.isDistributionSite||a.location.isTestingSite||a.location.isReferralSite},h()}]),angular.module("bsis").controller("LocationsCtrl",["$scope","$location","$routeParams","$log","ICONS","LocationsService","ConfigurationsService","gettextCatalog",function(a,b,c,d,e,f,g,h){function i(){a.searched=!1,a.searching=!1,a.locationSearch=angular.copy(j),c.name&&(a.locationSearch.name=c.name),c.includeSimilarResults&&("false"===c.includeSimilarResults?a.locationSearch.includeSimilarResults=!1:a.locationSearch.includeSimilarResults=!0),c.locationType&&(a.locationSearch.locationType=c.locationType),(a.locationSearch.name||a.locationSearch.locationType)&&a.findLocations(),f.getSearchForm(function(b){a.locationType=b.locationType},d.error)}var j={name:"",includeSimilarResults:!0,locationType:null},k=[{name:"Name",displayName:h.getString("Name"),field:"name",width:"**"},{name:"Enabled",displayName:h.getString("Enabled"),field:"isDeleted",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="!row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARECHECK}}"></i></span><span ng-show="row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARE}}"></i></span></div>',width:"**",maxWidth:"200"},{displayName:g.getStringValue("ui.division.level3.displayName"),field:"divisionLevel3.name",width:"**"}];a.icons=e,a.findLocationForm={},a.locationSearch={},a.locationType=[],a.searching=!1,a.searched=!1,a.gridOptions={data:[],paginationPageSize:7,paginationTemplate:"views/template/pagination.html",minRowsToShow:7,columnDefs:k,rowTemplate:"views/template/clickablerow.html",onRegisterApi:function(b){a.gridApi=b}},a.onRowClick=function(a){b.search({}).path("/manageLocation/"+a.entity.id)},a.clear=function(){b.search({}),a.locationSearch=angular.copy(j),a.searched=!1,a.searching=!1,a.gridOptions.data=[],a.findLocationForm.$setPristine()},a.findLocations=function(){a.findLocationForm.$invalid||(a.searched=!1,a.searching=!0,b.search(a.locationSearch),f.search(a.locationSearch,function(b){a.gridOptions.data=b.locations,a.searched=!0,a.searching=!1,a.gridOptions.paginationCurrentPage=1},function(b){d.error(b),a.searching=!1}))},i()}]),angular.module("bsis").controller("DivisionsCtrl",["$scope","$location","$routeParams","$filter","$log","DivisionsService","gettextCatalog",function(a,b,c,d,e,f,g){function h(){c.search&&(a.search={name:c.name,includeSimilarResults:c.includeSimilarResults,level:c.level?+c.level:null},a.findDivisions())}function i(){null!=a.gridApi&&a.gridApi.pagination.seek(1)}var j={name:null,includeSimilarResults:!0,level:null};a.search=angular.copy(j),a.searching=!1,a.divisionLevels=[1,2,3].map(function(a){return{label:d("divisionLevel")(a),value:a}}),a.gridOptions={data:null,columnDefs:[{displayName:g.getString("Name"),field:"name"},{displayName:g.getString("Division Level"),field:"level",cellFilter:"divisionLevel"},{displayName:g.getString("Parent Division"),field:"parent.name"}],paginationPageSize:7,paginationTemplate:"views/template/pagination.html",minRowsToShow:7,rowTemplate:"views/template/clickablerow.html",onRegisterApi:function(b){a.gridApi=b}},a.onRowClick=function(a){b.path("/manageDivision/"+a.entity.id)},a.findDivisions=function(){a.searchForm&&a.searchForm.$invalid||(i(),a.searching=!0,b.search(angular.extend({search:!0},a.search)),f.findDivisions(a.search,function(b){a.gridOptions.data=b.divisions,a.searching=!1},function(b){e.error(b),a.searching=!1}))},a.clearSearch=function(){a.gridOptions.data=null,a.search=angular.copy(j),b.search({}),a.searchForm.$setPristine()},h()}]),angular.module("bsis").controller("ManageDivisionCtrl",["$scope","$routeParams","$log","$location","$timeout","DivisionsService",function(a,b,c,d,e,f){function g(){b.id&&f.getDivision({id:b.id},function(b){a.division=b.division},function(a){c.error(a)})}function h(b){d.path("/divisions").search({search:!0,name:b.division.name}),a.saving=!1}function i(b){var d=b.data||{},e=d.fieldErrors||{};angular.forEach(e.name||[],function(b){"duplicate"===b.code&&a.divisionForm.name.$setValidity("duplicate",!1)}),c.error(b),a.saving=!1}a.levels=[1,2,3],a.parentDivisions=null,a.division={name:null,level:null,parent:null},a.saving=!1,a.$watch("division.name",function(){e(function(){a.divisionForm.name.$setValidity("duplicate",!0)})}),a.$watch("division.level",function(b){return 2!==b&&3!==b?void(a.parentDivisions=null):void f.findDivisions({level:b-1},function(b){null!=b.divisions&&(a.parentDivisions=b.divisions.filter(function(b){return b.id!==a.division.id}))},function(a){c.error(a)})}),a.saveDivision=function(){if(!a.divisionForm||!a.divisionForm.$invalid)if(a.saving=!0,b.id){var c=angular.extend({id:+b.id},a.division);f.updateDivision(c,h,i)}else f.createDivision(a.division,h,i)},a.cancel=function(){d.path("/divisions")},g()}]),angular.module("bsis").controller("ComponentTypesCtrl",["$scope","$location","$routeParams","$log","gettextCatalog","ICONS","ComponentTypesService",function(a,b,c,d,e,f,g){function h(){g.getComponentTypes(function(b){a.gridOptions.data=b.componentTypes},d.error)}var i=[{name:"Name",field:"componentTypeName",displayName:e.getString("Name"),width:"**"},{name:"ComponentCode",displayName:e.getString("Component Code"),field:"componentTypeCode",width:"**",maxWidth:"200"},{name:"CanBeIssued",displayName:e.getString("Can be Issued"),field:"canBeIssued",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="row.entity.canBeIssued"><i class="fa {{grid.appScope.icons.SQUARECHECK}}"></i></span><span ng-show="!row.entity.canBeIssued"><i class="fa {{grid.appScope.icons.SQUARE}}"></i></span></div>',width:"**",maxWidth:"125"},{name:"ContainsPlasma",displayName:e.getString("Contains Plasma"),field:"containsPlasma",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="row.entity.containsPlasma"><i class="fa {{grid.appScope.icons.SQUARECHECK}}"></i></span><span ng-show="!row.entity.containsPlasma"><i class="fa {{grid.appScope.icons.SQUARE}}"></i></span></div>',width:"**",maxWidth:"150"},{name:"ExpiresAfter",displayName:e.getString("Expires After"),field:"expiresAfter",cellTemplate:'<div class="ui-grid-cell-contents"><span translate translate-params-count="row.entity.expiresAfter">{{count}} day(s)</span></div>',width:"**",maxWidth:"150"},{name:"Enabled",field:"isDeleted",displayName:e.getString("Enabled"),cellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="!row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARECHECK}}"></i></span><span ng-show="row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARE}}"></i></span></div>',width:"**",maxWidth:"100"}];a.icons=f,a.gridOptions={data:[],paginationPageSize:10,paginationTemplate:"views/template/pagination.html",minRowsToShow:10,columnDefs:i,rowTemplate:"views/template/clickablerow.html",onRegisterApi:function(b){a.gridApi=b}},a.onRowClick=function(a){b.path("/manageComponentType/"+a.entity.id)},h()}]),angular.module("bsis").controller("ManageComponentTypeCtrl",["$scope","$location","$log","$timeout","$routeParams","ComponentTypesService",function(a,b,c,d,e,f){function g(b){b.data&&b.data.componentTypeCode&&a.componentTypeForm.componentTypeCode.$setValidity("duplicate",!1),b.data&&b.data.componentTypeName&&a.componentTypeForm.componentTypeName.$setValidity("duplicate",!1),a.savingComponentType=!1}function h(){e.id&&f.getComponentTypeById({id:e.id},function(b){a.componentType=b.componentType},c.error)}a.componentType={isDeleted:!1,canBeIssued:!1,containsPlasma:!1},a.componentTypeForm={},a.$watch("componentType.componentTypeCode",function(){d(function(){a.componentTypeForm.componentTypeCode.$setValidity("duplicate",!0)})}),a.$watch("componentType.componentTypeName",function(){d(function(){a.componentTypeForm.componentTypeName.$setValidity("duplicate",!0)})}),a.cancel=function(){b.path("/componentTypes")},a.saveComponentType=function(){a.componentTypeForm.$invalid||(a.savingComponentType=!0,e.id?f.updateComponentType(a.componentType,function(){b.path("/componentTypes")},function(a){g(a)}):f.createComponentType(a.componentType,function(){b.path("/componentTypes")},function(a){g(a)}))},h()}]),angular.module("bsis").controller("ManageComponentTypeCombinationCtrl",["$scope","$location","$log","$timeout","$routeParams","ComponentTypeCombinationsService",function(a,b,c,d,e,f){function g(b){b.data&&b.data.combinationName&&a.componentCombinationForm.componentCombinationName.$setValidity("duplicate",!1),a.savingComponentCombination=!1}function h(){f.getComponentTypeCombinationById({id:e.id},function(b){a.componentTypeCombination=b.componentTypeCombination;var c=angular.copy(a.componentTypeCombination.sourceComponentTypes);a.componentTypeCombination.sourceComponentTypes=[],angular.forEach(a.sourceComponentTypesDropDown,function(b,d){angular.forEach(c,function(c){c.id===b.id&&(a.componentTypeCombination.sourceComponentTypes.push(a.sourceComponentTypesDropDown[d]),a.sourceComponentTypesDropDown[d].disabled=!0)})})},c.error)}function i(){f.getComponentTypeCombinationsForm(function(b){a.sourceComponentTypesDropDown=b.sourceComponentTypes,a.producedComponentTypesDropDown=b.producedComponentTypes,e.id&&h()},c.error)}a.componentTypeCombination={combinationName:"",sourceComponentTypes:[],componentTypes:[],isDeleted:!1},a.userSelection={selectedSourceComponentIndex:null,selectedSourceComponentList:[],selectedProducedComponentIndex:null,selectedProducedComponentList:[]},a.componentCombinationForm={},a.$watch("componentTypeCombination.combinationName",function(){d(function(){a.componentCombinationForm.componentCombinationName.$setValidity("duplicate",!0)})});var j=function(){0==a.componentTypeCombination.sourceComponentTypes.length?a.componentCombinationForm.sourceComponentList.$setValidity("required",!1):a.componentCombinationForm.sourceComponentList.$setValidity("required",!0),0==a.componentTypeCombination.componentTypes.length?a.componentCombinationForm.producedComponentList.$setValidity("required",!1):a.componentCombinationForm.producedComponentList.$setValidity("required",!0)};a.cancel=function(){b.path("/componentTypeCombinations")},a.addSourceComponent=function(){a.componentTypeCombination.sourceComponentTypes.push(a.sourceComponentTypesDropDown[a.userSelection.selectedSourceComponentIndex]),a.sourceComponentTypesDropDown[a.userSelection.selectedSourceComponentIndex].disabled=!0,a.userSelection.selectedSourceComponentIndex=null,j()},a.addUnit=function(){a.componentTypeCombination.componentTypes.push(a.producedComponentTypesDropDown[a.userSelection.selectedProducedComponentIndex]),a.userSelection.selectedProducedComponentIndex=null,j()},a.removeSourceComponent=function(){a.userSelection.selectedSourceComponentList.reverse();var b=a.componentTypeCombination.sourceComponentTypes.filter(function(b,c){return a.userSelection.selectedSourceComponentList.indexOf(String(c))>-1});b.forEach(function(b){a.componentTypeCombination.sourceComponentTypes.splice(a.componentTypeCombination.sourceComponentTypes.indexOf(b),1),b.disabled=!1}),a.userSelection.selectedSourceComponentList=[],j()},a.removeProducedComponent=function(){a.userSelection.selectedProducedComponentList.reverse(),a.userSelection.selectedProducedComponentList.forEach(function(b){a.componentTypeCombination.componentTypes.splice(b,1)}),a.userSelection.selectedProducedComponentList=[],j()},a.saveComponentCombination=function(){j(),a.componentCombinationForm.$invalid||(a.savingComponentCombination=!0,angular.forEach(a.componentTypeCombination.sourceComponentTypes,function(a){delete a.disabled}),angular.forEach(a.componentTypeCombination.componentTypes,function(a){delete a.disabled}),e.id?f.updateComponentTypeCombinations(a.componentTypeCombination,function(){b.path("/componentTypeCombinations")},function(b){a.savingComponentCombination=!1,g(b)}):f.createComponentTypeCombinations(a.componentTypeCombination,function(){b.path("/componentTypeCombinations")},function(b){a.savingComponentCombination=!1,g(b)}))},i()}]),angular.module("bsis").controller("ComponentTypeCombinationsCtrl",["$scope","$location","$routeParams","gettextCatalog","$log","ICONS","ComponentTypeCombinationsService",function(a,b,c,d,e,f,g){function h(){g.getComponentTypeCombinations(function(b){a.gridOptions.data=b.componentTypeCombinations},e.error)}var i=[{name:"Name",field:"combinationName",displayName:d.getString("Name"),width:"**"},{name:"Enabled",field:"isDeleted",displayName:d.getString("Enabled"),cellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="!row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARECHECK}}"></i></span><span ng-show="row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARE}}"></i></span></div>',width:"**",maxWidth:"100"}];a.icons=f,a.gridOptions={data:[],paginationPageSize:10,paginationTemplate:"views/template/pagination.html",minRowsToShow:10,columnDefs:i,rowTemplate:"views/template/clickablerow.html",onRegisterApi:function(b){a.gridApi=b}},a.onRowClick=function(a){b.path("/manageComponentTypeCombination/"+a.entity.id)},h()}]),angular.module("bsis").controller("BloodTestsCtrl",["$scope","$log","ICONS","$location","BloodTestsService","gettextCatalog",function(a,b,c,d,e,f){function g(){e.getBloodTests(function(b){a.gridOptions.data=b.bloodTests},b.error)}var h=[{name:"Name",displayName:f.getString("Name"),field:"testName",width:"**"},{name:"Short Name",displayName:f.getString("Short Name"),field:"testNameShort",width:"**"},{name:"Category",displayName:f.getString("Category"),field:"category",width:"**",maxWidth:"200"},{name:"Rank in Category",displayName:f.getString("Rank in Category"),field:"rankInCategory",width:"**",maxWidth:"140"},{name:"BloodTestType",displayName:f.getString("Blood Test Type"),field:"bloodTestType",width:"**",maxWidth:"200"},{name:"IsActive",displayName:f.getString("In Active Use"),field:"isActive",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="row.entity.isActive"><i class="fa {{grid.appScope.icons.SQUARECHECK}}"></i></span><span ng-show="!row.entity.isActive"><i class="fa {{grid.appScope.icons.SQUARE}}"></i></span></div>',width:"**",maxWidth:"150"},{name:"Enabled",displayName:f.getString("Enabled"),field:"isDeleted",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="!row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARECHECK}}"></i></span><span ng-show="row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARE}}"></i></span></div>',width:"**",maxWidth:"115"}];a.icons=c,a.gridOptions={data:[],paginationPageSize:10,paginationTemplate:"views/template/pagination.html",minRowsToShow:10,columnDefs:h,rowTemplate:"views/template/clickablerow.html",onRegisterApi:function(b){a.gridApi=b}},a.onRowClick=function(a){d.path("/manageBloodTest/"+a.entity.id)},g()}]),angular.module("bsis").controller("ManageBloodTestCtrl",["$scope","$location","$log","$timeout","$routeParams","BloodTestsService",function(a,b,c,d,e,f){function g(b,c,d){return a.addOutcomeClicked=!0,!b||b.length>10?!1:-1!==d.indexOf(b)?(c.$setValidity("duplicate",!1),!1):(c.$setValidity("duplicate",!0),d.push(b),!0)}function h(a,b){a.forEach(function(a){b.forEach(function(c,d){c===a&&b.splice(d,1)})})}function i(){f.getBloodTestById({id:e.id},function(b){a.bloodTest=b.bloodTest,a.notSelectedResults=angular.copy(a.bloodTest.validResults),h(a.bloodTest.positiveResults,a.notSelectedResults),h(a.bloodTest.negativeResults,a.notSelectedResults)})}function j(){f.getBloodTestsForm(function(b){a.categories=b.categories,a.categories.forEach(function(a){k[a]=b.types[a]}),e.id&&i()},c.error)}var k=[];a.types=[],a.notSelectedResults=[],a.bloodTest={isDeleted:!1,isActive:!0,testName:"",testNameShort:"",category:"",bloodTestType:"",flagComponentsForDiscard:!1,flagComponentsContainingPlasmaForDiscard:!1,validResults:[],negativeResults:[],positiveResults:[]},a.cancel=function(){b.path("/bloodTests")},a.$watch("bloodTest.category",function(){d(function(){a.types=k[a.bloodTest.category]})}),a.$watch("bloodTest.testName",function(){d(function(){a.bloodTestForm.testName.$setValidity("duplicate",!0)})}),a.addValidOutcome=function(){var b=g(a.validOutcome,a.bloodTestForm.validOutcome,a.bloodTest.validResults);b&&(a.bloodTestForm.removedValidOutcomes.$setValidity("required",!0),a.notSelectedResults.push(a.validOutcome),a.validOutcome=null,a.addOutcomeClicked=!1)},a.addNegativeOutcome=function(){var b=g(a.negativeOutcome,a.bloodTestForm.negativeOutcome,a.bloodTest.negativeResults);if(b){var c=a.notSelectedResults.indexOf(a.negativeOutcome);a.notSelectedResults.splice(c,1)}a.negativeOutcome=null},a.addPositiveOutcome=function(){var b=g(a.positiveOutcome,a.bloodTestForm.positiveOutcome,a.bloodTest.positiveResults);if(b){var c=a.notSelectedResults.indexOf(a.positiveOutcome);a.notSelectedResults.splice(c,1)}a.positiveOutcome=null},a.removeValidOutcomes=function(){var b=!0;a.removedValidOutcomes.forEach(function(c){(-1!==a.bloodTest.negativeResults.indexOf(c)||-1!==a.bloodTest.positiveResults.indexOf(c))&&(a.bloodTestForm.removedValidOutcomes.$setValidity("cantremove",!1),b=!1,d(function(){a.bloodTestForm.removedValidOutcomes.$setValidity("cantremove",!0)},3e3))}),b&&(a.bloodTestForm.removedValidOutcomes.$setValidity("cantremove",!0),h(a.removedValidOutcomes,a.bloodTest.validResults),a.removedValidOutcomes.forEach(function(b){var c=a.notSelectedResults.indexOf(b);a.notSelectedResults.splice(c,1)}))},a.removeNegativeOutcomes=function(){h(a.removedNegativeOutcomes,a.bloodTest.negativeResults),a.removedNegativeOutcomes.forEach(function(b){a.notSelectedResults.push(b)})},a.removePositiveOutcomes=function(){h(a.removedPositiveOutcomes,a.bloodTest.positiveResults),a.removedPositiveOutcomes.forEach(function(b){a.notSelectedResults.push(b)})},a.saveBloodTest=function(){0===a.bloodTest.validResults.length&&a.bloodTestForm.removedValidOutcomes.$setValidity("required",!1),a.bloodTestForm.$invalid||(a.savingBloodTest=!0,e.id?f.updateBloodTest(a.bloodTest,function(){b.path("/bloodTests")},function(b){b.data&&b.data.testName&&a.bloodTestForm.testName.$setValidity("duplicate",!1),a.savingBloodTest=!1}):f.createBloodTest(a.bloodTest,function(){b.path("/bloodTests")},function(b){b.data&&b.data.testName&&a.bloodTestForm.testName.$setValidity("duplicate",!1),a.savingBloodTest=!1}))},j()}]),angular.module("bsis").controller("BloodTestingRulesCtrl",["$scope","$location","$log","ICONS","BloodTestingRulesService","gettextCatalog",function(a,b,c,d,e,f){function g(){e.getBloodTestingRules(function(b){a.gridOptions.data=b.bloodTestingRules},c.error)}var h=[{name:"Blood Test",displayName:f.getString("Blood Test"),field:"testNameShort",width:"**"},{name:"Category",displayName:f.getString("Category"),field:"category",width:"**",maxWidth:"200"},{name:"Donation Field",displayName:f.getString("Donation Field"),field:"donationFieldChanged",width:"**",maxWidth:"200"},{name:"Test Outcome",displayName:f.getString("Test Outcome"),field:"pattern",width:"**",maxWidth:"200"},{name:"Donation Field Value",displayName:f.getString("Donation Field Value"),field:"newInformation",width:"**",maxWidth:"200"},{name:"Enabled",displayName:f.getString("Enabled"),field:"isDeleted",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="!row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARECHECK}}""></i></span><span ng-show="row.entity.isDeleted"><i class="fa {{grid.appScope.icons.SQUARE}}""></i></span></div>',width:"**",maxWidth:"120"}];a.icons=d,a.gridOptions={data:[],paginationPageSize:10,paginationTemplate:"views/template/pagination.html",minRowsToShow:10,columnDefs:h,rowTemplate:"views/template/clickablerow.html",onRegisterApi:function(b){a.gridApi=b}},a.onRowClick=function(a){b.path("/manageBloodTestingRule/"+a.entity.id)},g()}]),angular.module("bsis").controller("ManageBloodTestingRuleCtrl",["$scope","$location","$log","$timeout","$routeParams","BloodTestingRulesService","BloodTestsService",function(a,b,c,d,e,f,g){function h(){a.bloodTestingRule=angular.copy(n),a.bloodTestingRuleForm.$setPristine()}function i(){a.bloodTestingRule.bloodTest&&g.getBloodTestById({id:a.bloodTestingRule.bloodTest.id},function(b){a.bloodTestingRule.bloodTest=b.bloodTest,a.donationFields=m[b.bloodTest.category],a.testOutcomes=b.bloodTest.validResults,a.bloodTestingRule.pendingTests=a.bloodTestingRule.pendingTests.filter(function(a){return a.category===b.bloodTest.category})})}function j(){f.getBloodTestingRuleById({id:e.id},function(b){a.bloodTestingRule=b.bloodTestingRule,a.bloodTestingRule.pendingTests=a.pendingBloodTests.filter(function(b){return a.bloodTestingRule.pendingTests.some(function(a){return b.id===a.id})}),a.updateDonationFieldValuesDropdown(),i()})}function k(){a.bloodTestingRule=angular.copy(n),f.getBloodTestingRuleForm(function(b){a.bloodTests=b.bloodTests,a.pendingBloodTests=b.bloodTests.filter(function(a){return"BASIC_TTI"!==a.bloodTestType&&"BASIC_BLOODTYPING"!==a.bloodTestType}),m=b.donationFields,l=b.newInformation,e.id&&j()},c.error)}var l=[],m=[],n={bloodTest:null,pattern:"",donationFieldChanged:"",newInformation:"",pendingTests:[],isDeleted:!1};a.donationFields=[],a.testOutcomes=[],a.donationFieldValues=[],a.userSelection={bloodTestToAdd:null,bloodTestsToRemove:[]},a.bloodTestingRuleForm={},a.cancel=function(){b.path("/bloodTestingRules")},a.updateDonationAndTestOutcomeDropDowns=function(){var b=a.bloodTestingRule.bloodTest;h(),a.bloodTestingRule.id=e.id,a.bloodTestingRule.bloodTest=b,i()},a.updateDonationFieldValuesDropdown=function(){a.donationFieldValues=l[a.bloodTestingRule.donationFieldChanged]},a.addPendingTest=function(){a.bloodTestingRule.pendingTests.push(a.userSelection.bloodTestToAdd),a.userSelection.bloodTestToAdd=null},a.isValidPendingTest=function(b){return-1!==a.bloodTestingRule.pendingTests.indexOf(b)||a.bloodTestingRule.bloodTest&&b.id===a.bloodTestingRule.bloodTest.id},a.removePendingTests=function(){a.bloodTestingRule.pendingTests=a.bloodTestingRule.pendingTests.filter(function(b){return-1===a.userSelection.bloodTestsToRemove.indexOf(b)}),a.userSelection.bloodTestsToRemove=[]},a.saveBloodTestingRule=function(){if(!a.bloodTestingRuleForm.$invalid){a.savingBloodTestingRule=!0;var d=e.id?f.updateBloodTestingRule:f.createBloodTestingRule;delete a.bloodTestingRule.testNameShort,d(a.bloodTestingRule,function(){b.path("/bloodTestingRules")},function(b){a.savingBloodTestingRule=!1,c.error(b)})}},k()}]),angular.module("bsis").controller("SettingsSidebarCtrl",["$scope","RoutingService","ICONS",function(a,b,c){var d=[{path:"/accountSettings",subpaths:[]},{path:"/configurations",subpaths:["/manageConfiguration"]},{path:"/deferralReasons",subpaths:["/manageDeferralReason"]},{path:"/discardReasons",subpaths:["/manageDiscardReason"]},{path:"/roles",subpaths:["/manageRole"]},{path:"/users",subpaths:["/manageUser"]},{path:"/donationTypes",subpaths:["/manageDonationType"]},{path:"/packTypes",subpaths:["/managePackType"]},{path:"/adverseEventTypes",subpaths:["/manageAdverseEventTypes","/addAdverseEventType","/editAdverseEventType"]},{path:"/auditLog",subpaths:[]},{path:"/locations",subpaths:["/manageLocation"]},{path:"/componentTypeCombinations",subpaths:["/manageComponentTypeCombination"]},{path:"/componentTypes",subpaths:["/manageComponentType"]},{path:"/divisions",subpaths:["/manageDivision"]},{path:"/bloodTestingRules",subpaths:["/manageBloodTestingRule"]},{path:"/bloodTests",subpaths:["/manageBloodTest"]},{path:"/transfusionReactionTypes",subpaths:["/manageTransfusionReactionType"]},{path:"/dataExport",subpaths:[]}];a.icons=c,a.currentPath=b.getCurrentPath(d)}]),angular.module("bsis").controller("DataExportCtrl",["$scope","$log","ModalsService","DataExportService","gettextCatalog",function(a,b,c,d,e){function f(){d.getDataExport(function(b){var c="dataexport"+moment(new Date).format("YYYYMMDDHHmm")+".zip",d=document.createElement("a"),e=new Blob([b.data],{type:"application/octet-stream"});d.href=URL.createObjectURL(e),d.target="_blank",d.download=c,d.click(),a.downloading=!1},function(c){b.error(c),c.userMessage&&(a.error={message:c.userMessage}),a.downloading=!1})}a.downloading=!1,a.download=function(){var b={title:e.getString("Data Export"),button:e.getString("Export Data"),message:e.getString("Are you sure that you want to export all data?")+e.getString("This export may take some time and can affect the performance of the system. It is recommended that this process is only run after standard operating hours, to minimise the impact on other activities.")};c.showConfirmation(b).then(function(){a.downloading=!0,f()})["catch"](function(){a.downloading=!1})}}]),angular.module("bsis").constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("ROLES",{all:"*",admin:"admin",editor:"editor",guest:"guest"}).constant("ICONS",{ACCOUNT:"fa-cog",ARCHIVE:"fa-archive",BARCODE:"fa-barcode",BARS:"fa-bars",CALENDAR:"fa-calendar",CIRCLE:"fa-circle",CIRCLEO:"fa-circle-o",COMMENT:"fa-comment",COMPONENTS:"fa-filter",DONORS:"fa-clipboard",EDIT:"fa-edit",EXCLAMATION:"fa-exclamation-circle",FEMALE:"fa-female",FLAG:"fa-flag",GLOBE:"fa-globe",HOME:"fa-home",INFO:"fa-info",INFOCIRCLE:"fa-info-circle",INVENTORY:"fa-tint",LABELLING:"fa-barcode",LOGOUT:"fa-sign-out",MALE:"fa-male",MOBILE:"fa-truck",PHONE:"fa-phone",PLUS:"fa-plus-square",REMOVE:"fa-times-circle",REPORTS:"fa-bar-chart-o",SETTINGS:"fa-cogs",SQUARE:"fa-square-o",SQUARECHECK:"fa-check-square-o",TESTING:"fa-flask",TINT:"fa-tint",USER:"fa-user",VENUE:"fa-hospital-o",WARNING:"fa-warning",MAPMARKER:"fa-map-marker"}).constant("REGEX",{INTEGER:/^\-?\d+$/,DECIMAL:/^\d+(\.\d{1,2})?$/,NAME:/^[a-zA-Z \-\.]*$/}).constant("BLOODGROUP",{options:["O+","O-","A+","A-","B+","B-","AB+","AB-"]}).constant("BLOODABO",{options:["A","B","AB","O"]}).constant("BLOODRH",{options:["+","-"]}).constant("MONTH",{options:[{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}]}).constant("TITLE",{options:["Mr","Mrs","Ms","Dr","Prof"]}).constant("GENDER",{options:[{id:"male",name:"Male"},{id:"female",name:"Female"}]}).constant("DATATYPES",{options:[{id:1,datatype:"text"},{id:2,datatype:"integer"},{id:3,datatype:"decimal"},{id:4,datatype:"boolean"},{id:5,datatype:"password"}]}).constant("UI",UI).constant("DONATION",DONATION),angular.module("bsis").constant("PERMISSIONS",{AUTHENTICATED:"Authenticated",ADD_DONOR:"Add Donor",VIEW_DONOR:"View Donor",EDIT_DONOR:"Edit Donor",VOID_DONOR:"Void Donor",ADD_DEFERRAL:"Add Deferral",VIEW_DEFERRAL:"View Deferral",EDIT_DEFERRAL:"Edit Deferral",VOID_DEFERRAL:"Void Deferral",ADD_DONOR_CODE:"Add Donor Code",VIEW_DONOR_CODE:"View Donor Code",EDIT_DONOR_CODE:"Edit Donor Code",VOID_DONOR_CODE:"Void Donor Code",VIEW_DONOR_CODE_GROUP:"View Donor Code Group",VIEW_DUPLICATE_DONORS:"View Duplicate Donors",MERGE_DONORS:"Merge Donors",ADD_DONATION:"Add Donation",VIEW_DONATION:"View Donation",EDIT_DONATION:"Edit Donation",VOID_DONATION:"Void Donation",ADD_DONATION_BATCH:"Add Donation Batch",VIEW_DONATION_BATCH:"View Donation Batch",EDIT_DONATION_BATCH:"Edit Donation Batch",VOID_DONATION_BATCH:"Void Donation Batch",IMPORT_CLINIC_DATA:"Import Clinic Data",EXPORT_CLINIC_DATA:"Export Clinic Data",ADD_COMPONENT:"Add Component",VIEW_COMPONENT:"View Component",EDIT_COMPONENT:"Edit Component",VOID_COMPONENT:"Void Component",ADD_COMPONENT_BATCH:"Add Component Batch",VIEW_COMPONENT_BATCH:"View Component Batch",EDIT_COMPONENT_BATCH:"Edit Component Batch",VOID_COMPONENT_BATCH:"Void Component Batch",ADD_REQUEST:"Add Request",EDIT_REQUEST:"Edit Request",VIEW_REQUEST:"View Request",VOID_REQUEST:"Void Request",ADD_TEST_OUTCOME:"Add Test Outcome",EDIT_TEST_OUTCOME:"Edit Test Outcome",VIEW_TEST_OUTCOME:"View Test Outcome",VOID_TEST_OUTCOME:"Void Test Outcome",ADD_TTI_OUTCOME:"Add TTI Outcome",EDIT_TTI_OUTCOME:"Edit TTI Outcome",VIEW_TTI_OUTCOME:"View TTI Outcome",ADD_TEST_BATCH:"Add Test Batch",VIEW_TEST_BATCH:"View Test Batch",EDIT_TEST_BATCH:"Edit Test Batch",VOID_TEST_BATCH:"Void Test Batch",EDIT_BLOOD_TYPING_OUTCOMES:"Edit Blood Typing Outcome",ADD_BLOOD_TYPING_OUTCOME:"Add Blood Typing Outcome",VIEW_BLOOD_TYPING_OUTCOME:"View Blood Typing Outcome",BLOOD_CROSS_MATCH_CHECK:"Blood Cross Match Check",ISSUE_COMPONENT:"Issue Component",LABEL_COMPONENT:"Label Component",ADD_TRANSFUSION_DATA:"Add Transfusion Data",EDIT_TRANSFUSION_DATA:"Edit Transfusion Data",VIEW_TRANSFUSION_DATA:"View Transfusion Data",VOID_TRANSFUSION_DATA:"Void Transfusion Data",DISCARD_COMPONENT:"Discard Component",VIEW_DISCARDS:"View Discards",ADD_ORDER_FORM:"Add Order Form",VIEW_ORDER_FORM:"View Order Form",EDIT_ORDER_FORM:"Edit Order Form",VOID_ORDER_FORM:"Void Order Form",DONATIONS_REPORTING:"Reporting - Donations",REQUESTS_REPORTING:"Reporting - Requests",TTI_REPORTING:"Reporting - TTI Testing",COMPONENTS_REPORTING:"Reporting - Components",DONORS_REPORTING:"Reporting - Donors",TRANSFUSIONS_REPORTING:"Reporting - Transfusions",MANAGE_USERS:"Manage Users",MANAGE_ROLES:"Manage Roles",MANAGE_LOCATIONS:"Manage Locations",MANAGE_DONATION_TYPES:"Manage Donation Types",MANAGE_DONATION_CATEGORIES:"Manage Donation Categories",MANAGE_COMPONENT_COMBINATIONS:"Manage Component Combinations",MANAGE_CROSS_MATCH_TYPES:"Manage Cross Match Types",MANAGE_BLOOD_TESTING_RULES:"Manage Blood Testing Rules",MANAGE_PACK_TYPES:"Manage Pack Types",MANAGE_DISCARD_REASONS:"Manage Discard Reasons",MANAGE_DEFERRAL_REASONS:"Manage Deferral Reasons",MANAGE_DONOR_CODES:"Manage Donor Codes",MANAGE_DIAGNOSES_CODES:"Manage Diagnoses Codes",MANAGE_LAB_SETUP:"Manage Lab Setup",MANAGE_DATA_SETUP:"Manage Data Setup",MANAGE_FORMS:"Manage Forms",MANAGE_BACKUP_DATA:"Manage Backup Data",MANAGE_BLOOD_TESTS:"Manage Blood Tests",MANAGE_REQUESTS:"Manage Requests",MANAGE_GENERAL_CONFIGS:"Manage General Configs",MANAGE_COMPONENT_TYPES:"Manage Component Types",MANAGE_TRANSFUSION_REACTION_TYPES:"Manage Transfusion Reaction Types",VIEW_DONOR_INFORMATION:"View Donor Information",VIEW_DONATION_INFORMATION:"View Donation Information",VIEW_MOBILE_CLINIC_INFORMATION:"View Mobile Clinic Information",VIEW_MOBILE_CLINIC_EXPORT:"View Mobile Clinic Export",VIEW_COMPONENT_INFORMATION:"View Component Information",VIEW_TESTING_INFORMATION:"View Testing Information",VIEW_BLOOD_BANK_INFORMATION:"View Blood Bank Information",VIEW_INVENTORY_INFORMATION:"View Inventory Information",VIEW_DISCARD_INFORMATION:"View Discard Information",VIEW_REPORTING_INFORMATION:"View Reporting Information",
VIEW_ADMIN_INFORMATION:"View Admin Information",VIEW_AUDIT_LOG:"View Audit Log",HIDDEN:"Hidden Functionality",VIEW_POST_DONATION_COUNSELLING_DONORS:"View Post Donation Counselling Donors",ADD_POST_DONATION_COUNSELLING:"Add Post Donation Counselling",EDIT_POST_DONATION_COUNSELLING:"Edit Post Donation Counselling",VIEW_POST_DONATION_COUNSELLING:"View Post Donation Counselling",VOID_POST_DONATION_COUNSELLING:"Void Post Donation Counselling",MANAGE_ADVERSE_EVENTS:"Manage Adverse Events",MANAGE_DIVISIONS:"Manage Divisions",DATA_EXPORT:"Data Export"}).run(["$rootScope","PERMISSIONS",function(a,b){a.permissions=b}]),angular.module("bsis").filter("slice",function(){return function(a,b,c){return a.slice(b,c)}}).filter("bsisDate",["$filter","DATEFORMAT",function(a,b){var c=a("date");return function(a){return c(a,b)}}]).filter("isoString",function(){return function(a){return angular.isDate(a)?a.toISOString():a}}).filter("bsisDateTime",["$filter","DATETIMEFORMAT",function(a,b){var c=a("date");return function(a){return c(a,b)}}]).filter("bsisTime",["$filter","TIMEFORMAT",function(a,b){var c=a("date");return function(a){return c(a,b)}}]).filter("revisionType",function(){return function(a){switch(a){case"ADD":return"Added";case"MOD":return"Modified";case"DEL":return"Deleted";default:return""}}}).filter("eligibility",function(){return function(a){return a?"Eligible":"Not Eligible"}}).filter("titleCase",function(){return function(a){return a=a||"",a=a.replace(/_/g," "),a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}}).filter("divisionLevel",["ConfigurationsService",function(a){return function(b){return a.getStringValue("ui.division.level"+b+".displayName")||"Unknown level"}}]).filter("daysToExpire",["gettextCatalog",function(a){return function(b){return 0>b?a.getString("Already expired"):a.getString("{{count}} day(s) to expire",{count:b})}}]),angular.module("gettext").run(["gettextCatalog",function(a){a.setStrings("fr",{"%":"%","% Issued vs Ordered":"% Distribu vs command","% Issued vs Requests":"% Distribu vs demandes","(0.001 to 2) with max 3 decimal digits (i.e. 1.004)":"(0,001  2) avec un maximum de 3 chiffres dcimaux (c'est--dire 1,004 )","+":"+",ABO:"ABO","ABO Rh Blood Grouping Report":"Rapport des Groupes sanguins ABO RhD","ABO/Rh":"ABO/Rh","ABO/Rh Outcomes":"Rsultats ABO / Rh","Account Settings":"Gestion des comptes",Add:"Ajouter","Add Adverse Event Type":"Ajouter un effet indsirable","Add Blood Test":"Ajouter un test sanguin","Add Deferral":"Ajouter un report","Add Delivery Form":"Ajouter un formulaire de livraison","Add Donation":"Ajouter un don","Add Donation Batch":"Ajouter un lot de don","Add Donor":"Ajouter un donneur","Add New Adverse Event Type":"Ajouter un nouveau type d'effet indsirable","Add New Blood Test":"Ajouter un nouveau test sanguin","Add New Blood Testing Rule":"Ajouter une nouvelle rgle de test sanguin","Add New Component Combination":"Ajouter une nouvelle combinaison de composants","Add New Component Type":"Ajouter un nouveau type de composant","Add New Configuration":"Ajouter une nouvelle configuration","Add New Deferral Reason":"Ajouter une nouvelle raison dajournement","Add New Discard Reason":"Ajouter une nouvelle raison de rejet","Add New Division":"Ajouter une nouvelle division","Add New Donation Type":"Ajouter un nouveau type de don","Add New Donor":"Ajouter un nouveau donneur","Add New Location":"Ajouter un nouvel emplacement","Add New Pack Type":"Ajouter un nouveau type de pack","Add New Role":"Ajouter un nouveau rle","Add New Transfusion Reaction Type":"Ajouter un nouveau type de raction transfusionnelle","Add New User":"Ajouter un nouvel utilisateur","Add Order":"Ajouter une commande","Add Outcome":"Ajouter un rsultat","Add Pack":"Ajouter un pack","Add Return":"Ajouter un retour","Add Source Component":"Ajouter un composant source","Add Unit":"Ajouter une unit","Add a blood transport box":"Ajouter un rcipient de transport de sang","Add box":"Ajouter un rcipient","Add to Order":"Ajouter  la commande",Added:"Ajoute","Adding...":"Ajout...","Address Type":"Type d'adresse",Addresses:"Adresses","Adverse Event":"Effet indsirable","Adverse Event Comment":"Commentaire sur Effet indsirable","Adverse Event Type":"Type d'effet indsirable",Age:"Age",All:"Tous","All Processing Sites":"Tous les sites de traitement","All Samples":"Tous les chantillons","All Sites":"Tous les sites","All Venues":"Tous les emplacements","All search fields cannot be empty":"Tous les champs de recherche ne peuvent pas tre vides","All venues":"Tous les emplacements","Already added or invalid DINs entered.":"DIN dj ajouts ou invalids.","Already expired":"Dj expir",Ambiguous:"Ambigu","An error occurred.":"Une erreur est survenue.",Any:"Tous",April:"Avril","Are you sure that you want to close this test batch?":"tes-vous sr de vouloir fermer ce lot de test?","Are you sure that you want to continue?":"tes-vous sr de vouloir continuer?","Are you sure that you want to delete this Order?":"Etes-vous sr de vouloir supprimer cette commande?","Are you sure that you want to delete this Return?":"tes-vous sr de vouloir supprimer ce retour?","Are you sure that you want to export all data?":"tes-vous sr de vouloir exporter toutes les donnes?","Are you sure that you want to reopen this test batch?":"tes-vous sr de vouloir rouvrir ce lot de test?","Are you sure that you want to void this Tranfusion?":"tes-vous sr de vouloir annuler cette transfusion?","Are you sure that you want to void this test batch?":"tes-vous sr de vouloir annuler ce lot de test?","Are you sure you want to delete the selected rows?":"tes-vous sr de vouloir supprimer les lignes slectionnes?","Are you sure you want to discard all units in this return?":"tes-vous sr de vouloir liminer toutes les units de ce retour?","Are you sure you want to discard these components?":"tes-vous sr de vouloir supprimer ces composants?","Are you sure you want to dispatch the order?":"tes-vous sr de vouloir expdier la commande?","Are you sure you want to return all units into inventory?":"tes-vous sr de vouloir retourner toutes les units dans l'inventaire?","Are you sure you want to undiscard these components?":"tes-vous sr de vouloir supprimer ces composants?","Are you sure you want to void this deferral?":"tes-vous sr de vouloir annuler ce report?","Are you sure you want to void this permanent deferral? The donor may be eligible to donate as a result of this action.":"tes-vous sr de vouloir annuler ce report permanent? Le donneur peut tre admissible  faire un don du fait de cette action.",'Are you sure you wish to delete the donor "{{firstName}}, {{lastName}} {{donorNumber}}"?':'tes-vous sr de vouloir supprimer le donneur "{{firstName}, {{lastName}} {{donorNumber}}"?',"Assign Sample(s) to Test Batch":"Attribuer un chantillon(s)  un lot de test","Audit Log":"Journal d'audit",August:"Aot",Available:"Disponible",BP:"TA",Back:"Retour","Back to login":"Retour connexion",Batch:"Lot","Batch Date":"Date du lot","Batch Status":"Statut du lot","Birth Date":"Date de naissance","Bleed Times":"Dure de prlvement","Bleed time exceeded, the following components will be flagged as unsafe: {{components}}.":"Si le temps de saignement est dpass, les composants suivants seront marqus comme dangereux: {{components}}","Bleed times":"Temps de saignement","Blood ABO":"Sang ABO","Blood Bank":"Banque de sang","Blood Group":"Groupe sanguin","Blood Group Serology":"Srologie de groupe sanguin","Blood Group Serology Outcomes":"Rsultats de la srologie du groupe sanguin","Blood Group Serology Status":"Statut srologique du groupe sanguin","Blood Groups":"Groupe Sanguin","Blood Rh":"Sang Rh","Blood Test":"Test sanguin","Blood Test Type":"Type de test sanguin","Blood Transport Box Temperature":"Temprature de la conteneur de transport de sang","Blood Transport box":"Bote de Transport du Sang","Blood Type":"Groupe sanguin","Blood Typing Issues or Incomplete":"Problmes de typage sanguin ou incomplets","Blood Typing Status":"Statut hmotypologie","Blood Units Issued Summary Report":"Rsum du Rapport des units de sang distribues",Boolean:"Boolen","Box #{{boxNumber}}":"Bote #{{boxNumber}}","Build: {{backendBuildNumber}} / {{frontEndBuildNumber}}":"Cration: {{backendBuildNumber}} / {{frontEndBuildNumber}}",COMPONENTS:"COMPOSANTS",CSV:"CSV","Calling Name":"Identifiant","Can be Issued":"Peut tre Distribu",Cancel:"Annuler","Cannot be a future date":"Ne peut pas tre une date future","Cannot print pack or discard labels for component":"Impossible d'imprimer le pack ou de supprimer les tiquettes pour le composant",Category:"Catgorie","Check Components to Print Pack and Discard Labels":"Vrifier les composants pour imprimer les tiquetes des poches  distribuer ou  dtruire",Clear:"Effacer","Clinic Date":"Date de la Clinique Mobile",Close:"Fermer","Close Batch":"Fermer le lot",Closed:"Ferm","Closed Batches":"Lots ferms","Collection Date":"Date de collecte","Combined weight of components exceeds weight of parent component. Do you want to continue?":"Le poids combin des composants dpasse le poids du composant source. Voulez-vous continuer?",Comment:"Commentaire",Comments:"Commentaires",Complete:"Termin","Component Code":"Code du Composant","Component Delivery Forms":"Formulaires de livraison de composants","Component Production Laboratory":"Grer la Production de Composants","Component Status":"Statut du composant","Component Transfusion Information":"Informations sur la transfusion de composants","Component Type":"Type de composant","Component Weight":"Poids du composant","Component can be discarded":"Le composant peut tre limine","Component has been labelled and verified":"Le composant a t tiquet et vrifi","Component is ready to be labelled":"Le composant est prt  tre tiquet","Component weight exceeds weight of parent component":"Le poids des composants dpasse le poids du Composant source","Component with DIN {{DIN}} and ComponentCode {{componentCode}} not found.":"Composant avec DIN {{DIN}} et code de composant {{componentCode}} pas trouv.","Component {{DIN}} ({{componentCode}}) does not match what was ordered.":"Composant {{DIN}} ({{componentCode}}) ne correspond pas  ce qui a t command.","Component {{DIN}} ({{componentCode}}) has already been added to this Order Form.":"Composant {{DIN}} ({{componentCode}}) a dj t ajout  ce bon de commande.","Component {{DIN}} ({{componentCode}}) has already been added to this Return Form.":"Composant {{DIN}} ({{componentCode}}) a dj t ajout  ce formulaire de retour.","Component {{DIN}} ({{componentCode}}) has already been assigned to another Order Form.":"Composant {{DIN}} ({{componentCode}}) a dj t affect  un autre formulaire de commande.","Component {{DIN}} ({{componentCode}}) has not been issued.":"Composant {{DIN}} ({{componentCode}}) n'a pas t publi.","Component {{DIN}} ({{componentCode}}) is not currently in stock at {{location}}.":"Composant {{DIN}} ({{componentCode}}) n'est pas en stock actuellement  a {{location}}.","Component {{DIN}} ({{componentCode}}) is not currently in stock.":"Composant {{DIN}} ({{componentCode}}) n'est pas en stock.","Component {{DIN}} ({{componentCode}}) is not suitable for dispatch.":"Composant {{DIN}} ({{componentCode}}) ne convient pas  l'expdition.","Component {{DIN}} ({{componentCode}}) was not found in this Order Form.":"Composant {{DIN}} ({{componentCode}}) n'a pas t trouv dans ce bon de commande.","Component {{DIN}} ({{componentCode}}) was not found in this Return Form.":"Composant {{DIN}} ({{componentCode}}) n'a pas t trouv dans ce formulaire de retour.",Components:"Composants","Components Produced":"Composant sanguins","Components Produced Report":"Rapport des Composants Prpars","Components Produced Summary Report":"Rapport sommaire des composants produits",Confirm:"Confirmer","Confirm Close":"Confirmer Fermeture","Confirm Password":"Confirmer le mot de passe","Confirm Release":"Confirmer la sortie","Confirm Reopen":"Confirmer la rouverture","Confirm Void":"Confirmer annulation","Confirm new password":"Confirmer le nouveau mot de passe","Confirm password":"Confirmer le mot de passe","Confirmatory TTI Outcomes":"Rsultats de confirmation de l'ITT","Contains Plasma":"Contient du plasma",Continue:"Continuer",Counselled:"Thrapie","Counselling Date":"Date de thrapie","Counselling Notes":"Notes de thrapie","Counselling Status":"Statut de la Traitement",Created:"Cr","Created On":"Cr le","Current Orders":"Commandes en cours","Current Returns":"Retours actuels","Current password":"Mot de passe actuel","Currently Deferred":"Actuellement ajourn",DIN:"DIN","DIN From":"DIN  de","DIN To":"DIN ","DIN cannot be empty":"Le DIN ne peut pas tre vide","DIN should be {{dinLength}} characters":"Le DIN doit tre de {{dinLength}} caractres","DINs do not match":"Les DIN ne correspondent pas",DOB:"DOB","DONOR CLINIC":"CLINIQUE DU DONNEUR","DONOR COMMUNICATIONS":"COMMUNICATIONS AU DONNEUR","DONOR RECORDS":"INFORMATIONS RELATIVES AU DONNEUR",DONORS:"DONNEURS","Data Export":"Exportation de donnes","Data Type":"Type de donnes","Data export":"Exporter les Donnes ",Date:"Date","Date Bled":"Date de prlvement","Date Collected":"Date de collecte","Date Created":"Date de Cration","Date Period: {{fromDate}} to {{toDate}}":"Priode de date: {{fromDate }} de {{toDate}}","Date Range":"Priode","Date Transfused":"Date de transfusion","Date generated: {{date}}":"Date de cration: {{date}}","Date is before collection date. Please re-enter":"La date est antrieure  la date de collecte. veuillez corriger","Date must be after component was created":"La date doit tre aprs la cration du composant","Date must be today or before":"La date doit tre daujourd'hui ou antrieure","Date of Birth":"Date de Naissance","Date of Donation":"Date de don","Date of First Donation":"Date du premier don","Date of Last Donation":"Date du dernier don","Date or time is in the future: please re-enter":"La date ou l'heure est dans le futur: veuillez corriger",Day:"Jour",December:"Dcembre",Decimal:"Dcimal","Default Duration":"Dure par dfaut","Deferral Reason already exists.":"La raison du report existe dj.",Deferrals:"Reports","Deferred By":"Diffr par","Deferred From":"Diffr de","Deferred Until":"Diffr jusqu'","Deferred Until {{date}}":"Diffr jusqu' {{date}}",Delete:"Supprimer","Delete Donor":"Supprimer le donneur","Delete Rows":"Supprimer les lignes","Delete Selected Rows":"Supprimer les lignes slectionnes",Deleted:"Supprime","Delivery Date":"Date de livraison","Delivery Note":"Bon de livraison","Delivery Time":"Heure de Livraison",Demographics:"Contact",Description:"La description","Did Not Receive Counselling":"N'a pas reu de thrapie",Discard:"Supprimer","Discard Components":"liminer les composants","Discard Reason":"Raison du rejet","Discard Reason already exists.":"La raison du rejet existe dj.","Discard Stock":"Supprimer le stock",Discarded:"Rejet","Discarding...":"Supprimant...","Discards Summary Report":"Rapport sommaire des rejets","Dispatch From":"Distribu de","Dispatch Note":"Bordereau d'envoi","Dispatch Order":"Expdition de la commande","Dispatch Type":"Type de Distribution",Dispatched:"Envoy","Dispatched From":"Expdi de","Dispatched To":"Envoy ","Distribution Center":"Centre de distribution","Distribution Site":"Site de distribution","Distribution Sites":"Sites de distribution","Division Level":"Niveau de division","Do not bleed donor":"Ne pas prlver le donneur",Donation:"Don","Donation Batch Info":"Information sur les lots de dons","Donation Batch Report":"Rapport de lot de don","Donation Batch Status":"Statut du lot de dons","Donation Date":"Date du don","Donation Field":"Rubrique du Don","Donation Field Affected":"Rubrique du Don","Donation Field Value":"Valeur de la Rubrique du Don","Donation Information":"Informations du Don","Donation Notes":"Notes sur le Don","Donation Period":"Priode du Don","Donation Type":"Type de Don","Donation Types Report":"Rapport des Types de Don","Donation batch":"Lot du Don","Donation type already exists.":"Le type de don existe dj.",Donations:"Dons","Donations Collected By Type Report":"Rapport des Dons Collects par Type",Done:"Termin","Donor Address Merge":"Adresse Combine du Donneur","Donor Assessment":"valuation du Donneur","Donor Clinic":"Clinique du Donneur","Donor Contact Merge":"Informations de Contact Combines du Donneur","Donor Counselling":"Traitement du Donneur","Donor Deferrals Review":"Examen des Reports du Donneur","Donor Donations Review":"Examen des Dons du Donneur","Donor Merging":"Combinaison du Donneur","Donor Notes":"Notes sur le Donneur","Donor Number":"Numro du Donneur","Donor Overview Merge":"Aperu Combin du Donneur","Donor Registration Blocked - No Open Donation Batches":"Inscription du Donneur Bloque - Pas de Lot de Don Disponible","Donors Adverse Events Summary Report":"Rsum du Rapport dEffets Indsirables du Don","Donors Deferred Summary Report":"Rsum du Rapport des Donneurs Ajourns","Donors List":"Liste de Donneurs","Downloading...":"Tlchargement...",Dr:"Dr","Due To Donate":"Donn Le","Due to Expire By":"Prime le","Duplicate Donors":"Double Donneurs",Edit:"Modifier","Edit Adverse Event Type":"Modifier le Type dvnement Dfavorable",Eligibility:"ligibilit",Eligible:"ligible","Eligible Donors: {{numberEligibleDonors}} out of {{totalDonors}} ({{percentage}}%)":"Donneurs ligibles: {{numberEligibleDonors}} sur {{totalDonors}} ({{percentage}}%)","Eligible donor":"Donneur ligible",Email:"E-mail",Enabled:"Activ",End:"Fin","End Date":"Date de Fin","End Deferral":"Fin du Report","End date can't be before deferral date":"La date de fin ne peut pas tre situe avant la date de report","End time should be after Start time":"La date de fin doit tre situe aprs la date de Dbut",Enter:"Entrer","Enter a valid temperature":"Insrer une temprature valide","Enter a valid time":"Entrez une heure valide","Enter password":"Entrez un mot de passe",Entity:"Entit","Error merging the duplicate Donors.":"Erreur lors de la fusion des donneurs doublons.",Expired:"Prim","Expires After":"Prime aprs le","Expiry Status":"Statut de lExpiration","Export All Data":"Exporter Toutes les Donnes","Export Data":"Exporter des Donnes","Export donors, donations, deferrals, post-donation counselling, test outcomes, and components datasets. The data will be downloaded as a compressed zip file containing a separate CSV file for each dataset.":"Exporte les groupes de donnes des donneurs, des dons, des ajournements, de lassistance post-don, des rsultats des tests, et des composants sanguins. Les donnes seront tlcharges sous forme de fichier zip compress contenant un fichier CSV spar pour chaque groupe de donnes",Fail:"chec",February:"Fvrier",Female:"Fminin","Filter data":"Filtrer les donnes","Final Review":"Examen Final","Find Components":"Trouver des Composants","Find Discards":"Trouver des Rejets","Find Donor":"Trouver un Donneur","Find Inventory":"Trouver lInventaire","Find Safe Components":"Trouver des Composants Srs","Find Safe Components to Label":"Trouver des Composants Srs  tiqueter","Find Test Samples":"Trouver les Echantillons  Tester","Find Transfusions":"Trouver des Transfusions",Finish:"Terminer",First:"Prnom","First Name":"Prnom","Flagged for Counselling":"Identifi pour un Traitement","Forgot password":"Mot de passe oubli","Fulfil Order Form":"Remplir le Formulaire de Commande",Gap:"cart",Gender:"Genre","General Configurations":"Configurations Gnrales",Group:"Groupe",HOME:"ACCUEIL",Hb:"Hb","Hide test outcomes":"Cacher les Rsultats des Tests",Historical:"Historique","Historical Data Entry":"Entre de Donnes Historiques",Home:"Accueil","Hospital / Clinic":"Hpital / Clinique",INVENTORY:"INVENTAIRE",Identifier:"Identifiant","In Active Use":"Sous Utilisation Active","In Stock":"En Stock","Include Donors That Have Been Referred":"Inclure les Donneurs Ayant t Ajourns","Include Donors That Have Not Been Referred":"Inclure les Donneurs NAyant Pas t Ajourns","Include Similar Results":"Inclure les Rsultats Similaires",Indeterminate:"Indtermin","Ineligible Donor":"Donneur non-ligible",Integer:"Entier",Invalid:"Invalide","Invalid Component":"Composant Invalide","Invalid DIN range":"Intervalle DIN invalide","Invalid Username / Password":"Nom dUtilisateur/Mot de Passe invalide","Invalid boolean value":"Valeur boolenne invalide","Invalid date":"Date invalide","Invalid decimal value":"Valeur dcimale invalide","Invalid donor":"Donneur invalide","Invalid email address":"Adresse mail invalide","Invalid input":"Entre invalide","Invalid integer value":"Valeur entire invalide","Invalid number of decimal digits":"Nombre de chiffres dcimaux invalide","Invalid value":"Valeur invalide",Inventory:"Inventaire","Inventory Status":"Statut de lInventaire",Issue:"Dlivrance",Issued:"Distribu",January:"Janvier",July:"Juillet",June:"Juin",LABELLING:"ETIQUETAGE","Label Components":"Etiqueter les Composants","Label Verification for {{componentCode}}":"Vrification de ltiquette pour {{componentCode}}",Language:"Langue",Last:"Nom de Famille","Last Name":"Nom de Famille","Last Updated":"Dernire Mise  Jour",Level:"Niveau","List of donors for post donation counselling":"Liste de Donneurs pour le soutien post-don","Loading details failed. Please try refreshing":"Le chargement des dtails a chou. Veuillez essayer d'actualiser",Location:"Emplacement","Location Type":"Type d'emplacement","Location is not a venue or there is already an open donation batch for that venue":"L'emplacement n'est pas une salle, ou il y a dj un lot de dons ouvert pour cette salle","Location name already exists":"Le nom de lemplacement existe dj","Log in":"Connexion","Log out":"Dconnexion","Look Up":"Rechercher","Low Pack Weight":"Faible Poids de Paquet","Low Volume Weight":"Faible Volume","MANAGE COMPONENTS":"GRER LES COMPOSANTS","MANAGE DISCARDS":"GRER LES REJETS","MANAGE INVENTORY":"GRER LINVENTAIRE","MANAGE TESTING":"GRER LES TESTS","MOBILE CLINIC":"CLINIQUE MOBILE",Male:"Masculin","Manage Account and System Settings":"Grer les Paramtres du Systme","Manage Adverse Event Types":"Grer les Types dEffets Indsirables du Don","Manage Blood Bank Inventory, Requests, Transfers and Issues":"Grer lInventaire, les Requtes, les Transferts et les Livraisons de la Banque de Sang","Manage Blood Test":"Grer lAnalyse de Sang","Manage Blood Testing Rule":"Grer les Rgles dAnalyse de Sang","Manage Blood Testing Rules":"Grer les Rgles dAnalyse de Sang","Manage Blood Tests":"Grer les Analyses de Sang","Manage Component Combination":"Grer la Combinaison de Composants","Manage Component Combinations":"Grer les Combinaisons de Composants","Manage Component Type":"Grer le Type de Composant","Manage Component Types":"Grer les Types de Composants","Manage Configuration":"Grer la Configuration","Manage Deferral":"Grer lAjournement","Manage Deferral Reason":"Grer la Raison de Report","Manage Deferral Reasons":"Grer les Raisons dAjournement","Manage Discard Reason":"Grer la Raison de Rejet","Manage Discard Reasons":"Grer les Raisons de Rejet","Manage Division":"Grer la Division","Manage Divisions":"Grer les Divisions","Manage Donation Batch":"Grer le Lot de Dons","Manage Donation Batches":"Grer les Lots de Dons","Manage Donation Type":"Grer le Type de Dons","Manage Donation Types":"Grer les Types de Dons","Manage Donor Records, Donation Batches and Donor Communications":"Grer les Enregistrements des Donneurs, les Lots de Dons et les Communications aux Donneurs","Manage Donors":"Grer les Donneurs","Manage Location":"Grer lEmplacement","Manage Locations":"Grer les Emplacements","Manage Mobile Clinics and Sync Data":"Grer les Cliniques Mobiles et Synchroniser les Donnes","Manage Order":"Grer la Commande","Manage Orders":"Grer les Commandes","Manage Pack Type":"Grer le Type de Paquet","Manage Pack Types":"Grer les Types de Poches","Manage Return":"Grer le Retour","Manage Returns":"Grer les Retours","Manage Role":"Grer le Rle","Manage Roles":"Grer les Rles","Manage TTI and Blood Group Serology Testing":"Grer les Tests des ITT et de Srologie des Groupes Sanguins","Manage Test Batch":"Grer le Lot de Tests","Manage Test Batches":"Grer les Lots de Test","Manage Transfusion Reaction Type":"Grer le Type de Ractions Post-Transfusion","Manage Transfusion Reaction Types":"Grer les Types de Ractions Transfusionnelles","Manage User":"Grer lUtilisateur","Manage Users":"Grer les Utilisateurs",March:"Mars","Mark Component Containing Plasma as Unsafe for Positive Test Outcomes":"Marquer un Composant Contenant du Plasma comme Non Sr pour des Rsultats de Tests Positifs","Mark Component as Unsafe for Positive Test Outcomes":"Marquer un Composant comme Non Sr pour des Rsultats de Tests Positifs",Match:"Faire Correspondre","Max bleed time":"Temps de saignement","Max bleed time should be between 0 and 60 mins":"Le temps de saignement maximum devrait tre entre 0 et 60 minutes","Max time since donation":"Temps maximal depuis le dernier don","Max time since donation should be between 0 and 30 hours":"Le temps maximum depuis le dernier don devrait tre entre 0 et 30 heures","Maximum Weight":"Poids maximum",May:"Mai",Merge:"Combiner",Middle:"Deuxime Prnom","Minimum Weight":"Poids Minimum","Mobile Clinic":"Clinique Mobile","Mobile Clinic Export":"Exporter une Clinique Mobile","Mobile Clinic Look Up":"Rechercher une Clinique Mobile","Mobile Number":"Numro de Mobile",Modified:"Modifi","Modify password":"Modifier le Mot de Passe",Month:"Mois","More than one component returned for given component Type. Please enter a component code":"Plus dun Composant Renvoy pour le Type de Composant Donn. Veuillez entrer un code de Composant",Mr:"M",Mrs:"Mme",Ms:"Melle","Must match the previous entry":"Doit Correspondre  lEntre Prcdente",N:"N",NTD:"NTD",Name:"Nom","Negative Outcomes":"Rsultats Ngatifs","New Donation Batch":"Nouveau Lot de Dons","New Password":"Nouveau Mot de Passe","New Test Batch":"Nouveau Lot de Tests","New password":"Nouveau Mot de Passe",Next:"Suivant",No:"Non","No Blood Group":"Aucun Groupe Sanguin","No Deferrals Found":"Aucun Report Trouv","No Deferrals found":"Aucun report trouv","No Donations found":"Aucun Don trouv","No Match":"Aucune Correspondance","No Previous Donations":"Aucun don antrieur","No Type Determined":"Aucun Type Dtermin","No closed donation batches":"Aucun Lot de Dons Ferms","No closed test batches.":"Aucun lot de tests ferm.","No components for donation":"Aucun Composant pour le don","No components found":"Aucun Composant trouv","No components with the specified component type exist for the specified Donation":"Aucun Composant du type spcifi n'existe pour le don spcifi","No current deferrals":"Aucun ajournement en cours","No data for date range selected":"Aucune date pour la plage de dates slectionne","No donors found":"Aucun Report Trouv","No duplicate donors found":"Aucun double donneur trouv","No open donation batches":"Aucun lot de dons ouvert","No open test batches.":"Aucun lot de tests ouvert.",None:"Aucun","None of the above":"Aucun de ceux ci-dessus","Not Done":"Non Termin","Not Eligible":"Non ligible","Not In Stock":"Pas en Stock","Not Labelled":"Non tiquet","Not Specified":"Non Spcifi","Not Transfused":"Non Transfus","Not applicable":"Non Applicable","Not found. Please re-enter DIN or select a different component type":"Aucun rsultat. Veuillez r-entrer le DIN ou slectionner un type de composant diffrent","Not found. Please re-enter DIN.":"Aucun rsultat. Veuillez r-entrer le DIN.","Not in Stock":"Pas en Stock",Notes:"Notes",November:"Novembre","Num Boxes":"Nom. Conteneurs","Num Initial Components":"Nom. Initial de Composants","Number of Blood Transport Boxes":"Nombre de Conteneurs de Transport de Sang","Number of Donations":"Nombre de Dons","Number of Samples":"Nombre dchantillons","Number of Samples Ready for Release":"Nombre dchantillons Prts  tre Utiliss","Number of Samples Released":"Nombre dchantillons Utiliss","Number of Samples: {{sampleNumber}}":"Nombre dchantillons: {{sampleNumber}}","Number of components: {{componentNumber}}":"Nombre de Composants: {{componentNumber}}","Number of duplicates":"Nombre de doublons","Number of entities":"Nombre d'entits","Number of forms: {{count}}":"Nombre de formulaires: {{count}}","Number of processing sites: {{sitesNumber}}":"Nombre de sites de traitement: {{sitesNumber}}","Number of venues: {{venuesNumber}}":"Nombre de salles: {{venuesNumber}}",OK:"OK",October:"Octobre",Open:"Ouvert","Open Batches":"Lots ouverts","Order Date":"Date de Commande","Order Status":"Statut de la Commande","Order Type":"Type de la Commande",Ordered:"Command",Outcome:"Rsultat",Overview:"Aperu","Overweight Child Packs":"Paquets pour Enfant en Surpoids","Overweight Pack":"Paquet en Surpoids",PDF:"PDF","POST DONATION":"POST-DON",Pack:"Poche","Pack Label DIN":"tiquette DIN de la poche","Pack Type":"Type de Poche","Pack Type Update":"Mise  jour du type de paquet","Pack Type name already exists.":"Ce nom de Type de Paquet existe dj.","Pack Weight Update":"Mise  jour du Poids du paquet","Page {{currentPage}} of {{pageCount}}":"Page {{currentPage}} sur {{pageCount}}",Parent:"Parent","Parent Division":"Division Parente","Parent division levels cannot be changed":"Les niveaux de divisions parentes ne peuvent pas tre modifis",Pass:"Passe",Password:"Mot de passe","Password reset failed. Please make sure that you have entered the correct username and try again":"La rinitialisation du mot de passe a chou. Veuillez vous assurer que vous avez entr le bon nom d'utilisateur, et recommencez","Patient Details":"Informations sur le patient","Patient Name":"Nom du patient","Patient Number":"Numro du patient","Patient Request":"Requte du patient","Patient Requests":"Requtes du patient","Pending Tests":"Tests en attente","Pending: TTI repeat and/or confirmatory test outcomes.":"En attente: Rsultats de tests de confirmation et/ou rpts ITT.","Pending: ambiguous blood group serology test outcomes.":"En attente: Rsultats ambigus de tests de srologies de groupes sanguins.","Pending: blood group serology repeat test outcomes.":"En attente: Rsultats de tests rpts de srologies de groupes sanguins.",Period:"Priode","Period between donations":"Priode entre deux dons",Permanent:"Permanent","Permanently deferred":"Report de faon permanente",Permissions:"Permissions","Please choose at least one location type":"Veuillez choisir au moins un type d'emplacement","Please complete all of the required fields":"Veuillez remplir tous les champs requis","Please enter a valid identifier":"Veuillez entrer un identifiant valide","Please enter a value above {{minValue}}":"Veuillez entrer une valeur au-dessus de {{minValue}}","Please enter a value below {{maxValue}}":"Veuillez entrer une valeur en-dessous de {{maxValue}}","Please provide valid inputs":"Veuillez entrer des donnes valides","Please resolve all discrepancies between initial and re-rentered outcomes before saving the form.":"Veuillez rsoudre toutes les disparits entre les rsultats initiaux et re-rentrs avant d'enregistrer le formulaire.","Please select a dispatch type":"Veuillez slectionner un type d'envoi","Please select at least one permission":"Veuillez slectionner au moins une permission","Please select at least one role":"Veuillez slectionner au moins un rle","Please select at least two donors.":"Veuillez slectionner au moins deux donneurs.","Please select one":"Veuillez en slectionner un","Please select the correct donor information below":"Veuillez slectionner les bonnes informations de donneurs ci-dessous","Please supply a valid donor":"Veuillez entrer un donneur valide","Please supply all fields":"Veuillez remplir tous les champs",
"Positive Outcomes":"Rsultats positifs",Postal:"Bote Postale","Powered by":"Aliment Par","Preferred Address Type":"Type dAdresse Prfr","Preferred Contact Type":"Type de Contact Prfr","Preferred Language":"Langue Prfre","Preparation Info":"Infos de Prparation","Previous ABO/Rh":"ABO/Rh Prcdent","Previous Donation":"Don Prcdent","Print Delivery Note":"Imprimer un bon de Livraison","Print Discard Label":"Imprimer une tiquette de Rejet","Print Dispatch Note":"Imprimer un bon de livraison","Print Donor Barcode":"Imprimer le Code-Barre du Donneur","Print Pack Label":"Imprimer ltiquette du Paquet","Print Return Note":"Imprimer un bon de Retour",Process:"Prpar","Process Component":"Traiter le Composant","Process labelled component":"Traiter le Composant tiquet",Processed:"Prpar","Processing Date":"Date de Traitement","Processing Site":"Site de Prparation","Processing site":"Site de Prparation","Processing...":"Traitement en cours...","Produced Component(s)":"Composant(s) produit(s)",Prof:"Prof",Pulse:"Pouls",Quarantined:"Quarantaine",R:"R",REPORTS:"RAPPORTS","Rank in Category":"Rang dans la Catgorie","Re-Enter":"Re-Entrer","Re-Enter ABO/Rh Outcomes":"R-entrez les Rsultats ABO/Rh","Re-Enter TTI Outcomes":"R-entrez les Rsultats TTI","Re-entry completed for {{reEntriesConfirmed}} of {{totalReEntries}} outcomes.":"R-Entres termines pour {{reEntriesConfirmed}} rsultats sur {{totalReEntries}}.","Re-entry required for {{reEntriesNotConfirmed}} of {{totalReEntries}} outcomes.":"R-Entres requises pour {{reEntriesNotConfirmed}} rsultats sur {{totalReEntries}}.","Re-scan Pack Label":"Re-scanner une tiquette de Paquet",Reason:"Raison","Receive Components":"Rception des Composants","Received Counselling":"Thrapie Reu","Record ABO/Rh Outcomes":"Enregistrement des Rsultats ABO/Rh","Record Components":"Enregistrement des Composants","Record Confirmatory TTI Outcomes":"Enregistrement des Rsultats de Confirmation TTI","Record Repeat ABO/Rh Outcomes":"Enregistrement des Rsultats Rpts ABO/Rh","Record Repeat TTI Outcomes":"Enregistrement des Rsultats Rpts TTI","Record Return":"Enregistrement des Retours","Record TTI Outcomes":"Enregistrement des Rsultats TTI","Record Transfusions":"Enregistrement des Transfusions","Referral Site":"Site de Rfrence",Referred:"Rfrence","Refused Counselling":"Thrapie Refus",Release:"Libration",Released:"Valid",Remove:"Retirer","Remove Blood Test":"Retirer lAnalyse de Sang","Remove Outcome":"Retirer un Rsultat","Remove Pack":"Retirer un Paquet","Remove Source Component":"Retirer un Composant de Source","Remove Test Sample(s)":"Retirer chantillon(s) du Test","Remove Unit":"Retirer un Composant de Source","Remove from negative or positive outcomes first":"Retirer des rsultats positifs ou ngatifs en premier",Removed:"Retir","Removing...":"Retirant...",Reopen:"R-ouvrir","Reopen Batch":"R-ouvrir un Lot","Repeat ABO/Rh Outcomes":"Rpter les Rsultats ABO/Rh","Repeat TTI Outcomes":"Rpter les Rsultats ITT","Reset Password":"Rinitialiser le mot de passe","Reset password":"Rinitialiser le mot de passe","Resetting...":"Rinitialisation...",Resolve:"Rsoudre","Resolve Ambiguous ABO/Rh Outcomes":"Rsoudre les rsultats ambigus dABO/Rh",Resolved:"Rsolu","Return Date":"Date de Retour","Return Note":"Bon de Retour","Return Status":"Statut de Retour","Return to Stock":"Renvoyer au Stock",Returned:"Renvoy","Returned From":"Renvoy De","Returned To":"Renvoy A","Review the deferrals for the merged donor":"Examiner les Reports pour le donneur combin","Review the donations for the merged donor":"Examiner les dons pour le donneur combin","Revision type":"Type de rvision",Rh:"Rh","Role name already exists":"Le nom du rle existe dj",Roles:"Rles",SETTINGS:"PARAMETRES",Safe:"Sr","Safe components":"Composants Srs","Same as Home":"De Mme qu la Maison","Sample Released":"chantillon Utilis",Save:"Enregistrer","Save test outcomes":"Enregistrer les Rsultats des Tests","Saving...":"Enregistrement...",Search:"Rechercher","Searching...":"Recherche...",Select:"Slectionnez","Select Donors to Merge":"Slectionnez des Donneurs  Combiner","Select a component to process":"Slectionnez un Composant  prparer","Select a date range that is less than one month":"Slectionnez une plage de dates de moins d'un mois","Select a donation batch":"Slectionnez un lot de dons","Select a processing site":"Slectionnez un site de Prparation","Select a valid date":"Slectionnez une date valide","Select components to discard or undiscard":"Slectionnez des Composants  rejeter ou rcuprer aprs un rejet","Select one or more":"Slectionnez un ou plusieurs","Selected Component cannot be discarded until component batch received":"Le composant slectionn ne peut pas tre rejet avant la rception du lot de composants","Selected Component cannot be processed until component batch received":"Le composant slectionn ne peut pas tre trait avant la rception du lot de composants","Selected component cannot be discarded or undiscarded":"Le composant slectionn ne peut pas tre rejet ou rcupr","Selected component cannot be processed further":"Le composant slectionn ne peut pas tre encore trait",September:"Septembre","Set Password":"Choisir un Mot de Passe","Set a New Password":"Choisir un nouveau mot de passe","Short Name":"Nom abrg","Show test outcomes":"Afficher les Rsultats des Tests",Site:"Site","Source Component Option(s)":"Option(s) de Sources de Composants","Specific Gravity":"Gravit Spcifique",Start:"Dbut","Start Date":"Date de dbut","Start and end times are the same: please re-enter":"Les dates de dbut et de fin sont les mmes: veuillez les r-entrer","Start date must be before the end date":"La date de dbut doit se situer avant la date de fin",Status:"Statut","Step {{step}} of {{totalsteps}}":"tape {{step}} sur {{totalsteps}}","Stock Levels":"Niveaux de Stock","Storage Info":"Informations de Stockage",TESTING:"TESTS EN COURS",TTI:"ITT","TTI Outcomes":"Rsultats ITT","TTI Prevalence Report":"Rapport des Prvalences des ITT","TTI Status":"Statut ITT","TTI Unsafe or Incomplete":"TTI non sr ou incomplet",Temperature:"Temprature",Test:"Test","Test Batch Outcomes Summary Report":"Rapport Rsum des Rsultats du Lot de Tests","Test Batch Outcomes Summary Report - Blood Typing Issues and Tests Outstanding":"Rapport Rsum des Rsultats du Lot de Tests - Problmes de Types de Sang et Tests En Suspens","Test Batch Outcomes Summary Report - TTI Unsafe and Tests Outstanding":"Rapport Rsum des Rsultats du Lot de Tests - TTI Non Sr et Tests En Suspens","Test Name":"Nom du Test","Test Name (Short)":"Nom du Test (abrg)","Test Outcome":"Rsultat du Test","Test Sample Produced":"Echantillon pour le Test","Test Samples":"chantillons du Test","Test outcomes have been recorded for one or more samples. Removing these from the test batch will clear all outcomes for those samples. Are you sure you want to continue?":"Les rsultats du test ont t rorganiss pour un ou plusieurs chantillons. Le fait de les retirer du lot de test effacera tous les rsultats pour ces chantillons. tes-vous sur de vouloir continuer?","Tested On":"Test le",Testing:"Test en cours","Testing Date":"Date de Test","Testing Site":"Site de Test",Text:"Texte","That page is not accessible - you have been redirected to the home page.":"Cette page n'est pas accessible - vous avez t redirig vers laccueil.","The pack type has been updated - this will affect the initial components created with this donation. Do you want to continue?":"Le type de paquet a t mis  jour, cela affectera les composants initiaux crs avec ce don. Voulez-vous continuer?","The pack weight ({{componentWeight}}g) is above the maximum acceptable range ({{packTypeWeight}}g). Components from this donation will be flagged as unsafe. Do you want to continue?":"Le poids du paquet ({{componentWeight}}g) est au-dessus de la plage maximum acceptable ({{packTypeWeight}}g). Les composants de ce don seront marqus comme non srs. Voulez-vous continuer?","The pack weight ({{componentWeight}}g) is below the minimum acceptable range ({{packTypeWeight}}g). Components from this donation will be flagged as unsafe. Do you want to continue?":"Le poids du paquet ({componentWeight}}g) est au-dessous de la plage minimum acceptable ({{packTypeWeight}}g). Les composants de ce don seront marqus comme non srs. Voulez-vous continuer?","The pack weight ({{componentWeight}}g) is low (below {{packTypeWeight}}g). All components from this donation containing plasma will be flagged as Unsafe. Do you want to continue?":"Le poids du paquet ({{componentWeight}}g) est bas (en-dessous de {{packTypeWeight}}g). Les composants de ce don contenant du plasma seront marqus comme non srs. Voulez-vous continuer?","The pack weight has changed from an underweight or overweight value to one within the acceptable range. Components from this donation will no longer be flagged as unsafe as a result of the pack weight. Do you want to continue?":"Le poids du paquet est pass d'une valeur de sous-poids ou de sur-poids  une valeur acceptable. Les composants de ce don ne seront plus marqus comme non srs  cause d'un poids non acceptable. Voulez-vous continuer?","The same barcode has been scanned twice: please re-scan":"Le mme code-barre a t scann deux fois: veuillez re-scanner","The selected component has already been labelled. Do you want to continue?":"Le composant slectionn a dj t tiquet. Voulez-vous continuer?","The selected donors do not have the same blood group. If you continue, the merged donor will not be assigned a blood group, and will be considered a first time donor.":"Les donneurs slectionns ne disposent pas du mme groupe sanguin. Si vous continuez, le donneur combin n'aura pas de groupe sanguin lui tant assign, et sera considr comme un premier donneur.","There is another donation with the same donation identification number":"Il y a un autre don avec le mme DIN","There is no component in ISSUED state for specified DIN and component code":"Il ny a pas de composant dans ltat LIVR pour le code de composant et le DIN spcifis","There is no component in ISSUED state for specified DIN and component type":"Il ny a pas de composant dans ltat LIVR pour le type de composant et le DIN","This cannot be empty":"Ce champ ne peut pas tre vide","This component cannot be labelled - please check the status of the donor and donation":"Ce Composant ne peut pas tre tiquet - veuillez vrifier le statut du donneur et du don","This donor is below the minimum age of {{minAge}}":"Ce donneur est en-dessous de lge minimum de {{minAge}}","This donor is not eligible to donate. Components for this donation will be flagged as unsafe. Do you want to continue?":"Ce donneur nest pas ligible  un don. Les composants de ce don seront marqus comme non srs. Voulez-vous continuer?","This donor is over the maximum age of {{maxAge}}":"Ce donneur est au-dessus de lge maximum de {{maxAge}}","This export may take some time and can affect the performance of the system. It is recommended that this process is only run after standard operating hours, to minimise the impact on other activities.":"Cette exportation peut prendre du temps et pourrait affecter les performances du systme. Il est recommand de lancer ce processus aprs les horaires standard d'utilisation, pour minimiser l'impact sur les autres activits.","This export may take some time if run for all venues and can affect the performance of the system. It is recommended that this export is only run after standard operating hours, to minimise impact on other activities.":"Cette exportation peut prendre du temps si elle est lance sur tous les Postes de Prlvements et pourrait affecter les performances du systme. Il est recommand de lancer cette exportation aprs les horaires standard d'utilisation, pour minimiser l'impact sur les autres activits.","This form is not valid":"Ce formulaire est invalide","This is required":"Ce champ est requis","This must be a number":"Ce champ doit contenir un nombre","This must be unique":"Ce champ doit tre unique","This test batch is ready to be closed.":"Ce lot de test est prt  tre ferm.","This test batch is ready to be released.":"Ce lot de test est prt  tre utilis.",Time:"Heure","Time of Delivery":"Heure de Livraison","Time since Donation or Bleed Time exceeded":"La priode depuis le don ou la dure de saignement ont t dpasses","Time since donation exceeded, the following components will be flagged as unsafe: {{components}}.":"La priode depuis le don a t dpasse, les Composants suivants seront marqus comme non-srs: {{components}}.",Title:"Titre",To:"","Toggle navigation":"Activer la navigation","Too large":"Trop gros","Too long":"Trop long","Too short":"Trop court","Too small":"Trop petit",Total:"Total","Total Adverse Events":"Total Effets Indsirables","Total All Venues":"Total de Salles","Total Blood Units":"Total dUnits de Sang","Total Donations":"Total de Dons","Total Not Transfused":"Total de Non-Transfuss","Total Reactions":"Total de Ractions","Total Transfused Uneventfully":"Total de Transfuss Sans vnements","Total Units: {{total}}":"Total dUnits: {{total}}","Total Unknown":"Total Inconnu","Total donations":"Total de dons","Total donors":"Total de donneurs","Total donors: {{total}}":"Total de donneurs: {{total}}","Total {{recordsName}}: {{totalRecords}}":"Total de {{recordsName}}:  {{totalRecords}}",Transfer:"Transfert",Transfused:"Transfus","Transfused On":"Transfus Le","Transfused Uneventfully":"Transfus sans Accidents","Transfusion Notes":"Notes de Transfusion","Transfusion Outcome":"Rsultat de la Transfusion","Transfusion Reaction Occurred":"Raction Aprs La Transfusion","Transfusion Reaction Type":"Type de Raction  La Transfusion","Transfusion Site":"Site de Transfusion","Transfusions Summary Report":"Rsum du Rapport de Transfusions","Transport Info":"Infos de Transport",Type:"Type","Unable to establish a connection. Please report this issue and try again later":"Impossible d'tablir une connexion.  Veuillez rapporter ce problme et ressayer plus tard","Underweight Pack":"Paquet en sous-poids",Undiscard:"Rcuprer","Undiscard Components":"Rcuprer les Composants","Undiscarding...":"Rcupration...",Units:"Units","Units Ordered":"Units Commandes","Units Returned":"Units Renvoyes","Units Supplied":"Units Fournies",Unknown:"Inconnu",Unprocess:"D-Traiter","Unprocess Component":"D-Traiter un Composant","Unprocessing this component will cause all components that were produced from it to be deleted. Do you want to continue?":"D-Traiter ce Composant fera que tous les Composants issus de celui-ci seront supprims. Voulez-vous continuer?","Unprocessing...":"D-Traitement...",Unsafe:"Non Sr","Updating details failed. Please try again":"La mise  jour des dtails a chou. Veuillez ressayer","Usage Site":"Site dUtilisation","Usage Sites: {{count}}":"Sites dUtilisation: {{count}}",User:"Utilisateur",Username:"Nom dutilisateur","Username already exists":"Ce Nom dUtilisateur existe dj","Username invalid. Use only alphanumeric characters, underscore (_), hyphen (-), and period (.)":"Nom dUtilisateur invalide. Utilisez seulement des caractres alphanumriques, des tirets bas (_), des traits d'union (-) et des points (.)","Valid Outcomes":"Nom de lUtilisateur",Value:"Valeur",Venue:"Poste de Prlvement",Venues:"Postes de Prlvements",Verify:"Vrifier","Verifying...":"Vrification...","Version: {{backendVersion}} / {{frontEndVersion}}":"Version: {{backendVersion}} / {{frontEndVersion}}",View:"Afficher","View / Export Donor List":"Afficher / Exporter la Liste de Donneurs","View Audit Log":"Afficher le Journal dAudit","View Charts and Export Reports":"Afficher les Graphiques et Exporter les Rapports","View Delivery Forms":"Afficher les Formulaires de Livraison","View Orders":"Afficher les Commandes","View Returns":"Afficher les Retours","View Stock Levels":"Afficher les Niveaux de Stock","View Summary":"Afficher un Rsum","View Test Sample":"Afficher les chantillons  tester",Void:"Supprimer","Void Deferral":"Annuler un Report","Void Order":"Annuler une Commande","Void Return":"Annuler un Retour","Void Tranfusion":"Annuler une Transfusion","Voiding...":"Annulation...","Ward Number":"Numro du Service",Weight:"Poids","Welcome to BSIS - The Blood Safety Information System":"Bienvenue sur BSIS - Le Systme dInformation de Scurit du Sang",Work:"Travail",Wt:"Pds",Y:"Y",Year:"Anne",Yes:"Oui","You have logged in with a recovery password. Please set a new password before you continue.":"Vous vous tes connect grce  un mot de passe de rcupration. Veuillez choisir un nouveau mot de passe avant de continuer.","You need to provide a username":"Vous devez fournir un nom dutilisateur","Your details were successfully updated":"Vos dtails ont t mis  jour","Your password has been reset. Please check your email for the new password":"Votre mot de passe a t rinitialis. Veuillez consulter votre bote mail pour obtenir votre nouveau mot de passe",days:"jours",donations:"dons","false":"faux",hours:"heure",minutes:"minutes",sites:"sites",to:"a","true":"vrai",venues:"salles","{{count}} Blood Test(s) found":"{{count}} Test(s) sanguin(s) identifi(s)","{{count}} Blood Testing Rule(s) found":"{{count}} Rgle(s) de test sanguin trouve(s)","{{count}} Component Combination(s) found":"{{count}} Diffrent(s) Composant(s) identifi(s)","{{count}} Component Type(s) found":"{{count}} Type(s) de composant trouv(s)","{{count}} Division(s) found":"{{count}} Division(s) trouve(s)","{{count}} Location(s) found":"{{count}} emplacement(s) trouv(s)","{{count}} adverse event type(s) found":"{{count}} Type(s) deffets secondaires identifi(s)","{{count}} component(s) found":"{{count}} composant(s) trouv(s)","{{count}} configuration(s) found":"{{count}} configuration(s) trouve(s)","{{count}} day(s)":"{{count}} Jour(s)","{{count}} day(s) to expire":"{{count}} jour(s) restant avant expiration","{{count}} deferral reason(s) found":"{{count}} motif(s) de report identifie(s)","{{count}} discard reason(s) found":"{{count}} la(les) raison(s) de rejet trouve(s)","{{count}} donation type(s) found":"{{count}} type de don(s) identifis","{{count}} donor(s) found":"{{count}} donneur(s) identifi(s)","{{count}} of {{total}}":"{{count}} sur {{total}}","{{count}} of {{total}} samples will be released, the remaining samples require discrepancies to be resolved. Once you release these samples you will no longer be able to add DINs to this batch. Are you sure that you want to release this test batch?":"{{count}} du {{total}} des chantillons qui seront librs, les chantillons restants ont des anomalies  rsoudre. tes-vous sr de vouloir librer ce lot de test?","{{count}} of {{total}} samples will be released. Once you release these samples you will no longer be able to add DINs to this batch. Are you sure that you want to release this test batch?":"{{count}} du {{total}} des chantillons qui seront librs, les chantillons restants ont des anomalies  rsoudre. tes-vous sr de vouloir librer ce lot de test?","{{count}} pack type(s) found":"{{count}} types de poche(s) identifie(s)","{{count}} role(s) found":"{{count}} rle(s) identifie(s)","{{count}} sample(s) found":"{{count}} chantillon(s) identifie(s)","{{count}} site(s) found":"{{count}} site(s) identifi(s)","{{count}} transfusion reaction type(s) found":"{{count}} raction(s) transfusionnelle(s) trouve(s)","{{count}} user(s) found":"{{count}} utilisateur(s) identifie(s)","{{count}} venue(s) found":"{{count}} emplacement(s) identifi(s)","{{dinsAdded}} out of {{dinsToAdd}} sample(s) in the range were added to the test batch. {{testBatch.dinsInOtherTestBatches.length}} belonged to another test batch and {{testBatch.dinsWithoutTestSamples.length}} didn't produce test samples and {{testBatch.dinsInOpenDonationanBatch.length}} belonged to an open Donation Batch.":"{{dinsAdded}} sur {{dinsToAdd}} chantillon(s) de la squence tait(ent) ajout(s) au lot de tests. {{testBatch.dinsInOtherTestBatches.length}} appartenait(ent)  un autre lot de tests et {{testBatch.dinsWithoutTestSamples.length}} navait(ent) pas dchantillons de test et {{testBatch.dinsInOpenDonationanBatch.length}} appartenait(ent)  un lot de dons ouvert.","{{duplicateCount}} possible duplicate donors identified.":"{{duplicateCount}} possibles de donneurs en double identifis.","{{duplicateDonorCount}} set(s) of duplicate donors found.":"{{duplicateDonorCount}} ensemble(s) de donneurs en double trouvs.","{{formNumber}} form(s) found":"{{formNumber}} formulaire(s) trouv(s)","{{fromDate}} to {{toDate}}":"{{fromDate}}  {{toDate}}","{{startTime}} to {{endTime}}":"{{startTime}}  {{endTime}}","{{total}} donation(s) in batch":"{{total}} don(s) dans le lot"})}]);